= 第 1 步：关闭受损节点
:allow-uri-read: 


您可以对存储系统支持的所有ONTAP版本使用此过程。

.开始之前
* 您必须准备好更换部件。
* 确保存储系统中的所有其他组件均正常运行；否则、请联系技术支持。




== 第 1 步：关闭受损节点

关闭或接管受损控制器。

要关闭受损控制器，您必须确定控制器的状态，并在必要时执行控制器的存储故障转移接管，以便健康的控制器继续从受损控制器存储提供数据。

.关于此任务
* 如果您的集群具有四个以上的节点，则它必须达到法定人数。要查看有关节点的集群信息，请使用 `cluster show`命令。有关 `cluster show`命令，请参阅link:https://docs.netapp.com/us-en/ontap/system-admin/display-nodes-cluster-task.html["查看ONTAP集群中的节点级详细信息"^]。
* 如果集群不处于法定人数，或者任何控制器（受损控制器除外）的健康状况或资格显示为错误，则必须在关闭受损控制器之前纠正该问题。看link:https://docs.netapp.com/us-en/ontap/system-admin/synchronize-node-cluster-task.html?q=Quorum["将节点与集群同步"^] 。


.步骤
. 如果启用了AutoSupport 、则通过调用AutoSupport 消息禁止自动创建案例：
+
`system node autosupport invoke -node * -type all -message MAINT=<# of hours>h`

+
以下AutoSupport 消息禁止自动创建案例两小时：

+
`cluster1:> system node autosupport invoke -node * -type all -message MAINT=2h`

. 从受损控制器的控制台禁用自动交还：
+
`storage failover modify -node impaired-node -auto-giveback-of false`

+

NOTE: 当您看到“您想禁用自动回馈吗？”时，请输入 `y`。

+
.. 如果您运行的是ONTAP版本 9.17.1，并且受损控制器无法启动或已被接管，则必须先从正常控制器断开 HA 互连链路，然后再启动受损控制器。这可以防止受损控制器执行自动交还。
+
`system ha interconnect link off -node healthy-node -link 0`

+
`system ha interconnect link off -node healthy-node -link 1`

+

NOTE: 如果您运行的不是ONTAP版本 9.17.1，请跳过上述步骤并转到步骤 3。



. 将受损控制器显示为 LOADER 提示符：
+
[cols="1,2"]
|===
| 如果受损控制器显示 ... | 那么 ... 


 a| 
LOADER 提示符
 a| 
转至下一步。



 a| 
系统提示符或密码提示符
 a| 
从健康控制器接管或停止受损控制器：
`storage failover takeover -ofnode _impaired_node_name_ -halt _true_`

_-halt true_ 参数将受损节点带入 LOADER 提示符。

|===




== 第2步：更换发生故障的I/O模块

要更换I/O模块、请在机箱中找到该模块、然后按照特定步骤顺序进行操作。

. 如果您尚未接地，请正确接地。
. 拔下目标 I/O 模块上的所有布线。
+

NOTE: 确保标记电缆连接的位置，以便在重新安装模块时将它们连接到正确的端口。

. 向下旋转缆线管理托架、方法是拉动缆线管理托架内侧两侧的按钮、然后向下旋转托架。
+

NOTE: 下图显示了如何卸下水平和垂直I/O模块。通常、您只会卸下一个I/O模块。

+
image:../media/drw_a1k_io_remove_replace_ieops-1382.svg["卸下I/O模块"]

+
[cols="1,4"]
|===


 a| 
image:../media/icon_round_1.png["标注编号1"]
 a| 
I/O凸轮闩锁

|===
+
请确保为这些缆线贴上标签，以便您知道这些缆线来自何处。

. 从机柜中卸下目标I/O模块：
+
.. 按下目标模块上的凸轮按钮。
.. 将凸轮闩锁尽可能远离模块。
.. 将手指插入凸轮拉杆开口中、然后将模块拉出机箱、从而将模块从机箱中卸下。
+
确保跟踪 I/O 模块所在的插槽。



. 将 I/O 模块放在一旁。
. 将更换用的I/O模块安装到机柜中：
+
.. 将模块与机柜插槽开口的边缘对齐。
.. 将模块轻轻地滑入插槽，直至完全滑入机箱，然后将凸轮闩锁一直向上旋转，以将模块锁定到位。


. 重新连接 I/O 模块。
. 将缆线管理托架向上旋转到关闭位置。




== 第3步：重新启动控制器

更换I/O模块后、必须重新启动控制器。

. 从加载程序提示符处重新启动控制器：
+
`bye`

+

NOTE: 重新启动受损控制器还会重新初始化I/O模块和其他组件。

. 当控制台消息停止时、按<enter>。
+
** 如果您看到_login_提示，请转到下一步。
** 如果您没有看到登录提示，请登录合作伙伴节点。


. 仅返回具有 override-destination-checks 选项的根：
+
`storage failover giveback -ofnode impaired-node -only-root true -override -destination-checks true`

+

NOTE: 以下命令仅在诊断模式权限级别下可用。有关权限级别的更多信息，请参阅link:https://docs.netapp.com/us-en/ontap/system-admin/administrative-privilege-levels-concept.html["了解ONTAP CLI 命令的权限级别"^]。

+
如果遇到错误，请联系 https://support.netapp.com["NetApp 支持"]。

. 在恢复报告完成后等待5分钟、然后检查故障转移状态和恢复状态：
+
`storage failover show`和 `storage failover show-giveback`

+

NOTE: 以下命令仅在诊断模式权限级别下可用。

. 如果 HA 互连链路已断开，请将其恢复：
+
`system ha interconnect link on -node healthy-node -link 0`

+
`system ha interconnect link on -node healthy-node -link 1`

. 如果已禁用自动交还、请重新启用它：
+
`storage failover modify -ofnode impaired-node -automatic-giveback true`

. 通过交还存储使受损控制器恢复正常运行：
+
`storage failover giveback -ofnode _impaired_node_name_`

. 从运行状况良好的控制器的控制台还原自动交还：
+
`storage failover modify -node local -auto-giveback-of true`

. 如果启用了AutoSupport、则还原/取消禁止自动创建案例：
+
`system node autosupport invoke -node * -type all -message MAINT=END`





== 第 4 步：将故障部件退回 NetApp

按照套件随附的 RMA 说明将故障部件退回 NetApp 。 https://mysupport.netapp.com/site/info/rma["部件退回和更换"]有关详细信息、请参见页面。
