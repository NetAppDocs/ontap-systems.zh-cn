= 
:allow-uri-read: 


 `boot_recovery -partner`对于运行ONTAP 9．16.0及更高版本的ASA R2平台、您可以使用从配对节点还原ONTAP映像(启动介质恢复)。

当您启动某个节点且该节点上的启动介质损坏时、您将在Loader提示符处看到以下消息以及启动过程STOP：

....

Can't find primary boot device u0a.0
Can't find backup boot device u0a.1
ACPI RSDP Found at 0x777fe014


Starting AUTOBOOT press Ctrl-C to abort...
Could not load fat://boot0/X86_64/freebsd/image1/kernel:Device not found

ERROR: Error booting OS on: 'boot0' file: fat://boot0/X86_64/Linux/image1/vmlinuz (boot0,fat)


ERROR: Error booting OS on: 'boot0' file: fat://boot0/X86_64/freebsd/image1/kernel (boot0,fat)


Autoboot of PRIMARY image failed. Device not found (-6)
LOADER-A>
....
如果您看到此消息、则必须还原ONTAP映像。

.步骤
. 在Loader提示符处、输入_boot_recovery -Partner_命令。
+
屏幕将显示消息 `Starting boot media recovery (BMR) process press Ctrl-C to abort...`、并开始初始检查和安装启动恢复文件。

+
.. 如果配置了外部密钥管理器(EKM)、则会显示以下内容：
+
....
Error when fetching key manager config from partner 169.254.139.209: 28
Has key manager been configured on this system? {y|n}
....
.. 如果已配置密钥管理器、请输入_y_。
+
....
key manager is configured.
Entering Bootmenu Option 11...
....


+
Bootmenu选项11将提示用户输入所有EKM配置信息、以便可以重建配置文件。

. 在每个提示符处输入EKM配置。
+
*注：*大多数此信息是在最初启用EMM时输入的。您应输入在初始EMM配置期间输入的相同信息。

. 检查 `Keystore UUID`和是否 `Cluster UUID`正确。
+
.. 在配对节点上、使用 `cluster identity show`命令检索集群UUID。
.. 在配对节点上、使用 `vserver show -type admin`命令和 `key-manager keystore show -vserver <nodename>`命令检索密钥库UUID。
.. 出现提示时、输入密钥库UUID和集群UUID的值。
+
*注意：*如果配对节点不可用、则可以从已配置密钥服务器上的Mroot-AK密钥获取密钥库UUID和集群UUID。

+
验证 `x-NETAPP-ClusterName: <cluster name>`集群UUID和 `x-NETAPP-KeyUsage: "MROOT-AK"`密钥库UUID属性的、以确保您具有正确的密钥。



. 监控Mroot-AK在ONTAP节点中的检索和还原情况。
. 如果此过程无法还原密钥、您将看到以下消息、需要从菜单系统Shell配置e0M：
+
....
ERROR: kmip_init: halting this system with encrypted mroot...
WARNING: kmip_init: authentication keys might not be available.
********************************************************
*                 A T T E N T I O N                    *
*                                                      *
*       System cannot connect to key managers.         *
*                                                      *
********************************************************
ERROR: kmip_init: halting this system with encrypted mroot...
.
Terminated

Uptime: 11m32s
System halting...

LOADER-B>

....
+
..  `boot_recovery -partner`在恢复节点上运行命令。
.. 当系统提示您执行(y或n) EMM选项时、选择_n_表示全部。
+
为8个提示选择_n_选项后、系统将在启动菜单处停止。

.. 从其他集群节点收集/cfcard/kmip/servers.cfg文件信息。您将收集以下信息：
+
*** KMIP服务器地址。
*** KMIP端口。
*** 密钥库UUID。
*** /cfcard/kmip/certs/client.crt文件中的客户端证书副本。
*** /cfcard/kmip/certs client.key文件中的客户端密钥副本。
*** /cfcard/kmip/certs /CA.pm文件中的KMIP服务器CA副本。


.. 在提示符处输入_systemshell_、从启动菜单输入systemshell。
.. 从systemshell菜单中为e0M、网络掩码和网关配置网络。
.. 使用_exit_命令退出菜单systemshell。
.. 您将看到启动菜单。选择选项 `11`以继续EMM还原。
.. 回答 `y`以下问题、并在出现提示时输入您之前收集的所需信息：
+
*** 是否有/cfcard/kmip/certs/client.crt文件的副本？｛y/n｝
*** 是否有/cfcard/kmip/certs / client.key文件的副本？｛y/n｝
*** 是否有/cfcard/kmip/certs文件的副本？｛y/n｝
*** 是否有/cfcard/kmip/servers.cfg文件的副本？｛y/n｝




. 如果密钥已正确还原、则恢复过程将继续并重新启动节点。

