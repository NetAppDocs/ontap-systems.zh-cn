---
permalink: c80/nvram-replace.html 
sidebar: sidebar 
keywords: c80, replace an nvdimm 
summary: 'NVRAM模块由NVRAM12和DIMM以及每个NVRAM模块最多两个NVMe SSD闪存模块(Flash Cache或缓存模块)组成。' 
---
= 更换NVRAM - AFF C80
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
当非易失性内存出现故障或需要升级时、请更换AFF C80系统中的NVRAM。更换过程包括关闭受损控制器、更换NVRAM模块或NVRAM DIMM、重新分配磁盘以及将故障部件返回给NetApp。

使用以下相应选项更换NVRAM模块或NVRAM DIMM。

[role="tabbed-block"]
====
.选项1：更换NVRAM模块
--
要更换NVRAM模块、请在机箱的插槽4/5中找到该模块、然后按照特定步骤顺序进行操作。

. 使用拇指推动每个驱动器、直至感觉到强制停止、以确保机箱中的所有驱动器都牢固地固定在中板上。
+
image::../media/drw_a800_drive_seated_IEOPS-960.svg[安装磁盘驱动器]

. 转至机箱背面。如果您尚未接地，请正确接地。
. 如果您尚未接地，请正确接地。
. 拔下控制器的 PSU。
+

NOTE: 如果您的系统使用直流电源、请断开电源块与PSU的连接。

. 向下旋转缆线管理托架、方法是拉动缆线管理托架内部的按钮、然后向下旋转。
. 从机箱中删除目标 NVRAM 模块：
+
.. 按下凸轮闩锁按钮。
+
凸轮按钮离开机箱。

.. 将凸轮闩锁旋转到最远位置。
.. 从机箱中卸下受损NVRAM模块、方法是将手指插入凸轮拉杆开口并将模块拉出机箱。
+
image::../media/drw_a70-90_nvram12_remove_replace_ieops-1370.svg[卸下NVRAM12模块和DIMM]

+
[cols="1,4"]
|===


 a| 
image:../media/icon_round_1.png["标注编号1"]
 a| 
凸轮锁定按钮



 a| 
image:../media/icon_round_2.png["标注编号2"]
 a| 
DIMM锁定卡舌

|===


. 将NVRAM模块放在稳定的表面上。
. 从受损NVRAM模块中逐一卸下DIMM、然后将其安装到更换用的NVRAM模块中。
. 将更换用的 NVRAM 模块安装到机箱中：
+
.. 将模块与插槽4/5中机箱开口的边缘对齐。
.. 将模块轻轻滑入插槽中、然后将凸轮闩锁一直向上推、以将模块锁定到位。


. 将电源线插入电源。一旦电源恢复，控制器就会重新启动。
+

NOTE: 如果您有直流电源，请将电源块重新连接到电源。

. 将缆线管理托架向上旋转到关闭位置。
. 通过交还存储使受损控制器恢复正常运行： `storage failover giveback -ofnode _impaired_node_name_`。
. 如果已禁用自动交还，请重新启用它： `storage failover modify -node local -auto-giveback true`。
. 如果启用了AutoSupport，则还原/取消禁止自动创建案例： `system node autosupport invoke -node * -type all -message MAINT=END`。


--
.选项2：更换NVRAM DIMM
--
要更换NVRAM模块中的NVRAM DIMM、必须先卸下NVRAM模块、然后再更换目标DIMM。

. 使用拇指推动每个驱动器、直至感觉到强制停止、以确保机箱中的所有驱动器都牢固地固定在中板上。
+
image::../media/drw_a800_drive_seated_IEOPS-960.svg[安装磁盘驱动器]

. 转至机箱背面。如果您尚未接地，请正确接地。
. 拔下控制器的 PSU。
+

NOTE: 如果您的系统使用直流电源、请断开电源块与PSU的连接。

. 轻轻拉动缆线管理托架两端的插销并向下旋转托架、向下旋转该托架。
. 从机箱中删除目标 NVRAM 模块：
+
.. 按下凸轮按钮。
+
凸轮按钮离开机箱。

.. 将凸轮闩锁旋转到最远位置。
.. 从机箱中卸下NVRAM模块、方法是将手指插入凸轮拉杆开口并将模块拉出机箱。
+
image::../media/drw_a70-90_nvram12_remove_replace_ieops-1370.svg[卸下NVRAM12模块和DIMM]

+
[cols="1,4"]
|===


 a| 
image:../media/icon_round_1.png["标注编号1"]
| 凸轮锁定按钮 


 a| 
image:../media/icon_round_2.png["标注编号2"]
 a| 
DIMM锁定卡舌

|===


. 将NVRAM模块放在稳定的表面上。
. 找到NVRAM模块内要更换的DIMM。
+

NOTE: 请参阅NVRAM模块侧面的FRU示意图标签、以确定DIMM插槽1和2的位置。

. 向下按DIMM锁定卡舌并将DIMM从插槽中提出、以卸下DIMM。
. 安装更换用的 DIMM ，方法是将 DIMM 与插槽对齐，然后将 DIMM 轻轻推入插槽，直到锁定卡舌锁定到位。
. 将 NVRAM 模块安装到机箱中：
+
.. 将模块轻轻滑入插槽、直到凸轮闩锁开始与I/O凸轮销啮合、然后一直向上旋转凸轮闩锁以将模块锁定到位。


. 将电源线插入电源。一旦电源恢复，控制器就会重新启动。
+

NOTE: 如果您有直流电源，请将电源块重新连接到电源。

. 将缆线管理托架向上旋转到关闭位置。
. 通过交还存储使受损控制器恢复正常运行： `storage failover giveback -ofnode _impaired_node_name_`。
. 如果已禁用自动交还，请重新启用它： `storage failover modify -node local -auto-giveback true`。
. 如果启用了AutoSupport，则还原/取消禁止自动创建案例： `system node autosupport invoke -node * -type all -message MAINT=END`。


--
====


== Step 3: Reassign disks

您必须在启动控制器时确认系统ID更改、然后验证是否已实施此更改。


CAUTION: 只有在更换NVRAM模块时才需要重新分配磁盘、而不适用于NVRAM DIMM更换。

.步骤
. 如果控制器处于维护模式（显示 `*>`提示符），退出维护模式并进入 LOADER 提示符：
+
`halt`

. 从控制器上的加载程序提示符处、启动控制器、并在系统因系统ID不匹配而提示覆盖系统ID时输入_y_。
. 等到更换模块的控制器控制台上显示等待交还消息，然后从健康的控制器验证是否已自动分配新的合作伙伴系统 ID：
+
`storage failover show`

+
在命令输出中，您应该看到一条消息，表明受损控制器上的系统 ID 已更改，并显示正确的旧 ID 和新 ID。在以下示例中，节点 2 已完成替换，并具有新的系统 ID 151759706。

+
[listing]
----
node1:> storage failover show
                                    Takeover
Node              Partner           Possible     State Description
------------      ------------      --------     -------------------------------------
node1             node2             false        System ID changed on partner (Old:
                                                  151759755, New: 151759706), In takeover
node2             node1             -            Waiting for giveback (HA mailboxes)
----
. 交还控制器：
+
.. 从健康的控制器中，归还被替换的控制器的存储空间：+
`storage failover giveback -ofnode replacement_node_name`
+
控制器将收回其存储并完成启动。

+
如果由于系统ID不匹配而提示您覆盖系统ID、则应输入_y_。

+
如果交还被否决，您可以考虑覆盖此否决。

+
有关详细信息，请参阅 https://docs.netapp.com/us-en/ontap/high-availability/ha_manual_giveback.html#if-giveback-is-interrupted["手动交还命令"^]推翻否决。

.. 完成交还后、确认HA对运行状况良好且可以进行接管：_storage Failover show_
+
`storage failover show` 命令的输出不应包含 System ID changed on partner 消息。



. 验证磁盘是否已正确分配：
+
`storage disk show -ownership`

+
属于控制器的磁盘应显示新的系统ID。在以下示例中、node1拥有的磁盘现在显示新的系统ID 151759706：

+
[listing]
----
node1:> storage disk show -ownership

Disk  Aggregate Home  Owner  DR Home  Home ID    Owner ID  DR Home ID Reserver  Pool
----- ------    ----- ------ -------- -------    -------    -------  ---------  ---
1.0.0  aggr0_1  node1 node1  -        151759706  151759706  -       151759706 Pool0
1.0.1  aggr0_1  node1 node1           151759706  151759706  -       151759706 Pool0
.
.
.
----
. 如果系统采用MetroCluster配置、请监控控制器的状态：_nnode show_ MetroCluster
+
在更换后， MetroCluster 配置需要几分钟才能恢复到正常状态，此时，每个控制器将显示已配置状态，并启用 DR 镜像并显示正常模式。The `metrocluster node show -fields node-systemid` command output displays the old system ID until the MetroCluster configuration returns to a normal state.

. 如果控制器采用 MetroCluster 配置，则根据 MetroCluster 状态，如果原始所有者是灾难站点上的控制器，请验证 DR 主 ID 字段是否显示磁盘的原始所有者。
+
如果同时满足以下条件，则必须执行此操作：

+
** MetroCluster 配置处于切换状态。
** 控制器是灾难站点上磁盘的当前所有者。
+
请参见 https://docs.netapp.com/us-en/ontap-metrocluster/manage/concept_understanding_mcc_data_protection_and_disaster_recovery.html#disk-ownership-changes-during-ha-takeover-and-metrocluster-switchover-in-a-four-node-metrocluster-configuration["在四节点 MetroCluster 配置中，磁盘所有权会在 HA 接管和 MetroCluster 切换期间发生更改"] 有关详细信息 ...



. 如果您的系统采用MetroCluster配置、请验证是否已配置每个控制器：_nnode MetroCluster show - fields configure-state_
+
[listing]
----
node1_siteA::> metrocluster node show -fields configuration-state

dr-group-id            cluster node           configuration-state
-----------            ---------------------- -------------- -------------------
1 node1_siteA          node1mcc-001           configured
1 node1_siteA          node1mcc-002           configured
1 node1_siteB          node1mcc-003           configured
1 node1_siteB          node1mcc-004           configured

4 entries were displayed.
----
. 验证每个控制器是否存在预期的卷：
+
`vol show -node node-name`

. 如果启用了存储加密、则必须还原功能。
. 通过交还存储使受损控制器恢复正常运行：
+
`storage failover giveback -ofnode _impaired_node_name_`(英文)

. 如果已禁用自动交还、请重新启用它：
+
`storage failover modify -node local -auto-giveback true`(英文)

. 如果启用了AutoSupport、则还原/取消禁止自动创建案例：
+
`system node autosupport invoke -node * -type all -message MAINT=END`(英文)


