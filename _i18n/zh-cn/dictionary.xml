<?xml version="1.0" encoding="UTF-8"?>
<blocks>
  <block id="6a537092418b1517855bd9bd8a6c8418" category="summary">您必须在机架中安装 node4 ，将 node2 连接传输到 node4 ，启动 node4 并安装 ONTAP 。</block>
  <block id="1a02fe8fc6a186319dd3345573fc3717" category="doc">安装并启动节点 4.</block>
  <block id="75586863c552442d574a9bbfc3a0d408" category="paragraph">您必须在机架中安装 node4 ，将 node2 的连接传输到 node4 ，启动 node4 并安装 ONTAP 。然后，您必须重新分配 node2 的任何备用磁盘，属于根卷的任何磁盘以及在此过程前面未重新定位到 node3 的任何非根聚合，如本节所述。</block>
  <block id="5f190baddba85177825d174bc2428bc9" category="paragraph">重新定位操作在此阶段开始时暂停。此过程大部分是自动完成的；操作将暂停，以便您可以检查其状态。您必须手动恢复此操作。</block>
  <block id="550ffaa7219faf74146770514db0d8e8" category="inline-link-macro">准备网络启动</block>
  <block id="cdb3662e6ecd47991de3008672ab3eb8" category="paragraph">如果 node4 的 ONTAP 9 版本与 node2 上安装的版本不同，则需要对其进行网络启动。安装 node4 后，从 Web 服务器上存储的 ONTAP 9 映像启动它。然后，您可以按照中的说明将正确的文件下载到启动介质设备，以供后续系统启动 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block>。</block>
  <block id="7a262cb0d3d917313c8ba12f996fe83c" category="list-title">重要</block>
  <block id="89023b09a8e04215547178052eb90222" category="inline-link-macro">在节点 4 上配置 FC 端口</block>
  <block id="113dd8c6d49d13f5871e1cbe53350eb2" category="inline-link-macro">检查并配置 node4 上的 UTA/UTA2 端口</block>
  <block id="6f4a225b29c0975663d0e4b9e1f4547f" category="inline-xref">第 1 步</block>
  <block id="2f5ad93b7f0dd7bdcdf63542c05e8ebe" category="inline-xref">第 21 步</block>
  <block id="f775037aa1f7a8a52b5159236f7449e7" category="inline-xref">第 23 步</block>
  <block id="09702fca7923997e0da2187b92badbd9" category="list-text">如果要升级连接到存储阵列的 V 系列系统或安装了 FlexArray 虚拟化软件并连接到存储阵列的系统，则必须完成升级 <block ref="72a284a0ab19d0d6976ab9f3aa1bfc65" category="inline-xref-macro-rx"></block> 到 <block ref="e953da376eb12d20ff3d04f195189ba7" category="inline-xref-macro-rx"></block>，然后退出本节并按照说明进行操作 <block ref="1d789633b45165b05bf13f9838060fe6" category="inline-link-macro-rx"></block> 和到 <block ref="15e1611f6cc2b64b7163cc152446c8c0" category="inline-link-macro-rx"></block>，在维护模式下输入命令。然后，您必须返回到此部分并继续使用 <block ref="7d33d698028361a6b46f35be2a3ff5a2" category="inline-xref-macro-rx"></block>。</block>
  <block id="df5267f8e4bbfa9add1dd732e6b68e41" category="inline-link-macro">在 node4 上设置 FC 或 UTA/UTA2 配置</block>
  <block id="ed722a5ba6799c1f65d4b9716575b170" category="list-text">但是，如果要升级具有存储磁盘的系统，则必须完成整个部分，然后继续 <block ref="a6d322e902b744ff3a11f02b5c6d9496" category="inline-link-macro-rx"></block>，在集群提示符处输入命令。</block>
  <block id="f3a29486bed19a90f2da6d007818b427" category="list-title">步骤</block>
  <block id="c7009662ac7e20dc02b0e7d7e2ed8804" category="list-text">【 auto_install4_step1]] 确保 node4 具有足够的机架空间。</block>
  <block id="82952c70726b36a56f0651368cd2be05" category="paragraph">如果 node4 与 node2 位于不同的机箱中，则可以将 node4 与 node3 放在同一位置。如果 node2 和 node4 位于同一机箱中，则 node4 已位于其相应的机架位置。</block>
  <block id="9ef9fab932162728d06bbfd2862c33d9" category="list-text">按照节点型号的 _Installation and Setup Instructions_中 的说明，在机架中安装 node4 。</block>
  <block id="179ba8fe173567627d42a1a9fc1e6948" category="list-text">为节点 4 布线，将连接从节点 2 移至节点 4 。</block>
  <block id="bdd991003eebd5e12bd133ce301ddb3e" category="paragraph">按照 node4 平台的 _Installation and Setup Instructions_or the _FlexArray 虚拟化安装要求和参考 _ 中的说明，相应的磁盘架指南和 _RAID ONTAP 9 高可用性配置指南 _ 为以下连接布线。</block>
  <block id="d95867deadfe690e40f42068d6b59df8" category="inline-link-macro">参考资料</block>
  <block id="ce7a84a20f408b054d3cd646b0c0eb5b" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Microsoft FlexArray 虚拟化安装要求和参考 _ 和 _ONTAP 9 高可用性配置指南 _ 。</block>
  <block id="7c37472309a8c54b0891c8e95190096e" category="list-text">控制台（远程管理端口）</block>
  <block id="f0012d7dc9fbefbb11bb69cd6932aef8" category="list-text">集群端口</block>
  <block id="b2d2606b76cd5df666c2b6a0f4bfc496" category="list-text">数据端口</block>
  <block id="f35c347c4cb65015138a4d291827b1a1" category="list-text">集群和节点管理端口</block>
  <block id="8c4aa541ee911e8d80451ef8cc304806" category="list-text">存储</block>
  <block id="e6627a49532995a915815645abe1e3bc" category="list-text">SAN 配置： iSCSI 以太网和 FC 交换机端口</block>
  <block id="0046d599de2c63ac6aee024be099994d" category="admonition">您可能不需要将互连卡 /FC-VI 卡或互连 /FC-VI 缆线连接从 node2 移至 node4 ，因为大多数平台型号都具有唯一的互连卡型号。对于 MetroCluster 配置，必须将 FC-VI 缆线连接从 node2 移至 node4 。如果新主机没有 FC-VI 卡，则可能需要移动 FC-VI 卡。</block>
  <block id="8c346c2672eda514d4b912cb897c6c54" category="list-text">打开 node4 的电源，然后在控制台终端按 `Ctrl-C` 以访问启动环境提示符，从而中断启动过程。</block>
  <block id="994bdd0bc026ec99be435de25a9ecc3d" category="admonition">启动 node4 时，您可能会看到以下警告消息：</block>
  <block id="d728df788701a4dbee2b7991f0468dad" category="list-text">如果您在步骤 4 中看到警告消息，请执行以下操作：</block>
  <block id="3e1ef1763b3680d2c8fbf0a8ea19db9b" category="list-text">检查是否存在任何可能指示 NVRAM 电池电量低以外问题的控制台消息，如有必要，请采取任何必要的更正措施。</block>
  <block id="d73910b693432e337843357586f3e39f" category="list-text">让电池充电并完成启动过程。</block>
  <block id="5d043d33743f66f7467bf67aa5653705" category="admonition">* 注意：请勿覆盖延迟；如果不允许电池充电，可能会导致数据丢失。 *</block>
  <block id="b1e6d70b6a993d323936c87bff29461b" category="admonition">请参见 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block>。</block>
  <block id="d583a56b378186283bc180e8dfcdad82" category="list-text">【第 6 步】选择以下操作之一，配置网络启动连接。</block>
  <block id="d1adb867eac5534b9fe3de6b0b271291" category="admonition">您应使用管理端口和 IP 作为网络启动连接。请勿使用数据 LIF IP ，否则在执行升级期间可能会发生数据中断。</block>
  <block id="3a325cd28eedfb6e2a8828a9cc5043a2" category="cell">动态主机配置协议（ DHCP ）</block>
  <block id="c1325f6903ebb5ebb2bb519a73ddb1b0" category="cell">那么 ...</block>
  <block id="5bda814c4aedb126839228f1a3d92f09" category="cell">正在运行</block>
  <block id="aee2adde97afad89c105aeb72e6320b3" category="cell">在启动环境提示符处使用以下命令自动配置连接： `ifconfig e0M -auto`</block>
  <block id="84435c8fed125c1f06699e20bdcee63d" category="cell">未运行</block>
  <block id="de9354e54a4c11f4eec6e3f3a44be9a1" category="cell">在启动环境提示符处输入以下命令以手动配置连接： `ifconfig e0M -addr=&lt;filer_addr&gt; -mask=&lt;netmask&gt; -gw=&lt; 网关 &gt; - DNS=&lt;DNS_addr&gt; domain=&lt;DNS_domain&gt;` ` &lt;filer_addr&gt;` 是存储系统的 IP 地址。` &lt; 网络掩码 &gt;` 是存储系统的网络掩码。` &lt; 网关 &gt;` 是存储系统的网关。` &lt;dns_addr&gt;` 是网络上名称服务器的 IP 地址。此参数是可选的。` &lt;dns_domain&gt;` 是 DNS 域名。此参数是可选的。* 注 * ：接口可能需要其他参数。有关详细信息，请在固件提示符处输入 `help ifconfig` 。</block>
  <block id="15fe98426987c07cba715dffbfb96c7e" category="list-text">对 node4 执行网络启动：</block>
  <block id="0ba2b3e0a887666765eb2d690768c576" category="cell">针对 ...</block>
  <block id="383b9c142d0ac9c95fc6323618a87c9b" category="cell">FAS/AFF8000 系列系统</block>
  <block id="8385f026f91d6fc14fd02b225112bac8" category="cell">`netboot \http://&lt;web_server_ip/path_to_web-accessible_directory&gt;/netboot/kernel`</block>
  <block id="edc91455dc5116cbd53031ff17548c91" category="cell">所有其他系统</block>
  <block id="1e3f57d872237ce4621e377ee8ff6896" category="cell">`netboot \http://&lt;web_server_ip/path_to_web-accessible_directory&gt;/&lt;ontap_version&gt;_image.tgz`</block>
  <block id="17e387f327c3866b0d0ae33451a79635" category="paragraph">` &lt;path_to_the_web-accessible_directory&gt;` 应指向您在本节第 1 步中下载 ` &lt;ontap_version&gt;_image.tgz` 的位置 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block>。</block>
  <block id="85bd8aebb41cb27f7bc364e977313958" category="admonition">请勿中断启动。</block>
  <block id="45b788b600b6973bddaa17d7d85de037" category="list-text">从启动菜单中，选择选项 ` （ 7 ） Install new software first` 。</block>
  <block id="adcfa58e9fef1d45cc4bd403ac68eb9f" category="paragraph">此菜单选项可下载新的 ONTAP 映像并将其安装到启动设备中。</block>
  <block id="161347e221ff82d9edced01f7b383668" category="admonition">请忽略以下消息： `HA 对上的无中断升级不支持此操作步骤` 请注意适用场景无中断升级 ONTAP ，而不是升级控制器。请始终使用 netboot 将新节点更新为所需映像。如果使用其他方法在新控制器上安装映像，则可能安装了错误的映像。此问题描述适用场景所有 ONTAP 版本。</block>
  <block id="0b22fb8d0feec85055f45c8c4a298766" category="list-text">如果系统提示您继续运行操作步骤，请输入 `y` ，并在系统提示您输入软件包时，输入 URL ：</block>
  <block id="84ea00dba7c6a1cf0426e58385307e4f" category="paragraph">` http://&lt;web_server_ip/path_to_web-accessible_directory&gt;/&lt;ontap_version&gt;_image.tgz`</block>
  <block id="7b3f6c26774d36cd594edf297f0f8f57" category="list-text">完成以下子步骤以重新启动控制器模块：</block>
  <block id="7043cc5b7b924f62a8af6f3d2e706c77" category="list-text">出现以下提示时，输入 `n` 以跳过备份恢复：</block>
  <block id="330edabea721cfdb93e4a4aed8cd1730" category="list-text">出现以下提示时，输入 `y` 以重新启动：</block>
  <block id="504d065328326a8677a260e4447bea63" category="paragraph">控制器模块重新启动，但停留在启动菜单处，因为启动设备已重新格式化，并且需要还原配置数据。</block>
  <block id="ca95d6295c1b1cab041926d491fa54ba" category="list-text">从启动菜单中选择维护模式 `5` ，并在系统提示您继续启动时输入 `y` 。</block>
  <block id="bea7673b9c3eda34bfe449c80f92539f" category="list-text">验证控制器和机箱是否已配置为 HA ：</block>
  <block id="70cfb57c22486ea2d08d331675532dce" category="paragraph">`ha-config show`</block>
  <block id="d66825c57ef1d03f12142772b5cb7bae" category="paragraph">以下示例显示了 `ha-config show` 命令的输出：</block>
  <block id="8d88ee8626e30313013b223ba409abaa" category="admonition">系统会在 PROM 中记录它们是采用 HA 对还是独立配置。独立系统或 HA 对中的所有组件的状态都必须相同。</block>
  <block id="55c802ca03b1fc5b58c1d59d28131125" category="list-text">如果控制器和机箱未配置为 HA ，请使用以下命令更正配置：</block>
  <block id="dd974151ca8e1528e09f3e46a090f617" category="paragraph">`ha-config modify controller ha`</block>
  <block id="898e93ac193351b4a5f895216aad0508" category="paragraph">`ha-config modify chassis ha`</block>
  <block id="236df8dd892b4bd6bb01e86747337e6f" category="paragraph">如果您使用的是 MetroCluster 配置，请使用以下命令修改控制器和机箱：</block>
  <block id="911c90c39145c3c3c0d524809f4a16c8" category="paragraph">`ha-config modify controller mcc`</block>
  <block id="1d3bd99dc4d12eba418aa32c0e69ed77" category="paragraph">`ha-config modify chassis mcc`</block>
  <block id="d09b053bad809215bd1c4350481aba44" category="list-text">退出维护模式：</block>
  <block id="819817945fea31f0c3596c841e685904" category="paragraph">`halt`</block>
  <block id="106cd92eb2d2b994c9a8675214fd438c" category="paragraph">在启动环境提示符处按 Ctrl-C 中断自动启动。</block>
  <block id="088efa1f2f879b1cccaa5b548a064885" category="list-text">在 node3 上，检查系统日期，时间和时区：</block>
  <block id="0dbad5b96349237116f63f0f389bd7f4" category="paragraph">`dATE`</block>
  <block id="68dd867f743672fe385fd727b406983a" category="list-text">在 node4 上，在启动环境提示符处使用以下命令检查日期：</block>
  <block id="3e72511c09e554faf49052f79d627689" category="paragraph">`s如何选择日期`</block>
  <block id="10615484104523967682784d6824a536" category="list-text">如有必要，请在 node4 上设置日期：</block>
  <block id="833ce90830a0406f310191c0da1f76da" category="paragraph">`set date &lt;MM/dd/yyy&gt;`</block>
  <block id="aa03f64841cdad6f19ac1550e1ad8c29" category="list-text">在 node4 上，在启动环境提示符处使用以下命令检查时间：</block>
  <block id="667f3a6a11750e110d0c1442d2aa20e7" category="paragraph">`s时间`</block>
  <block id="7651eb09fbac7d811bab7ed026019b25" category="list-text">如有必要，请在 node4 上设置时间：</block>
  <block id="25a249a3cdba620e6eba67639be13589" category="paragraph">`set time &lt;hh ： mm ： ss&gt;`</block>
  <block id="55f472f17ae9bd54337956b780332fff" category="list-text">如有必要，请在 node4 上设置配对系统 ID ：</block>
  <block id="50e811b2a9396215b344a15d01fc1fea" category="paragraph">`setenv partner- sysid &lt;node2_sysid&gt;`</block>
  <block id="e02ed2f754f906507b04045b6d64c6a8" category="list-text">保存设置：</block>
  <block id="4efce637d6ec3bc2a69f403fd39b9b41" category="paragraph">`saveenv`</block>
  <block id="a41540a4727489355ce1dd1fcda58843" category="list-text">在新节点的启动加载程序中，必须设置 `partner- sysid` 参数。对于 node4 ， `partn- sysid` 必须为 node3 。验证 node3 的 `partn- sysid` ：</block>
  <block id="fbe3b6f75f2d8164c601fbd0fdb2d3cd" category="paragraph">`printenv partn- sysid`</block>
  <block id="62ac7cf3796c3e4bbe3285d1976b1c2c" category="list-text">【第 22 步】执行以下操作之一：</block>
  <block id="a566a7773caad8e1452ad7591dace303" category="cell">如果您的系统 ...</block>
  <block id="b0d05d370a8e827d5c1d1e92258a25b2" category="cell">具有磁盘，无后端存储</block>
  <block id="7f3ec1ffd93dbf53956485464c8f29a2" category="cell">转至 <block ref="7d33d698028361a6b46f35be2a3ff5a2" category="inline-xref-macro-rx"></block>。</block>
  <block id="c9d3e45a02f36166b1f2d250fefe0e40" category="cell">是 V 系列系统或已将 FlexArray 虚拟化软件连接到存储阵列的系统</block>
  <block id="d41d8cd98f00b204e9800998ecf8427e" category="doc"></block>
  <block id="6c87f26ede26b8a4600cd3be3a5c4a39" category="list-text">转至第节 <block ref="a6d322e902b744ff3a11f02b5c6d9496" category="inline-link-macro-rx"></block> 并完成本节中的各小节。</block>
  <block id="d4bf40b038a0294c5a0c9cfeacb6b991" category="list-text">返回到此部分，完成从开始的其余步骤 <block ref="7d33d698028361a6b46f35be2a3ff5a2" category="inline-xref-macro-rx"></block>。</block>
  <block id="340156df6d6753b1e8aa84113b4a83e9" category="paragraph">* 重要信息 * ：在使用 FlexArray 虚拟化软件的 V 系列或系统上启动 ONTAP 之前，必须重新配置 FC 板载端口， CNA 板载端口和 CNA 卡。</block>
  <block id="f1f401fda84803d54fb9ed083d0ebefa" category="list-text">【 auto_install4_step23]] 将新节点的 FC 启动程序端口添加到交换机分区。</block>
  <block id="2a1ffcfd9b3fe851dbeca2f509c1f7a3" category="paragraph">如果您的系统具有磁带 SAN ，则需要对启动程序进行分区。如果需要，请参考将板载端口修改为启动程序 <block ref="1d789633b45165b05bf13f9838060fe6" category="inline-link-macro-rx"></block>。有关分区的详细说明，请参见存储阵列和分区文档。</block>
  <block id="626097c557d64952b56d6d6e63d3ad8e" category="list-text">将 FC 启动程序端口作为新主机添加到存储阵列，从而将阵列 LUN 映射到新主机。</block>
  <block id="c90869b8dd8fd41fd210932364a2caf7" category="paragraph">有关说明，请参见存储阵列和分区文档。</block>
  <block id="20285adb42be1ddc0c2df8f7a2de7595" category="list-text">修改与存储阵列上的阵列 LUN 关联的主机或卷组中的全球通用端口名称（ WWPN ）值。</block>
  <block id="a2b95adba38da1a033c4cae3447040cc" category="paragraph">安装新控制器模块会更改与每个板载 FC 端口关联的 WWPN 值。</block>
  <block id="23eacbaf200afc53fbaaaaa3d6705308" category="list-text">如果您的配置使用基于交换机的分区，请调整分区以反映新的 WWPN 值。</block>
  <block id="561611b8a20e2e0f3f7213992d997278" category="list-text">`s步骤 27]] 如果在此配置上使用 NetApp 存储加密（ NSE ），则必须将` etenv bootarg.storageencryption.support `命令设置为` true `，并将 kmip.init.maxwait` `变量设置为` off ，以避免在加载 node2 配置后出现启动环路：</block>
  <block id="0ab3dc62b58693ac60ff9111f9d60a74" category="paragraph">`setenv bootarg.storageencryption.support true`</block>
  <block id="461db791196d5961d2d12d83cd09d8ef" category="paragraph">`setenv kmip.init.maxwait off`</block>
  <block id="d1cffd7fada9f21315c30db304bb2ca9" category="list-text">启动节点进入启动菜单：</block>
  <block id="a94e69437db24dee798bbd90bce4ee0a" category="paragraph">`boot_ontap 菜单`</block>
  <block id="64782ddcc78f95845d4571abdc1d5f5a" category="inline-link-macro">检查并配置 node4 上的 UTA/UTA2 端口，步骤 15</block>
  <block id="f5de4d1593689e91265cc76abd91be3e" category="paragraph">如果您没有 FC 或 UTA/UTA2 配置，请执行 <block ref="65c4c751ac1fc661b74f2a8dfa84d816" category="inline-link-macro-rx"></block> 以便 node4 可以识别 node2 的磁盘。</block>
  <block id="9f6c1c59e595c7b6b493f92b24930c14" category="inline-link-macro">在 node4 上设置 FC 或 UTA/Ut2 配置</block>
  <block id="cbe290335ddc7c966d9c148980b1ddd5" category="list-text">【第 29 步】对于 MetroCluster 配置， V 系列系统以及将 FlexArray 虚拟化软件连接到存储阵列的系统，您必须在 node4 上设置和配置 FC 或 UTA/UTA2 端口，以检测连接到节点的磁盘。要完成此任务，请转至第节 <block ref="39202fc611c1fcac2f1575fc00cb55d3" category="inline-link-macro-rx"></block>。</block>
  <block id="14c464f3076760dd0c7480550e4464d7" category="summary">要停用 node2 ，您需要正确关闭 node2 并将其从机架或机箱中卸下。</block>
  <block id="befd434b83717d2b7bd83967d66e9157" category="doc">停用 node2</block>
  <block id="9da5def37cb93a4b07697531a680892e" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/ru_auto_retif_node2.adoc]]</block>
  <block id="a7dd277c916b5584ac7bfa0e2a0e1091" category="summary">如果使用 NetApp 卷加密（ NVE ）对要升级的系统上的卷进行加密。</block>
  <block id="6d23265c57ba430c404cc6f3a940e117" category="doc">还原 node4 上的 key-manager 配置</block>
  <block id="48ce4ace02a7e66e4a302eb34827e7ee" category="paragraph">如果使用 NetApp 卷加密（ NVE ）对要升级的系统上的卷进行加密，则加密配置必须与新节点同步。从 node2 到 node4 的 node1 聚合的 ARL 完成后，加密卷将脱机。</block>
  <block id="594ac9e04c14065852f0e508c7b91ccb" category="paragraph">执行以下步骤，将加密配置同步到新节点：</block>
  <block id="b58a207eb69ca3cec4fba13daf9dd85a" category="list-text">在集群提示符处使用以下命令同步 OKM 的加密配置：</block>
  <block id="0a83ed732b07426c840d56d0ee6e648b" category="paragraph">`sSecurity key-manager 板载同步`</block>
  <block id="9fe909e2cd822e396eda1b615c821ed1" category="list-text">输入 OKM 的集群范围密码短语。</block>
  <block id="91536c39913bd45a62884969813bb360" category="summary">在将 node2 替换为 node4 之前，必须将 node2 所拥有的非根聚合重新定位到 node3 。</block>
  <block id="43ccb3503988f16a767b1af1e29d2384" category="doc">将非根聚合和 NAS 数据 LIF 从 node2 重新定位到 node3</block>
  <block id="022b6cf9ec195b2e8cda97b2b9718dc0" category="paragraph">从上一阶段完成后检检查后， node2 的资源版本将自动启动。非根聚合和非 SAN 数据 LIF 将从 node2 迁移到 node3 。</block>
  <block id="b3fb9233a2435df292df205ef05e46db" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。升级期间，集群或服务运行状况无需移动 SAN LIF 。</block>
  <block id="93847b1108029ddbe22a512a569d1038" category="paragraph">迁移聚合和 LIF 后，此操作将暂停以进行验证。在此阶段，您必须验证是否所有非根聚合和非 SAN 数据 LIF 都已迁移到 node3 。</block>
  <block id="0569dcac35411678d2e9cbd8034fea69" category="admonition">不会修改聚合和 LIF 的主所有者；只会修改当前所有者。</block>
  <block id="cfe36116ee316c8890acf101b35dc90f" category="list-text">使用以下命令验证所有非根聚合是否已联机及其在 node3 上的状态：</block>
  <block id="83d84f87db7d89ef611cfd94ad7de568" category="paragraph">`storage aggregate show -node node3 -state online -root false`</block>
  <block id="e3f90b559d39f13fadeb0be05f3d5fff" category="paragraph">以下示例显示 node2 上的非根聚合处于联机状态：</block>
  <block id="6702bf0268c295c6d30a4dc2db82d427" category="paragraph">如果 node3 上的聚合脱机或变为外部聚合，请在 node3 上使用以下命令将其联机，每个聚合一次：</block>
  <block id="a4a2e92e7d5cb408d0448b6d08752d5a" category="paragraph">`storage aggregate online -aggregate &lt;aggr_name&gt;`</block>
  <block id="53725b4cb9249d9da8c483a5d9e47db1" category="list-text">在 node3 上使用以下命令并检查其输出，以验证 node3 上的所有卷是否联机：</block>
  <block id="07b749a6316cb9ade087e2a5f4ea8f62" category="paragraph">`volume show -node node3 -state offline`</block>
  <block id="b830851aa263bbc0b84c68604beef993" category="paragraph">如果 node3 上的任何卷脱机，请在 node3 上使用以下命令将其联机，每个卷一次：</block>
  <block id="6dcd6bf9703c1093c3bd05dbdcd04551" category="paragraph">`volume online -vserver &lt;vserver-name&gt; -volume &lt;volume-name&gt;`</block>
  <block id="a3b6690b513bd53e12723fa3f48d8134" category="paragraph">要与此命令结合使用的 ` &lt;vserver-name&gt;` 可在上一个 `volume show` 命令的输出中找到。</block>
  <block id="b8520ff69f6b8ffe5e588c1f7ce8e9be" category="list-text">验证 LIF 是否已移至正确的端口且状态为 `up` 。如果任何 LIF 已关闭，请为每个 LIF 输入以下命令，将 LIF 的管理状态设置为 `up` ：</block>
  <block id="84b1ceedff80bb769606c95da23925bc" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; - lif &lt;LIF_name&gt; -home-node &lt;nodename&gt; - status-admin up`</block>
  <block id="fd8e2fd42f256cad2a3449b8f484fdd3" category="list-text">如果新硬件上不存在当前托管数据 LIF 的端口，请使用以下命令将其从广播域中删除：</block>
  <block id="ee210a0730802d9c055ca601e95c499c" category="paragraph">`network port broadcast-domain remove-ports`</block>
  <block id="6e13fc9d1e75c160461788f1b750083d" category="list-text">使用以下命令并检查输出，以验证 node2 上是否没有剩余数据 LIF ：</block>
  <block id="39711e914bc528c59b5d5e3ec8e9bee0" category="paragraph">`network interface show - curr-node &lt;node2&gt;-role data`</block>
  <block id="de73c7940eaf280bb4c1867652fc7e01" category="summary">要确保设置正确，必须启用 HA 对。</block>
  <block id="1a4d3feb333aa03c1008e54bae47d8e9" category="doc">确保新控制器设置正确</block>
  <block id="bf029ec4ec6e853d0d08bafbb1c50927" category="paragraph">要确保设置正确，必须启用 HA 对。此外，还必须验证 node3 和 node4 是否可以访问彼此的存储，并且它们都不拥有属于集群上其他节点的数据 LIF 。此外，您必须确保 node3 拥有 node1 的聚合， node4 拥有 node2 的聚合，并且两个节点的卷均联机。</block>
  <block id="ca710412a883d1570696f0510733c7a0" category="list-text">在对 node2 执行后检之后，将为 node2 集群启用存储故障转移和集群 HA 对。操作完成后，两个节点均显示为已完成，系统将执行一些清理操作。</block>
  <block id="453f290f327bd6918e7f3e5ad760283a" category="list-text">使用以下命令输入以验证是否已启用存储故障转移：</block>
  <block id="751035e5db88d172e881299c202d9b13" category="paragraph">`s存储故障转移显示`</block>
  <block id="715940e961cf53af2ba53d695b5bdb37" category="paragraph">以下示例显示了启用存储故障转移时命令的输出：</block>
  <block id="9e6e3ee8077a0815c415187bf7e78b19" category="list-text">使用以下命令并检查输出，验证 node3 和 node4 是否属于同一集群：</block>
  <block id="494cb4f7976c64f111b74e9089d5bbd5" category="paragraph">`cluster show`</block>
  <block id="fd3a247231846521133c845ae4c424c0" category="list-text">使用以下命令并检查输出，验证 node3 和 node4 是否可以访问彼此的存储：</block>
  <block id="ca4a5bf327945cfdd4e55b64a87076b5" category="paragraph">`storage failover show -fields local-missing- disks ， partner-missing-disks`</block>
  <block id="ed63866964a059112ba504e1f09aa077" category="list-text">使用以下命令并检查输出，验证 node3 和 node4 均不拥有集群中其他节点拥有的主数据 LIF ：</block>
  <block id="6485b14c0e329aebda0c4dcd7d09dbd0" category="paragraph">`network interface show`</block>
  <block id="a4352e28b13a09b6c13475d7932553c5" category="paragraph">如果 node3 或 node4 都不拥有集群中其他节点拥有的主数据 LIF ，请使用以下命令将数据 LIF 还原到其主所有者：</block>
  <block id="98ab56275ed98fed50530abdb3a97ee7" category="paragraph">`网络接口还原`</block>
  <block id="7ab52e9ec65b0ed9de963e7f463bdd18" category="list-text">使用以下命令验证 node3 是否拥有 node1 中的聚合以及 node4 是否拥有 node2 中的聚合：</block>
  <block id="570743d2305de7bd0a4e44c426b2db21" category="paragraph">`storage aggregate show -owner-name &lt;node3&gt;`</block>
  <block id="75cf0b763a8b4981f23b004d1b96a715" category="paragraph">`storage aggregate show -owner-name &lt;node4&gt;`</block>
  <block id="1406c72ada453b6b280391ec01df7910" category="list-text">使用以下命令确定是否有任何卷脱机：</block>
  <block id="498a7d30e002a0545e05d9bfce9c6fd7" category="paragraph">`volume show -node &lt;node3&gt; -state offline`</block>
  <block id="26391f3798784439b28190a843ccb233" category="paragraph">`volume show -node &lt;node4&gt; -state offline`</block>
  <block id="83b27b00949218cb0d9ec7e1eb1c92ad" category="inline-link-macro">准备要升级的节点</block>
  <block id="7b90e5a79c44186b11106c43fe600ec2" category="list-text">如果任何卷处于脱机状态，请将其与您在部分中捕获的脱机卷列表进行比较 <block ref="94f2dfd916315926f685ba65e48c6e25" category="inline-link-macro-rx"></block>，并根据需要使用以下命令使每个卷的任何脱机卷联机一次：</block>
  <block id="f7d167d02c4419aa4a6731264ec3b0f2" category="paragraph">`volume online -vserver &lt;vserver-name&gt; -volume &lt;volume_name&gt;`</block>
  <block id="8b2ba35c1767c4b484add2236c0ffa6c" category="list-text">对每个节点使用以下命令，为新节点安装新许可证：</block>
  <block id="d68dddaa399afd62872ccc142420c8e8" category="paragraph">`ssystem license add - license-code &lt; 许可证代码，许可证代码，许可证代码 ...&gt;`</block>
  <block id="539b1b58f1be38076506f35eb15e4340" category="paragraph">license-code 参数接受一个包含 28 个大写字母字符密钥的列表。您可以一次添加一个许可证，也可以一次添加多个许可证，并以逗号分隔每个许可证密钥。</block>
  <block id="8fb49e1f692fe82fa4072e7f3b3adc5d" category="list-text">使用以下命令之一从原始节点中删除所有旧许可证：</block>
  <block id="3ce96f90e07aec61f73d0c41634c6aa1" category="paragraph">`ssystem license clean-up -unused -expired`</block>
  <block id="10c0851b91ac12edf49186d6d3d1f9e8" category="paragraph">`ssystem license delete -serial number &lt;node_serial number&gt; -package &lt;licensable_package&gt;`</block>
  <block id="39ae417852cfe60b9d822a0279b0ab54" category="list-text">使用以下命令删除所有已过期的许可证：</block>
  <block id="df1e7bcee84d26ba3ee0e0f129bf90c0" category="paragraph">`ssystem license clean-up -expired`</block>
  <block id="3bf5393fdb78923b044e0b051dee1ce3" category="list-text">使用以下命令删除所有未使用的许可证：</block>
  <block id="32be9f537283877b6e62fd279a4f5513" category="paragraph">`ssystem license clean-up -unused`</block>
  <block id="9501cf64d3b2dae298a8bc24331bd5f4" category="list-text">在节点上使用以下命令从集群中删除特定许可证：</block>
  <block id="799bede4cdc5081180edecafa5450710" category="paragraph">`ssystem license delete -serial number &lt;node1 serial number&gt; -package *`</block>
  <block id="951f07bea4d8173fd07579bfd41784d7" category="paragraph">`ssystem license delete -serial number &lt;node2 serial number&gt; -package *`</block>
  <block id="9a940b51cdd2b2d508cffc6eecff9e32" category="paragraph">此时将显示以下输出：</block>
  <block id="0b0ab53ca7ce0880a8c5c074d260f0ab" category="paragraph">输入 `y` 删除所有软件包。</block>
  <block id="4ce69e9f9d8587e084bc1b7e003695ac" category="list-text">使用以下命令并检查其输出，以验证是否已正确安装许可证：</block>
  <block id="f52d44aaa981f34fa588225f9d4cc820" category="paragraph">`s系统许可证显示`</block>
  <block id="a4ac3d900221761df4ffa0c14d7cf05c" category="paragraph">您可能需要将输出与中捕获的输出进行比较 <block ref="94f2dfd916315926f685ba65e48c6e25" category="inline-link-macro-rx"></block>。</block>
  <block id="9317939b472b78db666295bd5d822d4c" category="list-text">如果在配置中使用了 NetApp 存储加密（ NSE ），并且您将 `setenv bootarg.storageencryption.support` 命令设置为 `true` 并使用 ` &lt;kmip.init.maxwait&gt;` 变量 `off` （步骤 27 中），则需要使用以下命令重置此变量：</block>
  <block id="7595b7bfda3a3ae80ea41390c836acf4" category="paragraph">`set diag ； systemshell -node &lt;nodename&gt; -command sudo kenv -u -p kmip.init.maxwait`</block>
  <block id="83384f48b367d39b20d627f5230807a9" category="list-text">在两个节点上使用以下命令配置 SP ：</block>
  <block id="dde01ffa3dbac07014347a80fbf42f2f" category="paragraph">`ssystem service-processor network modify -node &lt;node_name&gt;`</block>
  <block id="96e2bc47c553dcc4e4a154f6b129069a" category="inline-link-macro">《系统管理参考》</block>
  <block id="112d3c239cd86d18383aedfae5ed632b" category="inline-link-macro">《 ONTAP 9.8 命令：手册页参考》</block>
  <block id="d87938e7e56deeb2324b63cfb0fb5757" category="paragraph">请参见 <block ref="839332b52391f9eb13d4a6fc107f1e56" category="inline-link-macro-rx"></block> 有关 SP 和的信息 <block ref="17d992424ad253bf21fb1a0ceb91e8d4" category="inline-link-macro-rx"></block> 有关 `ssystem service-processor network modify` 命令的详细信息。</block>
  <block id="c3e44bb7c41d54ab04ed9048fc5b39f1" category="list-text">对其中一个新节点执行以下操作：</block>
  <block id="3e5bd7be74c99626dd9c0e9959dfb74f" category="list-text">使用以下命令输入高级权限级别：</block>
  <block id="5fd1bcc8472b38442961eb87ca3f844a" category="paragraph">`set -privilege advanced`</block>
  <block id="6dcd1ebf4390170868ab9bcdfd967581" category="list-text">输入以下命令：</block>
  <block id="1b4358359b751ff53e2d497527507190" category="paragraph">`storage failover modify -node &lt;node_name&gt; - cifs- no-duration default_medium_low`</block>
  <block id="bdaf872fbb56ca73fe6e9dd9a980aba6" category="list-text">如果系统的工作负载的 50% 到 75% 的操作小于 4 KB ，请输入 `medium` 。</block>
  <block id="c347ef9cd4bc7e044fc3d1aa22c41ed4" category="list-text">如果系统的工作负载的 75% 到 100% 的操作小于或小于 4 KB ，请输入 `low` 。</block>
  <block id="c3ad9ea1caccd55758bcc3859594a479" category="list-text">使用以下命令返回到管理员级别：</block>
  <block id="d260c71f1d73fe6dce24fae82cd28aca" category="paragraph">`set -privilege admin`</block>
  <block id="0fbda10a905dbd102127a7a65daf7abd" category="list-text">重新启动系统以确保更改生效。</block>
  <block id="26ee87a1606d284ae34dfd890a86b337" category="list-text">如果要在新节点上设置无交换机集群，请按照 NetApp 支持站点上的 * 过渡到双节点无交换机集群 * 中的说明进行操作。</block>
  <block id="27af4227ca8acc558df96e2723ec9b37" category="inline-link-macro">在新控制器模块上设置存储加密</block>
  <block id="ac616410952c35e808a3c7ce4ea5b4a7" category="inline-link-macro">停用旧系统</block>
  <block id="1f2354221798f71ff84884afad4e486c" category="paragraph">如果在 node3 和 node4 上启用了存储加密，请完成此部分 <block ref="71c3c6e82ac4cdabf6d82d7b484d2163" category="inline-link-macro-rx"></block>。否则，请完成部分 <block ref="8e60bb3917e01e2c0c3fe74628f3291d" category="inline-link-macro-rx"></block>。</block>
  <block id="c5a0fbe5bc52c6bfa986d706834593e6" category="summary">您可以链接到此主题中的其他参考指南和网站。</block>
  <block id="ebbd1e762ddaa937297b0711ae73ad9c" category="paragraph">执行本指南中的过程时，您可能需要参考参考指南或访问参考网站。</block>
  <block id="ca08692e364235f9663a36e097fce11e" category="list-text"><block ref="62c5f0122d8aa83cbe5e5ee0c9a21b4b" category="inline-xref-macro-rx"></block></block>
  <block id="b39850fa882a12596e03ef7779fcfebc" category="list-text"><block ref="5e1bb6d16e6bc7a1d750ae669f510747" category="inline-xref-macro-rx"></block></block>
  <block id="58124051e0ef662b29adaa405eb9b08e" category="section-title">参考指南</block>
  <block id="efe2d7c21a2abcf983f636aa75ba03d6" category="paragraph">下表列出了特定于此升级的文档。</block>
  <block id="0945359809dad1fbf3dea1c95a0da951" category="cell">文档</block>
  <block id="c1df1da7a1ce305a3b60af9d5733ac1d" category="cell">内容</block>
  <block id="a2539e65a13fda0a8ce497ac0baa63a7" category="inline-link-macro">《控制器硬件升级快速指南》</block>
  <block id="cdf7dff00948470baf1757aaf343c1ae" category="cell"><block ref="cdf7dff00948470baf1757aaf343c1ae" category="inline-link-macro-rx"></block></block>
  <block id="2061ab494eae73f1e7251b76a58b27d3" category="cell">介绍如何通过移动存储或卷快速升级集群中的控制器硬件。还介绍如何将受支持的型号转换为磁盘架。</block>
  <block id="b8069555e46b2e92b9debe0ea6434eb5" category="inline-link-macro">《光纤连接的 MetroCluster 安装和配置指南》</block>
  <block id="fbd283f8a9f7651a5ce3e560e81d5264" category="cell"><block ref="fbd283f8a9f7651a5ce3e560e81d5264" category="inline-link-macro-rx"></block></block>
  <block id="5d1afe326f483a14ce8cd69456db1384" category="cell">介绍如何在网络结构配置中安装和配置 MetroCluster 硬件和软件组件。</block>
  <block id="e5c39acdb0f682a22a7b242d48ac3ce5" category="inline-link-macro">《 FlexArray 虚拟化安装要求和参考》</block>
  <block id="925c7487b0025eb7869cfb916154eda3" category="cell"><block ref="925c7487b0025eb7869cfb916154eda3" category="inline-link-macro-rx"></block></block>
  <block id="d1d13e1cdd7f75473f7902868b6ba3d7" category="cell">包含 FlexArray 虚拟化系统的布线说明和其他信息。</block>
  <block id="1025c690847593de32961ac3c15bacbd" category="inline-link-macro">《 MetroCluster 管理和灾难恢复指南》</block>
  <block id="a7741c235a7c165bd3af440939c6e899" category="cell"><block ref="a7741c235a7c165bd3af440939c6e899" category="inline-link-macro-rx"></block></block>
  <block id="34e4a4d5395b895e2a8897ebef238c1a" category="cell">介绍如何在计划内维护操作或发生灾难时执行 MetroCluster 切换和切回操作。</block>
  <block id="240d3868b181a0a12e2128654b07f892" category="inline-link-macro">《 MetroCluster 升级和扩展指南》</block>
  <block id="8b204f52a70b9489a5031692f81ea690" category="cell"><block ref="8b204f52a70b9489a5031692f81ea690" category="inline-link-macro-rx"></block></block>
  <block id="595e15ec8af10c3d959522d0d1eab769" category="cell">介绍升级 MetroCluster 配置中的控制器和存储型号，从 MetroCluster FC 过渡到 MetroCluster IP 配置以及通过添加更多节点扩展 MetroCluster 配置的过程。</block>
  <block id="b42a2144e64bfdf4eecf966f7bb495c5" category="inline-link-macro">《 ONTAP 9.0 命令：手册页参考》</block>
  <block id="a4117daa2ff8204dba8b79ed1da09e5b" category="cell"><block ref="a4117daa2ff8204dba8b79ed1da09e5b" category="inline-link-macro-rx"></block></block>
  <block id="81f65dde1fe71b470218b0fbe6dafc23" category="cell">介绍支持的 ONTAP 9.0 命令的语法和用法。</block>
  <block id="1447526d9bfec11c73a566b23b4f87ab" category="inline-link-macro">《 ONTAP 9.1 命令：手册页参考》</block>
  <block id="3f651f32c2efae31cb0b4da82294b37b" category="cell"><block ref="3f651f32c2efae31cb0b4da82294b37b" category="inline-link-macro-rx"></block></block>
  <block id="d7e58a36d2ecf34ed950099c1e30e349" category="cell">介绍支持的 ONTAP 9.1 命令的语法和用法。</block>
  <block id="25d709d9429cb9179fe81f4343515fa1" category="inline-link-macro">《 ONTAP 9.2 命令：手册页参考》</block>
  <block id="89065c0795a681c066df18ebe55464d3" category="cell"><block ref="89065c0795a681c066df18ebe55464d3" category="inline-link-macro-rx"></block></block>
  <block id="be948fce3cd6e191738619444b30062e" category="cell">介绍支持的 ONTAP 9.2 命令的语法和用法。</block>
  <block id="46490acdb4b495cbc81468a4840d2c5d" category="inline-link-macro">《 ONTAP 9.3 命令：手册页参考》</block>
  <block id="9d087aa4c3e3015b8ac013580c0f90d4" category="cell"><block ref="9d087aa4c3e3015b8ac013580c0f90d4" category="inline-link-macro-rx"></block></block>
  <block id="119362933ed4ef8c2dbccecbb68cc43b" category="cell">介绍支持的 ONTAP 9.3 命令的语法和用法。</block>
  <block id="1aeb70ab3e33d74db4928037aa88a7eb" category="inline-link-macro">《 ONTAP 9.4 命令：手册页参考》</block>
  <block id="8a14044dc26b4cb3bb6448492e70e961" category="cell"><block ref="8a14044dc26b4cb3bb6448492e70e961" category="inline-link-macro-rx"></block></block>
  <block id="929d0856b69565e71fefd5bef5533d93" category="cell">介绍支持的 ONTAP 9.4 命令的语法和用法。</block>
  <block id="6ea3af7ae81e05b625440926c8fcc6ea" category="inline-link-macro">《 ONTAP 9.5 命令：手册页参考》</block>
  <block id="78610e5d700899a0dc146918529c56af" category="cell"><block ref="78610e5d700899a0dc146918529c56af" category="inline-link-macro-rx"></block></block>
  <block id="db0052a2214aa0ca3e4d7e0a79e8d79a" category="cell">介绍支持的 ONTAP 9.5 命令的语法和用法。</block>
  <block id="384be8d232a0ab0b84a145e4bf59bbed" category="inline-link-macro">《 ONTAP 9.6 命令：手册页参考》</block>
  <block id="84d45c7d2db474ca3af465732948fd8d" category="cell"><block ref="84d45c7d2db474ca3af465732948fd8d" category="inline-link-macro-rx"></block></block>
  <block id="7478969542b0a3320dd1f9c09d30231a" category="cell">介绍支持的 ONTAP 9.6 命令的语法和用法。</block>
  <block id="c9aa14f76f0f0a25762ef86776113011" category="inline-link-macro">《 ONTAP 9.7 命令：手册页参考》</block>
  <block id="edcc14f99b45ac8b5b29319da6793eea" category="cell"><block ref="edcc14f99b45ac8b5b29319da6793eea" category="inline-link-macro-rx"></block></block>
  <block id="849578c3a682cf124d61ab2b562aa1fa" category="cell">介绍支持的 ONTAP 9.7 命令的语法和用法。</block>
  <block id="a206ae5c7f29407f29397485796cc31c" category="cell"><block ref="a206ae5c7f29407f29397485796cc31c" category="inline-link-macro-rx"></block></block>
  <block id="c85c87a5f255edc538c88661bb863907" category="cell">介绍支持的 ONTAP 9.8 命令的语法和用法。</block>
  <block id="604e3b21e20d2e3d15be71c643b54e69" category="inline-link-macro">《 ONTAP 9 磁盘和聚合高级指南》</block>
  <block id="508ea01112793b519989beb7d880527a" category="cell"><block ref="508ea01112793b519989beb7d880527a" category="inline-link-macro-rx"></block></block>
  <block id="83fe3ff910eb6889efd118cf192be584" category="cell">介绍如何管理 ONTAP 物理存储，介绍如何创建，扩展和管理聚合，如何使用 Flash Pool 聚合，如何管理磁盘以及如何管理 RAID 策略。</block>
  <block id="3804b132271e47a4db7521e977b43625" category="inline-link-macro">《 ONTAP 9 高可用性配置指南》</block>
  <block id="b3ab554c3d9911985767c939de6affcf" category="cell"><block ref="b3ab554c3d9911985767c939de6affcf" category="inline-link-macro-rx"></block></block>
  <block id="8514bd0cded8da51b71a7aba8599153c" category="cell">介绍如何安装和管理高可用性集群配置，包括存储故障转移和接管 / 交还。</block>
  <block id="0fa0071d4364b9114c15a5d2758f2577" category="inline-link-macro">《 ONTAP 9 逻辑存储管理指南》</block>
  <block id="a37dc8879c3a32509a9a3b2ebd32b7ec" category="cell"><block ref="a37dc8879c3a32509a9a3b2ebd32b7ec" category="inline-link-macro-rx"></block></block>
  <block id="5e4a89e01c551e30f3b547a226c6e59d" category="cell">介绍如何使用卷， FlexClone 卷，文件和 LUN ， FlexCache 卷， 重复数据删除，数据压缩， qtree 和配额。</block>
  <block id="536543b4960352f0462bf234eeb3870a" category="inline-link-macro">《 ONTAP 9 网络管理指南》（ 9.7 及更早版本）</block>
  <block id="dee039af23241dedd9ffcb0cdc5f0846" category="cell"><block ref="dee039af23241dedd9ffcb0cdc5f0846" category="inline-link-macro-rx"></block></block>
  <block id="ed99eca5665640e9b0e3fced8264b368" category="cell">介绍如何在集群中配置和管理物理和虚拟网络端口（ VLAN 和接口组）， LIF ，路由和主机解析服务；如何通过负载平衡优化网络流量；以及如何使用 SNMP 监控集群。</block>
  <block id="31170ccbfb4f57181759032218d5fe88" category="inline-link-macro">《 ONTAP 9 网络管理指南》</block>
  <block id="037e7f41a1db47e22165f7405cc5101f" category="cell"><block ref="037e7f41a1db47e22165f7405cc5101f" category="inline-link-macro-rx"></block></block>
  <block id="1988e9c8cf124cb346a67d52ea613567" category="inline-link-macro">《 ONTAP 9 SAN 管理指南》</block>
  <block id="d6472b75dbafb3a7c21a461e3ea86064" category="cell"><block ref="d6472b75dbafb3a7c21a461e3ea86064" category="inline-link-macro-rx"></block></block>
  <block id="3726fbd47284733606ebde91ad50a7c6" category="cell">介绍如何为 SAN 环境配置和管理 iSCSI 和 FC 协议。</block>
  <block id="9660abd0b48a5f9635c3e498547f1163" category="inline-link-macro">《 ONTAP 9 SAN 配置指南》</block>
  <block id="d7837c4b37e4d9c1b46341d9cbd59a0d" category="cell"><block ref="d7837c4b37e4d9c1b46341d9cbd59a0d" category="inline-link-macro-rx"></block></block>
  <block id="684c05de33c5ed574435c18094046bde" category="cell">包含有关 FC 和 iSCSI 拓扑和布线方案的信息。</block>
  <block id="2a4f547c7b73b569b09f737f8754554f" category="inline-link-macro">《 ONTAP 9 软件设置指南》</block>
  <block id="1975e733c6218d07722af6dcd0c21c73" category="cell"><block ref="1975e733c6218d07722af6dcd0c21c73" category="inline-link-macro-rx"></block></block>
  <block id="ec8a498c0ff432b735ba28247dbb239f" category="cell">介绍如何设置和配置 ONTAP 。</block>
  <block id="dec0306e681fc720cf31bc4851ebcee4" category="inline-link-macro">《 ONTAP 9 系统管理参考》</block>
  <block id="328f22df6c1a5af270e91f1b49d64810" category="cell"><block ref="328f22df6c1a5af270e91f1b49d64810" category="inline-link-macro-rx"></block></block>
  <block id="38f19900a80b03ef2e62f2105ab6323a" category="cell">介绍如何管理 ONTAP 系统，向您展示如何使用命令行界面，如何访问集群，如何管理节点等。</block>
  <block id="ed46df6261cf79571fbaa1f60a71ddce" category="inline-link-macro">《 ONTAP 9 升级和还原 / 降级指南》</block>
  <block id="cbe62d1ac470314d27bd0cc80fb88af8" category="cell"><block ref="cbe62d1ac470314d27bd0cc80fb88af8" category="inline-link-macro-rx"></block></block>
  <block id="25c1844876df2afa3616f32befb014b3" category="cell">包含有关下载和升级 ONTAP 的说明。</block>
  <block id="a7c6ad52ed3d2aeb45a615219b19eb9e" category="inline-link-macro">使用 " 系统控制器更换 " 命令将运行 ONTAP 9.5 的控制器硬件升级到 ONTAP 9.7</block>
  <block id="a7f16d1e8a1ac5d60550034de354dd1b" category="cell"><block ref="a7f16d1e8a1ac5d60550034de354dd1b" category="inline-link-macro-rx"></block></block>
  <block id="76131ba473c7ab8f940b1defa73cba87" category="cell">介绍使用 system controller replace 命令将运行 ONTAP 9.5 的控制器无中断升级到 ONTAP 9.7 所需的聚合重新定位过程。</block>
  <block id="2bad09e43b905b96c969ce2f2e47553c" category="inline-link-macro">使用 " 系统控制器更换 " 命令升级运行 ONTAP 9.8 的控制器硬件</block>
  <block id="748c6c99f6479bbb491c46a149cdfcef" category="cell"><block ref="748c6c99f6479bbb491c46a149cdfcef" category="inline-link-macro-rx"></block></block>
  <block id="62a92c3d7ea27667983fb6842f0835ec" category="cell">介绍使用 system controller replace 命令无中断升级运行 ONTAP 9.8 的控制器所需的聚合重新定位过程。</block>
  <block id="c4f6e679df3510ade01e1eb289f28470" category="inline-link-macro">使用聚合重新定位手动升级运行 ONTAP 9.7 或更早版本的控制器硬件</block>
  <block id="e2e9559980b3786b225c9c05e8a13568" category="cell"><block ref="e2e9559980b3786b225c9c05e8a13568" category="inline-link-macro-rx"></block></block>
  <block id="55b831f07f1b45c03df3d93cd827ad94" category="cell">介绍运行 ONTAP 9.7 或更早版本执行手动无中断控制器升级所需的聚合重新定位过程。</block>
  <block id="345d5e5ac849d0ff413facdf20f6117d" category="inline-link-macro">使用聚合重新定位手动升级运行 ONTAP 9.8 或更高版本的控制器硬件</block>
  <block id="d9a8e3f32ab422d08375a598a5807e74" category="cell"><block ref="d9a8e3f32ab422d08375a598a5807e74" category="inline-link-macro-rx"></block></block>
  <block id="f39fe3ae91660449bc81c96d4bc3f3a6" category="cell">介绍运行 ONTAP 9.8 或更高版本时执行手动无中断控制器升级所需的聚合重新定位过程。</block>
  <block id="f7e23c11beeca2c17c91f38177574a83" category="section-title">参考站点</block>
  <block id="9d2169c1c2855b78a7aeaa4f42d27dc7" category="inline-link-macro">NetApp 支持站点</block>
  <block id="da160308e3b4b4a80bf1b72b5bdbedb8" category="inline-link-macro">Hardware Universe</block>
  <block id="7799247fae92e6077d1c863277774421" category="paragraph">。 <block ref="a578dfd24b9ac76011d432b13fc1b9d1" category="inline-link-macro-rx"></block> 此外，此站点还包含有关网络接口卡（ NIC ）以及可能用于系统的其他硬件的文档。它还包含 <block ref="9c839fcdfb8699a63c787254d7b1ae03" category="inline-link-macro-rx"></block>，提供有关新系统支持的硬件的信息。</block>
  <block id="774a065cb3548cc61fb0ec3bc1494fbe" category="inline-link-macro">ONTAP 9 文档中心</block>
  <block id="52fd56498b7f7c00d95bd30d3d0fc632" category="paragraph">请参见 <block ref="ce7a5b355b31f8ee0c1b6b8b399a329a" category="inline-link-macro-rx"></block> 以访问 ONTAP 9 产品文档。</block>
  <block id="865e9b4ef52f3b0d3050c8b3c14eb660" category="inline-link-macro">Active IQ Config Advisor</block>
  <block id="7e2de5eb63fb2b34e58f2153cc03c71d" category="paragraph">要链接到，请参见 _NetApp 支持站点 _ <block ref="5fbf315c6f5ea598be883d972c599456" category="inline-link-macro-rx"></block> 工具。</block>
  <block id="37ca8b383b926ae9880b1b535c90290a" category="summary">在 ONTAP 命令行中输入以下命令，开始控制器更换过程。</block>
  <block id="ec8517f5a3bac3a1b92d4ef89c731fcc" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_auto_prepare_nodes_upgrade_top_step&gt;</block>
  <block id="9154c9f6f627ec9fa7725b0cbec3b33b" category="list-text">【第 4 步】按照系统控制台上控制器更换操作步骤的指示运行以下一组命令。</block>
  <block id="6c7905cfbf20ac44387cca492e010687" category="paragraph">您必须分别运行和保存以下命令的输出：</block>
  <block id="2a29db167c3a03336a9b63367df61117" category="list-text">vserver services name-service dns show</block>
  <block id="adb6c9273650502325bd84641dded06a" category="list-text">network interface show -curr-node &lt;nodename&gt; -role &lt;cluster ， intercluster ， node-mgmt ， cluster-mgmt ， data&gt;</block>
  <block id="8ba3dc8f2e507a70633697dc60de2269" category="list-text">network port show -node &lt;node_name&gt; -type physical</block>
  <block id="4b6d2742fe44e19ae334198040aa33ef" category="list-text">service-processor show -node * -instance</block>
  <block id="54435116abb139647e98feb1031829db" category="list-text">network fcp adapter show -node &lt;node_name&gt;</block>
  <block id="21ae3cd30d3faa7f1f8d97766b196a1a" category="list-text">network port ifgrp show</block>
  <block id="cbd335576ebae1caff82003d00697c97" category="list-text">system node show -instance -node &lt;node_name&gt;</block>
  <block id="a0ce199a837f76798ed0619d2ef94065" category="list-text">运行 -node &lt;node_name&gt; sysconfig</block>
  <block id="fac031b53ff277f8625f50e090a47475" category="list-text">storage aggregate show -node &lt;node_name&gt;</block>
  <block id="fbbf7d037bc226399100b8f4ea551e3a" category="list-text">volume show -node &lt;node_name&gt;</block>
  <block id="9a58231354c6d959f08b17d7fdb9350f" category="list-text">storage array config show -switch &lt;switch_name&gt;</block>
  <block id="760bdf3d6f89d3bd7422272872fc8ec1" category="list-text">system license show -owner &lt;node_name&gt;</block>
  <block id="46353f4e0bb2c136591c37c9eeedcf40" category="list-text">storage encryption disk show</block>
  <block id="6b6f6c1a8bc1fede794cda92ed140953" category="list-text">security key-manager backup show</block>
  <block id="001642cb897a8bebce3210207b7e81af" category="list-text">security key-manager external show</block>
  <block id="6afea099b023b1bd5f51935ccb31ce0a" category="list-text">security key-manager external show-status</block>
  <block id="27c32000aa45c9243e8b444a27636832" category="list-text">可访问性 show -detail</block>
  <block id="9cad135052afca91f1dd4b9f0372c825" category="admonition">如果使用板载密钥管理器（ OKM ）进行 NetApp 卷加密，请准备好密钥管理器密码短语，以便稍后在操作步骤中完成密钥管理器重新同步。</block>
  <block id="e35c9bcadd15fafdadb9422ec67d5b55" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/ru_auto_correct_aggregate_ownery.adoc]]</block>
  <block id="dcb5f4625de7512f722074c6a6d5fc37" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/Rm_auto_license.adoc]]</block>
  <block id="62a59e60f8dc64071df571bef45b97de" category="summary">如果更换的控制器或新控制器的 HA 配对项使用存储加密。</block>
  <block id="71dd89b192a133f8ccfd6e18f0397ebc" category="paragraph">如果更换的控制器或新控制器的 HA 配对项使用存储加密，则必须为新控制器模块配置存储加密，包括安装 SSL 证书和设置密钥管理服务器。</block>
  <block id="1bf6f98fb62d5ca413d6cce101954a5f" category="paragraph">此操作步骤包含对新控制器模块执行的步骤。您必须在正确的节点上输入命令。</block>
  <block id="7aa4aef633570e557584b795ec5144e9" category="list-text">使用以下命令验证密钥管理服务器是否仍可用，其状态及其身份验证密钥信息：</block>
  <block id="a57b36ea9f75076c6744f1f269e29bd8" category="paragraph">`security key-manager show -status`</block>
  <block id="eeb811dde1344fabc569b67ecd8b95f6" category="paragraph">`s安全密钥管理器查询`</block>
  <block id="32ce57c242557f5657864f2684cf9a96" category="list-text">将上一步中列出的密钥管理服务器添加到新控制器的密钥管理服务器列表中。</block>
  <block id="6bdf9080f49ca89e65220e312d51e688" category="list-text">使用以下命令添加密钥管理服务器：</block>
  <block id="d972edad5fb5c103c1c6f1ac23a3cdf1" category="paragraph">`security key-manager -add &lt;key_management_server_ip_address&gt;`</block>
  <block id="74bdef17191283e61278bf225ca4520d" category="list-text">对列出的每个密钥管理服务器重复上述步骤。您最多可以链接四个密钥管理服务器。</block>
  <block id="0dd9d4ff0944e970430f96022e169191" category="list-text">使用以下命令验证是否已成功添加密钥管理服务器：</block>
  <block id="0e79decb13af5d2dc1cdba7d4607d34c" category="paragraph">`sSecurity key-manager show`</block>
  <block id="613e5831fca345289928a52de72937a1" category="list-text">在新控制器模块上，运行密钥管理设置向导以设置和安装密钥管理服务器。</block>
  <block id="bbdb53ee65b9a0c8fdb6fdf3661d0fb6" category="paragraph">您必须安装与现有控制器模块上安装的密钥管理服务器相同的密钥管理服务器。</block>
  <block id="3bf7f9a82df0c130b46780052ca49e4c" category="list-text">使用以下命令在新节点上启动密钥管理服务器设置向导：</block>
  <block id="0d51f1cd2b3f0ee725fef68026226c50" category="paragraph">`security key-manager setup -node &lt;new_controller_name&gt;`</block>
  <block id="5560b948b9e6ef0348c58a90d5656939" category="list-text">完成向导中的步骤以配置密钥管理服务器。</block>
  <block id="909e5630fa0cab445f0538f20d1af620" category="list-text">使用以下命令将所有链接的密钥管理服务器中的身份验证密钥还原到新节点：</block>
  <block id="441e1cbf2c222517b5366ca827ed309d" category="paragraph">`security key-manager restore -node &lt;new_controller_name&gt;`</block>
  <block id="ea6471fa3c0b778358a74a483b65908e" category="summary">如果 node4 具有板载 FC 端口， UTA/UTA2 端口或 UTA/UTA2 卡，则必须先配置这些设置，然后才能完成其余操作步骤。</block>
  <block id="b807d86632667b471ffae105471bdbdf" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/r_auto_set_fc_or_UTA_uta2_config_node4_intro 。 adoc[]</block>
  <block id="405ab80b96586360ea83735c37305935" category="inline-link-macro">验证 node4 安装</block>
  <block id="e5d8ce1e4e0f9c50b3cbdf452d60972e" category="inline-link-macro">第 22 步</block>
  <block id="3dc7a36efda97abdf7240a1ca32de490" category="admonition">如果 node4 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，并且您要升级具有存储磁盘的系统，则可以跳至 <block ref="3a339ed5bdc85366b677c546716fabfa" category="inline-link-macro-rx"></block>。但是，如果您使用的是 V 系列系统或 FlexArray 虚拟化软件并连接到存储阵列，并且 node4 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，则必须返回 _Install and boot node4_ 部分并继续执行 <block ref="1a99f6ce933cd745b2b02e54c9272506" category="inline-link-macro-rx"></block>。确保 node4 具有足够的机架空间。如果 node4 与 node2 位于不同的机箱中，则可以将 node4 与 node3 放在同一位置。如果 node2 和 node4 位于同一机箱中，则 node4 已位于其相应的机架位置。</block>
  <block id="dab5593c109fec12a76b5fc654c23126" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/r_auto_set_fc_or_UTA_uta2_config_node4_choices.adoc[]</block>
  <block id="3606ac4fad6a78917c33a073f5d20bed" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/rm_auto_config_fc_ports_node4.adoc]]</block>
  <block id="59df83a3d8dd25ad19619fe75cc32a49" category="list-text">【第 8 步】执行以下操作之一：</block>
  <block id="78f6ac180c7bb87b8aee79da36246598" category="cell">如果要升级的系统 ...</block>
  <block id="a7a589b8e6e6d3aac1d1459d66a748a0" category="cell">然后选择…</block>
  <block id="61bc24f9f2f24029ba7b04d76f768598" category="cell">具有存储磁盘</block>
  <block id="f57ce051c0dd7274751c09db8a0e40b1" category="list-text">跳过此部分并转到 <block ref="3a339ed5bdc85366b677c546716fabfa" category="inline-link-macro-rx"></block> 如果 node4 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="58b0fc39873b9fe983d6b57e06585d6f" category="cell">是 V 系列系统或具有 FlexArray 虚拟化软件并连接到存储阵列</block>
  <block id="403ef226990b83673617ca3be4865d06" category="list-text">转至 <block ref="5752cac0a470e06ffceef40fba1931c1" category="inline-xref-macro-rx"></block> 如果 node4 具有 UTA/UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="be1e23bb281357a07ce5db58c0e3ed83" category="list-text">如果 node4 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请跳过 _Check and configure UTA/UTA2 ports on node4_ 一节，返回 _Install and boot node4_ 一节，然后继续执行 <block ref="ec6d4cacddb01e88226b9b376590bcc5" category="inline-link-macro-rx"></block>。</block>
  <block id="69e973a9aba58ba3c0012cb107497fbd" category="paragraph">如果 node4 具有板载 UTA/UTA2 端口或 UTA/UTA2 卡，则必须检查这些端口的配置并进行配置，具体取决于您希望如何使用升级后的系统。</block>
  <block id="cb462dbb35ebe0e4c6fef592bf7fd143" category="paragraph">您必须为 UTA/UTA2 端口配备正确的 SFP+ 模块。</block>
  <block id="c0caef2dbd4158cab9473c4f3805c920" category="paragraph">UTA/UTA2 端口可以配置为原生 FC 模式或 UTA/UTA2 模式。FC 模式支持 FC 启动程序和 FC 目标； UTA/UTA2 模式允许并发 NIC 和 FCoE 流量共享相同的 10 GbE SFP+ 接口并支持 FC 目标。</block>
  <block id="d99657bf946aa6dc77b75f8f378cf072" category="admonition">NetApp 营销材料可能会使用术语 UTA2 来指代 CNA 适配器和端口。但是，命令行界面使用术语 CNA 。</block>
  <block id="8076deb73ec5b74885a5b14258d5df96" category="paragraph">UTA/UTA2 端口可能位于具有以下配置的适配器或控制器上：</block>
  <block id="da3b32a8a5f86ee9c63b2d0328f453e3" category="list-text">与控制器同时订购的 UTA/UTA2 卡会在发货前配置为具有您请求的个性化设置。</block>
  <block id="494d18d03e7c6fb4b46866273ca75c34" category="list-text">与控制器分开订购的 UTA/UTA2 卡附带了默认的 FC 目标特性。</block>
  <block id="9fca14a117603ee6762ebe968e8cedec" category="list-text">新控制器上的板载 UTA/UTA2 端口（发货前）已配置为具有您请求的个性化设置。</block>
  <block id="898667c4cb95b7e44aafe17e4edf0567" category="paragraph">但是，您应检查 node4 上的 UTA/UTA2 端口的配置，并根据需要进行更改。</block>
  <block id="504b32f9515b15fa8407335de4be00e7" category="admonition">* 注意 * ：如果您的系统具有存储磁盘，除非指示您进入维护模式，否则您可以在集群提示符处输入本节中的命令。如果您的 MetroCluster FC 系统， V 系列系统或安装了 FlexArray 虚拟化软件的系统连接到存储阵列，则必须处于维护模式才能配置 UTA/UTA2 端口。</block>
  <block id="5113998ac3c679e0d1220f045f54831f" category="list-text">在 node4 上使用以下命令之一检查端口的当前配置方式：</block>
  <block id="8eae44e92f7155cef20bea12cd5a16c8" category="cell">如果系统 ...</block>
  <block id="e1a8971092776bc2e25be6babad152ab" category="cell">`ssystem node hardware unified-connect show`</block>
  <block id="5344ecb990fb0b0e60a7b979eeca26cd" category="cell">`ucadmin show`</block>
  <block id="fd894a783c8c8400a3021bd2ad147cba" category="paragraph">系统将显示类似于以下示例的输出：</block>
  <block id="64da799aef6205bb6034c61f1f25c391" category="list-text">如果当前 SFP+ 模块与所需用途不匹配，请将其更换为正确的 SFP+ 模块。</block>
  <block id="d72066c585919f0b5faa9807de695bf8" category="paragraph">请联系您的 NetApp 代表以获取正确的 SFP+ 模块。</block>
  <block id="89d66b059cd78c250aa205de02793541" category="list-text">检查 `ucadmin show` 命令的输出，并确定 UTA/UTA2 端口是否具有所需的个性化设置。</block>
  <block id="4d65ef8cf84d37cbb99560183afc8431" category="list-text">执行以下操作之一：</block>
  <block id="d4a3eb778a9003e6551eb488099a389d" category="cell">如果 CNA 端口 ...</block>
  <block id="2a6b2595426d2565bc2823be04753585" category="cell">没有所需的个性化设置</block>
  <block id="0011237e8dc98411a0794ba6dddb9989" category="inline-xref">第 5 步</block>
  <block id="feb4c7d35f5c6972a78c24ac4caebf00" category="cell">转至 <block ref="7ffb05d2232c9c60f695127651bcf871" category="inline-xref-macro-rx"></block>。</block>
  <block id="3fa4c0ba2b210d02bdf49ea3e2812989" category="cell">拥有所需的个性化特性</block>
  <block id="c0f1d3db2a584ee59498c0abaa47adf7" category="inline-xref">第 13 步</block>
  <block id="a06e3550b827dbbc3fa903ada41f165b" category="cell">跳过步骤 5 到步骤 12 ，然后转到 <block ref="8c1d75fc2023dc4e109b4251bd0229b1" category="inline-xref-macro-rx"></block>。</block>
  <block id="1228ef3c4a262a3a23b05009801f9d74" category="list-text">【 auto_check_4_step5]] 执行以下操作之一：</block>
  <block id="bb8715eb9d3c8fc0a643a55fc3e9ed29" category="cell">如果要配置</block>
  <block id="c4c1b40245719a0e56eb453401560e8e" category="cell">UTA/UTA2 卡上的端口</block>
  <block id="805e47ec7b4ef2165b02c8ff12688343" category="inline-xref">第 7 步</block>
  <block id="5ab10acc3f713db2883e41aeefc0a947" category="cell">转至 <block ref="8fa9bd2d3aca152bc08859144a7af8fa" category="inline-xref-macro-rx"></block></block>
  <block id="a7f2071dd0b7eee34d97c156132a3210" category="cell">板载 UTA/UTA2 端口</block>
  <block id="d60d761a93da31e724112577c571c923" category="inline-xref">第 8 步</block>
  <block id="5014f056b226c4802b8e30f5800a2ea3" category="cell">跳过第 7 步，转到 <block ref="3d86a68aa8fb2ef1661a4814f02f3b64" category="inline-xref-macro-rx"></block>。</block>
  <block id="ef0770e5329716a78bdc700afc4541c1" category="list-text">如果适配器处于启动程序模式，并且 UTA/UTA2 端口处于联机状态，请使 UTA/UTA2 端口脱机：</block>
  <block id="b3c0d59f1fa098e490810b0e947e6307" category="paragraph">`storage disable adapter &lt;adapter_name&gt;`</block>
  <block id="fff4e24de6543fad49dbe48a7b01e1d1" category="paragraph">目标模式下的适配器会在维护模式下自动脱机。</block>
  <block id="d8f98bdc807ae3903ae80ea0b78fbd6e" category="list-text">【 auto_check_4_step7]] 如果当前配置与所需用途不匹配，请根据需要更改配置：</block>
  <block id="749cabc3295eb5c2617db20882147797" category="paragraph">`ucadmin modify -m fc|cna -t initiators|target &lt;adapter_name&gt;`</block>
  <block id="d014763bc3b52aee3850e01f8065200f" category="list-text">` -m` 是特性模式 FC 或 10 GbE UTA 。</block>
  <block id="2e23b3b6b4b04a1d678f35eda127d4d6" category="list-text">` -t` 是 FC4 类型， `target` 或 `initiator` 。</block>
  <block id="3f0869d2c33ab7caf7185458236590fe" category="admonition">您必须对磁带驱动器， FlexArray 虚拟化系统和 MetroCluster 配置使用 FC 启动程序。您必须对 SAN 客户端使用 FC 目标。</block>
  <block id="7e0be6e2a6d4c241d66e582ce0ecbcea" category="list-text">【 auto_check_4_step8]] 使用以下命令并检查其输出，以验证设置：</block>
  <block id="fe040552b4fc83efe2ba593498969954" category="list-text">验证设置：</block>
  <block id="38827adabf48650b74e5fe794b8f2413" category="paragraph">以下示例中的输出显示， FC4 类型的适配器 "1b" 更改为 `initiator` ，适配器 "2a" 和 "2b" 的模式更改为 `CNA` ：</block>
  <block id="4cf4d3bfbda859f7fbe3247599afeba5" category="list-text">输入以下命令之一，使所有目标端口联机，每个端口输入一次：</block>
  <block id="efdbd48524f71c2dd98be1f586e183b7" category="cell">`network fcp adapter modify -node &lt;node_name&gt; -adapter &lt;adapter_name&gt; -state up`</block>
  <block id="4d6e26003e754a745cf62eed31431aad" category="cell">`FCP 配置 &lt;adapter_name&gt; up`</block>
  <block id="b50635aa317c4f94943cbad3bf2ffdf2" category="list-text">为端口布线。</block>
  <block id="8eeb6ccf00d6f27741c5b734b3130459" category="list-text">【第 12 步】执行以下操作之一：</block>
  <block id="803497e06fb63becf479290f3ae30e01" category="cell">转至 <block ref="3a339ed5bdc85366b677c546716fabfa" category="inline-link-macro-rx"></block>。</block>
  <block id="00538e299fb2786306fe6cdcd6e9fd03" category="cell">返回到 _Install and boot node4_ 部分，然后继续执行 <block ref="ec6d4cacddb01e88226b9b376590bcc5" category="inline-link-macro-rx"></block>。</block>
  <block id="4a137bad34f46785824a8100e1c6cba6" category="list-text">【 auto_check_4_step13]] 退出维护模式：</block>
  <block id="479951d6e509fddf053f700071fd43a4" category="list-text">【第 14 步】启动节点进入启动菜单：</block>
  <block id="204783b1ca658239a7b205df8e2d83dd" category="paragraph">`boot_ontap 菜单`</block>
  <block id="d27b8c8cfb6e88cecd06bd564e90cd36" category="paragraph">如果要升级到 A800 ，请转至 <block ref="1917bbf2d6d289423b4a495f5ba4fcca" category="inline-xref-macro-rx"></block></block>
  <block id="cd642c3a70cf520cbc7cc74da7b6cf70" category="list-text">在 node4 上，转到启动菜单并使用 22/7 并选择隐藏选项 `boot_after_controller_replacement` 。在提示符处，输入 node2 以将 node2 的磁盘重新分配给 node4 ，如以下示例所示。</block>
  <block id="f91809c39c7c5ad59f2475c5ee644448" category="admonition">在上述控制台输出示例中，如果系统使用高级磁盘分区（ ADP ）磁盘， ONTAP 将提示您输入配对节点名称。</block>
  <block id="9c709df0d0930ada3ab147bf9abe8f06" category="inline-xref">第 17 步</block>
  <block id="5dbdf6da1c2d885026bcf4a6be74a4b0" category="list-text">如果系统进入重新启动循环并显示消息 `no disks found` ，则表示系统已将 FC 或 UTA/UTA2 端口重置回目标模式，因此无法看到任何磁盘。要解决此问题，请继续 <block ref="d55e3a0f9758a99c055e4411cec66cde" category="inline-xref-macro-rx"></block> to <block ref="1abe7aef97cf6f4670adea7171f10403" category="inline-xref-macro-rx"></block> 或者转到第节 <block ref="3a339ed5bdc85366b677c546716fabfa" category="inline-link-macro-rx"></block>。</block>
  <block id="00454a3a0a181cf262da410213cfcb17" category="list-text">在自动启动期间按 `Ctrl-C` 在 `LOADER&gt;` 提示符处停止节点。</block>
  <block id="8923acb8081affcd156ba6d58720db9b" category="list-text">在 LOADER 提示符处，进入维护模式：</block>
  <block id="24655647ccabfd614d439a15f52407aa" category="paragraph">`boot_ontap maint`</block>
  <block id="82b61383829ad9f7c791ca9adcbe4b1f" category="list-text">在维护模式下，显示先前设置的所有启动程序端口，这些端口现在处于目标模式：</block>
  <block id="0237455b5c9b0d306e2c96ee6c599c24" category="paragraph">将端口改回启动程序模式：</block>
  <block id="cf3e9bc0a901473a585931eab06fd36e" category="paragraph">`ucadmin modify -m fc -t initiator -f &lt; 适配器名称 &gt;`</block>
  <block id="7dca1ec13f028b73f4170b0124cf9d45" category="list-text">验证端口是否已更改为启动程序模式：</block>
  <block id="a04a9fc20b8a671e539314c55bde8973" category="list-text">在 LOADER 提示符处启动：</block>
  <block id="bf1d9c5801bc3674bc765551ff2f2964" category="paragraph">`boot_ontap`</block>
  <block id="eedc84ab2e1ed2d5f77ae259bcc2e53d" category="paragraph">现在，在启动时，节点可以检测到先前分配给它的所有磁盘，并可按预期启动。</block>
  <block id="a615e77be7318a1511c3e98bbe302ca7" category="list-text">【自动检查 _4_step23]] 如果要从具有外部磁盘的系统升级到支持内部和外部磁盘的系统（例如， AFF A800 系统），请将 node2 聚合设置为根聚合，以确保 node4 从 node2 的根聚合启动。要设置根聚合，请转到启动菜单并选择选项 `5` 以进入维护模式。</block>
  <block id="60429a189ace5d1ba3d34868ab11d685" category="admonition">* 您必须按所示的确切顺序执行以下子步骤；否则可能发生原因会导致中断甚至数据丢失。 *</block>
  <block id="534c28a3529827f81e0580e98c2c91b5" category="paragraph">以下操作步骤会将 node4 设置为从 node2 的根聚合启动：</block>
  <block id="c9029dad52ad7bd50890b949161a37e6" category="list-text">进入维护模式。</block>
  <block id="a1dd60e47fece6bf56643327d78025eb" category="list-text">检查 node2 聚合的 RAID ，丛和校验和信息：</block>
  <block id="d54681223c9aa263c12e4a2a2a99ab44" category="paragraph">`aggr status -r`</block>
  <block id="bceb8f6bf2ef6f67a08ea5f6823b050c" category="list-text">使用以下命令检查 node2 聚合的状态：</block>
  <block id="39cff9999d84ec4289e4ab2ff2e81c67" category="paragraph">`聚合状态`</block>
  <block id="4c7213f8f3213d4809b8212b52bfc23a" category="list-text">如有必要，将 node2 聚合置于联机状态：</block>
  <block id="b64fc01bc73df9f024483d0ebe029c8f" category="paragraph">`aggr_online root_aggr_from_&lt;node2&gt;`</block>
  <block id="40418d7b25faced12b99f33b2265e3b3" category="list-text">阻止 node4 从其原始根聚合启动：</block>
  <block id="99748e6869c558cd84e1f7cd78209e7e" category="paragraph">`aggr offline &lt;root_aggr_on_node4&gt;`</block>
  <block id="2f71ad2b913b1589756e19c235187106" category="list-text">将 node2 根聚合设置为 node4 的新根聚合：</block>
  <block id="fb7c6c0ffab0377659471575f7daad3e" category="paragraph">`aggr options aggr_from_&lt;node2&gt;root`</block>
  <block id="cb891bf7e336200833c9e240c76a0cc6" category="list-text">验证 node4 的根聚合是否脱机，从 node2 接管的磁盘的根聚合是否联机并设置为 root ：</block>
  <block id="6bab8b4510fec23b1120be927a0bfea7" category="admonition">如果不执行上一个子步骤，发生原因 node4 可能会从内部根聚合启动，或者它可能会发生原因系统以假定存在新的集群配置或提示您确定一个集群配置。</block>
  <block id="c06377da744f281f74d745bd6cf53c71" category="paragraph">下面显示了命令输出的示例：</block>
  <block id="b9afc0f55ceae0ffd6b6f1e1c9a8f62e" category="summary">在 node4 上验证网络配置之后，以及在将聚合从 node3 重新定位到 node4 之前。</block>
  <block id="32d978cffec9875e4d92dc55b84df69b" category="doc">将 node2 拥有的非根聚合和 NAS 数据 LIF 从 node3 移动到 node4</block>
  <block id="33b455f1b5d98f0ba5db998a78bbbbe3" category="paragraph">在验证 node4 上的网络配置以及将聚合从 node3 重新定位到 node4 之前，您必须验证当前位于 node3 上的 node2 所属的 NAS 数据 LIF 是否已从 node3 重新定位到 node4 。您还必须验证 node4 上是否存在 SAN LIF 。</block>
  <block id="d2f28697e2bc23acb2a0a646043ffac0" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。升级期间，集群或服务运行状况无需移动 SAN LIF 。除非需要将 SAN LIF 映射到新端口，否则不会移动这些 LIF 。使 node4 联机后，您将验证 LIF 是否运行正常并位于相应的端口上。</block>
  <block id="0515b14b743c9032d850e7d789187991" category="list-text">使用以下命令恢复重新定位操作：</block>
  <block id="d6fd449bc639f92f27b747fd5b40361d" category="paragraph">`s系统控制器更换恢复`</block>
  <block id="0088774945c7d5ae5289c2de3632524f" category="paragraph">系统将执行以下任务：</block>
  <block id="8f1335854a57fa62ce5fd7596399825b" category="list-text">集群仲裁检查</block>
  <block id="9ebfbaf3d8306da9bc975b709c5ec632" category="list-text">系统 ID 检查</block>
  <block id="02d365a95e78a8c9b434a9c521f379c8" category="list-text">映像版本检查</block>
  <block id="2540df2535b5361f67db0cb18a3f91a5" category="list-text">目标平台检查</block>
  <block id="c8740509193885a8e40f7a7fb84ebff6" category="list-text">网络可访问性检查</block>
  <block id="93328d3894b0eabbdee40ef873079464" category="paragraph">此操作将在网络可访问性检查的此阶段暂停。</block>
  <block id="ba825b8ec370a1f6fa3b0b9ac48b0036" category="list-text">系统将执行以下检查：</block>
  <block id="e31fb2dedfef9337a9708f375d220030" category="list-text">集群运行状况检查</block>
  <block id="8ea7886b35c3e44ad6fcf3a1535ab9e7" category="list-text">集群 LIF 状态检查</block>
  <block id="545969fcc9e42f8cf5ca0598e1ec25f6" category="paragraph">执行这些检查后，系统会将 node2 拥有的非根聚合和 NAS 数据 LIF 重新定位到新控制器 node4 。资源重新定位完成后，控制器更换操作将暂停。</block>
  <block id="62ddee6b3b9135e9eda7c5bf96b2d614" category="list-text">使用以下命令检查聚合重新定位和 NAS 数据 LIF 移动操作的状态：</block>
  <block id="f1e1b94ce2ba7179506b74127da77af2" category="paragraph">`s系统控制器更换 show-details`</block>
  <block id="ff23473696232fd91c1e2dcb460109e4" category="paragraph">如果控制器更换操作步骤已暂停，请检查并更正错误（如果有），然后选择问题描述 `reume` 继续操作。</block>
  <block id="e4a5ba6110a9401660bd49252e37d969" category="list-text">如有必要，还原和还原任何已替换的 LIF 。使用以下命令列出所有已替换的 LIF ：</block>
  <block id="0b66eef739f727e3f877d8fd0e6b8862" category="paragraph">`cluster controller-replacement network placed-interface show`</block>
  <block id="4f67fb175aeac59570c3ee59b2048d49" category="paragraph">如果已替换任何 LIF ，请使用以下命令将主节点还原回 node4 ：</block>
  <block id="26490175c6a9bb3f68c33041e7c3bd2e" category="paragraph">`cluster controller-replacement network placed-interface restore-home-node`</block>
  <block id="7a3dfdff87bcd05a9bb92e3ef7bb1a40" category="list-text">使用以下命令恢复此操作，以提示系统执行所需的后检查：</block>
  <block id="f3bf2563f63e5f2af4793dec3cbb4411" category="paragraph">系统将执行以下后检查：</block>
  <block id="9e9f6a103b5a748cadf8dfd54b8e29ac" category="list-text">聚合重建检查</block>
  <block id="ea017e018f3e760c65f3b02f928b8e43" category="list-text">聚合状态检查</block>
  <block id="08f0db77633fd9c7f12fcd8827332b9d" category="list-text">磁盘状态检查</block>
  <block id="3c1799bbeb29b748f57f26ac2c4fc6f9" category="list-text">卷检查</block>
  <block id="c9c93a19732545b8a8812f3665050df3" category="summary">升级后，您必须立即配置存储加密。</block>
  <block id="26678fb639f40f31f518f926dd61b9ab" category="doc">获取用于存储加密的外部密钥管理服务器的 IP 地址</block>
  <block id="b8502e783bdb917fdc3cdb8f5669cf02" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_auto_get_ip_address_external_key_management_server_encryption.adoc]]</block>
  <block id="d3632885c406f1fdf833bfa7e1f0af27" category="section-title">使用 KMIP 服务器管理身份验证</block>
  <block id="eef7c3c189b38852fa6fd7ff22f1836c" category="paragraph">对于 ONTAP 9.8 或更高版本，您可以使用密钥管理互操作性协议（ KMIP ）服务器管理身份验证密钥。</block>
  <block id="848d1d77ef93461131de96c63bf0d645" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/ru_auto_manage_authentication_kmip_servers.adoc]]</block>
  <block id="700e0983810f7b842a203a090be56c40" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_auto_manage_storage_encryption_OKM.adoc]]</block>
  <block id="214f35608f8b795c650412f255442539" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_auto_quiesce_snapmirror_relationships.adoc]]</block>
  <block id="017b5062ed4e1498b1fe073b7b8cc546" category="summary">如果 node3 具有板载 FC 端口，板载统一目标适配器（ UTA/UTA2 ）端口或 UTA/UTA2 卡。</block>
  <block id="bc26b5e5559721e19875fb91dce22cec" category="doc">在 node3 上设置 FC 或 UTA/UTA2 配置</block>
  <block id="7bd5452d2f3a1c07fc54d3a08cc82d64" category="paragraph">如果 node3 具有板载 FC 端口，板载统一目标适配器（ UTA/UTA2 ）端口或 UTA/UTA2 卡，则必须先配置这些设置，然后才能完成其余操作步骤。</block>
  <block id="2ad1e670b60bb257ae5313d5009813a5" category="inline-link-macro">在 node3 上配置 FC 端口</block>
  <block id="b6f436f6398306a921de09279a6a8256" category="inline-link-macro">检查并配置 node3 上的 UTA/UTA2 端口</block>
  <block id="ef0be082d7ca1bab8630df88ecce644f" category="paragraph">您可能需要完成此部分 <block ref="b48af89854b82411ff58b4642c985df6" category="inline-link-macro-rx"></block>，部分 <block ref="e8f8d63644de968e3b5945cef425ba46" category="inline-link-macro-rx"></block>或这两个部分。</block>
  <block id="61a70f63b15f41db325598863adb0177" category="inline-link-macro">验证节点 3 安装</block>
  <block id="133634d291b6dbed9d4ad1cc73bfb71c" category="list-text">如果 node3 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，并且您要升级具有存储磁盘的系统，则可以跳至 <block ref="e1e3d09a5bb947a8d1b15fc31cc3b167" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="5ff20c188ceb23808ed9b47d8e5637ff" category="inline-link-macro">安装并启动 node3</block>
  <block id="7c36cf6cad805ba92f2c15221ad65254" category="list-text">但是，如果您使用的是 V 系列系统或安装了 FlexArray 虚拟化软件和存储阵列的系统，并且 node3 没有板载 FC 端口，板载 UTA/UTA 端口或 UTA/UTA2 卡，请返回到部分 <block ref="1619b1d4cec26b9f46f158ed5add4ab0" category="inline-link-macro-rx"></block> 并恢复步骤 23 中的部分。</block>
  <block id="6ef697f11922be2e4de0971f7d70997f" category="list-title">选项</block>
  <block id="8c986217270abd0ebe0e339e0d9d531b" category="list-text"><block ref="8c986217270abd0ebe0e339e0d9d531b" category="inline-link-macro-rx"></block></block>
  <block id="e8f8d63644de968e3b5945cef425ba46" category="list-text"><block ref="e8f8d63644de968e3b5945cef425ba46" category="inline-link-macro-rx"></block></block>
  <block id="8992459eb47b3dc5036bd8be4d821db3" category="paragraph">如果 node3 具有板载或 FC 适配器上的 FC 端口，则必须先在节点上设置端口配置，然后再将其投入使用，因为这些端口未经过预配置。如果未配置端口，则可能会发生服务中断。</block>
  <block id="0dce2bd52df484ed2da8db2ade281eab" category="paragraph">您必须具有在部分中保存的 node1 中的 FC 端口设置值 <block ref="94f2dfd916315926f685ba65e48c6e25" category="inline-link-macro-rx"></block>。</block>
  <block id="03ed7b9b905b544f247aa0b92eb8340f" category="paragraph">如果您的系统没有 FC 配置，则可以跳过此部分。如果您的系统具有板载 UTA/UTA2 端口或 UTA/UTA2 卡，则可以在中对其进行配置 <block ref="e8f8d63644de968e3b5945cef425ba46" category="inline-link-macro-rx"></block>。</block>
  <block id="4499075b12fda8ae40c8f6475349240b" category="paragraph">* 重要信息 * ：如果您的系统具有存储磁盘，请在集群提示符处输入本节中的命令。如果您使用的是 V 系列系统或 FlexArray 虚拟化软件并连接到存储阵列，请在维护模式下在此部分中输入命令。</block>
  <block id="5cb12b259721a136cc774cadc7c074c9" category="list-text">将 node3 上的 FC 设置与先前从 node1 中捕获的设置进行比较。</block>
  <block id="158580b0032f63c5230751175dea0f61" category="paragraph">在维护模式（启动菜单中的选项 5 ）下，根据需要使用以下命令之一修改 node3 上的 FC 端口：</block>
  <block id="2a89c3d97b61149625edcb17b1a04ab7" category="list-text">要对目标端口进行编程： `ucadmin modify -m fc -t target &lt;adapter&gt;`</block>
  <block id="aa6b5e0f3f85521221493b726a4ef498" category="list-text">要对启动程序端口进行编程： `ucadmin modify -m fc -t initiator &lt;adapter&gt;` ` -t` 是 FC4 类型： target 或 initiator 。</block>
  <block id="255973bd444380150c99ab5f810b123d" category="cell">在维护模式（启动菜单中的选项 5 ）下，根据需要使用以下命令修改 node3 上的 FC 端口： `ucadmin modify -m fc -t initiator -f &lt;adapter_port_name&gt;` ` -t` 是 FC4 类型，目标或启动程序。* 注 * ：必须将 FC 端口编程为启动程序。</block>
  <block id="dc19afaee728d475a48b658a9c09b990" category="cell">使用以下命令并检查输出，以验证新设置： `ucadmin show`</block>
  <block id="cbdb28ad6c338a8595170ad066765e68" category="list-text">使用以下命令退出维护模式：</block>
  <block id="f32a5f93a0f8f4487a3f72a3889a4810" category="list-text">使用以下命令从 LOADER 提示符启动系统：</block>
  <block id="6fbd819a7ffcfac7237456907e32238d" category="list-text">输入命令后，请等待，直到系统停留在启动环境提示符处。</block>
  <block id="4e0dd5a6524aabaa8ad8173947fbf52a" category="list-text">从维护模式的启动菜单中选择选项 `5` 。</block>
  <block id="672a791e2d7b759dbe3c29aab358eb15" category="list-text">如果 node3 具有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请转至部分 <block ref="e8f8d63644de968e3b5945cef425ba46" category="inline-link-macro-rx"></block>。</block>
  <block id="63ad3c4d36a1a9f413872ac57af754a7" category="inline-link-macro">验证 node3 安装</block>
  <block id="14f3fec6e2a9858d19d886a48d0a0345" category="list-text">如果 node3 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请跳过部分 <block ref="e8f8d63644de968e3b5945cef425ba46" category="inline-link-macro-rx"></block> 然后转到部分 <block ref="e5d463aaa9b038b1efee70e147ab4739" category="inline-link-macro-rx"></block>。</block>
  <block id="65388bf37cf8943b6ae990f110dbe576" category="list-text">如果 node3 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请跳过部分 <block ref="e8f8d63644de968e3b5945cef425ba46" category="inline-link-macro-rx"></block> 并返回 <block ref="1619b1d4cec26b9f46f158ed5add4ab0" category="inline-link-macro-rx"></block> 并恢复步骤 23 中的部分。</block>
  <block id="d190fd34bae28aff670090c55eb7e24b" category="paragraph">如果 node3 具有板载 UTA/UTA2 端口或 UTA/UTA2 卡，则必须检查这些端口的配置，并可能对其进行重新配置，具体取决于您希望如何使用升级后的系统。</block>
  <block id="7cda71007d207ef48448dffed511abb8" category="paragraph">如果要对 FC 使用统一目标适配器（ UTA/UTA2 ）端口，则必须先验证此端口的配置方式。</block>
  <block id="55e55fd6d28dec627ac074963cbf9279" category="paragraph">您可以使用 `ucadmin show` 命令验证当前端口配置：</block>
  <block id="b91d8d8d49f32c190d000475eaaf1a99" category="paragraph">UTA/UTA2 端口可以配置为原生 FC 模式或 UTA/UTA2 模式。FC 模式支持 FC 启动程序和 FC 目标； UTA/UTA2 模式允许并发 NIC 和 FCoE 流量共享相同的 10 GbE SFP+ 接口并支持 FC 目标。</block>
  <block id="7561dbd16073c82eda6418543cdd93ec" category="paragraph">UTA/UTA2 端口可能位于适配器或控制器上，并且具有以下配置，但您应检查 node3 上的 UTA/UTA2 端口的配置，并根据需要进行更改：</block>
  <block id="7107b4a109094877db55716e76bb317a" category="list-text">订购控制器时订购的 UTA/UTA2 卡会在发货前配置为具有您请求的个性化设置。</block>
  <block id="ac077d6a8af47d3f6459bdc75d20144c" category="list-text">新控制器上的板载 UTA/UTA2 端口会在发货前配置为具有您请求的个性化设置。</block>
  <block id="1acb31a5b3534092750f6ee560e0995c" category="paragraph">* 注意 * ：如果您的系统具有存储磁盘，除非指示您进入维护模式，否则您可以在集群提示符处输入本节中的命令。如果您使用的是 V 系列系统或 FlexArray 虚拟化软件并连接到存储阵列，则可以在维护模式提示符处在此部分中输入命令。要配置 UTA/UTA2 端口，您必须处于维护模式。</block>
  <block id="acb716cb88324392697eb22eddc7c3a3" category="list-text">【第 1 步】在 node3 上输入以下命令，以检查端口当前的配置方式：</block>
  <block id="e8eedad0c370be864050462beebc8141" category="cell">无需执行任何操作。</block>
  <block id="1f81aa18292065e5242ce30775d96e2c" category="paragraph">系统将显示类似于以下示例的输出：</block>
  <block id="b9372fe4eb2e1f51dc5ecc63ef944026" category="list-text">【第 2 步】如果当前 SFP+ 模块与所需用途不匹配，请将其更换为正确的 SFP+ 模块。</block>
  <block id="cf64c78b7d463ed3f7aa4e4a9d43ca20" category="list-text">`步骤 3]] 查看` ucadmin show 命令的输出，并确定 UTA/UTA2 端口是否具有所需的个性化设置。</block>
  <block id="37ba28d857fa9f472bd54799a71b4d1f" category="list-text">【第 4 步】执行以下操作之一：</block>
  <block id="2c59ff8f0f110684a1947a7be9c33989" category="cell">如果 UTA/UTA2 端口 ...</block>
  <block id="07d4c533878766923bd46c0ad1c07580" category="cell">转至 <block ref="861668d9cff26e583cb336053a01f9e4" category="inline-xref-macro-rx"></block>。</block>
  <block id="c24c89c849360fa759686bcc55215bde" category="cell">跳过步骤 5 到步骤 12 ，然后转到 <block ref="4dee99626dba3377b9d9c4e83b147efa" category="inline-xref-macro-rx"></block>。</block>
  <block id="e517f479718742d7735088b63cb4b0a6" category="list-text">【第 5 步】执行以下操作之一：</block>
  <block id="dd9a20380743fd0be8124656b4d4ab63" category="cell">转至 <block ref="26f10975298f1040a7b43f7164af041b" category="inline-xref-macro-rx"></block></block>
  <block id="5979362880fb0beb82ed703473e99fae" category="cell">跳过第 7 步，转到 <block ref="9ceac178d2a16e52b0311eab28cd7776" category="inline-xref-macro-rx"></block>。</block>
  <block id="db9102abe2408ee4fea1c2484a886da4" category="list-text">【第 6 步】如果适配器处于启动程序模式，并且 UTA/UTA2 端口处于联机状态，请使用以下命令使 UTA/UTA2 端口脱机：</block>
  <block id="13d2cbaf30ba642416a751e72335fbd5" category="list-text">【第 7 步】如果当前配置与所需用途不匹配，请使用以下命令根据需要更改配置：</block>
  <block id="68393ca2b7b9884fdd9f7eea661220e1" category="list-text">` -m` 是特性模式， `fc` 或 `CNA` 。</block>
  <block id="6c0032f71f96f6cbf3306cb2f3897ad4" category="list-text">【第 8 步】使用以下命令验证设置：</block>
  <block id="dbebec5dd2407c06cf693c4932aca95a" category="list-text">【第 9 步】使用以下命令之一验证设置：</block>
  <block id="7487a7c3d23ff8fb7ac97c86902fb023" category="paragraph">以下示例中的输出显示， FC4 类型的适配器 1b 正在更改为 `initiator` ，适配器 2a 和 2b 的模式正在更改为 `CNA` ：</block>
  <block id="b72b45050e36429103ef8a4d16d411be" category="list-text">【第 10 步】输入以下命令之一，使所有目标端口联机，每个端口输入一次：</block>
  <block id="9acdc1f2d575ffa9049389142b06720a" category="cell">`network fcp adapter modify -node &lt;node_name&gt; -adapter&lt;adapter_name&gt; -state up`</block>
  <block id="b479e4a9e97e157251ef3d2064ea4380" category="list-text">【第 11 步】为端口布线。</block>
  <block id="aebf7b50b70ed2ebf2c575a075bd9438" category="cell">转至 <block ref="e5d463aaa9b038b1efee70e147ab4739" category="inline-link-macro-rx"></block>。</block>
  <block id="6c6b8c59c90f6496076c738e7ff24c94" category="cell">恢复时间 <block ref="4469a51edd4697937e9b433996ec0b8b" category="inline-link-macro-rx"></block>。</block>
  <block id="5b2f0e007cd9ea02702aeb62d60c43e0" category="list-text">【第 13 步】使用以下命令退出维护模式：</block>
  <block id="26ee4be5cb2380ca98e9521456fd341f" category="list-text">【第 14 步】运行 `boot_ontap menu` 将节点启动到启动菜单。如果要升级到 A800 ，请转至 <block ref="3139ad98428111e167d1cbeb5cf5398c" category="inline-xref-macro-rx"></block>。</block>
  <block id="c80b31cc0c13ab0e11a8150100033a02" category="list-text">在 node3 上，使用 22/7 转到启动菜单并选择隐藏选项 `boot_after_controller_replacement` 。在提示符处，输入 node1 将 node1 的磁盘重新分配给 node3 ，如下例所示。</block>
  <block id="f754dab3d8015ef1d19b1781e9dc0cf7" category="list-text">【第 16 步】如果系统进入重新启动循环并显示消息 `未找到磁盘` ，则表示系统已将 FC 或 UTA/UTA2 端口重置回目标模式，因此无法查看任何磁盘。要解决此问题，请继续 <block ref="5f1aad4c994d87ede6a84b14e5fc7bca" category="inline-xref-macro-rx"></block> to <block ref="91e8c1ed01f1f8955e4e66087c66bdf6" category="inline-xref-macro-rx"></block>或转到第节 <block ref="e5d463aaa9b038b1efee70e147ab4739" category="inline-link-macro-rx"></block>。</block>
  <block id="a556a158a1621945323c5f6b337e6b8e" category="list-text">在自动启动期间按 Ctrl-C 可在 `LOADER&gt;` 提示符处停止节点。</block>
  <block id="d53423601d74fcaf09ac6d9ed50d827a" category="list-text">在 LOADER 提示符处，使用以下命令进入维护模式：</block>
  <block id="7b0df9ce8db61645cca400e062744575" category="list-text">在维护模式下，使用以下命令显示先前设置的所有启动程序端口，这些端口现在均处于目标模式：</block>
  <block id="0e79006c52695f8d4e54aa6765850c1a" category="paragraph">使用以下命令将端口重新更改为启动程序模式：</block>
  <block id="5a220d755d651cfa7ce691a00cd5b016" category="list-text">【第 20 步】使用以下命令验证端口是否已更改为启动程序模式：</block>
  <block id="2306d3041b8ccfdd71b1322f647aff4d" category="list-text">【第 21 步】使用以下命令退出维护模式：</block>
  <block id="53ed6df5803b59e285153d90b661b3e0" category="list-text">在 LOADER 提示符处，使用以下命令启动：</block>
  <block id="1220547ba4d85f01aafbdca81abf8088" category="list-text">【第 23 步】如果要从具有外部磁盘的系统升级到支持内部和外部磁盘的系统（例如， AFF A800 系统），请将 node1 聚合设置为根聚合，以确保 node3 从 node1 的根聚合启动。要设置根聚合，请转到启动菜单并选择选项 `5` 以进入维护模式。</block>
  <block id="839d6f1820a7da41933656247fa8b2cf" category="admonition">您必须按所示的确切顺序执行以下子步骤；否则可能发生原因会导致中断甚至数据丢失。</block>
  <block id="2d74e383435cfe64554575d0ab7faf2a" category="paragraph">以下操作步骤会将 node3 设置为从 node1 的根聚合启动：</block>
  <block id="393c73596c4eabb410418342bf771f48" category="list-text">使用以下命令进入维护模式：</block>
  <block id="91055fecc1724d5546658b4a8a0780a6" category="list-text">使用以下命令检查 node1 聚合的 RAID ，丛和校验和信息：</block>
  <block id="16279b00e4653f8ee5c1083aa907350f" category="list-text">使用以下命令检查 node1 聚合的状态：</block>
  <block id="ed8a1a8656c549f7328b38fc3d966074" category="list-text">如有必要，使用以下命令使 node1 聚合联机：</block>
  <block id="83b7dae21419642dd5e031d6fa6f2690" category="paragraph">`aggr_online root_aggr_from_&lt;node1&gt;`</block>
  <block id="e47cdd133a3533872433253113e30886" category="list-text">使用以下命令防止 node3 从其原始根聚合启动：</block>
  <block id="1d9aa029b391cb266140104de06a9144" category="paragraph">`aggr offline &lt;root_aggr_on_node3&gt;`</block>
  <block id="f90b092cd196ed5263522b03fd956395" category="list-text">使用以下命令将 node1 根聚合设置为 node3 的新根聚合：</block>
  <block id="f447db02ef1a999852a59545c4a25c75" category="paragraph">`aggr options aggr_from_&lt;node1&gt; root`</block>
  <block id="4b70f91d485aa48c29e98a3271e370b6" category="list-text">使用以下命令验证 node3 的根聚合是否已脱机，从 node1 接管的磁盘的根聚合是否已联机并设置为 root ：</block>
  <block id="3d7f94ab24ae28ffe95b85995cdb0a28" category="admonition">如果不执行上一个子步骤，发生原因 node3 可能会从内部根聚合启动，或者它可能会发生原因系统以假定存在新的集群配置或提示您确定一个集群配置。</block>
  <block id="3656662210f47dcbe034b998e90c0643" category="summary">了解是否可以使用 ARL 升级一对运行 ONTAP 9.8 的控制器。</block>
  <block id="da289ccf0fe9b7b8a0a8c3f55c76c877" category="doc">使用 ARL 升级控制器的准则</block>
  <block id="748989a9c7bd82e7d1765996607e182c" category="paragraph">要了解是否可以使用 ARL 升级一对运行 ONTAP 9.8 的控制器，取决于原始控制器和替代控制器的平台和配置。</block>
  <block id="da9431cc35c8bdde2930587bdcf661c2" category="section-title">支持 ARL 升级</block>
  <block id="e071734eb612d30829d1149fb460187d" category="paragraph">在使用适用于 ONTAP 9.8 的 ARL 操作步骤升级一对节点时，您必须验证是否可以对原始控制器和替代控制器执行 ARL 。</block>
  <block id="25bdbf3bbe517164bd0a266b84c0cb36" category="paragraph">您应检查所有已定义聚合的大小以及原始系统支持的磁盘数。然后，您必须将支持的聚合大小和磁盘数量与新系统支持的聚合大小和磁盘数量进行比较。此信息可在中找到 <block ref="e9a08380ac48c4cddc2ba1523ab880f9" category="inline-link-macro-rx"></block>。新系统支持的聚合大小和磁盘数必须等于或大于原始系统支持的聚合大小和磁盘数。</block>
  <block id="0ae6b54ffc6c60ea2536313a56f256d9" category="paragraph">您应在集群混用规则中验证在更换原始控制器后，新节点是否可以成为现有节点集群的一部分。有关集群混合规则的详细信息，请参见 <block ref="e9a08380ac48c4cddc2ba1523ab880f9" category="inline-link-macro-rx"></block>。</block>
  <block id="bd84475fd667775729ac63a2b2001dc9" category="admonition">如果要升级的系统支持内部驱动器（例如 FAS2700 或 AFF A250 ），但没有内部驱动器，请使用 _using aggregate relocation to manually Upgrade Controller Hardware_ 中的操作步骤。</block>
  <block id="5dab68a78b9466ced5074675f91c7438" category="paragraph">配置了 SnapLock 企业版和 SnapLock 合规性卷的系统支持使用 ARL 升级控制器。</block>
  <block id="cb0385d0286af5544c83edeb7702b741" category="section-title">双节点无交换机集群</block>
  <block id="69ceb2d36918ef5eab686101ab353f0d" category="paragraph">如果要升级双节点无交换机集群中的节点，则可以在执行升级时将这些节点保留在无交换机集群中。您无需将其转换为交换集群。</block>
  <block id="bea87fe3e38e1c2fba92c7b4ca690a9d" category="section-title">ARL 不支持升级</block>
  <block id="d061d57f2d82b85a7aa74e13aaec4c96" category="paragraph">您不能执行以下升级：</block>
  <block id="70a3b031f6a4e388e4285d647440ec82" category="list-text">更换不支持与原始控制器相连的磁盘架的控制器</block>
  <block id="666858e38bf5748ab62838fee4216e24" category="paragraph">请参见 <block ref="e9a08380ac48c4cddc2ba1523ab880f9" category="inline-link-macro-rx"></block> 磁盘支持信息。</block>
  <block id="d5457a285ea7fce244bde8387644b062" category="list-text">具有内部驱动器的入门级控制器，例如： FAS 2500 。</block>
  <block id="e8bbf639382ea95fc978d8420f1da4ec" category="paragraph">如果要使用内部驱动器升级入门级控制器，请参见中的操作步骤 _Upgrading a pair of nodes running 集群模式 Data ONTAP by moving volumes_ <block ref="9cc0d5221a9e998f923428a347033ebc" category="inline-link-macro-rx"></block>。</block>
  <block id="231cf4c70d866b616c21baddaeed0696" category="section-title">故障排除</block>
  <block id="3ba9e9ec13cd460d912c14b623889b10" category="paragraph">如果在升级控制器时出现任何问题，请参见 <block ref="b231fd1117eedf854289d13fffbf56ef" category="inline-link-macro-rx"></block> 部分，请参见操作步骤末尾的详细信息和可能的解决方案。</block>
  <block id="aaa66a015fd5899ae88e1fe7fce7257c" category="paragraph">如果您未找到与遇到的问题相关的解决方案，则应联系技术支持。</block>
  <block id="d5dcbeb79cc6a2aa334dc821840400c2" category="summary">在升级期间，聚合重新定位（ ARL ）可能会在不同点失败。</block>
  <block id="b02aac451baf6d7b36d981f898537961" category="doc">聚合重新定位失败</block>
  <block id="5889ed673e50bf5bb2f31df8c0d66478" category="summary">开始升级 Fabric MetroCluster 配置之前。</block>
  <block id="e7323a54c9f53a295a2c4d707c7b3fce" category="doc">验证 MetroCluster 配置的运行状况。</block>
  <block id="57b41b4e6b26c5d81b64f649f73c20f8" category="paragraph">在开始对光纤 MetroCluster 配置进行升级之前，您必须检查 MetroCluster 配置的运行状况以验证是否正常运行。</block>
  <block id="ce1ec3b6f165be8cdde0654c531487e5" category="list-text">验证 MetroCluster 组件是否运行正常：</block>
  <block id="b39709ac0ef947bdc090084f89c2ad94" category="paragraph">`MetroCluster check run`</block>
  <block id="f005234d35c44406394bfc86ede22866" category="paragraph">此操作将在后台运行。</block>
  <block id="14b1eaf3b61e952ace468e42285ce4ac" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_auto_verify_health_metrocluster_configuration.adoc]]</block>
  <block id="31edc329e96c14e95f770c101fc8cb3b" category="paragraph">如果 node4 的 ONTAP 9 版本与 node2 上安装的版本不同，则需要对其进行网络启动。安装 node4 后，从 Web 服务器上存储的 ONTAP 9 映像启动它。然后，您可以按照中的说明将正确的文件下载到启动介质设备，以供后续系统启动 <block ref="61665dbc7133bd75f8603aa8031b8059" category="inline-link-macro-rx"></block>。</block>
  <block id="4cffbd3d45c5794a1086c5ea8a6efcf0" category="list-text">如果要升级连接到存储阵列的 V 系列系统或安装了 FlexArray 虚拟化软件并连接到存储阵列的系统，则必须完成升级 <block ref="2404dae7899a613545fd901aa9857111" category="inline-xref-macro-rx"></block> 到 <block ref="79d8c0c5d1f20fd73b9c5cf6c2f16153" category="inline-xref-macro-rx"></block>，然后退出本节并按照说明进行操作 <block ref="e4a308316f89855579fcbb31b7ca4dfa" category="inline-link-macro-rx"></block> 和到 <block ref="f83114d9adca40bee6dbc7b70e5770d9" category="inline-link-macro-rx"></block>，在维护模式下输入命令。然后，您必须返回到此部分并继续使用 <block ref="fa7dc806bd5abc3aa70265946d09bc1c" category="inline-xref-macro-rx"></block>。</block>
  <block id="b82fd2e9b5f5045e64a07383691ee296" category="list-text">但是，如果要升级具有存储磁盘的系统，则必须完成整个部分，然后继续 <block ref="19e1cb1407ac1a7709bf36e64e7fec5d" category="inline-link-macro-rx"></block>，在集群提示符处输入命令。</block>
  <block id="4e94c1cbac3946720a42a1541bf39548" category="list-text">【第 1 步】确保 node4 具有足够的机架空间。</block>
  <block id="28935e867299c9d584c88c8fc1fb8a70" category="paragraph">按照 _Installation and Setup Instructions_或 中的说明，为以下连接布线 <block ref="86f7609c999f49f3dc914db25956e703" category="inline-link-macro-rx"></block> 对于 node4 平台，相应的磁盘架指南和 <block ref="fce145d95584367b9c4d78d9aa5ffce3" category="inline-link-macro-rx"></block>：</block>
  <block id="ffb09ffc35bea252e4e21d97d6400ddf" category="list-text">打开 node4 的电源，然后在控制台终端按 Ctrl-C 以访问启动环境提示符，从而中断启动过程。</block>
  <block id="0573ce38d8bd51f54c3a7724754e89f1" category="admonition-title">注意：请勿覆盖此延迟；如果不允许电池充电，可能会导致数据丢失。</block>
  <block id="75426af04160a0d2e55ed266c798f00e" category="admonition">请参见 <block ref="61665dbc7133bd75f8603aa8031b8059" category="inline-link-macro-rx"></block>。</block>
  <block id="f47f57e3434d00c4cb0ddb03933b3fc5" category="list-text">通过选择以下操作之一来配置网络启动连接。</block>
  <block id="8034469a98cb8171e1d88d330266e9b3" category="paragraph">` &lt;path_to_the_web-accessible_directory&gt;` 应指向您在本节第 1 步中下载 ` &lt;ontap_version&gt;_image.tgz` 的位置 <block ref="61665dbc7133bd75f8603aa8031b8059" category="inline-link-macro-rx"></block>。</block>
  <block id="734f579e8fa44e795a2d8f03940b3b8e" category="admonition">请忽略以下消息： `HA 对上的无中断升级不支持此操作步骤` 。注意适用场景可无中断升级 ONTAP ，而不是升级控制器。请始终使用 netboot 将新节点更新为所需映像。如果使用其他方法在新控制器上安装映像，则可能安装了错误的映像。此问题描述适用场景所有 ONTAP 版本。</block>
  <block id="f7165489b9b742b79c1edc66a3adf2a0" category="list-text">使用以下命令验证控制器和机箱是否已配置为 HA ：</block>
  <block id="6c3f17b59ca4781564b9e4a1526324f4" category="paragraph">`ha-config modify controller`</block>
  <block id="dd89cc637fcb9494346abfa250ac6820" category="paragraph">`ha ha-config modify chassis ha`</block>
  <block id="318cb6d625a1adf2c19ba7bed20d4061" category="list-text">使用以下命令退出维护模式：</block>
  <block id="2903a296e962981622f9fbb34fe3dbde" category="list-text">在 node3 上，使用以下命令检查系统日期，时间和时区：</block>
  <block id="e0dcb67cb9fbe2eca84263866e93758f" category="list-text">如有必要，请使用以下命令在 node4 上设置日期：</block>
  <block id="844393b53f7901c9253dcd2d1a0517b1" category="list-text">如有必要，请使用以下命令在 node4 上设置时间：</block>
  <block id="74696d3b09b6d742230a7bf13c661b5f" category="list-text">如有必要，请使用以下命令在 node4 上设置配对系统 ID ：</block>
  <block id="a0abc7261c0fb200627ac78f93b08090" category="list-text">在新节点的启动加载程序中，必须设置 `partner- sysid` 参数。对于 node4 ， `partn- sysid` 必须为 node3 。使用以下命令验证 node3 的 `partn- sysid` ：</block>
  <block id="591411226b213d9f7725e9ea7c71a472" category="cell">转至 <block ref="fa7dc806bd5abc3aa70265946d09bc1c" category="inline-xref-macro-rx"></block>。</block>
  <block id="055b7aa27b43043d10c451ccaeff6974" category="list-text">转至第节 <block ref="19e1cb1407ac1a7709bf36e64e7fec5d" category="inline-link-macro-rx"></block> 并完成本节中的各小节。</block>
  <block id="55a6283675d98fefe1a382b2a5aff637" category="list-text">返回到此部分，完成从开始的其余步骤 <block ref="fa7dc806bd5abc3aa70265946d09bc1c" category="inline-xref-macro-rx"></block>。</block>
  <block id="d1443596c33bb4e09a1ed7fb618c57ca" category="list-text">【第 23 步】将新节点的 FC 启动程序端口添加到交换机分区。</block>
  <block id="d86d0e7d3d0c0a0df158445c8dbe92fd" category="paragraph">如果您的系统具有磁带 SAN ，则需要对启动程序进行分区。如果需要，请参考将板载端口修改为启动程序 <block ref="e4a308316f89855579fcbb31b7ca4dfa" category="inline-link-macro-rx"></block>。有关分区的详细说明，请参见存储阵列和分区文档。</block>
  <block id="20cba2cce8bf251a0de11e5d6bbe7c02" category="list-text">如果此配置正在使用 NetApp 存储加密（ NSE ），则必须将 `setenv bootarg.storageencryption.support` 命令设置为 `true` ，并将 `kmip.init.maxwait` 变量设置为 `off` ，以避免在加载 node1 配置后出现启动环路：</block>
  <block id="b727396c4b982dd058d36cf687f34a4f" category="list-text">使用以下命令将节点启动至启动菜单：</block>
  <block id="fb89a7ef586904dc37e09f10f3f0ec64" category="inline-link-macro">第 15 步</block>
  <block id="2b0c71240fabf2d0a0d6aa17087fc5d6" category="paragraph">如果您没有 FC 或 UTA/UTA2 配置，请执行 <block ref="6b152c20af1c8ba3fcf66a2e78a16388" category="inline-link-macro-rx"></block> 以便 node4 可以识别 node2 的磁盘。</block>
  <block id="2ca91a400830d0cc0086e96a51715554" category="list-text">对于 MetroCluster 配置， V 系列系统以及将 FlexArray 虚拟化软件连接到存储阵列的系统，您必须在 node4 上设置和配置 FC 或 UTA/UTA2 端口，以检测连接到节点的磁盘。要完成此任务，请转至第节 <block ref="68e88a3cd80d57386df7e62e183f5294" category="inline-link-macro-rx"></block>。</block>
  <block id="b180c3a6690338cc8cfaeb6b4c37008c" category="summary">您必须在机架中安装 node3 ，将 node1 的连接传输到 node3 ，启动 node3 并安装 ONTAP 。</block>
  <block id="80f347da1888e440d3f1755d2e9ca001" category="paragraph">您必须在机架中安装 node3 ，将 node1 的连接传输到 node3 ，启动 node3 并安装 ONTAP 。然后，您必须重新分配 node1 的任何备用磁盘，属于根卷的任何磁盘以及此过程先前未重新定位到 node2 的任何非根聚合，如本节所述。</block>
  <block id="cabcb5ad3a57db50c098cbabe3b6d8c5" category="paragraph">重新定位操作在此阶段开始时暂停。此过程大部分是自动化的；操作将暂停，以便您可以检查其状态。您必须手动恢复此操作。此外，您还必须验证 SAN LIF 是否已成功移至 node3 。</block>
  <block id="31ccaad020ad8995655b8785712ac7b9" category="paragraph">如果 node3 与 node1 上安装的 ONTAP 9 版本不同，则需要对其进行网络启动。安装 node3 后，从 Web 服务器上存储的 ONTAP 9 映像启动它。然后，您可以按照中的说明将正确的文件下载到启动介质设备，以供后续系统启动 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block>。</block>
  <block id="9a1df33637b4fc5aa325b169d3a7aa84" category="list-text">如果要升级连接到存储阵列的 V 系列系统或安装了 FlexArray 虚拟化软件并连接到存储阵列的系统，则需要完成升级 <block ref="7c8db700ba9d62850f8b66020ea3d4b9" category="inline-xref-macro-rx"></block> 到 <block ref="d133a54ce8997c6b3c1ffdd4bfb32c84" category="inline-xref-macro-rx"></block>，然后退出本节并按照中的说明进行操作 <block ref="b8be2332e6727dc6b48478780a30df1b" category="inline-link-macro-rx"></block> 和 <block ref="e1881302722b07e924682c0aeef752a5" category="inline-link-macro-rx"></block> 根据需要输入相应部分，在维护模式下输入命令。然后，您必须返回到此部分并继续使用 <block ref="d602dbbaca50060142dad0af29921558" category="inline-xref-macro-rx"></block>。</block>
  <block id="80f025cc78499a80da49bd37c9bde220" category="list-text">如果要升级具有存储磁盘的系统，则需要完成整个部分，然后转到 <block ref="b8be2332e6727dc6b48478780a30df1b" category="inline-link-macro-rx"></block> 和 <block ref="e1881302722b07e924682c0aeef752a5" category="inline-link-macro-rx"></block> 部分，在集群提示符处输入命令。</block>
  <block id="56fd5e5051297f55fa1e22d93c8d71b8" category="list-text">【 auto_install3_step1]] 请确保为 node3 预留机架空间。</block>
  <block id="2c6541bc32b15b7aae8bab68f0ca5874" category="paragraph">如果 node1 和 node2 位于不同的机箱中，则可以将 node3 与 node1 放在同一机架位置。但是，如果 node1 与 node2 位于同一机箱中，则需要将 node3 置于其自身的机架空间中，最好靠近 node1 的位置。</block>
  <block id="b76de3994341c25067b438fe161926b7" category="list-text">【 auto_install3_step2]] 按照适用于您的节点型号的 _Installation and Setup Instructions_ 在机架中安装 node3 。</block>
  <block id="e642674ff2b68ba9c6309b786d87c4f9" category="admonition">如果要升级到两个节点位于同一机箱中的系统，请在机箱中安装 node4 以及 node3 。否则，在启动 node3 时，该节点的行为将如同处于双机箱配置中，而在启动 node4 时，节点之间的互连将不会启动。</block>
  <block id="c558275e7d3a61c5ffa4c89d17138a8e" category="list-text">【 auto_install3_step3]] 为节点 3 布线，将连接从节点 1 移动到节点 3 。</block>
  <block id="8786753bd0ed7258440133f486b3e488" category="paragraph">使用适用于 node3 平台的 _Installation and Setup Instructions_or the _FlexArray Virtualization Installation Requirements and Refertion_ ，相应的磁盘架指南和 _ONTAP 9 高可用性配置指南为以下连接布线。</block>
  <block id="a237c9d74ab3870e45b318a1071c10f4" category="admonition">您可能不需要将互连卡或集群互连缆线连接从 node1 移至 node3 ，因为大多数平台型号都具有唯一的互连卡型号。对于 MetroCluster 配置，您需要将 FC-VI 缆线连接从 node1 移至 node3 。如果新主机没有 FC-VI 卡，则可能需要移动 FC-VI 卡。</block>
  <block id="a5492c1c64c93543c424918fe38a847e" category="list-text">【 auto_install3_step4]] 打开 node3 的电源，然后在控制台终端按 Ctrl-C 访问启动环境提示符，以中断启动过程。</block>
  <block id="db32660dfabf573a3553146b10c4b358" category="paragraph">如果要升级到两个节点位于同一机箱中的系统， node4 也会重新启动。但是，您可以忽略 node4 启动，直到稍后再启动。</block>
  <block id="93bd68c37b47b8665f3fe8bb9add087f" category="admonition">启动 node3 时，您可能会看到以下警告消息：</block>
  <block id="7882a4b556b6996eaf604413a9e602d9" category="inline-xref">第 4 步</block>
  <block id="b64113c5a70901151e544500a7cb6e41" category="list-text">如果您在中看到警告消息，则需要执行以下操作 <block ref="07e6330d4bc574888011bcb486743c88" category="inline-xref-macro-rx"></block>，执行以下操作：</block>
  <block id="c05c7a2303ef34ab95234ebadd79fc8f" category="cell">在启动环境提示符处使用以下命令自动配置连接： `ifconfig e0M -auto`</block>
  <block id="96e59e91cef900d59b3ce93f663391f3" category="cell">在启动环境提示符处使用以下命令手动配置连接： `ifconfig e0M -addr=&lt;filer_addr&gt; -mask=&lt;netmask&gt; -gw=&lt;gateway&gt; - dns=&lt;dns_addr&gt; domain=&lt;dns_domain&gt;` ` &lt;filer_addr&gt;` 是存储系统的 IP 地址。` &lt; 网络掩码 &gt;` 是存储系统的网络掩码。` &lt; 网关 &gt;` 是存储系统的网关。` &lt;dns_addr&gt;` 是网络上名称服务器的 IP 地址。此参数是可选的。` &lt;dns_domain&gt;` 是域名服务（ DNS ）域名。此参数是可选的。* 注 * ：接口可能需要其他参数。有关详细信息，请在固件提示符处输入 `help ifconfig` 。</block>
  <block id="48060f068bd1fae855e05859f04c5e3f" category="list-text">【第 7 步】对 node3 执行网络启动：</block>
  <block id="526c6586cac2a5ca719ec72a9f077f53" category="paragraph">` &lt;path_to_the_web-accessible_directory&gt;` 应指向您在部分中下载 ` &lt;ontap_version&gt;_image.tgz` 的位置 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block>。</block>
  <block id="00a7cfe4f4da76897b759c2fe0aa87e4" category="list-text">【第 8 步】从启动菜单中选择选项 ` （ 7 ）首先安装新软件` 。</block>
  <block id="f0546cfa67e11944c3c115c55c0d74c6" category="list-text">【第 9 步】如果系统提示您继续运行操作步骤，请输入 `y` ，当系统提示您输入软件包时，请输入 URL ：</block>
  <block id="b420e8eb0083114b740da33989940785" category="list-text">【第 10 步】完成以下子步骤以重新启动控制器模块：</block>
  <block id="dab98833427c3d8aa8eeb5d6db41328b" category="paragraph">`d要立即还原备份配置？｛ y|n ｝`</block>
  <block id="78531eca4abf30d4c07d610d913a17b4" category="list-text">出现以下提示时，输入 `y` 以重新启动：</block>
  <block id="3cab3f136b2c476f859a364c003079c3" category="paragraph">`要开始使用新安装的软件，必须重新启动节点。是否要立即重新启动？｛ y|n ｝`</block>
  <block id="665b6d787a8576ee10e9c9cee3583341" category="list-text">【第 11 步】从启动菜单中选择维护模式 `5` ，并在系统提示您继续启动时输入 `y` 。</block>
  <block id="d268c4054cbf23abb6afc6dec45039b4" category="list-text">【第 12 步】验证控制器和机箱是否配置为 ha ：</block>
  <block id="51c448ec2d072d0227e5d83964636a54" category="list-text">【第 13 步】如果控制器和机箱未配置为 ha ，请使用以下命令更正配置：</block>
  <block id="a73d1d9d7a9d36edb67531c5cdd004f4" category="list-text">【第 14 步】退出维护模式：</block>
  <block id="c3f299c216a4d01822966fa31545bf67" category="paragraph">在启动环境提示符处按 `Ctrl-C` 以中断自动启动。</block>
  <block id="46b4ada45ce5a9b580d12f2837589006" category="list-text">在 node2 上，检查系统日期，时间和时区：</block>
  <block id="f68146a357d007c5719e57f0df2f6cea" category="list-text">在 node3 上，在启动环境提示符处使用以下命令检查日期：</block>
  <block id="92b09953e03c695a41d0eca9cc7a70b3" category="list-text">【第 17 步】如有必要，请在 node3 上设置日期：</block>
  <block id="a35c7561d833fab42eb0820cd7256987" category="list-text">在 node3 上，在启动环境提示符处使用以下命令检查时间：</block>
  <block id="8fa05814ac535bc4cac5dc313de56abe" category="list-text">【第 19 步】如有必要，请在 node3 上设置时间：</block>
  <block id="671e8c839701c582dc6d924cc3f17c82" category="list-text">【第 20 步】如有必要，请在 node3 上设置配对系统 ID ：</block>
  <block id="9b0061842e9b4b978c7b1f439fbd5125" category="paragraph">`setenv partner-sysid &lt;node2_sysid&gt;`</block>
  <block id="adf02be63922314f36e41d4ce1193e79" category="list-text">在新节点的启动加载程序中，需要设置 `partner-sysid` 参数。对于 node3 ， `partner-sysid` 必须为 node2 。验证 node3 的 `partner-sysid` ：</block>
  <block id="b7b77c4a8d173f38e98b19b6fa156359" category="paragraph">`printenv partner-sysid`</block>
  <block id="b5a7adde1af5c87d7fd797b6245c2a39" category="cell">Description</block>
  <block id="1bf7d37df6710b2cae5f87ffc87ac7ca" category="cell">转至 <block ref="d602dbbaca50060142dad0af29921558" category="inline-xref-macro-rx"></block></block>
  <block id="74c497c4741babe01069b2689c6f6d96" category="inline-link-macro">在 node3 上设置 FC 或 UTA/UTA2 配置</block>
  <block id="2987901eef48d33908a5fe3bc58101db" category="list-text">转至第节 <block ref="9cb2fecd70723749806307bb1e7fc101" category="inline-link-macro-rx"></block> 并完成本节中的各小节。</block>
  <block id="824a922c708e37c4e38da69123f1f712" category="list-text">返回到此部分，完成从开始的其余步骤 <block ref="d602dbbaca50060142dad0af29921558" category="inline-xref-macro-rx"></block>。</block>
  <block id="d2382bf853b3c31a2584de4ebbcb20f5" category="list-text">【 auto_install3_step23]] 将新节点的 FC 启动程序端口添加到交换机分区。</block>
  <block id="72797da0a6dd02827100892ec56ff0f7" category="inline-link-macro">在节点 3 上配置 FC 端口</block>
  <block id="33b34c9b4b9fcbf19dc61172941a60f7" category="paragraph">如果您的系统具有磁带 SAN ，则需要对启动程序进行分区。如果需要，请参考将板载端口修改为启动程序 <block ref="587d3c60b98ebe686bf65e1387fc811f" category="inline-link-macro-rx"></block>。有关分区的详细说明，请参见存储阵列和分区文档。</block>
  <block id="c72fdddc98e37cd5e62f25b9974065fc" category="list-text">【第 24 步】将 FC 启动程序端口作为新主机添加到存储阵列，将阵列 LUN 映射到新主机。</block>
  <block id="3ba1b014c973048d41b40e37b1cfeb69" category="list-text">【第 25 步】修改与存储阵列上的阵列 LUN 关联的主机或卷组中的全球通用端口名称（ WWPN ）值。</block>
  <block id="be6df649a349785ed8ec2a552e7c8903" category="list-text">【第 26 步】如果您的配置使用基于交换机的分区，请调整分区以反映新的 WWPN 值。</block>
  <block id="76e2b1ef0b0a726203126fcf7ef71a45" category="list-text">`s步骤 27]] 如果在此配置上使用 NetApp 存储加密（ NSE ），则必须将` etenv bootarg.storageencryption.support `命令设置为` true `，并将 kmip.init.maxwait` `变量设置为` off ，以避免在加载 node1 配置后出现启动环路：</block>
  <block id="dc19b23ad13df9e69f052ca959f75ad8" category="list-text">【第 28 步】启动节点进入启动菜单：</block>
  <block id="d5a2736750f555e1b93002d11e192b77" category="inline-link-macro">检查并配置节点 3 上的 UTA/UTA2 端口，步骤 15</block>
  <block id="8105e4198590e4ba2b52ef420719d8f6" category="paragraph">如果您没有 FC 或 UTA/UTA2 配置，请执行 <block ref="197bcdf5306898ec17e6022b26568f43" category="inline-link-macro-rx"></block> 以便 node3 可以识别 node1 的磁盘。</block>
  <block id="8ba547e72776f098f3b70a6614639f73" category="list-text">【第 29 步】对于 MetroCluster 配置， V 系列系统以及将 FlexArray 虚拟化软件连接到存储阵列的系统，您必须在 node3 上设置和配置 FC 或 UTA/UTA2 端口，以检测连接到节点的磁盘。要完成此任务，请转至第节 <block ref="c73225f56714e22dffa9ff7369895ce1" category="inline-link-macro-rx"></block>。</block>
  <block id="1c7f16089bd951221e84fa5322358ba8" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_auto_ensure_new_controller_is_set_up_correct_intro 步骤 _12.adoc]]</block>
  <block id="1534946b2dbb4d79955a0d451c913c4c" category="list-text">在两个节点上使用以下命令配置 SP ：</block>
  <block id="e4c074cd0d17a1426d4153413c21f2b8" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 ONTAP `s管理参考 _ 以了解 SP 的相关信息，以及 _SP 9.8 命令：手册页参考 _ 以了解有关 system` service-processor network modify 命令的详细信息。</block>
  <block id="c4aeec21dfe5bd16279a57e79dda936e" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_auto_ensure_new_controller_is_set_up_correct_sted_14_end.adoc]]</block>
  <block id="7acef9ce6b481d82dc187cf0cd0ba769" category="paragraph">升级后，您必须立即配置存储加密并建立集群范围的身份验证密钥，以替换先前的节点级别身份验证密钥。</block>
  <block id="3f4ec080b2021bda3aa571a5e22a721e" category="list-text">使用以下命令安装与密钥管理服务器通信所需的客户端和服务器安全套接字层（ SSL ）证书：</block>
  <block id="6b3a21077187795e57ca156a1f7425b1" category="paragraph">`s安全证书安装`</block>
  <block id="cbb3eece6687c0e5f34c4dd9eec3d644" category="list-text">在每个节点上使用以下命令，在所有节点上配置存储加密：</block>
  <block id="36b59c92319c91ef4b062f7a5735609c" category="paragraph">`s安全密钥管理器设置`</block>
  <block id="65de00a8e302559ffc774756d2f45b6f" category="list-text">使用以下命令为每个密钥管理服务器添加 IP 地址：</block>
  <block id="4ddacc4fe876ce1520a863683e858a54" category="paragraph">`s安全密钥管理器 add`</block>
  <block id="a0e16315c615f1ffb7ea7917002c5ebe" category="list-text">使用以下命令验证是否已在集群中的所有节点上配置相同的密钥管理服务器并使其可用：</block>
  <block id="e5b3e8638e7440dde3a413f172675dd9" category="list-text">使用以下命令创建新的集群范围身份验证密钥：</block>
  <block id="16ad807911a8c9b345c579c4bcb340cb" category="paragraph">`s安全密钥管理器 create-key`</block>
  <block id="cf838fadddca3730f4efc72c1c3c093c" category="list-text">记下新的身份验证密钥 ID 。</block>
  <block id="ab893dc08471dccfa540322bea4bf69f" category="list-text">使用以下命令使用新的身份验证密钥重新设置所有自加密驱动器的密钥：</block>
  <block id="6228599495561d44995cb3ef3f353e9b" category="paragraph">`storage encryption disk modify -disk * -data-key-id &lt;authentication_key_id&gt;`</block>
  <block id="37edd24368a6d3b3ef46638abcb37233" category="paragraph">在 ONTAP 9.8 中，您可以使用密钥管理互操作性协议（ Key Management Interoperability Protocol ， KMIP ）服务器管理身份验证密钥。</block>
  <block id="238aec95a63d1a9491fe7f04cb92d176" category="list-text">使用以下命令添加新控制器：</block>
  <block id="e6f04682f232152502b55694d0528032" category="list-text">使用以下命令添加密钥管理器：</block>
  <block id="1565a7df8a43704649d43cf763c37d9a" category="list-text">使用以下命令验证密钥管理服务器是否已配置并可供集群中的所有节点使用：</block>
  <block id="ddd3648b4ff881bff470e16ed91f43ec" category="list-text">使用以下命令将所有链接的密钥管理服务器中的身份验证密钥还原到新节点：</block>
  <block id="1cdcb35bc0549da482556496121fbed8" category="list-text">使用以下命令使用新的身份验证密钥重新设置所有自加密磁盘的密钥：</block>
  <block id="bf0679d0cb7aea4f9f1e7253a96643cf" category="paragraph">`storage encryption disk modify -disk * （ -data-key-id nonMSID AK ）`</block>
  <block id="5129605118eb7621624d0ff0a17cf3b3" category="list-text">如果您使用联邦信息处理标准（ FIPS ），请使用以下命令使用新的身份验证密钥重新设置所有自加密磁盘的密钥：</block>
  <block id="5beb4b8523f6870e231ec55cdf442a39" category="paragraph">`storage encryption disk* modify -disk * "-fips-key-id nonMSID AK]`</block>
  <block id="666d41f92db6a2191af16e999d035f4f" category="section-title">使用板载密钥管理器管理存储加密</block>
  <block id="54279af53279de10320508d0526f332e" category="paragraph">您可以使用 OKM 管理加密密钥。如果您计划使用 OKM ，则必须在开始升级之前记录密码短语和备份材料。</block>
  <block id="259c8a53b900b4102babb5d05e113f67" category="list-text">将密码短语保存到安全位置。</block>
  <block id="19077cc2690337623f542cbef7fae627" category="list-text">创建备份以进行恢复。运行以下命令并保存输出：</block>
  <block id="d1599347e2c1e8206cd8017da7de3ee0" category="paragraph">`key-manager 板载 show-backup`</block>
  <block id="63ce5117a618b44a9a730ed25c154d96" category="section-title">暂停 SnapMrror 关系（可选）</block>
  <block id="8e2255ca1830e4b8f59bef03c0eaa4e7" category="paragraph">在继续执行替换步骤之前，您必须确认所有 SnapMirror 关系均已暂停。暂停 SnapMirror 关系后，它会在重新启动和故障转移后保持静默状态。</block>
  <block id="e7c267219e312e103ff9e2c946e70665" category="list-text">使用以下命令验证目标集群上的 SnapMirror 关系状态：</block>
  <block id="5bab70a374b8d81dfb1cf1f910800c2a" category="paragraph">`snapmirror show`</block>
  <block id="d61bacc5fb74b7c02dc15d185df875b9" category="admonition">如果状态为 `transferring` ，则必须使用以下命令中止这些传输： `snapmirror abort -destination-vserver &lt;vserver name&gt;`</block>
  <block id="d5560010a4b579866a98e0b680b5c248" category="paragraph">如果 SnapMirror 关系未处于 `Transferring` 状态，则中止将失败。</block>
  <block id="ed662f4696868f5d80fe9998763cd98a" category="list-text">使用以下命令暂停集群之间的所有关系：</block>
  <block id="839e7ff3d7f7c6c8b5b42b0480b183b6" category="paragraph">`snapmirror quiesce -destination-vserver &lt;vserver name&gt;`</block>
  <block id="f4b0e9bc470ad2b8ac6c955fe361607e" category="summary">您可以恢复升级前暂停的 SnapMirror 传输，并恢复 SnapMirror 关系。</block>
  <block id="140c4ad72e426b76f7e15699ae078635" category="doc">恢复 SnapMirror 操作</block>
  <block id="5f561bedca26d8d072e51e5a351d1918" category="paragraph">您可以恢复升级前暂停的 SnapMirror 传输，并恢复 SnapMirror 关系。升级完成后，更新将按计划进行。</block>
  <block id="7fc3f5f5195f699ab95ec48565a40ad4" category="list-text">使用以下命令验证目标上的 SnapMirror 状态：</block>
  <block id="db7c2a00f8c278c1dcfe48c17962cd43" category="list-text">使用以下命令恢复 SnapMirror 关系：</block>
  <block id="52167f27ac641afda13c59903c8be219" category="paragraph">`snapmirror resume -destination – vserver &lt;vserver_name&gt;`</block>
  <block id="2a6561787d019392ed8915740a8cbb85" category="list-text">使用以下命令恢复操作：</block>
  <block id="21d67404cbc8811a82f375c6eb59ce82" category="paragraph">节点会自动暂停。</block>
  <block id="deb0c649717df2b352162aaccc90b075" category="paragraph">升级完成后，您可以停用 node2 。请参见 <block ref="8e60bb3917e01e2c0c3fe74628f3291d" category="inline-link-macro-rx"></block>。</block>
  <block id="964b0454175f6a1894f796b6a8fc4f59" category="summary">某些问题可能会在操作步骤的不同阶段发生。</block>
  <block id="e33c48b52ab7d302b4af41aca3bbe858" category="doc">操作步骤的多个阶段可能会出现的问题</block>
  <block id="84508423fbb2d015c45d8207837aede4" category="section-title">意外的 "storage failover show" 命令输出</block>
  <block id="9fae6006c452841a1b4104d26127eccf" category="paragraph">在操作步骤期间，如果托管所有数据聚合的节点发生崩溃或意外重新启动，您可能会在重新启动，崩溃或重新启动前后看到 `storage failover show` 命令的意外输出。</block>
  <block id="8a503ef07edf673987e764eff646e0d0" category="paragraph">您可能会在阶段 2 ，阶段 3 ，阶段 4 或阶段 5 中看到 `storage failover show` 命令的意外输出。</block>
  <block id="4e873fccdf7f54c0486cf43e1300ab3f" category="paragraph">以下示例显示了托管所有数据聚合的节点上没有重新启动或崩溃时 `storage failover show` 命令的预期输出：</block>
  <block id="b19cffa247e3fb2147fa3eb145c4247f" category="paragraph">以下示例显示了重新启动或崩溃后 `storage failover show` 命令的输出：</block>
  <block id="399a9894ac45311024aba0a4f4cd1197" category="paragraph">尽管输出显示某个节点正在进行部分交还，并且已禁用存储故障转移，但您可以忽略此消息。</block>
  <block id="3794e9e48df4b7a93a3321f2477f7880" category="paragraph">无需执行任何操作；请继续执行节点对升级操作步骤。</block>
  <block id="12e5dea4b29b66ec41d8307d3502847c" category="summary">在阶段 3 中，您将安装并启动 node3 。</block>
  <block id="3f765691a1037f4fcf966c679a3f3a4a" category="doc">第 3 阶段。安装并启动 node3</block>
  <block id="aed0650ed977ce1ee331d98fdf3fb87b" category="paragraph">在第 3 阶段，您安装并启动 node3 ，检查 node1 中的集群和节点管理端口是否在 node3 上联机，并验证 node3 安装。属于 node1 的非 SAN 数据 LIF 和非根聚合将从 node2 移动到 node3 。</block>
  <block id="b27daeccf5fbd8a2e88a3636ee615b74" category="list-text"><block ref="b27daeccf5fbd8a2e88a3636ee615b74" category="inline-link-macro-rx"></block></block>
  <block id="c73225f56714e22dffa9ff7369895ce1" category="list-text"><block ref="c73225f56714e22dffa9ff7369895ce1" category="inline-link-macro-rx"></block></block>
  <block id="35ed01fca1dde6c35ca197b89d2bbfc7" category="list-text"><block ref="35ed01fca1dde6c35ca197b89d2bbfc7" category="inline-link-macro-rx"></block></block>
  <block id="7ce57c4ce051863fc414ccd402a178f5" category="inline-link-macro">还原 node3 上的 key-manager 配置</block>
  <block id="f6eafe551d29e5e1c533099843028759" category="list-text"><block ref="f6eafe551d29e5e1c533099843028759" category="inline-link-macro-rx"></block></block>
  <block id="840820d31f6c078aeb1567ce302bdd05" category="inline-link-macro">将 node1 拥有的非根聚合和 NAS 数据 LIF 从 node2 移动到 node3</block>
  <block id="6acca98fea84a4d59c293fb72d8b9155" category="list-text"><block ref="6acca98fea84a4d59c293fb72d8b9155" category="inline-link-macro-rx"></block></block>
  <block id="f6fb20eca8c0d2026e6fe206142772b0" category="paragraph">在第 3 阶段，您安装并启动 node3 ，检查 node1 中的集群和节点管理端口是否在 node3 上联机，并验证 node3 安装。属于 node1 的非 SAN 数据 LIF 和非根聚合将从 node2 移动到 node3 。</block>
  <block id="1619b1d4cec26b9f46f158ed5add4ab0" category="list-text"><block ref="1619b1d4cec26b9f46f158ed5add4ab0" category="inline-link-macro-rx"></block></block>
  <block id="c1d98918f251b16ee7804a1a99dc8cb2" category="list-text"><block ref="c1d98918f251b16ee7804a1a99dc8cb2" category="inline-link-macro-rx"></block></block>
  <block id="e5d463aaa9b038b1efee70e147ab4739" category="list-text"><block ref="e5d463aaa9b038b1efee70e147ab4739" category="inline-link-macro-rx"></block></block>
  <block id="8a8ad9dde196f4a3aa7b69f49a062e95" category="list-text"><block ref="8a8ad9dde196f4a3aa7b69f49a062e95" category="inline-link-macro-rx"></block></block>
  <block id="ffc6f037d0c9e8912cf30d6829e534a6" category="list-text"><block ref="ffc6f037d0c9e8912cf30d6829e534a6" category="inline-link-macro-rx"></block></block>
  <block id="53bf10d232214698fea58c12013ebb0b" category="summary">在第 1 阶段，您必须准备好节点进行升级并运行一系列预检。</block>
  <block id="81605039a97ca73a232818034b412a87" category="doc">第 1 阶段。准备升级</block>
  <block id="b4145e0f7c86507c5b343ce4ca7e9224" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/Rm_auto_stage_1_overview.adoc]]</block>
  <block id="b23f00f19a53ab820bfe8b7098e820ce" category="summary">使用 system controller replace 命令升级运行 ONTAP 9.8 的控制器硬件</block>
  <block id="e8869ea54056dd530c02573ded44d739" category="paragraph">本指南介绍如何在不造成中断的情况下升级控制器硬件。</block>
  <block id="a1cb64b8e71e447ebb7fcb878b7b8879" category="paragraph">通过将非根聚合从原始节点迁移到同一集群中的新节点，您可以无中断地升级运行 ONTAP 9.8 的一对节点上的控制器硬件。升级期间，可以访问要升级的节点上托管的数据。</block>
  <block id="60b36970c08352c3c476769f29561cf4" category="paragraph">此操作步骤使用一种称为聚合重新定位（ Aggregate Relocation ， ARL ）的方法，该方法利用 HA 配置，可以将非根聚合的所有权从一个节点移动到另一个节点，前提是它们在同一集群中共享存储。</block>
  <block id="73df6067ad433973d674881dda3dc967" category="summary">在第 6 阶段，确认新节点设置正确。</block>
  <block id="d48dfd29ad21ccd1c5cfa50ed99cd89e" category="doc">第 6 阶段。完成升级</block>
  <block id="4abe369009e998078072172b842bd207" category="paragraph">在第 6 阶段，确认新节点设置正确。如果其中一个新节点具有统一目标适配器，则必须还原任何端口配置，并且可能需要更改此适配器的使用。如果新节点已启用加密，则还应设置存储加密。</block>
  <block id="b81d64bc331b1e2e60b2cef595c6ddf8" category="inline-link-macro">完成 MetroCluster FC 配置的升级</block>
  <block id="78337bb469acc9834c0a4f1200f56dd8" category="list-text"><block ref="78337bb469acc9834c0a4f1200f56dd8" category="inline-link-macro-rx"></block></block>
  <block id="bba9ced3eb73a12c00cf91e9e344d3d7" category="list-text"><block ref="bba9ced3eb73a12c00cf91e9e344d3d7" category="inline-link-macro-rx"></block></block>
  <block id="71c3c6e82ac4cdabf6d82d7b484d2163" category="list-text"><block ref="71c3c6e82ac4cdabf6d82d7b484d2163" category="inline-link-macro-rx"></block></block>
  <block id="da7d6f53a5e074768e000aca830b3bfa" category="inline-link-macro">在新控制器模块上设置 NetApp 卷加密</block>
  <block id="6408fc5f6c6699d7daa3b0c94bcdeb91" category="list-text"><block ref="6408fc5f6c6699d7daa3b0c94bcdeb91" category="inline-link-macro-rx"></block></block>
  <block id="8e60bb3917e01e2c0c3fe74628f3291d" category="list-text"><block ref="8e60bb3917e01e2c0c3fe74628f3291d" category="inline-link-macro-rx"></block></block>
  <block id="d98c7080288afd2fa147ed918ba1b385" category="list-text"><block ref="d98c7080288afd2fa147ed918ba1b385" category="inline-link-macro-rx"></block></block>
  <block id="685f08a5b99430f3e9a6b908131fd4c3" category="summary">如果更换的控制器或新控制器的 HA 配对项使用 NetApp 卷加密。</block>
  <block id="0f36176e72d67a1afa95c79c3e1a12de" category="paragraph">如果更换的控制器或新控制器的 HA 配对项使用 NetApp 卷加密（ NVE ），则必须为 NVE 配置新控制器模块。</block>
  <block id="d38fed7bb4bf7b2cd414582a337f388f" category="list-text">验证密钥管理服务器是否仍可用，其状态及其身份验证密钥信息：</block>
  <block id="1a59e73da663791d8cc1a4162cc79daa" category="cell">对于此 ONTAP 版本 ...</block>
  <block id="394247ac369fff4729d586172906244e" category="cell">使用此命令 ...</block>
  <block id="127cae73d2b4d7758b4c0a0e3f49ba5f" category="cell">ONTAP 9.6 及更高版本</block>
  <block id="97d64be0988671e53d352ae4aa93eaf6" category="cell">`sSecurity key-manager key query -node node`</block>
  <block id="85b2cc925922ee961d8156414096bb8d" category="cell">ONTAP 9.5 及更早版本</block>
  <block id="afa9cce4f8e9d7e0dc9a3f8278517e40" category="cell">`sSecurity key-manager key show`</block>
  <block id="01a72c63e79e1fcc9b3e0cac4fb2bf75" category="list-text">将上一步中列出的密钥管理服务器添加到新控制器的密钥管理服务器列表中：</block>
  <block id="b0b1f7cd7ad16c151d90a8783f1752db" category="list-text">将所有链接的密钥管理服务器中的身份验证密钥还原到新节点：</block>
  <block id="08ac1a2fb254b60e9c511fe04b6536d0" category="cell">外部密钥管理器（ EKM ）</block>
  <block id="ca1ca50323446209228f3f72af231354" category="cell">`security key-manager external restore` 此命令需要 OKM 密码短语</block>
  <block id="a9849e92b148965a7bbb6c14d0afbcd0" category="cell">板载密钥管理器（ OKM ）</block>
  <block id="841196916665de2571df2fa230353881" category="paragraph">检查是否有任何卷因身份验证密钥不可用或无法访问外部密钥管理服务器而脱机。使用以下命令将这些卷恢复联机：</block>
  <block id="6d507e4601f1378ea8dbc7446cb265dd" category="paragraph">`卷联机`</block>
  <block id="1153d5d087ce8e64810354b376fd67cd" category="summary">要停用 node1 ，您需要恢复自动操作，以便使用 node2 禁用 HA 对并正确关闭 Lonode1 。</block>
  <block id="93d6a78ca650a17d67b6a45ca81b7f3f" category="doc">停用 node1</block>
  <block id="15ae34c4770749f2042d550a9e6558a0" category="paragraph">要停用 node1 ，您需要恢复自动操作，以便使用 node2 禁用 HA 对并正确关闭 node1 。您必须稍后从机架或机箱中删除 node1 。</block>
  <block id="bc1742c74df9fcc42dfd04db0540d6b7" category="list-text">使用以下命令验证 node1 是否已暂停：</block>
  <block id="b6cbeac15790ede2ca7c473d0604fdb1" category="paragraph">升级完成后，您可以停用 node1 。请参见 <block ref="8e60bb3917e01e2c0c3fe74628f3291d" category="inline-link-macro-rx"></block>。</block>
  <block id="f341d92eb5df0fca403d238ce18471d8" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_auto_set_up_storage_encryption_new_module.adoc]]</block>
  <block id="2d5a70198b86012f50adf28d146a05be" category="summary">在阶段 4 中，所有非根聚合都会从 node2 重新定位到 node3 。</block>
  <block id="7bc7e56fe8ddd27289de0794179c5451" category="doc">第 4 阶段。重新定位和停用节点 2</block>
  <block id="d4d422ac28594b1bddb2c593ae821f17" category="paragraph">在阶段 4 中，所有非根聚合将从 node2 重新定位到 node3 ； node2 拥有的非 SAN 数据 LIF 将移至 node3 。您必须记录必要的 node2 信息，然后停用 node2 。</block>
  <block id="3957e03cfda2dcf05cfe239a9b6b2245" category="list-text"><block ref="3957e03cfda2dcf05cfe239a9b6b2245" category="inline-link-macro-rx"></block></block>
  <block id="835a71ffd6f4a3964989583b0e2633f4" category="list-text"><block ref="835a71ffd6f4a3964989583b0e2633f4" category="inline-link-macro-rx"></block></block>
  <block id="22ea33bc6c6dca2de7665008209005ee" category="summary">本指南介绍如何使用新控制器升级 HA 对中的存储控制器。</block>
  <block id="2e4e187dce2e8970e167f157b1040ef2" category="doc">确定是否使用聚合重新定位指南</block>
  <block id="afced07d58498bf37f5ac5e4787fe0e9" category="paragraph">本指南介绍如何使用新控制器升级 HA 对中的存储控制器，同时保留所有现有数据和磁盘。这是一个复杂的操作步骤，只能由经验丰富的管理员使用。</block>
  <block id="8a5876fc5aff9d4ba29b01b35732f36b" category="paragraph">在以下情况下，应使用本指南：</block>
  <block id="0254a2717286f49eac846482fe37bc8a" category="list-text">您正在运行 ONTAP 9.8 。</block>
  <block id="5d07aebfbe36ac522f2e416e3efcad81" category="list-text">您不希望将新控制器作为新的 HA 对添加到集群中，并使用卷移动来迁移数据。</block>
  <block id="0218d5b45eb7cfed65f2674d40f1e479" category="list-text">您拥有管理 ONTAP 的经验，并对在诊断权限模式下工作的风险感到满意。</block>
  <block id="3c7466988f8b9287732208137373b802" category="list-text">如果要升级 MetroCluster 配置，则此配置为 4 节点或更高版本的 FC 配置，并且所有节点均运行 ONTAP 9.8 。</block>
  <block id="a72462c08c5bf7cce76e9fa18cdf8700" category="inline-link-macro">《 MetroCluster 升级，过渡和扩展指南》</block>
  <block id="5c9573e0d7a34c3cfb26db9f9354a9ce" category="paragraph">有关升级 MetroCluster IP 配置的信息，请参见 <block ref="bb7ef8f95645255fd63bda26e8cf0d00" category="inline-link-macro-rx"></block>。</block>
  <block id="f25ecc85a7d953e00ca5f626eeed2a96" category="admonition">您可以对此操作步骤使用 NetApp 存储加密（ NSE ）和 NetApp 卷加密（ NVE ）。</block>
  <block id="2b378caa5145e2c7adf8d8e9a477ac03" category="paragraph">下表显示了控制器升级支持的型号列表。</block>
  <block id="f37bbd4cc778d5861294352bef9c1c7f" category="cell">旧控制器</block>
  <block id="cfdade9e474e805958704ec0836f18ac" category="cell">更换控制器</block>
  <block id="8c06a9afcd20cc8675f878a8e07e16ab" category="cell">FAS8020 ， FAS8040 ， FAS8060 ， FAS8080</block>
  <block id="c86ccf041137a3e913e3e89ed65dbff5" category="cell">FAS8200 ， FAS8300 ， FAS8700 ， FAS9000</block>
  <block id="96e7c50f9e1d1f9b66d5ab1dbe5d047a" category="cell">AFF8020 ， AFF8040 ， AFF8060 ， AFF8080</block>
  <block id="34a20edcb9328546b8a5f23795f35b92" category="cell">AFF A300 ， AFF A400 ， AFF A700 ， AFF A800*</block>
  <block id="c37feb3492d999b3f216448183986be2" category="cell">FAS8200</block>
  <block id="33f30bea35826525ddc350a931a3e60e" category="cell">FAS8700 ， FAS9000 ， FAS8300</block>
  <block id="c78a423f3132ee2ac4f4f4c1fa5d4859" category="cell">AFF A300</block>
  <block id="7010740b589a6730f87d5fcedfcd0abc" category="cell">AFF A700 ， AFF A800* ， AFF A400</block>
  <block id="4852954d031f57b417813707e91dd5bd" category="admonition">如果上表不包含您的控制器升级型号组合，请联系技术支持。</block>
  <block id="0083da0657f029386d4dd54adc7e7631" category="inline-link-macro">检查并配置 node3 上的 UTA/UTA2 端口，步骤 23</block>
  <block id="f67f192cd82e6b4f9a7acfc19a4286b5" category="inline-link-macro">检查并配置 node4 上的 UTA/UTA2 端口，步骤 23</block>
  <block id="93491adf85ea282cfe0c7125f025c90f" category="list-text">有关 A800 系统所需的其他步骤，请转至第节中引用 A800 的步骤 <block ref="4a6bfe6a62ba240adccf3a2b33efa3db" category="inline-link-macro-rx"></block>或 <block ref="bbd1ffa0c143d6a108996dc2f07d0723" category="inline-link-macro-rx"></block>。</block>
  <block id="d88b3ffa1ad4af16e4f56f5653cfa84a" category="paragraph">如果您希望使用其他方法升级控制器硬件并愿意执行卷移动，请使用 <block ref="9cc0d5221a9e998f923428a347033ebc" category="inline-link-macro-rx"></block> 而是。请参见 <block ref="292163533a147210a514360785f12599" category="inline-link-macro-rx"></block> 以访问 ONTAP 9 产品文档。</block>
  <block id="d3569e9c14f07d7684dcc0e8f1b714ab" category="paragraph">如果 node3 与 node1 上安装的 ONTAP 9 版本不同，则需要对其进行网络启动。安装 node3 后，从 Web 服务器上存储的 ONTAP 9 映像启动它。然后，您可以按照中的说明将正确的文件下载到启动介质设备，以供后续系统启动 <block ref="61665dbc7133bd75f8603aa8031b8059" category="inline-link-macro-rx"></block>。</block>
  <block id="5f56b9ee14bb00ec66c65389cd2e7591" category="list-text">如果要升级连接到存储阵列的 V 系列系统或安装了 FlexArray 虚拟化软件并连接到存储阵列的系统，则需要完成升级 <block ref="a21f3b2098abe7275d608a6a9c864195" category="inline-xref-macro-rx"></block> 到 <block ref="e3c5e60b4239704a2e70f19799b9b009" category="inline-xref-macro-rx"></block>，然后退出本节并按照中的说明进行操作 <block ref="8c986217270abd0ebe0e339e0d9d531b" category="inline-link-macro-rx"></block> 和 <block ref="e8f8d63644de968e3b5945cef425ba46" category="inline-link-macro-rx"></block> 根据需要输入相应部分，在维护模式下输入命令。然后，您必须返回到此部分并继续使用 <block ref="3139ad98428111e167d1cbeb5cf5398c" category="inline-xref-macro-rx"></block>。</block>
  <block id="98ed937d1a233f5842b98541cb239ee5" category="list-text">如果要升级具有存储磁盘的系统，则需要完成整个部分，然后转到 <block ref="8c986217270abd0ebe0e339e0d9d531b" category="inline-link-macro-rx"></block> 和 <block ref="e8f8d63644de968e3b5945cef425ba46" category="inline-link-macro-rx"></block> 部分，在集群提示符处输入命令。</block>
  <block id="e694ffdf4927373e2452f8ed83ed44a4" category="list-text">【第 1 步】确保为 node3 预留机架空间。</block>
  <block id="29c2b1d89a2c1fb12556096fc5b5d9f9" category="list-text">根据适用于您的节点型号的 * 安装和设置说明 * ，在机架中安装 node3 。</block>
  <block id="5528857f98fded77afccd9d97a9a0711" category="list-text">【第 3 步】为节点 3 布线，将节点 1 的连接移至节点 3 。</block>
  <block id="4c4ac907348b91d2c9ac0330e07430a2" category="paragraph">按照 * 安装和设置说明 * 或使用缆线连接以下连接 <block ref="86f7609c999f49f3dc914db25956e703" category="inline-link-macro-rx"></block> 对于 node3 平台，相应的磁盘架指南和 <block ref="fce145d95584367b9c4d78d9aa5ffce3" category="inline-link-macro-rx"></block>：</block>
  <block id="398c19d15dc5160b9d5d197fabfe0bca" category="list-text">【第 4 步】打开 node3 的电源，然后在控制台终端按 Ctrl-C 以访问启动环境提示符，从而中断启动过程。</block>
  <block id="327f074dcd0116fe45e96ad17501349a" category="list-text">如果您在中看到警告消息，请执行以下操作 <block ref="a4882b71f5935aea43154f35b1a6d350" category="inline-xref-macro-rx"></block>，执行以下操作：</block>
  <block id="340b2cb6f890104de63ad67a09f43086" category="admonition">* 请勿覆盖延迟 * ； * 如果不允许电池充电，可能会导致数据丢失 * 。请参见 <block ref="61665dbc7133bd75f8603aa8031b8059" category="inline-link-macro-rx"></block>。</block>
  <block id="f806530cf3b45af78df526f1094bd3e0" category="paragraph">` &lt;path_to_the_web-accessible_directory&gt;` 应指向您在部分中下载 ` &lt;ontap_version&gt;_image.tgz` 的位置 <block ref="61665dbc7133bd75f8603aa8031b8059" category="inline-link-macro-rx"></block>。</block>
  <block id="822492abb31be3af3c5ef9e03f837fef" category="list-text">【第 12 步】使用以下命令验证控制器和机箱是否已配置为 ha ：</block>
  <block id="901d6f263055480c317d4fb73367242e" category="list-text">【第 14 步】使用以下命令退出维护模式：</block>
  <block id="40b70e432cec417877bce1160c94e7d1" category="list-text">在 node2 上，使用以下命令检查系统日期，时间和时区：</block>
  <block id="514d59f6bfe33257f09b3284bc0e0e88" category="list-text">【第 17 步】如有必要，请使用以下命令在 node3 上设置日期：</block>
  <block id="baf657561f00e2317ed875c046ecf04f" category="list-text">【第 19 步】如有必要，请使用以下命令在 node3 上设置时间：</block>
  <block id="7f5317fe7f1086a3ecd999e737898e88" category="list-text">【第 20 步】如有必要，请使用以下命令在 node3 上设置配对系统 ID ：</block>
  <block id="9a665749d52d15cc00e5dbd8de070139" category="list-text">在新节点的启动加载程序中，需要设置 `partner-sysid` 参数。对于 node3 ， `partner-sysid` 必须为 node2 。使用以下命令验证 node3 的 `partner-sysid` ：</block>
  <block id="dabc7422e73e40e627546bedcc5b454c" category="cell">转至 <block ref="3139ad98428111e167d1cbeb5cf5398c" category="inline-xref-macro-rx"></block></block>
  <block id="e86f621febc99ddab0195f5f05568e08" category="list-text">转至第节 <block ref="cb8a8fa5f7925ca8b3746fff5285473e" category="inline-link-macro-rx"></block> 并完成本节中的各小节。</block>
  <block id="1ec1507884e522d42b22966f04309116" category="list-text">返回到此部分，完成从开始的其余步骤 <block ref="3139ad98428111e167d1cbeb5cf5398c" category="inline-xref-macro-rx"></block>。</block>
  <block id="e5b2b8d4f2c36968154eb99e73011604" category="list-text">【第 23 步】将新节点的 FC 启动程序端口添加到交换机分区。</block>
  <block id="76fef0258c09a87fd4b88a18f7fc6207" category="paragraph">如果您的系统具有磁带 SAN ，则需要对启动程序进行分区。如果需要，请参考将板载端口修改为启动程序 <block ref="f70f149eedc7d02fc590b5893f57e9ad" category="inline-link-macro-rx"></block>。有关分区的详细说明，请参见存储阵列和分区文档。</block>
  <block id="2f9758bb2cf060c406de214568f0d242" category="list-text">【第 28 步】使用以下命令将节点启动到启动菜单：</block>
  <block id="ad5fe31629462430777c30250624a4fc" category="inline-link-macro">检查并配置节点 3 上的 UTA/UTA2 端口，步骤 15</block>
  <block id="1b2f442cbaf0caadd58b415472b4a803" category="paragraph">如果您没有 FC 或 UTA/UTA2 配置，请执行 <block ref="a79d79d8bed5cbfea64fddf94ad4ee68" category="inline-link-macro-rx"></block> 以便 node3 可以识别 node1 的磁盘。</block>
  <block id="6b67f345cce4e3d0174c82f41977064c" category="list-text">【第 29 步】对于 MetroCluster 配置， V 系列系统以及将 FlexArray 虚拟化软件连接到存储阵列的系统，您必须在 node3 上设置和配置 FC 或 UTA/UTA2 端口，以检测连接到节点的磁盘。要完成此任务，请转至第节 <block ref="c1d98918f251b16ee7804a1a99dc8cb2" category="inline-link-macro-rx"></block>。</block>
  <block id="46b044633ef6f16ddbc579c9f0bbaa7c" category="summary">这是测试摘要</block>
  <block id="eeb639c3d3a71ea32a9414c5e5e05d42" category="summary">在将 node1 替换为 node3 之前，必须移动非根聚合。</block>
  <block id="7de24b16e7313de118da7559fecd8fd4" category="doc">将节点 1 拥有的非根聚合和 NAS 数据 LIF 重新定位到节点 2</block>
  <block id="dd019fbf939676387b29c50185dd26bb" category="paragraph">在将 node1 替换为 node3 之前，必须先将非根聚合和 NAS 数据 LIF 从 node1 移动到 node2 ，然后再最终将 node1 的资源移动到 node3 。</block>
  <block id="231d6537090582d94372987139e9087b" category="paragraph">开始任务时，此操作应已暂停；您必须手动恢复此操作。</block>
  <block id="c7a9927e0e434c0c91c5b27e8dfc438a" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_auto_relocate_non_root_aggr_nas_lifs_from_node1_to_node2_steps_1_4.adoc]]</block>
  <block id="fa39e98dea804607ace91ae82c9543d7" category="list-text">`步骤 5]] 如果任何 LIF 已关闭，请使用以下命令将 LIF 的管理状态设置为` up ，每个 LIF 一次：</block>
  <block id="a6177fa5aafac8280f0868d4d136dd02" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -home-node &lt;nodename&gt; - status-admin up`</block>
  <block id="fac54699f861d36d543f619170eba56f" category="summary">升级后，您可以通过 NetApp 支持站点停用旧系统。</block>
  <block id="e15f73e6bbe4295992efeff1359c9642" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/ru_auto_decommission_old_system.adoc]]</block>
  <block id="45b074dad328c980b5542326d8a35285" category="list-text">使用以下命令验证 MetroCluster 组件是否运行正常：</block>
  <block id="2a5fbc402ff4a1c026c937ca08441422" category="list-text">在 MetroCluster check run` 操作完成后，使用以下命令查看结果：</block>
  <block id="e3ccf677e56366a417a172944cdd9599" category="paragraph">MetroCluster check show`</block>
  <block id="070a4bbedae89743ad2f6646a3f23205" category="paragraph">大约五分钟后，将显示以下结果：</block>
  <block id="f64554c8f67e219a4c294d4f9e13de5c" category="list-text">使用以下命令检查正在运行的 MetroCluster 检查操作的状态：</block>
  <block id="fbd55aa6c7d3ee9ec90836dfa01b62d2" category="paragraph">MetroCluster 操作历史记录显示 -job-id 38`</block>
  <block id="2f5dc5231215e1becf893a212ca2f4ef" category="list-text">使用以下命令验证是否没有运行状况警报：</block>
  <block id="838f9a3aa0c54c620c1dab5cccc98ca5" category="paragraph">`s系统运行状况警报显示`</block>
  <block id="9ee1c91750c5940467f5ebf5aa17fc5a" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/ru_auto_retif_node1.adoc]]</block>
  <block id="8c0489611df3c9267665a7d99d204fa2" category="summary">迁移 LIF 后，它们可能无法在迁移到阶段 2 ，阶段 3 或阶段 5 后联机。</block>
  <block id="06d473a91334306e0ea337d0cf403b02" category="doc">LIF 迁移失败</block>
  <block id="8fc5e587b615f796c0e6e519e500f09c" category="list-text">验证端口 MTU 大小是否与源节点的端口 MTU 大小相同。</block>
  <block id="f1dc53f85f175f3393f82fdfda459a06" category="paragraph">例如，如果源节点上的集群端口 MTU 大小为 9000 ，则目标节点上的 MTU 大小应为 9000 。</block>
  <block id="0be497933ebed90434432b1367f6ac50" category="list-text">如果端口的物理状态为 `down` ，请检查网络缆线的物理连接。</block>
  <block id="eb04decd1d026d2a659ebfb3bc27a9e2" category="summary">验证 node3 安装</block>
  <block id="853a38843b4d12d75ba15c53177a9637" category="paragraph">您必须验证 node1 中的物理端口是否正确映射到 node3 上的物理端口。这样， node3 便可在升级后与集群中的其他节点以及网络进行通信。</block>
  <block id="bc407a0ada7e83021d05ff7bcc09d6d5" category="paragraph">从捕获有关新节点上端口的信息 <block ref="e9a08380ac48c4cddc2ba1523ab880f9" category="inline-link-macro-rx"></block>。您将在本节稍后部分使用此信息。</block>
  <block id="3e1a89708cfe8d08896ed24a0d0be5e8" category="paragraph">物理端口布局可能因节点型号而异。当新节点启动时， ONTAP 将尝试确定应托管集群 LIF 的端口，以便自动达到仲裁。</block>
  <block id="e81669be921c5bd20d872e337c5b204d" category="paragraph">如果 node1 上的物理端口未直接映射到 node3 上的物理端口，请执行下一节 <block ref="871101a3a410248482eefafa62332b63" category="inline-xref-macro-rx"></block> 必须用于修复网络连接。</block>
  <block id="3e0da2be1046cdf5d552f8adaa98c3ae" category="paragraph">安装并启动 node3 后，您必须验证是否已正确安装它。您必须等待 node3 加入仲裁，然后恢复重新定位操作。</block>
  <block id="60d0d1447a22e8eb1a7dd321b2eec56f" category="paragraph">此时，在操作步骤中，操作将暂停，因为 node3 加入仲裁。</block>
  <block id="dfcf569eaa927a8ae2862b1d6237c4d4" category="list-text">使用以下命令验证 node3 是否已加入仲裁：</block>
  <block id="0f452669c01e49cb27b82dac8c6f9656" category="paragraph">`cluster show -node node3 -fields health`</block>
  <block id="a5c25ebe0ba44233d498c66cb77e22f2" category="paragraph">`health` 字段的输出应为 `true` 。</block>
  <block id="c94abf3de6c49d4ca1f1b4188576f36e" category="list-text">使用以下命令验证 node3 是否与 node2 属于同一集群，以及是否运行正常：</block>
  <block id="b3f3a0e3e16f407c072321de6936bb87" category="list-text">使用以下命令切换到高级权限模式：</block>
  <block id="248f892426f89c07bc5999439096f3e0" category="paragraph">`set advanced`</block>
  <block id="a7482c3d64af222d43f7c45fbbe19e5f" category="list-text">使用以下命令检查控制器更换操作的状态，并验证其是否处于暂停状态以及在 node1 暂停之前的状态，以便执行安装新控制器和移动缆线的物理任务：</block>
  <block id="8005ab9a73c38cc367636a0ec9e8fa35" category="paragraph">`ssystem controller replace show`</block>
  <block id="218d1d2c084970e58ed8b40b9940967e" category="list-text">如果您正在处理 MetroCluster 系统，请验证是否已为 MetroCluster 配置正确配置更换的控制器； MetroCluster 配置应处于运行状况良好的状态。请参见 <block ref="e3d28e9e05862b41999f2936501ebd43" category="inline-link-macro-rx"></block>。</block>
  <block id="cc3fae395501f043309fdf0319483db7" category="paragraph">在 MetroCluster 节点 node3 上重新配置集群间 LIF ，并检查集群对等关系以恢复 MetroCluster 节点之间的通信，然后再继续执行步骤 6 。</block>
  <block id="d0b15ca69d5b7ac66ee88fbd3523a0ce" category="paragraph">使用以下命令检查 MetroCluster 节点状态：</block>
  <block id="ecada3140a47012aab89f14c63ba9190" category="paragraph">`MetroCluster node show`</block>
  <block id="158df1168b205cd4f462c584fe94051a" category="list-text">使用以下命令恢复控制器更换操作。</block>
  <block id="2a2c4f4e7fd268d1d4c0dda8807d69e2" category="list-text">控制器更换将暂停以进行干预，并显示以下消息：</block>
  <block id="df707e7f3bf510f8eda6e81fa41cf3ce" category="admonition">在本指南中， _re-creating VLAN ， ifgrp 和 broadcast domains_一 节已重命名为 _Restore node3_ 上的网络配置。</block>
  <block id="6f399bf4f62f96a02d91e295630626e7" category="list-text">在控制器更换处于暂停状态的情况下，继续执行本文档的下一节以还原节点上的网络配置。</block>
  <block id="4ab15a5901ac29ba8b22502370d01f1b" category="section-title">还原 node3 上的网络配置</block>
  <block id="50aa547709666157235d709c3c40d254" category="paragraph">确认 node3 处于仲裁状态并可与 node2 通信后，请确认 node3 上显示了 node1 的 VLAN ，接口组和广播域。此外，验证是否已在其正确的广播域中配置所有 node3 网络端口。</block>
  <block id="6d010a137f21b95223102a401a47ed0d" category="paragraph">有关创建和重新创建 VLAN ，接口组和广播域的详细信息，请参见 <block ref="4acfce26e4c9287fa50f5c5a9d818db4" category="inline-link-macro-rx"></block>。</block>
  <block id="feba0b87d85f33bf07f3f8b61a6c650a" category="list-text">【第 1 步】使用以下命令列出已升级的 node1 （称为 node3 ）上的所有物理端口：</block>
  <block id="8e80c0200aab07655785cb1bec3cc1b7" category="paragraph">`network port show -node node3`</block>
  <block id="7d18d6d6569ac51a685a80b4877c4f98" category="paragraph">此时将显示节点上的所有物理网络端口， VLAN 端口和接口组端口。在此输出中，您可以看到 ONTAP 已将任何物理端口移至 `集群` 广播域。您可以使用此输出来帮助确定应将哪些端口用作接口组成员端口， VLAN 基本端口或独立物理端口来托管 LIF 。</block>
  <block id="698ba9c7ea609460c6a8e38a3d7ce47c" category="list-text">使用以下命令列出集群上的广播域：</block>
  <block id="3723e98cfe679a4d7a6a396b19de8982" category="paragraph">`broadcast-domain show`</block>
  <block id="fa323e7b23a87d19368644754f3f3d11" category="list-text">【第 3 步】使用以下命令列出 node3 上所有端口的网络端口可访问性：</block>
  <block id="5e805181dd219e5299df90fe82dbae5d" category="paragraph">`网络端口可访问性显示`</block>
  <block id="a4780c06a89c299119583f29f32ac093" category="paragraph">您应看到类似于以下示例的输出：</block>
  <block id="e940af53f7d36aaa1ead918494c5c508" category="paragraph">在上面的示例中， node1_node3 是在更换控制器后刚刚启动的。某些端口无法访问其预期广播域，必须进行修复。</block>
  <block id="d640102c0f1d010e832d7ab6c998976d" category="list-text">【 auto_verify_3_step4]] 修复 node3 上每个端口的可访问性状态不是 `ok` 的可访问性。首先对任何物理端口运行以下命令，然后对任何 VLAN 端口运行以下命令，一次运行一个：</block>
  <block id="d8c7ef2c85a7a25537cac9242cffa1bd" category="paragraph">`network port reachability repair -node &lt;node_name&gt; -port &lt;port_name&gt;`</block>
  <block id="5b3590915b0de4e44a7e6eecff6a5a24" category="paragraph">您应看到类似于以下示例的输出：</block>
  <block id="926bbd76240f31054ef4744babd679da" category="paragraph">对于可访问性状态可能与当前所在广播域的可访问性状态不同的端口，应显示一条警告消息，如上所示。根据需要查看端口和问题解答 `y` 或 `n` 的连接。</block>
  <block id="9119170c03a257bc65a7eeaac3022986" category="paragraph">使用以下命令验证所有物理端口是否具有预期可访问性：</block>
  <block id="763c4b6560b672163a09cf2e67ba8d89" category="paragraph">在执行可访问性修复时， ONTAP 会尝试将端口放置在正确的广播域中。但是，如果无法确定某个端口的可访问性，并且该端口不属于任何现有广播域，则 ONTAP 将为这些端口创建新的广播域。</block>
  <block id="475bdd7eeca873ac007d2e8d1ed1d0d7" category="list-text">【第 5 步】如果接口组配置与新控制器物理端口布局不匹配，请使用以下步骤进行修改。</block>
  <block id="a0c9e092b3640057dbbb2fad95c8d7be" category="list-text">您必须先从其广播域成员资格中删除接口组成员端口的物理端口。您可以使用以下命令执行此操作：</block>
  <block id="a7f60658094ae5cd0040096989b61fd4" category="paragraph">`network port broadcast-domain remove-ports -broadcast-domain &lt;broadcast-domain_name&gt; -ports &lt;node_name ： port_name&gt;`</block>
  <block id="994e94a4c4f782b78cbc1338d420e089" category="list-text">使用以下命令将成员端口添加到接口组：</block>
  <block id="a53c80be8dbadd4ecfb18eacac1d405c" category="paragraph">`network port ifgrp add-port -node &lt;node_name&gt; - ifgrp &lt;ifgrp&gt; -port &lt;port_name&gt;`</block>
  <block id="0abff6a62b49a7204a8ea4607845ec05" category="list-text">在添加第一个成员端口后大约一分钟，接口组会自动添加到广播域中。</block>
  <block id="024d7648058890605a7a03bd32714b91" category="list-text">使用以下命令验证接口组是否已添加到相应的广播域：</block>
  <block id="d8f93cb99c84b71cefbdf673772842c8" category="paragraph">`network port reachability show -node &lt;node_name&gt; -port &lt;ifgrp&gt;`</block>
  <block id="78c17820b3f1666fe682806666adfaa4" category="paragraph">如果接口组的可访问性状态不是 `ok` ，请使用以下命令将其分配给相应的广播域：</block>
  <block id="39f16ed05d559ba39f10f8313fdbdbf7" category="paragraph">`network port broadcast-domain add-ports -broadcast-domain &lt;broadcast_domain_name&gt; -ports &lt;node ： port&gt;`</block>
  <block id="cb5bf72c08bc8139f3d3b440a9e7819b" category="list-text">通过执行以下步骤，将适当的物理端口分配给 `集群` 广播域：</block>
  <block id="4fa02207949b327defb07a75015b6ba5" category="list-text">使用以下命令确定哪些端口可访问 `集群` 广播域：</block>
  <block id="a2904a68bb127cf5751716be508a8cd4" category="paragraph">`network port reachability show -reachable-broadcast-domains cluster ：集群`</block>
  <block id="4a60959ffcc7b5a5c96fd844367e2fcf" category="list-text">使用以下命令修复可访问 `集群` 广播域的任何端口，如果其可访问性状态为 NOT `ok` ：</block>
  <block id="9c0ec98274edaf49b54f8a682182e736" category="paragraph">`network port reachability repair -node &lt;node_name&gt; -port &lt;port_name&gt;`</block>
  <block id="1a385242d9fb60423161c8ec41af6b34" category="list-text">【第 7 步】使用以下命令之一将其余物理端口移动到其正确的广播域中：</block>
  <block id="fc794a16843cc25cbaf14628270ab5d2" category="paragraph">`network port broadcast-domain remove-port`</block>
  <block id="db5edb9657d0577afb5f42b19b5b760f" category="paragraph">`网络端口 broadcast-domain add-port`</block>
  <block id="ce885b3d303810e3d85ace1f89c4a065" category="paragraph">确认不存在不可访问或意外的端口。使用以下命令检查所有物理端口的可访问性状态，并检查输出以确保状态为 `ok` ：</block>
  <block id="add7de11dea94372ab92280144dd2eae" category="paragraph">`网络端口可访问性 show -detail`</block>
  <block id="652d99b8bb896eacc70cc28d4cea6df9" category="list-text">【第 8 步】使用以下步骤还原可能已被替换的任何 VLAN ：</block>
  <block id="f24690e54f316db66c2926980f2199ff" category="list-text">使用以下命令列出已替换的 VLAN ：</block>
  <block id="25b072f1ccd78f519330142d52dcdabc" category="paragraph">`displaced VLAN show`</block>
  <block id="551f04031696758c1c256f1c90e57b39" category="paragraph">此时应显示如下输出：</block>
  <block id="4ce70b1cc6016ee742451edb1c226478" category="list-text">使用以下命令还原从先前的基础端口中替换的 VLAN ：</block>
  <block id="525a1c0d24b5d4c8e9116b07730aee42" category="paragraph">`displaced VLAN restore`</block>
  <block id="e08a0549a69b4bf0d4b807833ac0b586" category="paragraph">以下示例显示了将已从接口组 a0a 中移出的 VLAN 还原到同一接口组的过程：</block>
  <block id="f222081117a7c9410603cf0e49475859" category="paragraph">以下是将端口 e0e 上的已替换 VLAN 还原到 e0h 的示例：</block>
  <block id="2a31dfadfe9a33da55e9d278be8596a4" category="paragraph">成功还原 VLAN 后，将在指定的目标端口上创建已替换的 VLAN 。如果目标端口是接口组的成员或目标端口已关闭，则 VLAN 还原将失败。</block>
  <block id="aad2ee0340b449143fc7eaa87d78ba8b" category="paragraph">等待大约一分钟，以便将新还原的 VLAN 放置到其相应的广播域中。</block>
  <block id="0d659399d58c646652e9fc4a4b40b32f" category="list-text">根据需要为不在 `displaced - vlan show` 输出中，但应在其他物理端口上配置的 VLAN 端口创建新的 VLAN 端口。</block>
  <block id="15d3f7289459cadee8fa890171f70a33" category="list-text">在完成所有端口修复后，使用以下命令删除任何空广播域：</block>
  <block id="8cb8d05546274856c8c2cb56b7cd62ac" category="paragraph">`broadcast-domain delete -broadcast-domain &lt;broadcast_domain_name&gt;`</block>
  <block id="033259d4680e9721b6e56691dfc778fe" category="list-text">【第 10 步】使用以下命令验证端口可访问性：</block>
  <block id="94e75d181c02739e78c94503deab7a67" category="paragraph">如果所有端口均已正确配置并添加到正确的广播域中，则 `network port reachability show` 命令应将所有已连接端口的可访问性状态报告为 `ok` ，对于无物理连接的端口，此状态报告为 `no-reachability` 。如果任何端口报告的状态不是这两个端口，请按照中的说明执行可访问性修复并在其广播域中添加或删除端口 <block ref="647eca8a7ea8d4d8434879df3c364180" category="inline-xref-macro-rx"></block>。</block>
  <block id="63fe88791a357ac0ce2d8525afc99e01" category="list-text">使用以下命令验证是否已将所有端口置于广播域中：</block>
  <block id="47cd03a2fa721b9f4f83dca38829afea" category="paragraph">`network port show`</block>
  <block id="27f8deebdeb6d0eda41bc875bbb038cc" category="list-text">使用以下命令验证广播域中的所有端口是否配置了正确的最大传输单元（ MTU ）：</block>
  <block id="3ef90a77774be1f83d79d3a57d347bee" category="paragraph">`network port broadcast-domain show`</block>
  <block id="bf3f92b1cc4c69581f2185ebf4603ed4" category="list-text">使用以下步骤还原 LIF 主端口，指定需要还原的 Vserver 和 LIF 主端口（如果有）：</block>
  <block id="19de6d359bf95e7f554e0aef8496ed6c" category="list-text">使用以下命令列出已替换的任何 LIF ：</block>
  <block id="b24b42eec37d4f62111bc66268ece07c" category="paragraph">`displaced interface show`</block>
  <block id="0d5b2e314d8c2b27c73937fb2c6772d6" category="list-text">使用以下命令还原 LIF 主节点和主端口：</block>
  <block id="942a2e20bfd5086873f5ad24de65d688" category="paragraph">`displaced interface restore-home-node -node &lt;node_name&gt; -vserver &lt;vserver_name&gt; - lif-name &lt;LIF_name&gt;`</block>
  <block id="4288666924e9210fcb305970ab5bb16c" category="list-text">使用以下命令验证所有 LIF 是否都具有主端口且已由管理员启动：</block>
  <block id="d5a3621c2468f29ad4fa0ab73f4bd80a" category="paragraph">`network interface show -fields home-port ， status-admin`</block>
  <block id="6c0e9c6d05c6f91d2edf95d8ad8f212d" category="paragraph">在第 1 阶段，您必须准备好节点进行升级并运行一系列预检。您可能需要为磁盘重新设置密钥以进行存储加密。您还必须准备通过网络启动新控制器。</block>
  <block id="94f2dfd916315926f685ba65e48c6e25" category="list-text"><block ref="94f2dfd916315926f685ba65e48c6e25" category="inline-link-macro-rx"></block></block>
  <block id="a458f1a1bdbd6378f6a49101c110f3e2" category="list-text"><block ref="a458f1a1bdbd6378f6a49101c110f3e2" category="inline-link-macro-rx"></block></block>
  <block id="8b620239bad9bdcd3c45247820c7a988" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/r_auto_set_fc_or_UTA_uta2_confgig_node3_intro 。 adoc[]</block>
  <block id="9ddd1c356c6ec43f630dd03fa71725d5" category="list-text">如果 node3 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，并且您要升级具有存储磁盘的系统，则可以跳至 <block ref="d402045f7964b6e0cf4fcac8fa4d9846" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="be6b715addf3303698d174b13e915620" category="list-text">但是，如果您使用的是 V 系列系统或安装了 FlexArray 虚拟化软件和存储阵列的系统，并且 node3 没有板载 FC 端口，板载 UTA/UTA 端口或 UTA/UTA2 卡，请返回到 _Install and boot node3_ 部分并继续执行中的部分 <block ref="279060155dcadaa13689560d46e381cb" category="inline-link-macro-rx"></block>。</block>
  <block id="d917b6c7b42db6943a455ef6af8b414f" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/r_auto_set_fc_or_UTA_uta2_confgig_node3_choices.adoc]]</block>
  <block id="a763050addde0db4a07e19b2d04b1237" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/rm_auto_config_fc_ports_node3.adoc]]</block>
  <block id="d2dce3cff13fd2c8259fdef7c637226e" category="list-text">【 auto_check3_step8]] 执行以下操作之一：</block>
  <block id="dc1d267429f36a93fe45402105c83a9b" category="list-text">如果 node3 具有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请转至部分 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block>。</block>
  <block id="09a561f3362ed88514963066e3d7b720" category="list-text">如果 node3 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请跳过部分 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block> 然后转到部分 <block ref="35ed01fca1dde6c35ca197b89d2bbfc7" category="inline-link-macro-rx"></block>。</block>
  <block id="70d6bd3154ab38128a772f6268fea926" category="list-text">如果 node3 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请跳过部分 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block> 并返回到 _Install and boot node3_ 部分，然后在继续 <block ref="279060155dcadaa13689560d46e381cb" category="inline-link-macro-rx"></block>。</block>
  <block id="a74e65d44694577cd6490a79583dff8a" category="cell">转至 <block ref="e33bb2c935af60d67309f774bd9b33e2" category="inline-xref-macro-rx"></block>。</block>
  <block id="eb97cddf7fc62845fc1e4eea9c2d99cd" category="cell">跳过步骤 5 到步骤 12 ，然后转到 <block ref="1b9dfae277e309ab4a6eabe371e415ad" category="inline-xref-macro-rx"></block>。</block>
  <block id="c38c7f4981b1e1041fde50ff14eac24d" category="list-text">【 auto_check3_step5]] 执行以下操作之一：</block>
  <block id="19971734faa0d5692ce82090e92c08e4" category="cell">转至 <block ref="8636550629e708c32b80412fc9a4bd9f" category="inline-xref-macro-rx"></block></block>
  <block id="23cdc9078cbdc89882a254d05d67d976" category="cell">跳过第 7 步，转到 <block ref="c9ad15d95077080d869d1e4c8360803a" category="inline-xref-macro-rx"></block>。</block>
  <block id="da0cddf6f2fcc9355331e1d32bd6c782" category="list-text">【第 6 步】如果适配器处于启动程序模式，并且 UTA/UTA2 端口处于联机状态，请使 UTA/UTA2 端口脱机：</block>
  <block id="8538924568e2fc8f0f2a3823de803c1a" category="list-text">【 auto_check3_step7]] 如果当前配置与所需用途不匹配，请根据需要更改配置：</block>
  <block id="47677c5f320a3d7c211f1c3bf5ad457b" category="list-text">【 auto_check3_step8]] 验证设置：</block>
  <block id="315e31e9f839439e107a11b7ff7facb6" category="list-text">【第 9 步】验证设置：</block>
  <block id="3f9068a407bdbb378e93f4d5d6b9abe6" category="list-text">[[auto_check3_step12]] 执行以下操作之一：</block>
  <block id="66610f6c17cdd2f74ae18935d0791243" category="cell">转至 <block ref="35ed01fca1dde6c35ca197b89d2bbfc7" category="inline-link-macro-rx"></block>。</block>
  <block id="f0d8df7e74601e48e696d4b303665234" category="cell">返回到 _Install and boot node3_ 部分，然后继续执行 <block ref="279060155dcadaa13689560d46e381cb" category="inline-link-macro-rx"></block>。</block>
  <block id="56b97cceb683f15e6179871d3991edcc" category="list-text">【 auto_check3_step13]] 退出维护模式：</block>
  <block id="0e0a51d5d131ec116dbea50118d432b6" category="list-text">【第 14 步】运行 `boot_ontap menu` 将节点启动到启动菜单。如果要升级到 A800 ，请转至 <block ref="8de8415e5ddf050c51dc9df1ad54385b" category="inline-xref-macro-rx"></block>。</block>
  <block id="8818e56033c79a7d315b502b9d66c4b0" category="list-text">在 node3 上，转到启动菜单并使用 22/7 并选择隐藏选项 `boot_after_controller_replacement` 。在提示符处，输入 node1 将 node1 的磁盘重新分配给 node3 ，如下例所示。</block>
  <block id="78c17ca9081fa3b223c0d18eaf556df4" category="list-text">【第 16 步】如果系统进入重新启动循环并显示消息 `未找到磁盘` ，则表示系统已将 FC 或 UTA/UTA2 端口重置回目标模式，因此无法查看任何磁盘。要解决此问题，请继续 <block ref="cc511b4dbeed99af4a19f83ac3e97f04" category="inline-xref-macro-rx"></block> to <block ref="8dac798a0974640f6cae187a1dbe2d57" category="inline-xref-macro-rx"></block>或转到第节 <block ref="35ed01fca1dde6c35ca197b89d2bbfc7" category="inline-link-macro-rx"></block>。</block>
  <block id="014925696b96cf52282301c416016c05" category="list-text">在自动启动期间按 `Ctrl-C` 在 `LOADER&gt;` 提示符处停止节点。</block>
  <block id="46f0d1accd1916f786a903c85ad13b0f" category="list-text">在 LOADER 提示符处，进入维护模式：</block>
  <block id="8e26679b9fca64c8419387ed5ddbd066" category="list-text">在维护模式下，显示先前设置的所有启动程序端口，这些端口现在均处于目标模式：</block>
  <block id="4306b082c2e67956b1918aaea01dbeec" category="list-text">【第 20 步】验证端口是否已更改为启动程序模式：</block>
  <block id="4c830d7f040ff17fe7d01c1e6f446b3f" category="list-text">【第 21 步】退出维护模式：</block>
  <block id="9ac7575b190440f1f2d6fa8d83610ea2" category="list-text">在 LOADER 提示符处启动：</block>
  <block id="eed6529f7dcdfb878ddd910a0f3cb526" category="list-text">【 ｛ auto_check3_step23]] 如果要从具有外部磁盘的系统升级到支持内部和外部磁盘的系统（例如， AFF A800 系统），请将 node1 聚合设置为根聚合，以确保 node3 从 node1 的根聚合启动。要设置根聚合，请转到启动菜单并选择选项 `5` 以进入维护模式。</block>
  <block id="d354d3c68fd2aba01b58a01642bf6c97" category="list-text">检查 node1 聚合的 RAID ，丛和校验和信息：</block>
  <block id="5447152461820ee4fbd4988f18add272" category="list-text">检查 node1 聚合的状态：</block>
  <block id="beee7076b2d8936ef1f0677a931d72f4" category="list-text">如有必要，将 node1 聚合置于联机状态：</block>
  <block id="59bfd9205852a4f57899d2ed024d5fcf" category="list-text">阻止 node3 从其原始根聚合启动：</block>
  <block id="7dd49fac37eb0c12415d30414f193060" category="list-text">将 node1 根聚合设置为 node3 的新根聚合：</block>
  <block id="d788db47fa7ed7d234dcdfbb86c17a57" category="list-text">验证 node3 的根聚合是否脱机，从 node1 接管的磁盘的根聚合是否联机并设置为 root ：</block>
  <block id="9e4dddd26994fffb9e8ecadccc1f22a8" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_auto_relocate_non_root_aggr_nas_lifs_from_node2_to_node3_INTR_STEK_4.adoc]]</block>
  <block id="99988efb9efcf982f67af1157e609379" category="list-text">【第 5 步】输入以下命令并检查输出，验证 node2 上是否没有剩余数据 LIF ：</block>
  <block id="29b9e15ece46f3444e3509682e2aee9f" category="summary">在操作步骤中物理装入 node3 和 node4 后，您可能需要通过网络启动它们。</block>
  <block id="e2ad41f74e04c371eb256f2ff6f29e96" category="paragraph">在操作步骤中物理装入 node3 和 node4 后，您可能需要通过网络启动它们。术语 `netboot` 表示您从远程服务器上存储的 ONTAP 映像启动。在准备网络启动时，您必须将 ONTAP 9 启动映像的副本放在系统可以访问的 Web 服务器上。</block>
  <block id="135b308ed83c53f1516b7c754566d1c4" category="list-title">开始之前</block>
  <block id="1d32dacc20fe1feb077659fd0bebdc03" category="list-text">确认您可以使用系统访问 HTTP 服务器。</block>
  <block id="0373910e51252c7b97dcbea9f4942604" category="inline-link-macro">mysupport.netapp.com</block>
  <block id="d18d3fdc9de81c7f47b85e4268cc47b0" category="list-text">您需要从 NetApp 支持站点下载适用于您的平台和正确版本的 ONTAP 所需的系统文件 <block ref="e6e7a1a3b0c0c8a4d26c43c6ec1e93a1" category="inline-link-macro-rx"></block>。</block>
  <block id="48ab14af4b0090253431ed38e4cc2440" category="paragraph">如果新控制器上安装的 ONTAP 9 版本与原始控制器上安装的版本不同，则必须通过网络启动这些控制器。安装每个新控制器后，您可以从 Web 服务器上存储的 ONTAP 9 映像启动系统。然后，您可以将正确的文件下载到启动介质设备，以供后续系统启动。</block>
  <block id="021eb7b60dabf41949ccbeca660311c4" category="list-text">【 man_netboot_Step1]] 访问 NetApp 支持站点以下载用于执行系统网络启动的文件。</block>
  <block id="103ec41a89beb368e3357fad5f451a92" category="list-text">从 NetApp 支持站点的软件下载部分下载相应的 ONTAP 软件，并将 ` &lt;ontap_version&gt;_image.tgz` 文件存储在可通过 Web 访问的目录中。</block>
  <block id="5b1b8c3f072422a936e63f0d977e41e0" category="list-text">切换到可通过 Web 访问的目录，并验证所需文件是否可用。</block>
  <block id="9136934e518dd35933bb2332f534ab8d" category="cell">使用以下命令将 ` &lt;ontap_version&gt;_image.tgz` 文件的内容解压缩到目标目录： `tar -zxvf &lt;ontap_version&gt;_image.tgz` * 注意 * ：如果要在 Windows 上提取内容，请使用 7-Zip 或 WinRAR 提取网络启动映像。您的目录列表应包含一个包含内核文件的 netboot 文件夹： `netboot/kernel`</block>
  <block id="9162c7c3302da709d20d7af79c5dd94a" category="cell">您的目录列表应包含以下文件： ` &lt;ontap_version&gt;_image.tgz` * 注释 * ：您不需要提取 ` &lt;ontap_version&gt;_image.tgz` 文件的内容。</block>
  <block id="843ab277685630f82095416c5b9ae5a1" category="inline-link-macro">第 3 阶段</block>
  <block id="3510cbb504803f6d51a38904df9cd393" category="paragraph">您将使用中目录中的信息 <block ref="a4ac929e8d9516e71dbee962220fb3eb" category="inline-link-macro-rx"></block>。</block>
  <block id="1ccbd6f617ebfa1f7b6d1b6f16222909" category="summary">重新定位和停用节点 1</block>
  <block id="bbbe961bb71cae13cea3f5b878f4dbb9" category="doc">第 2 阶段。重新定位和停用节点 1</block>
  <block id="a87bccd109d187061a4e62dfad783508" category="paragraph">在阶段 2 中，您将 node1 聚合和 LIF 重新定位到 node2 ，记录 node1 信息，然后停用 node1 。此过程大部分是自动化的；操作将暂停，以便您可以检查其状态。您必须手动恢复此操作。</block>
  <block id="26d8a835bd371c5fa1c7d39b4f3d99fd" category="list-text"><block ref="26d8a835bd371c5fa1c7d39b4f3d99fd" category="inline-link-macro-rx"></block></block>
  <block id="ffe4503bdcec876d56d2c3e2cf5fcecb" category="list-text"><block ref="ffe4503bdcec876d56d2c3e2cf5fcecb" category="inline-link-macro-rx"></block></block>
  <block id="61665dbc7133bd75f8603aa8031b8059" category="list-text"><block ref="61665dbc7133bd75f8603aa8031b8059" category="inline-link-macro-rx"></block></block>
  <block id="a1bf01274d938e19b1e43eb57fc3c557" category="summary">您应验证 MetroCluster 配置的切换，修复和切回操作。</block>
  <block id="9759ad3dfabdb9631ec5fba47d71c313" category="doc">验证切换，修复和切回</block>
  <block id="a908b4effccc807f524f5774b19d7125" category="paragraph">使用中所述的协商切换，修复和切回过程 <block ref="26c4438b8d1b96b75d0e5192c822b491" category="inline-link-macro-rx"></block>。</block>
  <block id="8bd97ccee6af0cbb00432913fef95f69" category="summary">升级节点对。</block>
  <block id="15577d2c813239ab53fdc6f35d8a1dc5" category="doc">升级节点对</block>
  <block id="5634325c9c7a1ed8bb239cc0f0ecea96" category="paragraph">要升级节点对，您需要准备原始节点，然后对原始节点和新节点执行一系列步骤。然后，您可以停用原始节点。</block>
  <block id="731382e61ed8771d56493c8a21732cd6" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/ru_auto_stage6_overview.adoc]]</block>
  <block id="ec91f2dd66cb691d783fba58df9e214d" category="summary">升级节点对时可能会遇到故障。</block>
  <block id="d60c463bb4096f3ed4bd1618626dfe10" category="doc">故障排除</block>
  <block id="974201c51f98876fbd646fc435b7b26c" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/Rm_auto_troubleshoot .adoc]]</block>
  <block id="26f21c512ab4d5d4b123c5b8a953bb85" category="paragraph">您必须验证 node2 中的物理端口是否正确映射到 node4 上的物理端口。这样， node4 便可在升级后与集群中的其他节点以及网络进行通信。</block>
  <block id="085f23a7aa2a9d87a6bfa26f727889e5" category="paragraph">捕获有关新节点上端口的信息 <block ref="e9a08380ac48c4cddc2ba1523ab880f9" category="inline-link-macro-rx"></block>。您将在本节稍后部分使用此信息。</block>
  <block id="98ba93dd4de23479aa574bba16f17db7" category="paragraph">如果 node2 上的物理端口未直接映射到 node4 上的物理端口，请执行下一节 <block ref="364d871b05cd34ae9893fc6fc54b8984" category="inline-xref-macro-rx"></block> 必须用于修复网络连接。</block>
  <block id="e39c239523fa2335eed92e50ae0e2208" category="paragraph">安装并启动 node4 后，您必须验证是否已正确安装它。您必须等待 node4 加入仲裁，然后恢复重新定位操作。</block>
  <block id="ed944478e87ce6285850bdd8efb0399a" category="paragraph">此时，在操作步骤中，操作将暂停，因为 node4 加入仲裁。</block>
  <block id="ce902fee688db8f3044977579e83f0c8" category="list-text">使用以下命令验证 node4 是否已加入仲裁：</block>
  <block id="4395613c979349d83b9f7a1fd64ad821" category="paragraph">`cluster show -node node4 -fields health`</block>
  <block id="b2286139ad110c7f5f191c5e83f862da" category="list-text">使用以下命令验证 node4 是否与 node3 属于同一集群，以及是否运行正常：</block>
  <block id="354ac7a660cb2593b5e01489c9eed2f2" category="list-text">使用以下命令检查控制器更换操作的状态，并验证它是否处于暂停状态以及 node2 暂停之前的相同状态，以便执行安装新控制器和移动缆线的物理任务：</block>
  <block id="aa6d61d6e9f0e398c1d9b8fee35a64dd" category="list-text">如果您正在处理 MetroCluster 系统，请验证是否已为 MetroCluster 配置正确配置更换的控制器； MetroCluster 配置应处于运行状况良好的状态。请参见 <block ref="e3d28e9e05862b41999f2936501ebd43" category="inline-link-macro-rx"></block>。</block>
  <block id="f5ce4d426c8852e0090ab32842d1cd09" category="inline-xref">第 6 步</block>
  <block id="459235ad323edd7deeae2dc5ded37b95" category="paragraph">在 MetroCluster 节点 node4 上重新配置集群间 LIF ，并检查集群对等关系以恢复 MetroCluster 节点之间的通信，然后再继续 <block ref="ee95d9bf63146ca7fe271f7654fa2f7c" category="inline-xref-macro-rx"></block>。</block>
  <block id="973e4031ed35bf66df5741d51fd988da" category="list-text">【 auto_verify_4_Step6]] 恢复控制器更换操作：</block>
  <block id="8de494438fd804fafa8f3da92ae9d6e7" category="admonition">在本指南中， _re-creating VLAN ， ifgrp 和 broadcast domain_ 一节已重命名为 _restoring network configuration on node4_ 。</block>
  <block id="ad642c9296b70fbec2ff690ecca7088a" category="section-title">还原 node4 上的网络配置</block>
  <block id="51c7cb1cccc939f5c24359054f6e087c" category="paragraph">确认 node4 处于仲裁状态并可与 node3 通信后，请确认 node4 上显示了 node2 的 VLAN ，接口组和广播域。此外，验证所有 node4 网络端口是否均已配置在其正确的广播域中。</block>
  <block id="42640d20a9c858a31241fc66b1d15c64" category="paragraph">有关创建和重新创建 VLAN ，接口组和广播域的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Microsoft ONTAP 9 网络管理指南 _ 。</block>
  <block id="c676f2fa5f1e0884bfd01f75061fabbb" category="list-text">使用以下命令列出已升级的 node2 （称为 node4 ）上的所有物理端口：</block>
  <block id="932f91b355fe820e44bf7015a07fe9d1" category="paragraph">`network port show -node node4`</block>
  <block id="7201bec4fa4ce45284b39257c7ebc9bd" category="paragraph">此时将显示节点上的所有物理网络端口， VLAN 端口和接口组端口。在此输出中，您可以看到 ONTAP 已将任何物理端口移至 `集群` 广播域。您可以使用此输出来帮助确定应将哪些端口用作接口组成员端口， VLAN 基本端口或独立物理端口来托管 LIF 。</block>
  <block id="536b4705f2e8d08ffb5b1417a4988ec8" category="list-text">使用以下命令列出集群上的广播域：</block>
  <block id="a5016f5a3ad10eb1e5566540c7930e63" category="list-text">使用以下命令列出 node4 上所有端口的网络端口可访问性：</block>
  <block id="b60798a4e8624ef10969a61bd2f1a5a7" category="paragraph">命令的输出类似于以下示例：</block>
  <block id="84bdf9c97b15a3e6ea78416bdc99e1ee" category="paragraph">在上面的示例中， node2_node4 是在更换控制器后刚刚启动的。它具有多个不可访问的端口，并且正在等待可访问性扫描。</block>
  <block id="7e4772f5da93344d8ada20b9c581e1f9" category="list-text">【 auto_restore_4_Step4]] 修复 node4 上每个端口的可访问性状态不是 `ok` 的可访问性。首先对任何物理端口运行以下命令，然后对任何 VLAN 端口运行以下命令，一次运行一个：</block>
  <block id="b784d8e9f422428eac76c9239f75fe91" category="paragraph">输出如下所示：</block>
  <block id="6da5520b869a50ed547a761fe1f0e10e" category="paragraph">对于可访问性状态可能与当前所在广播域的可访问性状态不同的端口，应显示一条警告消息，如上所示。</block>
  <block id="2b17ef3c860c2adf63f0265d9181acce" category="paragraph">根据需要查看端口和问题解答 `y` 或 `n` 的连接。</block>
  <block id="6c2174965c1dafdd591752b78b10faa9" category="list-text">如果接口组配置与新控制器物理端口布局不匹配，请按照以下步骤进行修改。</block>
  <block id="d8f20787d5ec4fcacf599bd56be2bbd1" category="paragraph">`network port broadcast-domain remove-ports -broadcast-domain &lt;broadcast_domain_name&gt; -ports &lt;node_name ： port_name&gt;`</block>
  <block id="a1f794c27a81b33245cd8b0a81b4c628" category="list-text">按照以下步骤为 `集群` 广播域分配适当的物理端口：</block>
  <block id="094336d39f674644064e82381591f883" category="list-text">使用以下命令之一将其余物理端口移动到其正确的广播域中：</block>
  <block id="67d13fe1d5e641d73d6e558118a0902a" category="list-text">使用以下步骤还原可能已被替换的任何 VLAN ：</block>
  <block id="224ff4c0450f0016f9e5890884002971" category="list-text">在完成所有端口修复后，使用以下命令删除任何空广播域。</block>
  <block id="0f6198f1bf2d581387fad8176727e48b" category="list-text">使用以下命令验证端口可访问性：</block>
  <block id="e3d6faf783eff413421d5abeaf1dad48" category="paragraph">如果所有端口均已正确配置并添加到正确的广播域中，则 `network port reachability show` 命令应将所有已连接端口的可访问性状态报告为 `ok` ，对于无物理连接的端口，此状态报告为 `no-reachability` 。如果任何端口报告的状态不是这两个端口，请按照中的说明执行可访问性修复并在其广播域中添加或删除端口 <block ref="4f595e600f8320b4ad2d574fa1a9fe37" category="inline-xref-macro-rx"></block>。</block>
  <block id="ad308d03b899659ad0f618c14cf12629" category="list-text">使用以下命令还原 LIF 主端口，指定需要还原的 Vserver 和 LIF 主端口（如果有）：</block>
  <block id="25eba25d46b248412419096677ce3a09" category="list-text">使用以下命令还原 LIF 主端口：</block>
  <block id="6fc1b223ae855f26a231da135db5ea87" category="paragraph">`displaced interface restore-home-node -node &lt;node_name&gt; -vserver &lt;vserver_name &gt; - lif-name &lt;LIF_name&gt;`</block>
  <block id="05f8b48fbb8003809bf0b6e78825c8b7" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_auto_prepare_for_netboot_intro ： adoc]]</block>
  <block id="84b32351b8364737587c283186671c3f" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_auto_prepare_for_netboot_steps_1_3.adoc]]</block>
  <block id="8e698b8d4467a7a6309118b19a3aa168" category="summary">要安装新硬件，您必须使用特定工具，并且在升级过程中需要参考其他文档。</block>
  <block id="0e635d7a91ccc4eccdfb03e35353c899" category="doc">所需的工具和文档</block>
  <block id="c3b94594408530dae098d84cd0931315" category="paragraph">要安装新硬件，您必须使用特定工具，并且在升级过程中需要参考其他文档。您还需要记录完成控制器升级所需的信息；系统会提供一个工作表来记录信息。</block>
  <block id="c4cd2838020f3d163cb45dd2d33de6b2" category="paragraph">要执行升级，您需要使用以下工具：</block>
  <block id="5fa8c0eb2f030795135e9d47077f239b" category="list-text">接地线</block>
  <block id="230a7914d7f06a8506c29d7466cb12cd" category="list-text">2 号十字螺丝刀</block>
  <block id="143871839967c0ce4b560d72275287ae" category="cell">介绍如何设置和配置 NetApp 系统</block>
  <block id="14c80bdc64113a62decfea4eb6a57bbb" category="cell">介绍如何管理 ONTAP 系统，向您展示如何使用命令行界面，如何访问集群，如何管理节点等</block>
  <block id="1b2e223d7b0a739342036d545c07be1e" category="cell">包含有关下载和升级 ONTAP 的说明</block>
  <block id="a9c61f520e8d4a33f7c7b87e132bfa13" category="cell">介绍如何管理 ONTAP 物理存储，介绍如何创建，扩展和管理聚合，如何使用 Flash Pool 聚合，如何管理磁盘以及如何管理 RAID 策略</block>
  <block id="61adb7de4bb785562416ba83d166f89a" category="cell">介绍如何使用卷， FlexClone 卷，文件和 LUN ， FlexCache 卷， 重复数据删除，数据压缩， qtree 和配额</block>
  <block id="63495c9c7dc0832fca9ef908516e005a" category="cell">新节点型号的安装和设置说明</block>
  <block id="5cde7c50f5816b4da70e9eb41a64819b" category="cell">包含有关安装新系统并为其布线的说明</block>
  <block id="d4665f62b50f9e25c35dea93f10c5a47" category="cell">《 FlexArray 虚拟化安装要求和参考指南》</block>
  <block id="59f35d9f3417e72e504a84b5becddcb7" category="cell">包含 FlexArray 虚拟化系统的布线说明和其他信息</block>
  <block id="e9a08380ac48c4cddc2ba1523ab880f9" category="cell"><block ref="e9a08380ac48c4cddc2ba1523ab880f9" category="inline-link-macro-rx"></block></block>
  <block id="98ab25573042ac7a8765a9c4007041eb" category="cell">包含有关系统 LED 和系统消息的信息，以帮助进行故障排除</block>
  <block id="9dbb52531fd950a6ee1e03d590e98929" category="cell">相应的磁盘架指南</block>
  <block id="cb232dd594ad24e9077e9aaa120c03ac" category="cell">包含有关安装和监控磁盘架以及更换磁盘架设备的说明</block>
  <block id="4b2900e27b905268746bc80b2df554b3" category="cell">介绍如何为 SAN 环境配置和管理 iSCSI 和 FC 协议</block>
  <block id="af4b5a97e667c3c209e365c7dfa3e34c" category="cell">包含有关 FC 和 iSCSI 拓扑和布线方案的信息</block>
  <block id="434d0878e4f3a503cf18decd97a3f528" category="paragraph">NetApp 支持站点还包含有关网络接口卡（ NIC ）以及可能用于系统的其他硬件的文档。它还包含 <block ref="e9a08380ac48c4cddc2ba1523ab880f9" category="inline-link-macro-rx"></block>，提供有关新系统支持的硬件的信息。请参见 <block ref="292163533a147210a514360785f12599" category="inline-link-macro-rx"></block> 以访问 ONTAP 9 产品文档。</block>
  <block id="c39ea8ae7ab96639c1566b21005a53e1" category="summary">您可以使用 NetApp 支持站点上提供的 Config Advisor 工具。</block>
  <block id="f1b92e8f33cf66355b4b9762bf95256b" category="doc">检查 MetroCluster 配置错误</block>
  <block id="40fee02f58bec4862161038e695de5d6" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_all_check_metrocluster_configuration_errors.adoc]]</block>
  <block id="6af295d62e510174dc8b78d80e744fc4" category="summary">您可以无中断地升级运行 ONTAP 9.8 的一对节点上的控制器硬件。</block>
  <block id="8fb4b518ce39a0704f920c9d4f2f7b77" category="doc">使用聚合重新定位升级控制器硬件</block>
  <block id="88eee2e6d438ad3ba132fc6cdf4398d7" category="paragraph">在操作步骤期间，您可以使用替代控制器硬件升级原始控制器硬件，从而重新定位非根聚合的所有权。您可以在节点之间多次迁移聚合，以确保在整个升级操作步骤中至少有一个节点从聚合提供数据。您还可以迁移数据逻辑接口（ LIF ），并在继续操作时将新控制器上的网络端口分配给接口组。</block>
  <block id="c8ad6059ef689a9cdbc7a1076619df45" category="admonition">在本文档中，原始节点称为 _node1_ 和 _node2_ ，新节点称为 _node3_ 和 _node4_ 。在所述的操作步骤期间， node1 将替换为 node3 ， node2 将替换为 node4 。术语 _node1_ ， _node2_ ， _node3_ 和 _node4_ 仅用于区分原始节点和新节点。在操作步骤之后，必须替换原始节点和新节点的实际名称。但是，实际上，节点名称不会更改：在升级控制器硬件后， node3 的名称为 node1 ， node4 的名称为 node2 。本文档使用术语 _systems with FlexArray Virtualization Software_ 来指属于这些新平台的系统。它使用 V 系列系统一词来表示可连接到存储阵列的不同硬件系统</block>
  <block id="32de3fe80cc3182e6d21291decbf392a" category="inline-link-macro">ARL 升级概述</block>
  <block id="2b5992c45bfbea896711ff945a4844aa" category="list-text">此操作步骤非常复杂，假定您具备高级 ONTAP 管理技能。您还应阅读并了解 <block ref="4839d43871fe29773e86f5cefcab0e32" category="inline-link-macro-rx"></block> 和 <block ref="57e14e08755134bb6fef9ad899bb58ee" category="inline-link-macro-rx"></block> 开始升级前的章节。</block>
  <block id="bc0c3600d83329affdb0d85df2aeac56" category="list-text">此操作步骤假定更换用的控制器硬件是新的，尚未使用。使用 `wipeconfig` 命令准备已用控制器所需的步骤不在此操作步骤中。如果先前使用的是替代控制器硬件，则必须联系技术支持，尤其是在控制器以 7- 模式运行 Data ONTAP 时。</block>
  <block id="3f95c69711726ab20c6ad2092e62e13d" category="list-text">您可以使用此操作步骤升级具有两个以上节点的集群中的控制器硬件；但是，您需要为集群中的每个高可用性（ HA ）对单独执行操作步骤。</block>
  <block id="fe7e90598f62277a0b85475b75c57d4b" category="list-text">此操作步骤适用场景 FAS 系统， V 系列系统， AFF 系统以及安装了 FlexArray 虚拟化软件的系统。如果安装了所需的许可证，则在 ONTAP 9.5 之后发布的 FAS 系统可以连接到存储阵列。ONTAP 9.5 支持现有 V 系列系统。请参见 V 系列支持表，网址为 <block ref="e9a08380ac48c4cddc2ba1523ab880f9" category="inline-link-macro-rx"></block> 有关存储阵列和 V 系列型号的信息。</block>
  <block id="9ac92b97b9314fe7c9c80b03c2f61746" category="list-text">此操作步骤适用场景系统运行 4 节点 NetApp MetroCluster 配置或更高版本。由于 MetroCluster 配置站点可以位于两个物理上不同的位置，因此对于 HA 对，必须在每个 MetroCluster 站点上单独执行控制器自动升级。</block>
  <block id="2aa5c93d9c496fa51aae1bd50988ffb1" category="list-text">如果要从 AFF A320 系统升级，您可以使用卷移动升级控制器硬件或联系技术支持。如果您愿意执行卷移动，请参见 <block ref="9cc0d5221a9e998f923428a347033ebc" category="inline-link-macro-rx"></block>。</block>
  <block id="12a1856797218081c363d4151a746a51" category="paragraph">升级后，您可以通过 NetApp 支持站点停用旧系统。停用系统会告知 NetApp 系统不再运行，并将其从支持数据库中删除。</block>
  <block id="64415bc101bc035c5a6933833b0626cd" category="list-text">导航到 <block ref="e60beeaa103c7cce7039865bf593f639" category="inline-link-macro-rx"></block> 并登录。</block>
  <block id="eb020d21f20b70e49bbe4ebed52b9e29" category="list-text">从菜单中选择 * 产品 &gt; 我的产品 * 。</block>
  <block id="4d0016e281d3a86d70ae083a04a5da95" category="list-text">在 * 查看已安装系统 * 页面上，选择要用于显示系统信息的 * 选择条件 * 。</block>
  <block id="700d67d065f1bd740439eef879e00b77" category="paragraph">您可以选择以下选项之一来查找您的系统：</block>
  <block id="9738c15508e7d3e2fce3396706fc65c8" category="list-text">序列号（位于设备背面）</block>
  <block id="fce1b48d1133d34e0a4d5fdc15e8638b" category="list-text">" 我的位置 " 的序列号</block>
  <block id="fd719eec8decd496851f7b087029e913" category="list-text">单击 * 执行！ *</block>
  <block id="a35129a35ab8aae79ad1750a3753888c" category="paragraph">下表显示了集群信息，包括序列号。</block>
  <block id="b5554c834fafdd1adbf8f16933521491" category="list-text">在表中找到集群，然后从产品工具集下拉菜单中选择 * 停用此系统 * 。</block>
  <block id="7cb7e7951b479387ad32001aab9f53b2" category="summary">系统可能发生崩溃—重新启动，崩溃或重新启动。</block>
  <block id="d75bd21e9af20a5036c0fbf461bc4e2d" category="doc">重新启动，崩溃或重新启动</block>
  <block id="446d36fba2e507d61203c02578774ece" category="paragraph">在升级的不同阶段，系统可能会崩溃—重新启动，崩溃或重新启动。</block>
  <block id="dec0e91cad029c9d2b55e8bd32c88e76" category="paragraph">这些问题的解决方案取决于它们发生的时间。</block>
  <block id="343eae749a23fb17ef6cdd38fd2da8f5" category="section-title">在预检查阶段重新启动，崩溃或重新启动</block>
  <block id="8bea04524c5e6dcfb6d21a849345ee30" category="section-title">在 HA 对的预检查阶段仍处于启用状态之前，节点 1 或节点 2 崩溃</block>
  <block id="738ee8bcfd939a32f3de7df5814c6eba" category="paragraph">如果 node1 或 node2 在预检查阶段之前崩溃，则尚未重新定位任何聚合，并且 HA 对配置仍处于启用状态。</block>
  <block id="0dd6e0ba50acfc16218ced7b92e813f1" category="paragraph">接管和交还可以正常进行。</block>
  <block id="809ecf0f76cd48f719608b879e540f19" category="list-text">检查控制台是否存在系统可能已发出的 EMS 消息，并采取建议的更正操作。</block>
  <block id="0accdb9af8ee9902e6e12e8ad3c69dd6" category="list-text">继续执行节点对升级操作步骤。</block>
  <block id="32042e1cae255d52d27eb7e6f102079f" category="section-title">在第一个资源释放阶段重新启动，崩溃或重新启动</block>
  <block id="a929dc8c44e0a4c66070b18005fcda69" category="section-title">在 HA 对仍处于启用状态的情况下，节点 1 在第一个资源释放阶段崩溃</block>
  <block id="17b207ac883ad6c7c60e4c67b540500b" category="paragraph">部分或所有聚合已从 node1 重新定位到 node2 ，并且 HA 对仍处于启用状态。node2 接管 node1 的根卷以及未重新定位的任何非根聚合。</block>
  <block id="658aff35f1b2ef5bf804a6eaa8bd8834" category="paragraph">重新定位的聚合的所有权与因主所有者未发生更改而被接管的非根聚合的所有权相同。</block>
  <block id="6ccd7f2e78c66d169bbf302fa0cd170e" category="paragraph">当 node1 进入 `Waiting for giveback` 状态时， node2 将交还所有 node1 非根聚合。</block>
  <block id="15ea5ecb42f5a766ef591c29b45aac5f" category="list-text">启动 node1 后， node1 的所有非根聚合均已移回 node1 。您必须使用以下命令手动将聚合从 node1 重新定位到 node2 ： `storage aggregate relocation start -node node1 -destination node2 -aggregate-list * - ndocontroller-upgrade true`</block>
  <block id="db2e31afa00c26dc29029e29d8ff4e9f" category="section-title">在禁用 HA 对的情况下， Node1 在第一个资源释放阶段崩溃</block>
  <block id="a3ab092ff29c94a2c1dce4e8e58fbab8" category="paragraph">Node2 不会接管，但它仍在从所有非根聚合提供数据。</block>
  <block id="84604a4d07dcc33bcf3def32522ced97" category="list-text">启动 node1 。</block>
  <block id="07fcb95304f9b9b6a7b8e09bf3a43b90" category="section-title">在 HA 对仍处于启用状态的情况下，节点 2 在第一个资源释放阶段失败</block>
  <block id="ea41d430c1801092eb658fc92447fa77" category="paragraph">node1 已将其部分或全部聚合重新定位到 node2 。已启用 HA 对。</block>
  <block id="4ef90a16749941dcc42841a4d350f4e3" category="paragraph">node1 接管 node2 的所有聚合以及它已重新定位到 node2 的任何自身聚合。node2 启动时，聚合重新定位将自动完成。</block>
  <block id="f377056f049a875748f0f1fb62e593b9" category="list-text">启动 node2 。</block>
  <block id="a84419db35cfbd1052a6e3367b3e6550" category="section-title">在第一个资源释放阶段以及禁用 HA 对之后， Node2 会崩溃</block>
  <block id="3902e7586591847461eb93ec52677583" category="paragraph">Node1 不接管。</block>
  <block id="209379c90008402bff9e43e926d726f5" category="paragraph">在 node2 启动期间，所有聚合都会发生客户端中断。</block>
  <block id="fb4e509950818b78317fa6b0f32c946e" category="list-text">继续执行节点对升级操作步骤的其余部分。</block>
  <block id="c69c252a29e4c40de646b133d6b89286" category="section-title">在第一个验证阶段重新启动，崩溃或重新启动</block>
  <block id="eee0c63ddb8a9ee96da6fcbaee95750f" category="section-title">在禁用 HA 对的情况下，节点 2 在第一个验证阶段崩溃</block>
  <block id="3acacc48f49902e35f2acd0532846558" category="paragraph">Node2 崩溃后 Node3 不会接管，因为 HA 对已禁用。</block>
  <block id="4d671d2255fc765ecb0c9754a61e9e19" category="section-title">在禁用 HA 对的情况下，节点 3 在第一个验证阶段崩溃</block>
  <block id="26bf9df43caced35a52d77376336d969" category="list-text">启动 node3 。</block>
  <block id="b37a13b468d5049d51c1794bdee782ea" category="section-title">在第一个资源重新获取阶段重新启动，崩溃或重新启动</block>
  <block id="cdf0fa097138599db352e67f83f4d60e" category="section-title">在聚合重新定位期间，节点 2 在第一个资源重新获取阶段崩溃</block>
  <block id="e15376fba96131cecfad3a743435774e" category="paragraph">node2 已将其部分或全部聚合从 node1 重新定位到 node3 。node3 用于从已重新定位的聚合提供数据。HA 对已禁用，因此不存在接管。</block>
  <block id="27685d530ae8434b4b7c343805519a62" category="paragraph">未重新定位的聚合发生客户端中断。启动 node2 时， node1 的聚合将重新定位到 node3 。</block>
  <block id="afac1d41da19c91d8c537c0dd081b509" category="section-title">在聚合重新定位期间，节点 3 在第一个资源重新获取阶段崩溃</block>
  <block id="4309a6885186e1d672df942c1ef7364c" category="paragraph">如果在 node2 将聚合重新定位到 node3 时 node3 崩溃，则在 node3 启动后，此任务将继续执行。</block>
  <block id="c5689b790d4c37b77d1d9d0b5eb653e8" category="paragraph">Node2 将继续为其余聚合提供服务，但已重新定位到 Node3 的聚合会在 Node3 启动期间发生客户端中断。</block>
  <block id="c3ed2d002fa1511e957ac4f0f379ab64" category="list-text">继续升级控制器。</block>
  <block id="c99650cbb2e9705200e0c65ef8112d66" category="section-title">在检查后阶段重新启动，崩溃或重新启动</block>
  <block id="cd64011aa9e337fac4267ca724c07c1a" category="section-title">在后检查阶段，节点 2 或节点 3 崩溃</block>
  <block id="6cc3572daebdd8b0893f33d359db3778" category="paragraph">HA 对已禁用，因此不是接管。重新启动的节点中的聚合发生客户端中断。</block>
  <block id="79671f1c69add8723a6562ea9207f36a" category="list-text">启动节点。</block>
  <block id="453e1c1e18302a590c41d9e178962389" category="section-title">在第二个资源释放阶段重新启动，崩溃或重新启动</block>
  <block id="48824f490a3d91487cefde6c844f77c8" category="section-title">Node3 在第二个资源释放阶段崩溃</block>
  <block id="6fdf83c70d5ac6354046a77aed7edf87" category="paragraph">如果 node2 重新定位聚合时 node3 崩溃，则在 node3 启动后，此任务将继续执行。</block>
  <block id="5731c7830057407975be490c2494fb1f" category="paragraph">Node2 继续为其余聚合提供服务，但已重新定位到 Node3 和 Node3 自己的聚合的聚合在 Node3 启动期间会发生客户端中断。</block>
  <block id="c025602fb85c6101c2c2b73f3aee8c22" category="list-text">继续执行控制器升级操作步骤。</block>
  <block id="98b7194c3f7e4d897e4fd26d695e1854" category="section-title">Node2 在第二个资源释放阶段崩溃</block>
  <block id="5824934e067c33bb3114baa4a8cf9ec5" category="paragraph">如果节点 2 在聚合重新定位期间崩溃，则不会接管节点 2 。</block>
  <block id="8e080faf36569e4b034dc52f5a78a0c9" category="paragraph">node3 将继续为已重新定位的聚合提供服务，但 node2 拥有的聚合会发生客户端中断。</block>
  <block id="7ece8f4248b2db8509ecfad31259ec79" category="section-title">在第二个验证阶段重新启动，崩溃或重新启动</block>
  <block id="844787e278f2aed416a608ecf8da2f42" category="section-title">Node3 在第二个验证阶段崩溃</block>
  <block id="78d45d4102c6b7fa82c29a7ee6d3feac" category="paragraph">如果节点 3 在此阶段崩溃，则不会发生接管，因为 HA 对已禁用。</block>
  <block id="9776e59ce7d904cfd8633f152b0e9840" category="paragraph">在 node3 重新启动之前，所有聚合都会发生客户端中断。</block>
  <block id="0e9646babd06b1afc68db209c8b7e8cc" category="section-title">Node4 在第二个验证阶段崩溃</block>
  <block id="06581dc290bb90ebdc3bff784e74c05b" category="paragraph">如果节点 4 在此阶段崩溃，则不会发生接管。node3 从聚合提供数据。</block>
  <block id="320ac33a3a3ed82ed96ef3dd7d173ed9" category="paragraph">非根聚合发生中断，这些聚合已重新定位，直到 node4 重新启动。</block>
  <block id="d2dec120c917320cae7461e84d91f23c" category="list-text">启动 node4 。</block>
  <block id="510e98cf2edb71945018bbd3f1de261d" category="paragraph">如果使用 NetApp 卷加密（ NVE ）对要升级的系统上的卷进行加密，则加密配置必须与新节点同步。从 node2 到 node3 的 node1 聚合的 ARL 完成后，加密卷将脱机。</block>
  <block id="969f0a2571a7738a949482044a778723" category="summary">如果任何聚合无法重新定位或被否决，您必须手动重新定位这些聚合。</block>
  <block id="97075c537f59de355c8d44c57697ef74" category="doc">重新定位失败或被否决的聚合</block>
  <block id="1a246f70242ad6a20257f6b2816e32b7" category="paragraph">如果任何聚合无法重新定位或被否决，您必须手动重新定位聚合，或者在必要时覆盖否决或目标检查。</block>
  <block id="d5b52813fd23e774f0e560e7d8ecc452" category="paragraph">由于此错误，重新定位操作将暂停。</block>
  <block id="b10c9e2a07f0bd22d85f72c5fb19d122" category="list-text">检查事件管理系统（ EMS ）日志以确定聚合无法重新定位或被否决的原因。</block>
  <block id="01cbdaa18620ad6d965f125b9ad9b1a7" category="list-text">使用以下命令重新定位任何出现故障或被否决的聚合：</block>
  <block id="f31ceb40ff7b8a0764fb7750bb94fd7b" category="paragraph">`storage aggregate relocation start -node &lt;node1&gt; -destination &lt;node2&gt; aggregate-list &lt;aggr_name&gt; -no-controller-upgrade true`</block>
  <block id="4f6da995dc4a823a0d6529c9d724b695" category="list-text">出现提示时，输入 `y` 。</block>
  <block id="d5f8db2e1eae8ada3af51a497dead90d" category="list-text">您可以使用以下方法之一强制重新定位：</block>
  <block id="054b4f3ea543c990f6b125f41af6ebf7" category="cell">选项</block>
  <block id="bca8a20f71b5dee00fa30d0570b83068" category="cell">覆盖否决检查</block>
  <block id="63e95f3a5b822c0e1e5f710174695047" category="cell">使用以下命令： `storage aggregate relocation start -node node1 -destination node2 -aggregate-list &lt;aggr_list&gt; -no-controller-upgrade true -override-vetoes true`</block>
  <block id="1b27217f602bc4090b93bc2c72ec2c38" category="cell">覆盖目标检查</block>
  <block id="2b0aaee5d2bb595c0dd13e304bb34c55" category="cell">使用以下命令： `storage aggregate relocation start -node node1 -destination node2 -aggregate-list &lt;aggr_list&gt; -no-controller-upgrade true -override-vetoes true -override-destination-checks true`</block>
  <block id="26a8fc3a58ee2e1f4b9b0219f3203837" category="summary">在第 5 阶段，您安装并启动 node4 ，将集群和节点管理端口从 node2 映射到 node4 。</block>
  <block id="5eb59651a7213cf4ae352b4c3ee57a36" category="doc">第 5 阶段。安装并启动节点 4.</block>
  <block id="e6cd3f4f7e85ced0a9a0f950fd761aa0" category="paragraph">在第 5 阶段，您将安装并启动 node4 ，将集群和节点管理端口从 node2 映射到 node4 ，并验证 node4 安装。您还可以将 node2 拥有的 NAS 数据 LIF 从 node3 移动到 node4 ，并将 node2 的聚合从 node3 重新定位到 node4 。</block>
  <block id="1b3ff9ea37d4986ce34f2a6478db309f" category="list-text"><block ref="1b3ff9ea37d4986ce34f2a6478db309f" category="inline-link-macro-rx"></block></block>
  <block id="19e1cb1407ac1a7709bf36e64e7fec5d" category="list-text"><block ref="19e1cb1407ac1a7709bf36e64e7fec5d" category="inline-link-macro-rx"></block></block>
  <block id="f694066eff0c2ca8cd3a02623214690d" category="list-text"><block ref="f694066eff0c2ca8cd3a02623214690d" category="inline-link-macro-rx"></block></block>
  <block id="c9d83ff9b793f09ced9acfc606a50fe2" category="list-text"><block ref="c9d83ff9b793f09ced9acfc606a50fe2" category="inline-link-macro-rx"></block></block>
  <block id="a11ec3ccb8b10002318b3342187c386c" category="inline-link-macro">节点 2 拥有的 MOE 非根聚合和 NAS 数据 LIF 从节点 3 到节点 4</block>
  <block id="2d6eacb78dc5ccfe6fab43f6aa67b27e" category="list-text"><block ref="2d6eacb78dc5ccfe6fab43f6aa67b27e" category="inline-link-macro-rx"></block></block>
  <block id="f163cd0bda37780c7a24303611dc0185" category="paragraph">您必须执行以下步骤来准备要升级的节点。</block>
  <block id="6510eaf8fd7e9800a5b7d62b06dc6e9c" category="list-text">在 ONTAP 命令行中输入以下命令，开始控制器更换过程：</block>
  <block id="f65104a2552945130cb62829d56eac5e" category="paragraph">`ssystem controller replace start -nodes &lt;node_name&gt;`</block>
  <block id="dae991e7b6526863385fd89479e87f53" category="admonition">此命令只能在高级权限级别执行： `set -privilege advanced`</block>
  <block id="53d5140b9db74b84bdd8037a6063ec88" category="paragraph">您将看到以下输出：</block>
  <block id="9843edc4af038cb41e5ce95e9aad1e03" category="list-text">按 `y` ，您将看到以下输出：</block>
  <block id="ffc467f3c2a85173d4529548d72d41b9" category="paragraph">系统将运行以下预检；记下每个预检的输出，以便稍后在操作步骤中使用：</block>
  <block id="495aa5c508241f1eca40fd503bc73196" category="cell">预检查</block>
  <block id="688df3b12b34ef0608e319ff169390d4" category="cell">集群运行状况检查</block>
  <block id="2ebe98702ab3694ec3ccfe3e623a124e" category="cell">检查集群中的所有节点以确认其运行状况良好。</block>
  <block id="56beb58e6d547196c5aa44214e93ccaa" category="cell">MCC 集群检查</block>
  <block id="f8c3b8dcbd883dc2841679a94feb852a" category="cell">检查系统是否为 MetroCluster 配置。该操作会自动检测是否为 MetroCluster 配置，并执行特定的预检和验证检查。仅支持 4 节点 MetroCluster FC 配置。对于双节点 MetroCluster 配置和四节点 MetroCluster IP 配置，检查将失败。如果 MetroCluster 配置处于切换状态，则检查将失败。</block>
  <block id="b14360b478956e0213006307a2213b01" category="cell">聚合重新定位状态检查</block>
  <block id="23ecfd4d5c38f058d2a5b47f3a17a9b2" category="cell">检查聚合重新定位是否已在进行中。如果正在进行另一个聚合重新定位，则检查将失败。</block>
  <block id="2fb16648e5e222f12729fb8c953149b5" category="cell">型号名称检查</block>
  <block id="84599dff045e3f86049bc2022bf4b930" category="cell">检查此操作步骤是否支持这些控制器型号。如果不支持这些型号，则此任务将失败。</block>
  <block id="67c4a102a7629dddfcaf5472ead63dd6" category="cell">集群仲裁检查</block>
  <block id="b26031d08c55750f9480d081320ddcbe" category="cell">检查要更换的节点是否处于仲裁状态。如果节点未处于仲裁状态，则此任务将失败。</block>
  <block id="833b60ce00de23efdd84aaf2257b1cd3" category="cell">映像版本检查</block>
  <block id="366f79ac2a714dd82ba5dd9b17a31d55" category="cell">检查要更换的节点是否运行相同版本的 ONTAP 。如果 ONTAP 映像版本不同，则此任务将失败。新节点上安装的 ONTAP 9.8 版本必须与原始节点上安装的版本相同。如果新节点安装的 ONTAP 版本不同，则在安装新控制器后，需要通过网络启动这些控制器。请参见 <block ref="2306b060dda44ca496eae792a0e62a17" category="inline-link-macro-rx"></block> 有关升级 ONTAP 的说明。</block>
  <block id="4f324d87f2095ea7b3cb652dd2dc4b10" category="cell">HA 状态检查</block>
  <block id="0ec2a475eb3cc7052a2df9d912b429a5" category="cell">检查要更换的两个节点是否采用高可用性（ HA ）对配置。如果未为控制器启用存储故障转移，则任务将失败。</block>
  <block id="13953a740d52280d2268524a1a4a3535" category="cell">聚合状态检查</block>
  <block id="d2be5a07810282eec1226ecdcabc0e8d" category="cell">如果要更换的节点自身的聚合不是主所有者，则此任务将失败。节点不应拥有任何非本地聚合。</block>
  <block id="6244df7e25591403b0d5255577576eb4" category="cell">磁盘状态检查</block>
  <block id="04ae6128bf947dba9f2e16b5ffa540fa" category="cell">如果要更换的任何节点缺少磁盘或磁盘出现故障，则此任务将失败。如果缺少任何磁盘，请参见 <block ref="32ad4279d8decdf54b42d53297728513" category="inline-link-macro-rx"></block>， <block ref="2170dc6efac5d76f8ef2dd44719cb594" category="inline-link-macro-rx"></block>和 <block ref="fce145d95584367b9c4d78d9aa5ffce3" category="inline-link-macro-rx"></block> 在中 <block ref="292163533a147210a514360785f12599" category="inline-link-macro-rx"></block> 为 HA 对配置存储。</block>
  <block id="320bc2c593ebed7e970715ea3832bc2e" category="cell">数据 LIF 状态检查</block>
  <block id="9433521f789681a1a8fd76815674c438" category="cell">检查要更换的任何节点是否具有非本地数据 LIF 。节点不应包含其不是主所有者的任何数据 LIF 。如果其中一个节点包含非本地数据 LIF ，则任务将失败。</block>
  <block id="eb694fc97d0bfef2c84584a29b318d85" category="cell">集群 LIF 状态</block>
  <block id="ce7612b7485886dbb77994528256ffe5" category="cell">检查两个节点的集群 LIF 是否均已启动。如果集群 LIF 已关闭，则此任务将失败。</block>
  <block id="35a80eab14772418cca0ff3317910419" category="cell">ASUP 状态检查</block>
  <block id="166dc880ac0c6c0bb26663235da7e471" category="cell">如果未配置 ASUP 通知，则任务将失败。在开始更换控制器操作步骤之前，必须启用 ASUP 。</block>
  <block id="d39a17fff59bba71c24822f913f16591" category="cell">CPU 利用率检查</block>
  <block id="3478400e352864eaa33992de6e976ca8" category="cell">检查要更换的任何节点的 CPU 利用率是否超过 50% 。如果 CPU 使用率在相当长的一段时间内超过 50% ，则此任务将失败。</block>
  <block id="1a0a7ab1ebbc5d1d73b48be5c234810d" category="cell">聚合重建检查</block>
  <block id="7830789d964e8c8cf3a370b1d0299a28" category="cell">检查是否正在任何数据聚合上进行重建。如果正在进行聚合重建，则此任务将失败。</block>
  <block id="c17c89f5ba46492be395e9f071e013ae" category="cell">节点关联性作业检查</block>
  <block id="83aecfe9d4bf515a2ec45766e28a4ce0" category="cell">检查是否正在运行任何节点关联作业。如果节点关联性作业正在运行，则检查将失败。</block>
  <block id="3ae0a94222b6d6378899ff73d1aad6e3" category="list-text">在启动控制器更换操作并完成预检后，此操作将暂停，以便您稍后在配置 node3 时收集可能需要的输出信息。</block>
  <block id="3f906c041fb469b2794aa7ce7964b2a7" category="list-text">按照系统控制台上控制器更换操作步骤的指示运行以下一组命令。</block>
  <block id="22afa574ce25ee7b49bc951eecd7f0ac" category="section-title">如果 ARL 预检失败，请更正聚合所有权</block>
  <block id="7a29204c210eec42f3d01bebd9b483ba" category="paragraph">如果聚合状态检查失败，您必须将配对节点拥有的聚合返回到主所有者节点，然后重新启动预检过程。</block>
  <block id="13438714af5f265a69cdb9fb6fc028f5" category="list-text">使用以下命令将配对节点当前拥有的聚合返回到主所有者节点：</block>
  <block id="0620f85959e7122e0e62c6193df806f8" category="paragraph">`storage aggregate relocation start -node &lt;source_node&gt; -destination &lt;destination-node&gt; - aggregate-list *`</block>
  <block id="a11f98389b5ef65f9666f05434e8bca8" category="list-text">使用以下命令验证 node1 和 node2 是否仍拥有其当前所有者（而不是主所有者）的聚合：</block>
  <block id="ed33c4e76a67735c4a0e87361685f44c" category="paragraph">`storage aggregate show -nodes &lt;node_name&gt; -is-home false -fields owner-&lt;name&gt; ， home-name ， state`</block>
  <block id="74aa132d7caa1904dc30e16328313124" category="paragraph">以下示例显示了当节点同时是聚合的当前所有者和主所有者时命令的输出：</block>
  <block id="bd965e38a0c9cf27aa1bde099308e23f" category="section-title">完成后</block>
  <block id="716ae6d3100d9fe9a05d4602099875b6" category="paragraph">您必须使用以下命令重新启动控制器更换过程：</block>
  <block id="794df3791a8c800841516007427a2aa3" category="section-title">许可证</block>
  <block id="05a46531537373667ec97f48a0268bca" category="paragraph">设置集群时，设置向导会提示您输入集群基础许可证密钥。但是，某些功能需要额外的许可证，这些许可证会作为包含一个或多个功能的软件包发布。集群中的每个节点都必须有自己的密钥，才能在集群中使用每个功能。</block>
  <block id="0716a66a70e59256281f4030c078ce04" category="paragraph">如果没有新的许可证密钥，则新控制器可以使用集群中当前已获得许可的功能。但是，在控制器上使用未经许可的功能可能会使您不符合您的许可协议，因此，您应在升级完成后为新控制器安装新的许可证密钥。</block>
  <block id="3fd889980eb5b562e1bd6cb1bb4cced8" category="paragraph">您可以在上为 ONTAP 9.8 获取新的 2 字符许可证密钥 <block ref="e60beeaa103c7cce7039865bf593f639" category="inline-link-macro-rx"></block>。这些密钥位于 _Software licenses_ 下的 _My Support_ 部分中。如果此站点没有所需的许可证密钥，您可以联系您的 NetApp 销售代表。</block>
  <block id="d202da01ce49771212ff5a916d7301b9" category="paragraph">有关许可的详细信息，请参见 <block ref="839332b52391f9eb13d4a6fc107f1e56" category="inline-link-macro-rx"></block> 在中 <block ref="292163533a147210a514360785f12599" category="inline-link-macro-rx"></block>。</block>
  <block id="f316c2b1c3180013cd06406baadfb7d6" category="summary">升级操作步骤结束时， node3 应为聚合的新主节点。</block>
  <block id="64f7904c016a035f1928a2cbeea82ab1" category="doc">升级完成后， node1 上的聚合属于 node4</block>
  <block id="2e352bfe9deb78b924bf0f5e67164c3c" category="paragraph">升级操作步骤结束时， node3 应为聚合的新主节点，而这些聚合最初将 node1 作为主节点。您可以在升级后重新定位它们。</block>
  <block id="2cf6fa2f1aa97f868355968dffa896a3" category="paragraph">在以下情况下，聚合可能无法正确重新定位，也就是说，它们的主节点可能为 node1 ，而不是 node3 ：</block>
  <block id="eabfe2534554b27bddeea073dc85fdef" category="list-text">在第 3 阶段，聚合从 node2 重新定位到 node3 。</block>
  <block id="b64ff0aed650d75434d24e770d7ac535" category="paragraph">要重新定位的某些聚合的主节点为 node1 。例如，此类聚合可以称为 aggr_node_1 。如果 aggr_node_1 的重新定位在第 3 阶段失败，并且无法强制重新定位，则聚合将留在 node2 上。</block>
  <block id="10088c57d34f3ff8d01259d9bf23a10e" category="list-text">在第 4 阶段之后，将 node2 替换为 node4 。</block>
  <block id="3727ce4dce304c5ffcdfab64f1361e18" category="paragraph">更换 node2 后， aggr_node_1 将联机，并将 node4 作为其主节点，而不是 node3 。</block>
  <block id="2fd96d1cbc3f38a4d51b34fc38bb9795" category="paragraph">在启用存储故障转移后，您可以通过完成以下步骤在第 6 阶段后修复不正确的所有权问题：</block>
  <block id="d6c8a4ac010370637fda6aa00c4ecb61" category="list-text">使用以下命令获取聚合列表：</block>
  <block id="482c91d6a5bf35c82ea857455c024d88" category="paragraph">`storage aggregate show -nodes &lt;node4&gt;-is-home true`</block>
  <block id="69aeb97e68d779e078d70b2209787e83" category="paragraph">要确定未正确重新定位的聚合，请参阅在一节中获取的主所有者为 node1 的聚合列表 <block ref="94f2dfd916315926f685ba65e48c6e25" category="inline-link-macro-rx"></block> 并将其与上述命令的输出进行比较。</block>
  <block id="812a9848cb16db698df2fcc8c7caae5b" category="list-text">将步骤 1 的输出与您在一节中为 node1 捕获的输出进行比较 <block ref="94f2dfd916315926f685ba65e48c6e25" category="inline-link-macro-rx"></block> 并记下未正确重新定位的所有聚合。</block>
  <block id="f2bf75566771406c6ded668ee425d550" category="list-text">使用以下命令重新定位 node4 上遗留的聚合：</block>
  <block id="65a8c99f14b76057940b416927d170c9" category="paragraph">`storage aggregate relocation start -node &lt;node4&gt; - aggr &lt;aggr_node_1&gt; -destination &lt;node3&gt;`</block>
  <block id="19289925f6f4d12d2796b14d773968dd" category="paragraph">在此重新定位期间，请勿使用 ` -nt-controller-upgrade` 参数。</block>
  <block id="60656064cbcf2e1519ecbe0028959c9a" category="list-text">使用以下命令验证 node3 现在是否为聚合的主所有者：</block>
  <block id="efe0e1623e3de58285e110eadbfa034a" category="paragraph">`storage aggregate show -aggregate &lt;aggr1 ， aggr2 ， aggr3...&gt; -fields home-name`</block>
  <block id="3b6b92b0cbab52f7f27f444cda7f83aa" category="paragraph">` &lt;aggr1 ， aggr2 ， aggr3...&gt;` 是将 node1 作为原始主所有者的聚合列表。</block>
  <block id="0ff4f26e03c087491de24c0370828b1a" category="paragraph">如果聚合的主所有者不是 node3 ，则可以使用步骤 3 中的相同重新定位命令将其重新定位到 node3 。</block>
  <block id="f9e3e05fc30ddaa46c0f525fb1806314" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： ../_include/ru_auto_stage4_overview.adoc]]</block>
  <block id="1997edef0e8dc4dfe6a4e9bb54326b4c" category="summary">在控制器升级期间，此控制器将更换为另一个控制器。</block>
  <block id="d345c906575e21a898123708bebd7b5c" category="doc">自动执行控制器升级过程</block>
  <block id="211dd20476c70813f998487d2564ac39" category="paragraph">在控制器升级期间，此控制器将被替换为另一个运行更新或功能更强大的平台的控制器。本指南的早期版本包含无中断控制器更新过程的说明，该过程由完全手动的步骤组成。本指南介绍了新的自动化操作步骤的步骤，该 利用自动网络端口可访问性检查进一步简化了控制器升级体验。</block>
  <block id="d88ce1078b12ccecbaaa871291ee2c05" category="paragraph">手动过程耗时冗长且复杂，但在此简化的操作步骤中，您可以通过聚合重新定位来实施控制器更新，从而为 HA 对实现更高效的无中断升级。手动步骤明显减少，尤其是在验证，收集信息和 POST 检查方面。</block>
  <block id="12f0aff6b7931a4b46dc6629c132816a" category="summary">在操作步骤期间， ARL 可能会在第 2 阶段，第 3 阶段或第 5 阶段失败。</block>
  <block id="80e4215c73ac3899bde16fde12fcb7aa" category="doc">正在检查聚合重新定位失败</block>
  <block id="5f1a63352c537579794f3a3c507ca8fb" category="list-text">输入以下命令并检查其输出：</block>
  <block id="535fb4b2db5d261fd8e82fde21d267f2" category="paragraph">`s存储聚合重新定位显示`</block>
  <block id="e0fafb56752a62a2c5a8a941a4fa2864" category="paragraph">`storage aggregate relocation show` 命令可显示哪些聚合已成功重新定位，哪些聚合未成功重新定位以及故障原因。</block>
  <block id="85dae5feb66033271bbd3fea4eca5f7e" category="list-text">检查控制台是否存在任何 EMS 消息。</block>
  <block id="fe96c3f5ae23f058575d629b1b1befa1" category="list-text">根据 `storage aggregate relocation show` 命令的输出以及 EMS 消息的输出，采取适当的更正操作。</block>
  <block id="b3663b253690ee49735db122d80571d6" category="list-text">使用 `storage aggregate relocation start` 命令的 `override-vetoes` 选项或 `override-destination-checks` 选项强制重新定位聚合。</block>
  <block id="6d50991a352614d565931490ef78b642" category="paragraph">有关 `storage aggregate relocation start` ， `override-vetoes` 和 `override-destination-checks` 选项的详细信息，请参见 <block ref="17d992424ad253bf21fb1a0ceb91e8d4" category="inline-link-macro-rx"></block>。</block>
  <block id="0dcbb9ad75076c111ef077218e8532c1" category="summary">在使用 ARL 升级节点之前，您应了解操作步骤的工作原理。</block>
  <block id="ddfd90d1a40dc38efcde3d45c070506d" category="paragraph">在使用 ARL 升级节点之前，您应了解操作步骤的工作原理。在本文档中，操作步骤分为多个阶段。</block>
  <block id="7526cf9eecac88850b8e7b400f897378" category="paragraph">在操作步骤期间，您可以使用替代控制器硬件升级原始控制器硬件，一次升级一个控制器，从而利用 HA 对配置重新定位非根聚合的所有权。所有非根聚合都必须进行两次重新定位，才能到达其最终目标，即正确的升级节点。</block>
  <block id="dbbdd31aeee0756ad9d276a1eca618f8" category="paragraph">每个聚合都有一个主所有者和当前所有者。主所有者是聚合的实际所有者，当前所有者是临时所有者。</block>
  <block id="64c6da2436465d11573858d46056b95d" category="cell">阶段</block>
  <block id="b72f5020c23dbd9ffc6d4450f84ec5f3" category="cell">第 1 阶段：准备升级</block>
  <block id="707253335c75396f2f03f01d02cd611a" category="list-text">运行预检以验证是否可以执行此操作。</block>
  <block id="f03174f8fd409d7574b9f2016f96604d" category="list-text">如果预检失败，请更正聚合所有权。</block>
  <block id="0edc7061270b8cba6c4b291d98e9b404" category="list-text">输入集群基础许可证密钥。</block>
  <block id="dfeec1b537b43dc0ea5606e832f48af2" category="list-text">获取用于存储加密的 IP 地址。</block>
  <block id="58119f526d64656dd48685b7def3abf2" category="list-text">使用 KMIP 服务器管理身份验证。</block>
  <block id="5c43723af4fc43b85ff273259b771bc0" category="list-text">使用板载密钥管理器（ OKM ）管理存储加密。</block>
  <block id="c8e64b81bcc97d8861a9f55fcb0ae9e6" category="list-text">暂停 SnapMirror 关系（可选）。</block>
  <block id="9b7c5fc0588fe7d63e81b1258a1b7a71" category="paragraph">阶段 1 结束时的聚合所有权：</block>
  <block id="b309c38149cc0e7b5e0bdcbbb02d7372" category="list-text">node1 是 node1 聚合的主所有者和当前所有者。</block>
  <block id="c9441f483586640407720ae97b71e4aa" category="list-text">node2 是 node2 聚合的主所有者和当前所有者。</block>
  <block id="2751979c348fa4496d4f5e77b42bd6f7" category="cell">第 2 阶段：重新定位和停用节点 1</block>
  <block id="248ca24967f7bb9be3cc045e68b6dabe" category="list-text">将非根聚合从 node1 重新定位到 node2 。</block>
  <block id="fe43f44a817b4a8a1c1b0fbab66f1668" category="list-text">将节点 1 拥有的非 SAN 数据 LIF 重新定位到节点 2 。</block>
  <block id="f6eec92be77ff6719e538b7c51a97f55" category="list-text">重新定位失败或被否决的聚合。</block>
  <block id="faaafe46b0a9b962f0146097c9e28518" category="list-text">停用 node1 。</block>
  <block id="023ab2fff87c666eab071e675efdacaf" category="list-text">准备网络启动（可选）。</block>
  <block id="7544a9f5c9c9ff572c11f753aae7dedf" category="paragraph">阶段 2 结束时的聚合所有权：</block>
  <block id="80056829ceb7237c21b4536a01885e13" category="list-text">node2 是 node1 聚合的当前所有者。</block>
  <block id="f6e6ad572d16caa52deed3eeb7ca0ff5" category="list-text">node2 是 node2 聚合的主所有者和当前所有者。</block>
  <block id="34c13ce480fd28c643a03477e436ea69" category="cell">第 3 阶段：安装并启动节点 3.</block>
  <block id="2ecf50ce071750046e33889f76b4ddf1" category="list-text">安装并启动 node3 。</block>
  <block id="19fa01b5e1d74520ad0be1fb6bf1fc09" category="list-text">设置 FC 或（融合网络适配器） CNA 配置。</block>
  <block id="95b4c137787b29e51c74b71475d203dd" category="list-text">配置 FC 端口。</block>
  <block id="b9dd5a9a2b21507e0342ef620ec6824d" category="list-text">检查并配置 UTA/UTA2 端口。</block>
  <block id="8de9e3207ca31bee139241ad4fc0650f" category="list-text">验证 node3 是否已成功安装。</block>
  <block id="e60e41c512cd3f2ad332e91763d4d2a5" category="list-text">还原 node3 网络配置。</block>
  <block id="6b01c45aa39022f8fcfff3f90434c89c" category="list-text">将节点 1 下的非 SAN 数据 LIF 从 node2 移动到 node3 。</block>
  <block id="fd37436f77e7bb0f803c1afad985d422" category="list-text">将 node1 拥有的非根聚合从 node2 重新定位到 node3 。</block>
  <block id="ff8f4c5aae9f0216fa1c088e4c636ab0" category="paragraph">第 3 阶段结束时的聚合所有权：</block>
  <block id="d58c33bf48643b15350ce1c80bb474d8" category="list-text">node3 是 node1 聚合的主所有者和当前所有者。</block>
  <block id="c8add178229dab0c27c0edec3be3ed3a" category="cell">第 4 阶段：重新定位和停用节点 2</block>
  <block id="04bf2293479cb8cadbf0c59e985f585e" category="list-text">将非根聚合从 node2 重新定位到 node3 。</block>
  <block id="6ab2fb4ca5571833687af9b24c03405b" category="list-text">将节点 2 拥有的非 SAN 数据 LIF 重新定位到节点 3 。</block>
  <block id="8f4919c4d65b1afa5ab9c7d7757a53af" category="list-text">停用 node2 。</block>
  <block id="d517ee6c427837d3874a695e344df510" category="paragraph">第 4 阶段结束时的聚合所有权：</block>
  <block id="312d1c4e0e8f2ca55c86dd955ac42bff" category="list-text">node3 是最初属于 node1 的聚合的主所有者和当前所有者。</block>
  <block id="6ccf9360cf25c371211dcaee52075b0c" category="list-text">node2 是 node2 聚合的主所有者。</block>
  <block id="7c9dc4aa3c862a50866dfa4bf1cad537" category="list-text">node3 是 node2 聚合的当前所有者。</block>
  <block id="6c02f76a0894d55a982cb5450ab57f22" category="cell">第 5 阶段：安装并启动节点 4</block>
  <block id="f709cec4fcbf35e8bd7dc6e974d17d00" category="list-text">安装并启动节点 4.</block>
  <block id="c62822fe3e3275534a8fb949d6c66e6c" category="list-text">在 node4 上设置 FC 或 CNA 配置。</block>
  <block id="57bf5699914e63878247f19a25930b05" category="list-text">验证 node4 是否已成功安装。</block>
  <block id="1ed5ba60b18e0aad565c48c7e13368fc" category="list-text">还原 node4 网络配置</block>
  <block id="2c9672ea46aeb54c5860dc07332bc88b" category="list-text">将 node2 拥有的非 SAN 数据 LIF 从 node3 重新定位到 node4 ，并验证 node4 上的 SAN LIF 。</block>
  <block id="ae88ee721c31093785205944b85aa4ee" category="paragraph">第 5 阶段结束时的聚合所有权：</block>
  <block id="478c619523c38faa7066d2d25b446a3d" category="list-text">node3 是最初属于 node1 的聚合的主所有者和当前所有者。</block>
  <block id="c2583ec3499fda8ccfebbd517d0af4e6" category="list-text">Node4 是最初属于 Node2 的聚合的主所有者和当前所有者。</block>
  <block id="f76e06dd184bc4ee38bfcca355bec6fd" category="cell">第 6 阶段：完成升级</block>
  <block id="b112f13cf4b353be9d52a7a0591716fd" category="list-text">确认系统设置正确。</block>
  <block id="6849ebd666f25feda5374c9954336e52" category="list-text">在新控制器模块上设置存储加密。</block>
  <block id="ab04d447601d753d6450dcae75a3b355" category="list-text">在新控制模块上设置 NetApp 卷加密。</block>
  <block id="f6575cd6c144b0fafc0a4706e44b7184" category="list-text">停用旧系统。</block>
  <block id="01f95e082b71c8b8f530696c5c1e79f6" category="list-text">根据需要恢复 NetApp SnapMirror 操作。</block>
  <block id="b0bb9521a13e2a0adf723c21c0597b4d" category="paragraph">在 &lt;stdin&gt; 中未解析的指令 - 包括： .//_include/ru_auto_issues_m倍数 阶段 _of_Procedure .adoc]]</block>
  <block id="cdd3eef7b8578a295d456f9eaf566e58" category="summary">在 node3 上验证网络配置之后，以及在将聚合从 node2 重新定位到 node3 之前。</block>
  <block id="338e1133e592584bd1dc26b643cbe02f" category="paragraph">在验证 node3 上的网络配置以及将聚合从 node2 重新定位到 node3 之前，您必须验证当前位于 node2 上的 node1 所属的 NAS 数据 LIF 是否已从 node2 重新定位到 node3 。您还必须验证 node3 上是否存在 SAN LIF 。</block>
  <block id="f329a7087048b2fb128acd99205356e2" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。升级期间，集群或服务运行状况无需移动 SAN LIF 。除非需要将 SAN LIF 映射到新端口，否则不会移动这些 LIF 。使 node3 联机后，您将验证 LIF 是否运行正常并位于相应的端口上。</block>
  <block id="a29257abbaad84467babad354360d285" category="paragraph">执行这些检查后，系统会将 node1 拥有的非根聚合和 NAS 数据 LIF 重新定位到新控制器 node3 。资源重新定位完成后，控制器更换操作将暂停。</block>
  <block id="6b63a169d7b58dab073cd5e6b620fc2d" category="paragraph">如果已替换任何 LIF ，请使用以下命令将主节点还原回 node3 ：</block>
  <block id="b7041cc3a3bab5f1b9192a9fcb805812" category="summary">对于 MetroCluster FC 配置，您必须更换灾难恢复 / 故障转移站点节点。</block>
  <block id="01a591d046b462278053f73d43eaefe4" category="paragraph">对于 MetroCluster FC 配置，您必须尽快更换灾难恢复 / 故障转移站点节点。不支持 MetroCluster 配置中的控制器型号不匹配，因为控制器型号不匹配会导致灾难恢复镜像脱机。在更换第二个站点上的节点时，使用命令 ` skip- metrocluster-check true` option 可绕过 MetroCluster 检查。</block>
  <block id="7111f40126e236c3f7858ae25ad53307" category="paragraph">您可以使用 NetApp 支持站点上提供的 Config Advisor 工具检查常见配置错误。</block>
  <block id="4765d4c84ae977a0d2fd9458912cf094" category="paragraph">Config Advisor 是一款配置验证和运行状况检查工具。您可以将其部署在安全站点和非安全站点上，以便进行数据收集和系统分析。</block>
  <block id="0109999bfef624f78c3dcf4fb94f11ba" category="admonition">对 Config Advisor 的支持是有限的，并且只能联机使用。</block>
  <block id="32a404f0f31163f59d88f2d052711ecf" category="list-text">下载 <block ref="02685666481d8fcfc63d60bb8f2d7352" category="inline-link-macro-rx"></block> 工具。</block>
  <block id="6afe954858ef53a16278f4735833c1a5" category="list-text">运行 Active IQ Config Advisor ，查看输出并按照其建议解决任何问题。</block>
  <block id="356fd2e8c1c464dccb700641317d2900" category="admonition">不会修改聚合和 LIF 的主所有者；只会修改当前 -owner 。</block>
  <block id="dc84d077beb77f7f63fcf90bdccc812c" category="list-text">使用以下命令恢复聚合重新定位和 NAS 数据 LIF 移动操作：</block>
  <block id="44d6ab00bef397f6537d95a47a570251" category="paragraph">所有非根聚合和 NAS 数据 LIF 都会从 node1 迁移到 node2 。</block>
  <block id="1a5ea8528c363200c81b97bf8f1cbdc7" category="paragraph">此操作将暂停，以便验证是否已将所有 node1 非根聚合和非 SAN 数据 LIF 迁移到 node2 。</block>
  <block id="43661f4c70db27cdfea85162a88660c4" category="list-text">在操作仍处于暂停状态的情况下，使用以下命令验证所有非根聚合在 node2 上的状态是否处于联机状态：</block>
  <block id="9c328071e0321bfbe1d164cac2c22ebd" category="paragraph">`storage aggregate show -node &lt;node2&gt; -state online -root false`</block>
  <block id="761df4f887d66569090abb51e2ec705f" category="paragraph">如果 node2 上的聚合脱机或变为外部聚合，请在 node2 上使用以下命令将其联机，每个聚合一次：</block>
  <block id="f999b6b276f2c64e10bfb3630f92f94c" category="list-text">在 node2 上使用以下命令并检查其输出，以验证 node2 上的所有卷是否联机：</block>
  <block id="b3b5d42abc670ac795f4b90cfc221655" category="paragraph">`volume show -node &lt;node2&gt; -state offline`</block>
  <block id="074f2db71729d7f84803e85e33520125" category="paragraph">如果 node2 上的任何卷脱机，请在 node2 上使用以下命令将其联机，每个卷一次：</block>
  <block id="8c0f6eba4a2b3bef1eeefc2c5a412d5a" category="paragraph">要与此命令结合使用的 ` &lt;vserver-name&gt;` 可在上一个 volume show 命令的输出中找到。</block>
  <block id="9d3161968a4b5d5a467ded6255629741" category="list-text">如果任何 LIF 已关闭，请使用以下命令将 LIF 的管理状态设置为 `up` ，每个 LIF 一次：</block>
  <block id="9fd68cc494a9f57cae67ac737ab1370f" category="paragraph">升级节点对时可能会遇到故障。节点可能会崩溃，聚合可能无法重新定位或 LIF 可能无法迁移。故障的发生原因及其解决方案取决于升级操作步骤期间发生故障的时间。</block>
  <block id="148cb01915f73b429fb4402cc046fed1" category="paragraph">请参见一节中描述操作步骤不同阶段的表 <block ref="57e14e08755134bb6fef9ad899bb58ee" category="inline-link-macro-rx"></block>。有关可能发生的故障的信息按操作步骤的阶段列出。</block>
  <block id="291e8826d2b19041a0543b448060f314" category="paragraph">如果 node4 具有板载 FC 端口，板载统一目标适配器（ UTA/UTA2 ）端口或 UTA/UTA2 卡，则必须先配置这些设置，然后才能完成其余操作步骤。</block>
  <block id="3a1c9ff3b61fc7974ebcd7a1576841ce" category="paragraph">您可能需要完成 <block ref="e4a308316f89855579fcbb31b7ca4dfa" category="inline-link-macro-rx"></block>， <block ref="f83114d9adca40bee6dbc7b70e5770d9" category="inline-link-macro-rx"></block>或这两个部分。</block>
  <block id="733dccee9c3996eac175c74d7df58045" category="inline-link-macro">安装和启动节点 4.</block>
  <block id="cbab6d0aadc6694aef8d0ec78a8d7f45" category="admonition">如果 node4 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，并且您要升级具有存储磁盘的系统，则可以跳至 <block ref="f694066eff0c2ca8cd3a02623214690d" category="inline-link-macro-rx"></block>。但是，如果您使用的是 V 系列系统或 FlexArray 虚拟化软件并连接到存储阵列，并且 node4 没有板载 FC 端口，板载 UTA/UTA2 端口或 UTA/UTA2 卡，则必须返回到 <block ref="e1cdeb83e1976a7e853b163ee26d3201" category="inline-link-macro-rx"></block> 第节，然后继续执行第 22 步。确保 node4 具有足够的机架空间。如果 node4 与 node2 位于不同的机箱中，则可以将 node4 与 node3 放在同一位置。如果 node2 和 node4 位于同一机箱中，则 node4 已位于其相应的机架位置。</block>
  <block id="e4a308316f89855579fcbb31b7ca4dfa" category="list-text"><block ref="e4a308316f89855579fcbb31b7ca4dfa" category="inline-link-macro-rx"></block></block>
  <block id="f83114d9adca40bee6dbc7b70e5770d9" category="list-text"><block ref="f83114d9adca40bee6dbc7b70e5770d9" category="inline-link-macro-rx"></block></block>
  <block id="cd7dd5075be56af4a3298feff04bb98a" category="paragraph">如果 node4 具有板载或 FC 适配器上的 FC 端口，则必须先在节点上设置端口配置，然后再将其投入使用，因为这些端口未经过预配置。如果未配置端口，则可能会发生服务中断。</block>
  <block id="e924d268e6beb8d3d89f18a90dd8d9f9" category="paragraph">您必须具有在部分中保存的 node2 中的 FC 端口设置值 <block ref="94f2dfd916315926f685ba65e48c6e25" category="inline-link-macro-rx"></block>。</block>
  <block id="ac6ef9b42d869c3911e52e8691306c08" category="paragraph">如果您的系统没有 FC 配置，则可以跳过此部分。如果您的系统具有板载 UTA/UTA2 端口或 UTA/UTA2 适配器，则可以在中对其进行配置 <block ref="f83114d9adca40bee6dbc7b70e5770d9" category="inline-link-macro-rx"></block>。</block>
  <block id="b075444cf1672de101272f1c40d6530b" category="paragraph">* 重要说明 * ：如果系统具有存储磁盘，则必须在集群提示符处输入本节中的命令。如果您的 V 系列系统或系统已将 FlexArray 虚拟化软件连接到存储阵列，则可以在维护模式下在此部分中输入命令。</block>
  <block id="fb3f66b3a8d32dace037f5fc64cdcb39" category="cell">使用以下命令： `ssystem node hardware unified-connect show`</block>
  <block id="e74c3e16ce027a70a9ed5b69517af243" category="cell">使用以下命令： `ucadmin show`</block>
  <block id="c5c0e497c3f1186f3d1cfecfc658c546" category="paragraph">系统将显示有关系统上所有 FC 和融合网络适配器的信息。</block>
  <block id="ede48791c6a4d48413c294cc39314600" category="list-text">将 node4 上的 FC 设置与先前从 node1 中捕获的设置进行比较。</block>
  <block id="aff764c911b4541452722d04dd817822" category="paragraph">使用以下命令之一根据需要修改 node4 上的 FC 端口：</block>
  <block id="2835fab11f16b1e6b7950115632ebd62" category="list-text">要对启动程序端口进行编程： `ucadmin modify -m fc -t initiator &lt;adapter&gt;`</block>
  <block id="2b82f33f2fca28990565d495f9d55cd3" category="paragraph">` -t` 是 FC4 类型： target 或 initiator 。</block>
  <block id="e232209385eb7b98921ecdbaacea8f75" category="cell">根据需要使用以下命令之一修改 node4 上的 FC 端口： `ucadmin modify -m fc -t initiator -f &lt;adapter_port_name&gt;` ` -t` 是 FC4 类型，目标或启动程序。* 注 * ：必须将 FC 端口编程为启动程序。</block>
  <block id="f3ee9b289c7b437cc8c3738378219c2d" category="list-text">跳过此部分并转到 <block ref="f694066eff0c2ca8cd3a02623214690d" category="inline-link-macro-rx"></block> 如果 node4 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="05f0b322edfcec7724f0be57734c3c56" category="list-text">转至 <block ref="f83114d9adca40bee6dbc7b70e5770d9" category="inline-link-macro-rx"></block> 如果 node4 具有 UTA/UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="6c7a7e3cf84ede169573b6ba6732f22e" category="list-text">如果 node4 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请跳过 _Check and configure UTA/UTA2 ports on node4_ 一节，返回 _Install and boot node4_ 一节，然后继续执行 <block ref="0079456745a775e1bbe83d8f5f3879c2" category="inline-link-macro-rx"></block>。</block>
  <block id="2b7d6e150b1ad9a7324920d58add53e8" category="cell">转至 <block ref="41c022824608ca37267e3212853fde36" category="inline-xref-macro-rx"></block>。</block>
  <block id="ed528e1897322b6f9d3ae5cee092d168" category="cell">跳过步骤 5 到步骤 12 ，然后转到 <block ref="209c5aacdd4638183f37956eba312035" category="inline-xref-macro-rx"></block>。</block>
  <block id="30a868238f55d1d59e57331a33e79d19" category="list-text">【第 5 步】执行以下操作之一：</block>
  <block id="00558b45b3379fbfeee090bb3fc8abd9" category="cell">转至 <block ref="7d9b1c67755aa16612302b9c355c6813" category="inline-xref-macro-rx"></block></block>
  <block id="fa41cb483f8360a7d59c8b696fb02b49" category="cell">跳过第 7 步，转到 <block ref="607aa23bcc4188751f11a440d7cfdfe4" category="inline-xref-macro-rx"></block>。</block>
  <block id="6d7d662b72a0f3cc51587f92267e8ede" category="list-text">如果适配器处于启动程序模式，并且 UTA/UTA2 端口处于联机状态，请使用以下命令使 UTA/UTA2 端口脱机：</block>
  <block id="8705313723fb2dd32f08af233e2289a4" category="list-text">【第 7 步】如果当前配置与所需用途不匹配，请使用以下命令根据需要更改配置：</block>
  <block id="0f699653050619b444ac1605f3b71952" category="list-text">【第 8 步】使用以下命令验证设置：</block>
  <block id="010139319ae662f192792aba00c5a63f" category="list-text">使用以下命令之一验证设置：</block>
  <block id="2f9e5b600497e991136b340ad3d95269" category="cell">转至 <block ref="f694066eff0c2ca8cd3a02623214690d" category="inline-link-macro-rx"></block>。</block>
  <block id="5183e0a51a2803bd82cfb83c4040f112" category="cell">返回到 <block ref="1619b1d4cec26b9f46f158ed5add4ab0" category="inline-link-macro-rx"></block> 并恢复步骤 23 中的部分。</block>
  <block id="b1770e3e9f16e83da5b9947f639e4f13" category="list-text">【第 13 步，第 13 步 ]] 使用以下命令退出维护模式：</block>
  <block id="de81a1c588b1b95fdd8a4a333eeae4b9" category="paragraph">如果要升级到 A800 ，请转至 <block ref="fa7dc806bd5abc3aa70265946d09bc1c" category="inline-xref-macro-rx"></block></block>
  <block id="8daafd1de2ac95dd77afb1ec17e9b1f2" category="list-text">在 node4 上，使用 22/7 转到启动菜单并选择隐藏选项 `boot_after_controller_replacement` 。在提示符处，输入 node2 以将 node2 的磁盘重新分配给 node4 ，如以下示例所示。</block>
  <block id="ef6fe409d27a4f09810025db30744ed4" category="list-text">如果系统进入重新启动循环并显示消息 `no disks found` ，则表示系统已将 FC 或 UTA/UTA2 端口重置回目标模式，因此无法看到任何磁盘。要解决此问题，请继续 <block ref="0c8df7d679ee9d5c7ff34a354bf955fc" category="inline-xref-macro-rx"></block> to <block ref="39250fdd2ade726a19cb2044252beb70" category="inline-xref-macro-rx"></block> 或者转到第节 <block ref="f694066eff0c2ca8cd3a02623214690d" category="inline-link-macro-rx"></block>。</block>
  <block id="ebdea8e770813d0fc27333271895e3ab" category="list-text">在自动启动期间按 Ctrl-C 可在 `LOADER&gt;` 提示符处停止节点。</block>
  <block id="7055309e280f6393c40e03e37c753033" category="list-text">在 LOADER 提示符处，使用以下命令进入维护模式：</block>
  <block id="1977624184bad5bb2c4686086e5533bb" category="list-text">在维护模式下，使用以下命令显示先前设置的所有启动程序端口，这些端口现在处于目标模式：</block>
  <block id="32e64bfc9eaa52cd3ef419a69f542d85" category="list-text">使用以下命令验证端口是否已更改为启动程序模式：</block>
  <block id="44e03e3f81d4e3e20c3339df5596b507" category="list-text">在 LOADER 提示符处，使用以下命令启动：</block>
  <block id="b95ee0410132c4ed119eeaed71772b7f" category="list-text">【第 23 步】如果要从具有外部磁盘的系统升级到支持内部和外部磁盘的系统（例如， AFF A800 系统），请将 node2 聚合设置为根聚合，以确保 node4 从 node2 的根聚合启动。要设置根聚合，请转到启动菜单并选择选项 `5` 以进入维护模式。</block>
  <block id="80ea489c9fe3e248776ed04c3374b13e" category="list-text">使用以下命令检查 node2 聚合的 RAID ，丛和校验和信息：</block>
  <block id="861d5850e7f44d03a56066581a70a27a" category="list-text">如有必要，使用以下命令使 node2 聚合联机：</block>
  <block id="f6af6ee83903c7fbac361fed3a52124e" category="list-text">使用以下命令防止 node4 从其原始根聚合启动：</block>
  <block id="12ac6a4c07728084e1d485ddbc6e01fa" category="list-text">使用以下命令将 node2 根聚合设置为 node4 的新根聚合：</block>
  <block id="bc999de7a280fbfd90fd9794fdc85710" category="list-text">使用以下命令验证 node4 的根聚合是否已脱机，从 node2 接管的磁盘的根聚合是否已联机并设置为 root ：</block>
  <block id="b72c69a60f695309089392e6d394557c" category="doc">安装 NX-OS 软件和参考配置文件（ Reference Configuration Files ， RCF ）</block>
  <block id="7731c8a45a101fea978a6844183a8e0b" category="section-title">在 Cisco Nexus 9336C-FX2 集群交换机上安装 NX-OS 软件和 RCF</block>
  <block id="44cdf2e7271b8e2fcbb9adb04d66c093" category="paragraph">Cisco Nexus 9336C-x2 集群交换机上必须安装 Cisco NX-OS 软件和参考配置文件（ RCF ）。</block>
  <block id="3a03c0112ae32bf170b77bdb16df275a" category="paragraph">在集群交换机上安装 NX-OS 软件和 RCF 之前，必须满足以下条件：</block>
  <block id="c9f785db14b6fdfb7deea12d689be994" category="list-text">集群必须完全正常运行（日志中不应有任何错误或类似问题）。</block>
  <block id="73b841d07a1301889e57bfc407d7e585" category="list-text">如果您仅安装 NX-OS 并保留当前 RCF 版本，则必须在 RCF 中检查或设置所需的启动配置，以反映所需的启动映像。</block>
  <block id="7515327f81ebe9201b9f520ffe1eed07" category="list-text">如果您需要更改启动配置以反映当前启动映像，则必须在重新应用 RCF 之前进行更改，以便在将来重新启动时实例化正确的版本。</block>
  <block id="080a81921746ffb2fe914bc2bd49f08e" category="list-text">您必须与交换机建立控制台连接，这是安装 RCF 时所必需的。</block>
  <block id="70399670eb37f7ebf7bbd91e15766e17" category="inline-link">Cisco 以太网交换机</block>
  <block id="9ba7e74098b77999866a4e29fb3a2ad2" category="list-text">您必须已查看 Cisco 以太网交换机页面上的交换机兼容性表以了解受支持的 ONTAP ， NX-OS 和 RCF 版本。请参见<block ref="5c27bdff6f5cc32ce77bb635aee5a3ec" category="inline-link-rx"></block> 有关详细信息 ...</block>
  <block id="a8f8edb7442235385b4a149af7d45b04" category="list-text">RCF 中的命令语法与 NX-OS 版本中的命令语法之间可能存在命令依赖关系。</block>
  <block id="454d8bacc17503d670940b88fdf44b2a" category="inline-link">Cisco Nexus 9000 系列交换机</block>
  <block id="93bcc5669f0e6711d6aba3689fb32eee" category="list-text">您必须已参考 Cisco 网站上提供的相应软件和升级指南，以获取有关 Cisco Nexus 9000 系列交换机上的 Cisco 交换机升级和降级过程的完整文档。请参见<block ref="be7ba65926f2f461bdeaf4115306601b" category="inline-link-rx"></block> 有关详细信息 ...</block>
  <block id="0e9e9e2c6f88c5f4c53342802b95a81a" category="list-text">您必须具有当前 RCF 。</block>
  <block id="1231369e1218613623e1b520c27ce190" category="section-title">初始设置</block>
  <block id="3a5235a970574c03c491ba816b7efcc5" category="paragraph">此操作步骤中的示例使用两个节点。根据 A400 控制器，这些节点使用两个 100GbE 集群互连端口 E3A 和 e3b 。请参见<block ref="e8018b6e740a667345f4bcc94e4023fc" category="inline-link-rx"></block> 验证平台上的集群端口是否正确。</block>
  <block id="1a5fbb9c78227a044a7d11a646c64e2a" category="admonition">根据不同版本的 ONTAP ，命令输出可能会有所不同。</block>
  <block id="08a3b4f30cd799b9c46ef942ae0f647d" category="paragraph">此操作步骤中的示例使用以下交换机和节点命名：</block>
  <block id="21cdd5286ad338ac1e1ff083d62b5d6d" category="list-text">两个 Cisco 交换机的名称分别为 _CS1_ 和 _CS2_ 。</block>
  <block id="6169ae5d5db5b009247efff892416b21" category="list-text">节点名称为 _cluster1-01_ 和 _cluster1-02_ 。</block>
  <block id="14cce8700b380b41ee7141783958adc0" category="list-text">对于 cluster1-01 ，集群 LIF 名称分别为 _cluster1-01_clus1_ 和 _cluster1-01_clus2_ ；对于 cluster1-02 ，集群 LIF 名称分别为 _cluster1-02_clus1_ 和 _cluster1-02_clus2_ 。</block>
  <block id="47260d8977bfed7fc2ab803dd06d671b" category="list-text">cluster1 ：：： * &gt; 提示符指示集群的名称。</block>
  <block id="f0db4a1725ddf2683998fa54fd370447" category="admonition">操作步骤要求同时使用 ONTAP 命令和 Cisco Nexus 9000 系列交换机命令；除非另有说明，否则使用 ONTAP 命令。</block>
  <block id="49bbe8c2f71c4791413418d964b2b67e" category="list-text">`s步骤 1]] 如果此集群上启用了 AutoSupport ，请通过调用 AutoSupport 消息禁止自动创建案例：` system node AutoSupport invoke -node * -type all -message MAINT=x h</block>
  <block id="50a6450efe6f48e63fe6cdc703ef260f" category="paragraph">其中 x 是维护时段的持续时间，以小时为单位。</block>
  <block id="87a3bb7a9a30a69bb1b97bb3f2eb5329" category="list-text">【第 2 步】将权限级别更改为高级，在系统提示您继续时输入 y ： `set -privilege advanced`</block>
  <block id="4f21ff6f61e1071606649c4871ef7bf7" category="paragraph">此时将显示高级提示符（ * &gt; ）。</block>
  <block id="27cc2dbd07956c633e69ce2c76dc9459" category="list-text">【第 3 步】显示每个节点为每个集群互连交换机配置了多少个集群互连接口： `network device-discovery show -protocol cdp`</block>
  <block id="9a2e9547e1f8cfdcb2f137afb07f156e" category="list-text">【第 4 步】检查每个集群接口的管理或运行状态：</block>
  <block id="812c73458a9bcfba11e9f9ce18f5d870" category="list-text">显示网络端口属性： `network port show – IPSpace Cluster`</block>
  <block id="73fa057e8ea70ff9fcaebfa5fb04c0df" category="list-text">显示有关 LIF 的信息： `network interface show - Vserver Cluster`</block>
  <block id="4c6b6e8d0256a57f802a767c3cda666d" category="list-text">【第 5 步】对远程集群 LIF 执行 Ping 操作： `cluster ping-cluster -node node-name`</block>
  <block id="425edecc172c1a104da4a8a9f52919c4" category="list-text">【第 6 步】验证是否已在所有集群 LIF 上启用 auto-revert 命令： `network interface show - vserver cluster -fields auto-revert`</block>
  <block id="f680b3f7a1e59ca77ebee96ca084b070" category="list-text">【第 7 步】使用以下命令启用以太网交换机运行状况监控器日志收集功能，以收集交换机相关的日志文件：</block>
  <block id="6724e1022893a9633cfb2312f0732331" category="list-text">`s系统交换机以太网日志设置密码`</block>
  <block id="59f5de53d0bcaeeb4e4e9818bbf75f18" category="list-text">`s系统交换机以太网日志 enable-Collection`</block>
  <block id="c0f264a6f90e5505b277b8a8526dbfba" category="admonition">如果其中任何一个命令返回错误，请联系 NetApp 支持部门。</block>
  <block id="115f48600c555ef0c26ae33b9c750836" category="section-title">在 Cisco Nexus 9336c- FX2 集群交换机上安装 NX-OS 软件</block>
  <block id="e32f30672bced30275c59561547bb9ca" category="paragraph">您可以使用此操作步骤在 Cisco Nexus 9336C-x2 集群交换机上安装 NX-OS 软件。</block>
  <block id="315023ecf41390bf3da5256a508a3f74" category="list-text">【第 1 步】将集群交换机连接到管理网络。</block>
  <block id="0ad4621be6ed680f656c10d66806f36d" category="list-text">【第 2 步】使用 `ping` 命令验证与托管 NX-OS 软件和 RCF 的服务器的连接。</block>
  <block id="df388e62dd393d7a7a4ecd0894d8991b" category="paragraph">此示例验证交换机是否可以通过 IP 地址 `172.19.2.1` 访问服务器：</block>
  <block id="980488afb0b91fa49e08977b96694389" category="list-text">【第 3 步】将 NX-OS 软件和 EPLD 映像复制到 Nexus 9336C-x2 交换机。</block>
  <block id="b58ca1d337150f9579b9262d528aa7ac" category="list-text">【第 4 步】验证正在运行的 NX-OS 软件版本： `show version`</block>
  <block id="375e9b6b1ba3b7632a630ee8ec094411" category="list-text">【第 5 步】安装 NX-OS 映像。</block>
  <block id="fae0bfa2a533f948ea8bab875acb2ef9" category="admonition">安装映像文件会导致每次重新启动交换机时加载该映像文件。</block>
  <block id="a35e2c8e813cfa4f98b971dbb32cfbcb" category="list-text">【第 6 步】重新启动交换机后，请验证 NX-OS 软件的新版本： `sHow version`</block>
  <block id="ad02163f2b7e000ab6eb0f542bcdfb95" category="list-text">【第 7 步】升级 EPLD 映像并重新启动交换机。</block>
  <block id="f3bf0508f81cb16d8f1183a5babd44ab" category="list-text">在交换机重新启动后，再次登录并验证是否已成功加载新版本的 EPLD 。</block>
  <block id="c4d4380c105d86618a1c8e5e7e278abc" category="section-title">在 Cisco Nexus 9336c- x2 集群交换机上安装 RCF</block>
  <block id="58fdd965128fa855a145ee5285e3f421" category="paragraph">首次设置 Nexus 9336C-FX2 集群交换机后，您可以安装 RCF 。您也可以使用此操作步骤升级集群交换机上的 RCF 版本。</block>
  <block id="bbe48fb854ea022537208eeeff822f91" category="section-title">关于此任务</block>
  <block id="59d98c4371d8b96126b918b6e485c9d7" category="list-text">这两台 Cisco 交换机的名称分别为 `CS1` 和 `CS2` 。</block>
  <block id="17c77507bb5bee4b130dcc96474dd7aa" category="list-text">节点名称包括 `cluster1-01` ， `cluster1-02` ， `cluster1-03` 和 `cluster1-04` 。</block>
  <block id="184da567032abe3561c5d2ad05b67cc6" category="list-text">集群 LIF 名称为 `cluster1-01_clus1` ， `cluster1-01_clus2` ， `cluster1-02_clus1` ， `cluster1-02_clus2` ， `cluster1-03_clus1` ， `cluster1-03_clus2` ， `cluster1-04_clus1` 和 `cluster1-04_clus2` 。</block>
  <block id="6f59ffb0aff1eef7e0d6e4639fc8b552" category="list-text">【第 1 步】显示连接到集群交换机的每个节点上的集群端口： `network device-discovery show`</block>
  <block id="57bb9a852f73263e3b799b55fcc31118" category="list-text">【第 2 步】检查每个集群端口的管理和运行状态。</block>
  <block id="4a72d00c859a5662166fde201a6f8401" category="list-text">【第 3 步】确认所有集群端口均已启动且运行状况良好： `network port show – role cluster`</block>
  <block id="1efe831e4027761116f05afe4a76b490" category="list-text">【第 4 步】确认所有集群接口（ LIF ）都位于主端口上： `network interface show -role cluster`</block>
  <block id="e6eb77b46f5038fe2be7c6a3e46fd5e8" category="list-text">`s确认集群显示两个集群交换机的信息：` system cluster-switch show -is-monitoring-enableed-Operational true</block>
  <block id="119f0d0479f9941f749052021f33ac87" category="list-text">【第 6 步】在集群 LIF 上禁用自动还原。</block>
  <block id="2014cf2f27a4e96e96bad19ce837c9d7" category="list-text">在集群交换机 CS2 上，关闭连接到节点集群端口的端口。</block>
  <block id="9bd7b09d3a604bde6a4f23c6e7264720" category="list-text">【第 8 步】验证集群 LIF 是否已迁移到集群交换机 CS1 上托管的端口。这可能需要几秒钟时间： `network interface show -role cluster`</block>
  <block id="f7844b627d275305d802a9082359ba58" category="list-text">【第 9 步】验证集群是否运行正常： `cluster show`</block>
  <block id="ff2853f03b66c4604ca015098ade032e" category="list-text">【第 10 步】清理交换机 CS2 上的配置并执行基本设置。</block>
  <block id="1504cf88a17b3708e24bb6d08d1219aa" category="list-text">清理配置。此步骤需要与交换机建立控制台连接。</block>
  <block id="a60e6126941c3f2e1aeab2b7f1fd5da6" category="list-text">对交换机执行基本设置。</block>
  <block id="3665b3f0fc7160f9eec0fa81485c0fda" category="inline-link">Cisco Nexus 9000 系列 NX-OS 命令参考指南</block>
  <block id="a6eb32320381dab7fc6dcf483ed01eaa" category="list-text">【第 11 步】使用以下传输协议之一将 RCF 复制到交换机 CS2 的启动闪存： FTP ， TFTP ， SFTP 或 SCP 。有关 Cisco 命令的详细信息，请参见中的相应指南<block ref="ddab0e4c59f1173186c88b8e6d2844d1" category="inline-link-rx"></block>。</block>
  <block id="4ec9c300967777e19db00635cec839a4" category="paragraph">此示例显示了使用 TFTP 将 RCF 复制到交换机 CS2 上的 bootflash 。</block>
  <block id="1cfc3a092f0e63fac946beaaf955f2f2" category="list-text">【第 12 步】将先前下载的 RCF 应用于启动闪存。有关 Cisco 命令的详细信息，请参见中的相应指南<block ref="ddab0e4c59f1173186c88b8e6d2844d1" category="inline-link-rx"></block>。</block>
  <block id="2a187aceff13c243d7f89e5b96b7f2cf" category="paragraph">此示例显示了正在交换机 CS2 上安装的 RCF 文件 `Nexus 9336C_RCF_v1.6-Cluster-HA-Breakout 。 txt` 。</block>
  <block id="7fdc0c62cb85afeb6470d9bfc6ecf80c" category="list-text">【第 13 步】查看 `show banner motd` 命令的横幅输出。您必须阅读并遵循这些说明，以确保交换机的配置和操作正确。</block>
  <block id="5a7ad2c453ed3535cf40e5c895ce66b6" category="list-text">【第 14 步】验证 RCF 文件是否为正确的较新版本： `show running-config`</block>
  <block id="47c173b91782927bfc36acfeeaec5f9f" category="paragraph">在检查输出以确认您的 RCF 正确无误时，请确保以下信息正确无误：</block>
  <block id="2a4c49daad6f24fc930342baa230202a" category="list-text">RCF 横幅</block>
  <block id="f867470f4d681a0d1ba65ec5afb71681" category="list-text">节点和端口设置</block>
  <block id="5bd909d2aabb76836e8fdad730968abb" category="list-text">自定义</block>
  <block id="6581e275d5beff2b5ac80574ca81f3ef" category="paragraph">输出因站点配置而异。检查端口设置，并参阅发行说明，了解您安装的 RCF 的任何特定更改。</block>
  <block id="f84dbe517c4cab37d96220b08c6a7430" category="list-text">验证 RCF 版本和交换机设置是否正确后，将 running-config 文件复制到 startup-config 文件。</block>
  <block id="1d7efc47666ab70e4a9a2f49059d6f36" category="paragraph">有关 Cisco 命令的详细信息，请参见中的相应指南<block ref="ddab0e4c59f1173186c88b8e6d2844d1" category="inline-link-rx"></block>。</block>
  <block id="0b2d5b5929738c77eb7339e80be204b4" category="list-text">【第 16 步】重新启动交换机 CS2 。您可以忽略在交换机重新启动时报告的节点上的 " 集群端口关闭 " 事件。</block>
  <block id="8c100710ef7da1c5a25caac2ea22990b" category="list-text">【第 17 步】应用相同的 RCF 并再次保存运行配置。</block>
  <block id="94424f8858d01ed962dd87641b9776a6" category="list-text">【第 18 步】验证集群上集群端口的运行状况。</block>
  <block id="dd731ffd2ea93d5d4f7a6ec37ae136dc" category="list-text">验证集群中所有节点上的 e0d 端口是否均已启动且运行正常： `network port show -role cluster`</block>
  <block id="a8b215fa6b6d814a7e68d02c02b35409" category="list-text">从集群验证交换机运行状况（此操作可能不会显示交换机 CS2 ，因为 LIF 不驻留在 e0d 上）。</block>
  <block id="e3b96995522578c69012ad7e2f0b94cd" category="admonition">根据先前加载在 CS1 交换机控制台上的 RCF 版本，您可能会在该交换机控制台上看到以下输出。</block>
  <block id="7975bfd302a0d902636cf58d15d4b6ba" category="list-text">在集群交换机 CS1 上，关闭连接到节点集群端口的端口。以下示例使用步骤 1 中的接口示例输出：</block>
  <block id="276b12f283110f76d275def982eccbee" category="list-text">【第 20 步】验证集群 LIF 是否已迁移到交换机 CS2 上托管的端口。这可能需要几秒钟时间： `network interface show -role cluster`</block>
  <block id="e0d0ae7057b201d97ec22f91ff82d2f2" category="list-text">【第 21 步】验证集群是否运行正常： `cluster show`</block>
  <block id="010322043e6a0f2cb377ddc319acddfc" category="list-text">【第 22 步】对交换机 CS1 重复步骤 7 到 14 。</block>
  <block id="9baf7dc8ac289c210d4e50f17e9a797c" category="list-text">在集群 LIF 上启用自动还原。</block>
  <block id="7d570f5616c08513ff751b28be7d62ef" category="list-text">【第 24 步】重新启动交换机 CS1 。执行此操作可触发集群 LIF 还原到其主端口。您可以忽略在交换机重新启动时报告的节点上的 " 集群端口关闭 " 事件。</block>
  <block id="a648d759b45a2e063a5bb5f0ce05aaa0" category="list-text">【第 25 步】验证连接到集群端口的交换机端口是否已启动。</block>
  <block id="7fd9069a29ec1f3894e4bf3f8e46af56" category="list-text">【第 26 步】验证 CS1 和 CS2 之间的 ISL 是否正常运行： `sPort-Channel summary`</block>
  <block id="7e07a9e5464a35d66ee24e131cbf4591" category="list-text">【第 27 步】验证集群 LIF 是否已还原到其主端口： `network interface show -role cluster`</block>
  <block id="97d338e8c659dde4173ceb593a7ccc43" category="list-text">【第 28 步】验证集群是否运行正常： `cluster show`</block>
  <block id="309143a0feb1ae92f31c8e20212e99bb" category="list-text">【第 29 步】对远程集群接口执行 Ping 操作以验证连接： `cluster ping-cluster -node local`</block>
  <block id="e03b30f7a942f40e3ef9fa2dd25c4910" category="section-title">在 Cisco Nexus 9336C-x2 存储交换机上安装 RCF</block>
  <block id="d52af4db26cdc6972cb223d9c6949efd" category="paragraph">可以在 Cisco Nexus 9336C-x2 存储交换机上升级参考配置文件（ RCF ）。</block>
  <block id="dd94efc46ba7285ebf184360d8bd2069" category="paragraph">在存储交换机上升级 RCF 之前，必须满足以下条件：</block>
  <block id="1ddd8cd97d47781400c93ef2648320ac" category="list-text">交换机必须完全正常运行（日志中不应有任何错误或类似问题）。</block>
  <block id="67972398f3f6e677fdd5abecabee47b1" category="list-text">如果您仅安装 NX-OS 并保留当前 RCF 版本，则必须在 RCF 中检查或设置所需的启动变量，以反映所需的启动映像。</block>
  <block id="14fbade2b67035c34eec7534fb6c6b2c" category="list-text">如果您需要更改启动变量以反映当前启动映像，则必须在重新应用 RCF 之前进行更改，以便在未来重新启动时实例化正确的版本。</block>
  <block id="b75409ad20561d6d1e0855c872352b91" category="list-text">您必须已参考 Cisco 网站上提供的相应软件和升级指南，以获取有关 Cisco 存储升级和降级过程的完整文档。请参见<block ref="be7ba65926f2f461bdeaf4115306601b" category="inline-link-rx"></block> 有关详细信息 ...</block>
  <block id="cb3b33954945611e0ba8b2628e06d629" category="inline-link">Cisco 以太网交换机</block>
  <block id="e69be1a8940ded4a86c983ea41ce101b" category="list-text">100 GbE 端口的数量在上提供的参考配置文件（ Reference Configuration Files ， RCF ）中定义<block ref="78ccdd0a3e16d4d44b95043dbee8e2db" category="inline-link-rx"></block> 页面。</block>
  <block id="d846658fd20202f0bde85173d25b3b6e" category="section-title">操作步骤摘要</block>
  <block id="4d8d9a10a7f6c1d3adfc89b70d043ef4" category="list-text">检查交换机和端口的运行状况（步骤 1-4 ）</block>
  <block id="9a10130122f7ab40e88397de07680473" category="list-text">将 NX-OS 映像下载到 Cisco 交换机 ST2 并重新启动（步骤 5-8 ）</block>
  <block id="f1e72cccd81c54e9702d2a17ef6741d6" category="list-text">将 RCF 复制到 Cisco 交换机 ST2 （步骤 9-12 ）</block>
  <block id="fc914b7596e28ac17c34ab6409e4f76e" category="list-text">重新检查交换机和端口的运行状况（步骤 13-15 ）</block>
  <block id="b499c115983c87d2abc585368ecc8a68" category="list-text">对 Cisco 交换机 st1 重复步骤 1-15 。</block>
  <block id="0296e3820f6a9017b3c45707a6679765" category="list-text">这两个存储交换机的名称分别为 _st1_ 和 _st2_ 。</block>
  <block id="14c42e4d59f29697cd3c577b2c4d3d88" category="list-text">节点为 _node1_ 和 _node2_ 。</block>
  <block id="408a56ead85ecd9cd97d37a71b3aca37" category="list-text">如果在此集群上启用了 AutoSupport ，请通过调用 AutoSupport 消息来禁止自动创建案例： `ssystem node AutoSupport invoke -node * -type all - message MAINT=xh`</block>
  <block id="67c35d4cbdd5f01430776df014c4e83a" category="list-text">检查存储交换机是否可用： `ssystem switch Ethernet show`</block>
  <block id="be506e00d8c5a0f90848df43aaec57d1" category="list-text">【第 3 步】验证节点端口是否运行正常： `storage port show -port-type ENET`</block>
  <block id="0bfcedc4c29046eab84a685e19eaaccb" category="list-text">【第 4 步】检查集群是否没有存储交换机或布线问题： `ssystem health alert show -instance`</block>
  <block id="3b8e340f7708513e47cdb40f8f417da8" category="list-text">【第 5 步】将 NX-OS 映像下载到交换机 ST2 。</block>
  <block id="e7b725ded309e5f01ca39f1b7b8e4c37" category="list-text">安装系统映像，以便在下次重新启动交换机 ST2 时加载新版本。交换机将在 10 秒后重新启动，并显示新映像，如以下输出所示：</block>
  <block id="0fb405635f99323f477dd34eaaaec21a" category="list-text">【第 7 步】保存配置。</block>
  <block id="45ce5d616a97b4db0322e968ac3c0d3a" category="paragraph">系统将提示您重新启动系统，如以下示例所示：</block>
  <block id="3b02f68343abf714cab240ec36648aa3" category="list-text">【第 8 步】确认交换机上已有新的 NX-OS 版本号。</block>
  <block id="67589acf00f7ba71ca9338bb4e0fd1bb" category="list-text">【第 9 步】使用以下传输协议之一将交换机 ST2 上的 RCF 复制到交换机 bootflash ： FTP ， HTTP ， TFTP ， SFTP 或 SCP 。</block>
  <block id="bd7cf284a4de162c778c840fe7671baa" category="paragraph">以下示例显示了用于将 RCF 复制到交换机 ST2 上的 bootflash 的 HTTP ：</block>
  <block id="6e8b6368cdfe3dac206d3c34fea35245" category="list-text">【第 10 步】将先前下载的 RCF 应用于 bootflash ： `copy bootflash` 。</block>
  <block id="860bb58c533209a1a0e1a5a81daa9d56" category="paragraph">以下示例显示了正在交换机 ST2 上安装的 RCF 文件 `Nexus 9336C_RCF_v1.6-Storage.txt` ：</block>
  <block id="124b319394ac2a4c7e0b96f784f3482c" category="list-text">【第 11 步】验证 RCF 文件是否为正确的较新版本： `show running-config`</block>
  <block id="783607b7834c86426414bd326eac9af8" category="paragraph">* 重要说明： * 在 `show banner motd` 命令的横幅输出中，您必须阅读并遵循 * 重要说明 * 一节中的说明，以确保交换机的配置和操作正确。</block>
  <block id="ae568f7135a27b32b7e8bb3a276bd2ef" category="list-text">【第 12 步】确认软件版本和交换机设置正确后，将 running-config 文件复制到交换机 ST2 上的 startup-config 文件中。</block>
  <block id="1db78193f459bb20425c02c98a5d89e0" category="paragraph">有关 Cisco 命令的详细信息，请参见中的相应指南<block ref="ddab0e4c59f1173186c88b8e6d2844d1" category="inline-link-rx"></block>。</block>
  <block id="2b5da61174f57535e5ac41ebce733b08" category="paragraph">以下示例显示了已成功将 `running-config` 文件复制到 `starstartup-config` 文件：</block>
  <block id="1b124e5a5283fd46117154de1b61cb91" category="list-text">【第 13 步】重新启动后，重新检查存储交换机是否可用： `ssystem switch Ethernet show`</block>
  <block id="9d06968b9f870f0296b812437f447140" category="list-text">【第 14 步】重新启动后，验证交换机端口是否运行正常且正常运行： `storage port show -port-type ENET`</block>
  <block id="ba8d8d5f101d57e32f0f1ea1e503148e" category="list-text">【第 15 步】重新检查集群是否没有存储交换机或布线问题： `ssystem health alert show -instance`</block>
  <block id="544cf4bb505f4a2b3281aab49c8c1d04" category="list-text">【第 16 步】对交换机 st1 上的 RCF 重复此操作步骤。</block>
  <block id="d96137d6b55b18690724fa521ebda2f1" category="list-text">如果禁止自动创建案例，请通过调用 AutoSupport 消息重新启用此功能： `ssystem node AutoSupport invoke -node * -type all -message MAINT=end`</block>
  <block id="34a5a87b0cc4e8609dc123f3eda8ae15" category="section-title">在 Cisco Nexus 9336C-x2 共享交换机上安装 RCF</block>
  <block id="111819cdc8331282a1e7d94476ab33fd" category="paragraph">从 ONTAP 9.1.1 开始，您可以使用 Cisco Nexus 9336C-f2 交换机将存储和集群功能结合到共享交换机方案中。</block>
  <block id="7630744f4654dfae7fcf3a382ce4f001" category="list-text">集群交换机必须完全正常运行（日志中不应有任何错误或类似问题）。</block>
  <block id="b1d65cecd9473fe90e922dee86b6e267" category="list-text">存储交换机必须完全正常运行（日志中不应出现错误或类似问题）。</block>
  <block id="0d67bfb67ba8f3b70c336fd689fcf72d" category="list-text">这两个存储交换机的名称分别为 _SH1_ 和 _SH2_ 。</block>
  <block id="5d300e999224578cbf19f9938e2ceb44" category="list-text">此处使用的示例将共享 RCF 加载到新交换机。</block>
  <block id="9a71e23595ce0b2db0bd8400f0f7a5f8" category="list-text">使用以下传输协议之一将交换机 SH2 上的 RCF 复制到交换机 bootflash ： FTP ， HTTP ， TFTP ， SFTP 或 SCP 。</block>
  <block id="3295046e59c21cadabd536af253fa5a6" category="paragraph">以下示例显示了用于将 RCF 复制到交换机 SH2 上的 bootflash 的 HTTP ：</block>
  <block id="9359f59d81c8af8607852bd1a7e767bf" category="list-text">【第 2 步】将先前下载的 RCF 应用于 bootflash ： `copy bootflash` 。</block>
  <block id="1355622915562d855ddc30354a805a3d" category="paragraph">以下示例显示了正在交换机 SH2 上安装的 RCF 文件 `Nexus_9336C_RCF_v1.7-Cluster-HA-Storage.txt ` ：</block>
  <block id="1d9b11f893d3d9bba5e105e250f26c4e" category="list-text">【第 3 步】验证 RCF 文件是否为正确的较新版本： `show running-config`</block>
  <block id="10a6ccf9fc171d58769bff43b7d0e672" category="list-text">【第 4 步】确认软件版本和交换机设置正确后，将 `running-config` 文件复制到交换机 SH2 上的 startup-config 文件中。</block>
  <block id="d8130767192c2723846f89cb58f48dc3" category="list-text">【第 5 步】对交换机 SH1 上的 RCF 重复此操作步骤。</block>
  <block id="62bb127cfc33134b4b7ba3eb79ae05f3" category="doc">通过重复使用存储交换机从具有 SAT 存储的交换集群进行迁移</block>
  <block id="5542e924104d087ae00a02e0143b2f6b" category="section-title">迁移存储交换机</block>
  <block id="29c04d28b21adc7e1a7b356455c263a4" category="inline-image-macro">交换机连接</block>
  <block id="7424e91fe1d742657d5ad736cc938704" category="paragraph">通过重复使用存储交换机， HA 对 1 的存储交换机将成为共享交换机。* 交换机连接的布线图 *<block ref="6a2cf54f6a37518ec42d92fd7fd3e59c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="09de4d47ba4a61383fa6bd8275ea0013" category="list-text">验证 HA 对 1 （和 HA 对 2 ）的存储配置是否正确且无错误： `ssystem switch Ethernet show`</block>
  <block id="514085dcc3bcd7f871a43182b26fc37f" category="list-text">【第 2 步】将 HA 对 1 的 NSM224 路径 A 缆线从存储交换机 A 移至存储交换机 A 上 HA 对 1 的路径 A 的 NSM224 存储端口</block>
  <block id="9adac45c8f65af4ce2b61c1a4a107e6f" category="list-text">将缆线从 HA 对 1 的节点 A 路径 A 移至存储交换机 A 上 HA 对 1 的节点 A 的 NSM224 存储端口</block>
  <block id="0e537830f3d70ee3a080b4d98d4c355a" category="list-text">将缆线从 HA 对 1 的节点 B 路径 A 移至存储交换机 A 上 HA 对 1 的节点 B 的 NSM224 存储端口</block>
  <block id="9585534fcb2acd1761f1ba9070b7baf0" category="list-text">确认连接到 HA 对 1 存储交换机 A 的存储运行状况良好： `storage port show -port-type ENET`</block>
  <block id="6b4eb003d068fdec4d54fd55af67485b" category="list-text">【第 6 步】将共享交换机 A 上的存储 RCF 替换为共享 RCF 文件。请参见 <block ref="41062cda0a6ae510a0f118eb961870a4" category="inline-link-macro-rx"></block> 了解更多详细信息。</block>
  <block id="dfaf1e0c7a26db603d75c12484eecbe5" category="list-text">确认连接到 HA 对 1 存储交换机 A 的存储运行状况良好： `ssystem health alert show -instance`</block>
  <block id="cc173b3b8d39723f6f1a95f88f27699a" category="list-text">【第 8 步】将 HA 对 1 的 NSM224 路径 B 缆线从存储交换机 B 移至 HA 对 1 的共享 NS224 存储端口，路径 B 移至存储交换机 B</block>
  <block id="5d5108c830c67272c71b7aadba12e4b2" category="list-text">将缆线从 HA 对 1 的节点 A 路径 B 移至存储交换机 B 上 HA 对 1 的共享存储端口，节点 A 的路径 B</block>
  <block id="53b39cfff16d9870da3ecc23bf2f95ba" category="list-text">将缆线从 HA 对 1 的节点 B 路径 B 移至存储交换机 B 上 HA 对 1 的共享存储端口，节点 B 的路径 B</block>
  <block id="ce8c521f1923b2dd332b3fc771e23d2a" category="list-text">确认连接到 HA 对 1 存储交换机 B 的存储运行状况良好： `ssystem health alert show -instance`</block>
  <block id="7d2bca8f6a7efb4ad8be7d3f7b9740a4" category="list-text">【第 12 步】将共享交换机 B 上的存储 RCF 文件替换为共享 RCF 文件。请参见 <block ref="41062cda0a6ae510a0f118eb961870a4" category="inline-link-macro-rx"></block> 了解更多详细信息。</block>
  <block id="607592482c84ee6e3ab8d00221a34400" category="list-text">【第 14 步】验证 HA 对 1 的存储配置是否正确且无错误： `ssystem switch Ethernet show`</block>
  <block id="447638ceee95556dee2fdf9379e52c28" category="list-text">【第 15 步】在共享交换机 A 和共享交换机 B 之间安装 ISL ：</block>
  <block id="8a6725809e9d102de1fa5e1c7d8c431d" category="inline-link-macro">更换 Cisco Nexus 9336C-x2 共享交换机</block>
  <block id="afa9b8e6dc90129b62dcb7f7e629ccaf" category="list-text">【第 16 步】使用替代交换机操作步骤和共享 RCF 将集群网络从现有集群交换机迁移到共享交换机。新的共享交换机 A 为 "CS1" 。新的共享交换机 B 为 "CS2" 。请参见 <block ref="cbb16447b88abbf626db4295a94e10df" category="inline-link-macro-rx"></block> 和 <block ref="41062cda0a6ae510a0f118eb961870a4" category="inline-link-macro-rx"></block> 了解更多详细信息。</block>
  <block id="87ee7302cf3c1ada159d4d2696688b0d" category="list-text">验证交换网络配置是否有效： `network port show`</block>
  <block id="412d467b5f15dc1967df2c5af126e62d" category="list-text">删除未使用的集群交换机。</block>
  <block id="936648102dd0e64a9748e863cad7bbdd" category="list-text">删除未使用的存储交换机。</block>
  <block id="7bd0358c3b996edfe19bd3da912bde62" category="doc">Cisco Nexus 9336C-x2 共享交换机</block>
  <block id="c07d0e299690131f90afb07e5d847e3f" category="paragraph">更换有故障的 Nexus 9336C-x2 共享交换机是无中断操作步骤（ NDU ）。</block>
  <block id="c4ceb27b488ee8c76dddf465a267e6fb" category="paragraph">在当前环境中以及在替代交换机上执行交换机更换之前，必须满足以下条件。</block>
  <block id="60a085daee18baa4f76424f459638014" category="list-text">现有集群和网络基础架构：</block>
  <block id="bed48f8d78fae83f8dbfe9776b8a6b05" category="list-text">必须使用至少一个完全连接的集群交换机验证现有集群是否完全正常运行。</block>
  <block id="e99dfadc7ffd3ecaddd1986a48465f46" category="list-text">所有集群端口都必须为 * 启动 * 。</block>
  <block id="b59349f8fffc7ea477834852e7e20892" category="list-text">所有集群逻辑接口（ LIF ）都必须为 * 启动 * 并位于其主端口上。</block>
  <block id="50680f60b6b5a21bd37f50f4b636dad7" category="list-text">ONTAP cluster ping-cluster -node node1 命令必须指示所有路径上的基本连接以及大于 PMTU 的通信均成功。</block>
  <block id="6f523f9e785067d3925b0aec1c87ae91" category="list-text">Nexus 9336C-x2 更换交换机：</block>
  <block id="ff47b0585e566a73f653682a2d21e5b0" category="list-text">更换用的交换机上的管理网络连接必须正常工作。</block>
  <block id="50c541fa74de2f5af11460d3ea9124a7" category="list-text">必须能够通过控制台访问更换用的交换机。</block>
  <block id="cb941c5ab2121b66b6edc811bef1cf7f" category="list-text">节点连接为端口 1/1 到 1/34 ：</block>
  <block id="22886c387dcbb159cf76a09acea002be" category="list-text">必须在端口 1/35 和 1/36 上禁用所有交换机间链路（ ISL ）端口。</block>
  <block id="8d0dde131d3467b69599db1c22cbb114" category="list-text">必须将所需的参考配置文件（ Reference Configuration File ， RCF ）和 NX-OS 操作系统映像交换机加载到交换机上。</block>
  <block id="da3d2259355bee77531cdb315e049db9" category="list-text">之前的任何站点自定义设置，例如 STP ， SNMP 和 SSH ，都应复制到新交换机。</block>
  <block id="54bb024ba08d8f7e48b6be56f6a3301a" category="paragraph">您必须执行命令，从托管集群 LIF 的节点迁移集群 LIF 。</block>
  <block id="81d35344bbcd7f7963f3f312f27c7c0a" category="list-text">现有 Nexus 9336C-f2 交换机的名称是 _SH1_ 和 _SH2_ 。</block>
  <block id="9c96a9c93a3fb315e851f1ec0f1b4ccf" category="list-text">新 Nexus 9336C-fx2 交换机的名称是 _newsh1_ 和 _newsh2_ 。</block>
  <block id="faae0adf04bd789e302814634c2ad2b8" category="list-text">节点名称为 _node1_ 和 _node2_ 。</block>
  <block id="62c81a751ae46177c5688fd86330d69f" category="list-text">每个节点上的集群端口均名为 _e3A_ 和 _e3b_ 。</block>
  <block id="2b37f98166c30979ac9a6361c70e9ddd" category="list-text">集群 LIF 名称是 node1 的 `node1_clus1` 和 `node1_clus2` ， node2 的 `node2_clus1` 和 `node2_clus2` 。</block>
  <block id="1fc4d07624650dec28e2c1708226b30b" category="list-text">对所有集群节点进行更改的提示为 cluster1 ：：： * &gt; 。</block>
  <block id="94373e8833b452b5d7fcbeabe9edc3f3" category="admonition">以下操作步骤基于以下网络拓扑：</block>
  <block id="cc36844d7ce51a41c37bee302ed701b1" category="list-text">如果在此集群上启用了 AutoSupport ，请通过调用 AutoSupport 消息来禁止自动创建案例： `ssystem node AutoSupport invoke -node * -type all -message MAINT=xh`</block>
  <block id="859f21c0207e314111f0afb2da6d115e" category="list-text">可选：在交换机 newsh2 上安装相应的 RCF 和映像，并进行必要的站点准备。</block>
  <block id="2d5ce426423eeeead4f35769cd8b1b27" category="inline-xref">第 3 步</block>
  <block id="8dc7f184015d8c790de3fb26a2bc3f3c" category="list-text">如有必要，请验证，下载并安装适用于新交换机的 RCF 和 NX-OS 软件的相应版本。如果您已确认新交换机设置正确，并且不需要更新 RCF 和 NX-OS 软件，请继续执行 <block ref="6f5e80c5f38b7c17bfcb05f65cf8fc44" category="inline-xref-macro-rx"></block>。</block>
  <block id="d809d21bd67582c1334d95ab6c3a0098" category="list-text">转至 NetApp 支持站点上的 NetApp 集群和管理网络交换机参考配置文件问题描述页面。</block>
  <block id="df1f10867a66c2ecf7cead01d3984b7b" category="list-text">单击 "Cluster Network and Management Network Compatibility Matrix （集群网络和管理网络兼容性表） " 的链接，然后记下所需的交换机软件版本。</block>
  <block id="a03622205af9039cab7ee299edb23fc9" category="list-text">单击浏览器的后退箭头以返回到问题描述页面，单击继续，接受许可协议，然后转到下载页面。</block>
  <block id="3c16440f77643f58d4491055591e88b7" category="list-text">按照下载页面上的步骤下载与您要安装的 ONTAP 软件版本对应的正确 RCF 和 NX-OS 文件。</block>
  <block id="b02cd310686a37dfef491f23f468fd28" category="list-text">在新交换机上，以 admin 身份登录并关闭将连接到节点集群接口（端口 1/1 到 1/34 ）的所有端口。如果要更换的交换机无法正常工作并已关闭电源，请转至 <block ref="a4882b71f5935aea43154f35b1a6d350" category="inline-xref-macro-rx"></block>。集群节点上的 LIF 应已故障转移到每个节点的另一个集群端口。</block>
  <block id="628224310a08199c5d7d0b910365045c" category="list-text">【第 4 步】验证所有集群 LIF 是否均已启用自动还原。`network interface show - vserver cluster -fields auto-revert`</block>
  <block id="97fadeb84f4ed9ad0e75935498cb829f" category="list-text">【第 5 步】验证所有集群 LIF 是否均可通信： `cluster ping-cluster &lt;node name&gt;`</block>
  <block id="01327bf2293f5b2888e56a1495b8ffa5" category="list-text">【第 6 步】关闭 Nexus 9336C-x2 交换机 SH1 上的 ISL 端口 1/35 和 1/36 。</block>
  <block id="e81924e502449ac3559ac6842e5fc9a4" category="list-text">【第 7 步】从 Nexus 9336C-x2 SH2 交换机上拔下所有缆线，然后将其连接到 Nexus C9336C-Fx2 newsh2 交换机上的相同端口。</block>
  <block id="4f93e9535cb45064d78404c6ed6ed904" category="list-text">启动 SH1 和 newsh2 交换机之间的 ISL 端口 1/35 和 1/36 ，然后验证端口通道操作状态。</block>
  <block id="9976ce3dd89716631075e314d8369a88" category="paragraph">端口通道应指示 PO1 （ SU ），成员端口应指示 Eth1/35 （ P ）和 Eth1/36 （ P ）。</block>
  <block id="73d481b40707b0f3a0419c8059e5dfbc" category="paragraph">此示例将启用 ISL 端口 1/35 和 1/36 ，并显示交换机 SH1 上的端口通道摘要。</block>
  <block id="a28ce6ee9bc3de994458e6f603c8d76e" category="list-text">【第 9 步】验证所有节点上的端口 e3b 是否已启动： `network port show ipspace cluster`</block>
  <block id="334475bfa8e7e4525a49f9da2f5d9b5e" category="paragraph">输出应如下所示：</block>
  <block id="18b9420ed8fd66077342b0c040b213e9" category="list-text">在上一步使用的同一节点上，使用 network interface revert 命令还原上一步中与端口关联的集群 LIF 。</block>
  <block id="425e638245787e6e714da707fc01c142" category="paragraph">在此示例中，如果 Home 值为 true 且端口为 e3b ，则 node1 上的 LIF node1_clus2 将成功还原。</block>
  <block id="b926ce3dbb7009689ed024c9ea8aba02" category="paragraph">以下命令会将 node1 上的 LIF node1_clus2 返回到主端口 E3a ，并显示有关两个节点上的 LIF 的信息。如果两个集群接口的 "Is Home" 列均为 * true * ，并且显示正确的端口分配，则可以成功启动第一个节点，在此示例中， node1 上的 E3a 和 e3b 。</block>
  <block id="4f8b2be8127e6d97f5b4419778adab69" category="list-text">【第 11 步】显示集群中节点的相关信息： `cluster show`</block>
  <block id="08ceb55af9899d85ad284fdb01eb8069" category="paragraph">此示例显示此集群中 node1 和 node2 的节点运行状况为 true ：</block>
  <block id="6dff419ea570b4438706290945b04e81" category="list-text">【第 12 步】验证所有物理集群端口是否均已启动： `network port show ipspace cluster`</block>
  <block id="bd81aada2ea6a286ef6e1f36bc2ca511" category="list-text">【第 13 步】验证所有集群 LIF 是否均可通信： `cluster ping-cluster`</block>
  <block id="f201a9e1ffb2df5af2dc8e3c602cb68b" category="list-text">【第 14 步】确认以下集群网络配置： `network port show`</block>
  <block id="ecf7f1372c92c494288fb60fab64253c" category="list-text">【第 15 步】使用以下命令启用以太网交换机运行状况监控器日志收集功能，以收集交换机相关的日志文件：</block>
  <block id="d02e46aca2a59543c305eb64a888f4d8" category="list-text">`s系统交换机以太网日志设置密码`</block>
  <block id="47c9a5350c58460bee8ad418789973be" category="list-text">【第 16 步】将存储端口从旧交换机 SH2 移动到新交换机 newsh2 。</block>
  <block id="da9b9083935bcd0e31bcb793c35eec52" category="list-text">验证连接到 HA 对 1 共享交换机 newsh2 的存储是否运行正常。</block>
  <block id="039397de8f69cec6c8dbc4dce1344c56" category="list-text">确认连接到 HA 对 2 共享交换机 newsh2 的存储运行状况良好： `storage port show -port-type ENET`</block>
  <block id="7d61c65bb047647c5964e4cd03a064fc" category="list-text">`s确认磁盘架布线正确：` torage shelf port show -fields remote- device ， remote-port</block>
  <block id="c2a284bf2fca5ec22fc7906608176420" category="list-text">【第 20 步】删除旧交换机 SH2 。</block>
  <block id="c99d140356a40ad59a42b6a0463510af" category="list-text">对交换机 SH1 和新交换机 newsh1 重复上述步骤。</block>
  <block id="d828933791a5e7d1ea631c7a04ff2147" category="list-text">如果禁止自动创建案例，请通过调用 AutoSupport 消息重新启用该功能： `ssystem node AutoSupport invoke -node * -type all -message MAINT=end`</block>
  <block id="31a64a44fce8ed03b7b71b06a1ddc567" category="doc">通过重复使用存储交换机从具有 SAT 存储的无交换机配置进行迁移</block>
  <block id="e468dc98f46520dafb81c4a2860e35f5" category="list-text">【第 2 步】验证节点端口是否运行正常： `storage port show -port-type ENET`</block>
  <block id="a61fb4ee9862ad3ca2ace374860efe47" category="list-text">【第 3 步】将 HA 对 1 的 NSM224 路径 A 缆线从存储交换机 A 移至存储交换机 A 上 HA 对 1 的路径 A 的共享 NS224 存储端口</block>
  <block id="13edd7f420c2674d548b2a52a6da2adb" category="list-text">将缆线从 HA 对 1 节点 A 的路径 A 移至存储交换机 A 上 HA 对 1 节点 A 的共享存储端口</block>
  <block id="8fa35651fd65d802f471c470966f21ec" category="list-text">将缆线从 HA 对 1 节点 B 的路径 A 移至存储交换机 A 上 HA 对 1 节点 B 的共享存储端口</block>
  <block id="a791669229b197424a1c53af3c935995" category="list-text">【第 7 步】将共享交换机 A 上的存储 RCF 替换为共享 RCF 文件。请参见<block ref="f6e7f441bcff51ec3d8080f15010fd4c" category="inline-link-rx"></block> 了解更多详细信息。</block>
  <block id="ea77aeb98674be7fb36ce74bd1108462" category="list-text">【第 9 步】将 HA 对 1 的 NSM224 路径 B 缆线从存储交换机 B 移至 HA 对 1 的共享 NS224 存储端口，路径 B 移至存储交换机 B</block>
  <block id="ded104c4c31658cbea5c009e1de22984" category="list-text">【第 13 步】将共享交换机 B 上的存储 RCF 文件替换为共享 RCF 文件。请参见 <block ref="41062cda0a6ae510a0f118eb961870a4" category="inline-link-macro-rx"></block> 了解更多详细信息。</block>
  <block id="533661dac93384c9c5129a0888e57a1d" category="list-text">【第 16 步】将 HA 对 1 从无交换机集群转换为有交换机集群。使用共享 RCF 定义的集群端口分配。请参见 <block ref="2cdb0ef9b29e3206865e37e4f43be394" category="inline-link-macro-rx"></block>了解更多详细信息。</block>
  <block id="512a76427a65e27ffb75015bb7a6951e" category="list-text">验证交换网络配置是否有效： `network port show`</block>
  <block id="467a501ced0eaaee20142a975e074f95" category="doc">通过添加两个新的共享交换机，从具有数据存储的交换配置进行迁移</block>
  <block id="c501aa902a1c1cd5955cebe45bc1fc25" category="section-title">从使用数据存储的交换配置进行迁移</block>
  <block id="2439b6cc5b5d5f5ed61e8755a528a9b0" category="paragraph">在将某些旧的 Cisco Nexus 集群交换机更换为 Cisco Nexus 9336C-x2 共享交换机时，您必须了解某些配置信息，端口连接和布线要求。</block>
  <block id="8c0efb8b0ce576c4e0176ea2d8cf7d54" category="list-text">支持以下交换机：</block>
  <block id="f0936c8d947d6fc9958bb86b9f3f74f8" category="list-text">Nexus 9336C-x2</block>
  <block id="ee9afd7df5d1f09abe628235a0bbd29c" category="list-text">Nexus 3232C</block>
  <block id="8a60f61abd0c966314d5200a93ab4133" category="list-text">交换机使用以下端口连接到节点：</block>
  <block id="a1e2c6ab24c27a74cee460bdfe527877" category="list-text">Nexus 9336C-x2 ：</block>
  <block id="872199943acdea4294f0d4075d3561f0" category="list-text">端口 1-3 ：分支模式（ 4x10G ）集群内端口，内部 E1/1/1-4 ， E1/2/1-4 ， E1/3/1-4</block>
  <block id="348fe175e1a1ed27a74f3d8ce41e8b48" category="list-text">端口 4 - 6 ：分支模式（ 4x25G ）集群内 /HA 端口，内部 E1/4/1-4 ， E1/5/1-4 ， E1/6/1-4</block>
  <block id="a884c1d4a4c581995c17b4b28afe16f8" category="list-text">端口 7-34 ： 40/100GbE 集群内 /HA 端口，内部 E1/7-34</block>
  <block id="6623dc8ad86ae4f35f90a10a54b59362" category="list-text">Nexus 3232C ：</block>
  <block id="421f92c2458c0927a7ee05290951e3bd" category="list-text">端口 1-30 ： 10/40/100 GbE</block>
  <block id="a197a8451e6cdff83ec4ac0465632cab" category="list-text">交换机使用以下交换机间链路（ ISL ）端口：</block>
  <block id="1fae59cef223580d13c9e4f1b2caa312" category="list-text">端口 int E1/35-36 ： Nexus 9336C-x2</block>
  <block id="c6bbb6b6ae9f7905fd3e101a028feee1" category="list-text">端口 E1/31-32 ： Nexus 3232C</block>
  <block id="71b02efdbb3ccc6ece3fc351c656e1be" category="list-text">Hardware Universe 包含有关所有集群交换机支持的布线的信息。</block>
  <block id="6e28d8a516c0943fdffa37f9887142fa" category="paragraph">请参见<block ref="e8018b6e740a667345f4bcc94e4023fc" category="inline-link-rx"></block> 有关详细信息 ...</block>
  <block id="f3f2b4cbf3d4788e920cd6184c2ec2c1" category="list-text">您已将 Nexus 9336C-FX2 交换机上的某些端口配置为以 100 GbE 运行。</block>
  <block id="6e561db011e3b584885cf33faa6d2c5b" category="list-text">您已规划，迁移并记录了从节点到 Nexus 9336C-x2 交换机的 100 GbE 连接。</block>
  <block id="dd0cd60b35163e25bde3016a4a636b26" category="list-text">此操作步骤中支持的 ONTAP 和 NX-OS 版本位于 Cisco 以太网交换机页面上。请参见<block ref="78ccdd0a3e16d4d44b95043dbee8e2db" category="inline-link-rx"></block>。</block>
  <block id="f1b3b711c92578bab963ea6eeb2ccaa0" category="list-text">您可以无中断地将其他 Cisco 集群交换机从 ONTAP 集群迁移到 Cisco Nexus 9336C-x2 网络交换机。</block>
  <block id="8639553459142d294e15b12c7435701f" category="list-text">必须正确设置现有交换机网络并使其正常运行。</block>
  <block id="fd55eeed7121bd5c5fcc7054cf0fa600" category="list-text">所有端口都必须处于 * 启动 * 状态，以确保无中断运行。</block>
  <block id="4ec6857207c98f065042e4807684adff" category="list-text">Nexus 9336C-FX2 交换机必须在安装的正确 NX-OS 版本和应用的参考配置文件（ Reference Configuration File ， RCF ）下进行配置和运行。</block>
  <block id="3ea429d694342171e655186acd3ade7b" category="list-text">现有网络配置必须满足以下条件：</block>
  <block id="4911fe5a5a61a43546dd84d203eacf1c" category="list-text">使用两个旧版 Cisco 交换机的冗余且功能完备的 NetApp 集群。</block>
  <block id="c3f3714ca8555fda13d1cbc127147867" category="list-text">管理连接以及对旧 Cisco 交换机和新交换机的控制台访问。</block>
  <block id="41fa0b0c8361b00ebbc45803272d5d99" category="list-text">与集群 LIF 处于 * 启动 * 状态的所有集群 LIF 均位于其主端口上。</block>
  <block id="0c61adc358ee3db0e5a57be6cd5a4b8e" category="list-text">ISL 端口已启用，并已在其他 Cisco 交换机之间以及新交换机之间进行布线。</block>
  <block id="b253ba9e78963a8167fcf6f56cc98c6d" category="list-text">现有 Cisco Nexus 3232C 集群交换机为 _c1_ 和 _c2_ 。</block>
  <block id="b2646cdedb4f910d9c6995d6f8d1ae4c" category="list-text">新的 Nexus 9336C-f2 交换机为 _SH1_ 和 _SH2_ 。</block>
  <block id="b207d92313ec20f7c27adca3d1ae552c" category="list-text">集群 LIF 分别是节点 1 上的 _node1_clus1_ 和 _node1_clus2_ 以及节点 2 上的 _node2_clus1_ 和 _node2_clus2_ 。</block>
  <block id="77ac8435970d914eb19cfe4422ce47dd" category="list-text">交换机 C2 首先由交换机 SH2 取代，然后交换机 C1 由交换机 SH1 取代。</block>
  <block id="8df6d09a602fca4aa18fe9e0b5e94fd4" category="list-text">如果在此集群上启用了 AutoSupport ，请通过调用 AutoSupport 消息来禁止自动创建案例： `ssystem node AutoSupport invoke -node * -type all -message MAINT=x h`</block>
  <block id="1b75649d1b9ec0a73e309fd9b384b32a" category="list-text">检查每个集群端口的管理和运行状态。</block>
  <block id="cbe561eed93dd859c54d10fcf42becf6" category="list-text">确认所有集群端口均已启动且状态正常： `network port show – role cluster`</block>
  <block id="6bd9f902861cef254a9b1cd5a0b78a4b" category="list-text">【第 7 步】关闭 C2 交换机：</block>
  <block id="87da8bea7ed0dbbc94399550a077b570" category="list-text">【第 8 步】验证集群 LIF 是否已迁移到集群交换机 SH1 上托管的端口： `network interface show -role cluster` 这可能需要几秒钟的时间。</block>
  <block id="9ee2b21f2d226532d76345aed1bd5bb3" category="list-text">【第 9 步】将交换机 C2 更换为新交换机 SH2 并重新连接新交换机。</block>
  <block id="4ea2b5ab515b2bb50c23558fce34feca" category="list-text">验证 SH2 上的端口是否已备份。* 注意 * LIF 仍位于交换机 C1 上。</block>
  <block id="ff95ac04495597119a55479b8bf29792" category="list-text">关闭 C1 交换机：</block>
  <block id="91a2ec2e8a3cf37f0719c1d12fff393a" category="list-text">【第 12 步】验证集群 LIF 是否已迁移到集群交换机 SH2 上托管的端口。这可能需要几秒钟的时间。</block>
  <block id="b18702a6dcc683ab56156e15eec2de44" category="list-text">【第 13 步】将交换机 C1 更换为新交换机 SH1 ，然后重新为新交换机布线。</block>
  <block id="311d44668904b18ff8a6fd016d97a280" category="list-text">验证 SH1 上的端口是否已备份。* 注意 * LIF 仍位于交换机 C2 上。</block>
  <block id="fc35a9ec43fa15619b7584ce5c4daa8a" category="list-text">在集群 LIF 上启用自动还原：</block>
  <block id="c3c853dbaf3555c7b2a32f7228459b7f" category="list-text">【第 16 步】验证集群是否运行正常： `cluster show`</block>
  <block id="eac9e7086f92a026c0dbe06001206204" category="doc">Cisco 共享交换机的设置和配置指南</block>
  <block id="949a9350bf341b8fa64977aa3c2584c5" category="section-title">ONTAP 支持的交换机</block>
  <block id="641d7ad5c2ec29d01cc93211bd6393b9" category="paragraph">从 ONTAP 9.1.1 开始，您可以使用 Cisco Nexus 9336C-f2 交换机将存储和集群功能结合到共享交换机方案中。如果要使用两个以上的节点构建 ONTAP 网络，则需要两个受支持的网络交换机。</block>
  <block id="8a5fdb7aa013af2f886a0745ecad55fa" category="paragraph">支持以下 Cisco 共享网络交换机。</block>
  <block id="7a132c4084cb90373827f0625aad2cb0" category="paragraph">您可以将 Cisco Nexus 9336C-x2 交换机（ X190200/X190210 ）安装在 NetApp 系统机柜或第三方机柜中，并使用交换机附带的标准支架。</block>
  <block id="5dfcb593b3c7fd66ae6fded55e29ddb1" category="paragraph">下表列出了 9336C-fx2 交换机，风扇和电源的部件号和问题描述：</block>
  <block id="b8d29742df41ef40fca1e44a7b490835" category="cell">部件号</block>
  <block id="90dc16eea9a08fad9923a5ebde819373" category="cell">X190200-CS-PE</block>
  <block id="4e46dbb7e3c204d6d9c269325f2e7bce" category="cell">N9K-9336C-f2 ， CS ， PTSX ， 36PT10/25/40/100GQSFP28</block>
  <block id="f1d41ec97ee9c525034c6804bfbb8e9a" category="cell">X190200-CS-PI</block>
  <block id="2dec7a1b3423c75b9d0606e9404dbc31" category="cell">N9K-9336C-f2 ， CS ， PSIN ， 36PT10/25/40/100GQSFP28</block>
  <block id="0f554c96d2e3a75bed7665e692c123a2" category="cell">X190210-FE-PE</block>
  <block id="2c658a7cb78d78536a7a4d6a7ac007d7" category="cell">N9K-9336C ， FTE ， PTSX ， 36PT10/25/40/100GQSFP28</block>
  <block id="06bdfa4eeb4673a88109b189e8032086" category="cell">X190210-FE-PI</block>
  <block id="9067c6465253e023e1e8646348d031f3" category="cell">N9K-9336C ， FTE ， PSIN ， 36PT10/25/40/100GQSFP28</block>
  <block id="40e4cea49f9ea9bc784da2baf73a6aca" category="cell">X190002</block>
  <block id="6f68e5248a6396152e6ecda783007cf8" category="cell">附件套件 X190001/X190003</block>
  <block id="ea7579a6b12b271555314d6a489bd89e" category="cell">X-NXA-PA-11000W-PE2</block>
  <block id="e9a1f9ab973fed58606279d050d11c9e" category="cell">N9K-9336C 交流 1100 W PSU —端口侧排气</block>
  <block id="946836662a4a46cf1b1e4f3c18bfe440" category="cell">X-NXA-PC-11000W-PI2</block>
  <block id="8f6684e0f9fcae69e5cb12059d86a616" category="cell">N9K-9336C 交流 1100 W PSU —端口侧进气气流</block>
  <block id="127add51913b4b79891c2e48b56b1c02" category="cell">X-NXA-Fan-65CFM-PE</block>
  <block id="9f20b68dcb3f25905807b00fdbdc4368" category="cell">N9K-9336C 65CFM ，端口侧排气</block>
  <block id="afb5efd2052a5d24db3e141e498b20de" category="cell">X-NXA-Fan-65CFM-PI</block>
  <block id="464c69327917d32444dfaf4ff328f5d5" category="cell">N9K-9336C 65CFM ，端口侧进气气流</block>
  <block id="f1375f4dce82b7173addf1ef166c2ebc" category="section-title">设置交换机</block>
  <block id="7b6ae48e36dd3d7cf6fae83bada46583" category="paragraph">如果您还没有所需的配置信息和文档，则需要在设置共享交换机之前收集这些信息。</block>
  <block id="64079ae841ec2c52072b6eaa6b66b5c7" category="list-text">您必须能够访问安装站点上的 HTTP ， FTP 或 TFTP 服务器，才能下载适用的 NX-OS 和参考配置文件（ RCF ）版本。</block>
  <block id="dbbe2f3bc9da97414c113e97541ae09c" category="list-text">您必须具有所需的共享交换机文档。</block>
  <block id="83246b8752de9805863d58348a7becf5" category="paragraph">请参见 <block ref="6df9ca1b18f4b9116f2a66ddb44807b0" category="inline-xref-macro-rx"></block> 有关详细信息 ...</block>
  <block id="f50beb2085f83031ea688c993be24975" category="list-text">您必须具有所需的控制器文档和 ONTAP 文档。</block>
  <block id="ce5a4a36cafe8a250cdeaae60cd5a4e3" category="inline-link">NetApp ONTAP 文档</block>
  <block id="2243b8e536a25b6d6ed20924db099bcd" category="paragraph">请参见<block ref="78748c5793a1c2ef085ba3ee47bcce15" category="inline-link-rx"></block>。</block>
  <block id="f5d8da8c6150aa3c502eaea4ba2ab505" category="list-text">您必须具有适用的许可证，网络和配置信息以及缆线。</block>
  <block id="7f7491a5440c3793bf09afc3c2fcb114" category="list-text">您必须已完成布线工作表。</block>
  <block id="e281702f30e7a8e688ac1081ea3d6c99" category="admonition">除了布线图之外，本指南还提供了一些示例工作表，其中包含建议的端口分配以及可用于设置网络的空白工作表。有关详细信息，请参见<block ref="e8018b6e740a667345f4bcc94e4023fc" category="inline-link-rx"></block>。</block>
  <block id="1771b579c10634da9a764a221c18f7e1" category="paragraph">所有 Cisco 共享交换机都附带标准的 Cisco 出厂默认配置。这些交换机还具有最新版本的 NX-OS 软件，但未加载 RCF 。</block>
  <block id="2b25dfab590bd1b93981f3144798e49c" category="paragraph">* 注意： * 您必须从下载适用的 NetApp RCF<block ref="1ccfcc282c22bbf629043880b6e3d7b2" category="inline-link-rx"></block> 用于接收的交换机。</block>
  <block id="8c4271e6faf2cea4cfc8e5b7108d8ee9" category="section-title">操作步骤</block>
  <block id="b01c82f53d899ee81ba67bfac6270f54" category="inline-link">在 NetApp 机柜中安装 Cisco Nexus 9336C-x2 集群交换机和直通面板</block>
  <block id="d3e18e6cda55c62cb1229ed70a876467" category="list-text">将交换机和控制器装入机架。请参见<block ref="90faa892a4d50a53b0a7930f42b5c315" category="inline-link-rx"></block> 有关在 NetApp 机柜中安装交换机的说明的指南。</block>
  <block id="78e6dfddb13e04b530aa5e137fbcffcb" category="list-text">打开交换机和控制器的电源。</block>
  <block id="6ee5954a9939ee0324616b71255a1ea7" category="list-text">【第 3 步】根据中提供的信息对交换机执行初始配置 <block ref="4e098ee0fc4ed6ae0122d7d616100d24" category="inline-xref-macro-rx"></block>。</block>
  <block id="d51ed7f10b5732d6e9ec975c89648212" category="list-text">验证您在设置结束时显示的屏幕中所做的配置选择，并确保保存此配置。</block>
  <block id="39ea6d6c5412ec7e0e17dd391cd35f3a" category="list-text">检查交换机上的软件版本，如有必要，请将 NetApp 支持的软件版本下载到这些交换机。</block>
  <block id="7b1d1185b835814de783483f686e9825" category="inline-link">Cisco</block>
  <block id="1721782515e043c452981cc8c95c8b19" category="paragraph">如果您下载的是 NetApp 支持的软件版本，则还必须下载 NetApp 网络交换机参考配置文件并将其与保存在中的配置合并 <block ref="6f5e80c5f38b7c17bfcb05f65cf8fc44" category="inline-xref-macro-rx"></block>。您可以从下载文件和说明<block ref="5c27bdff6f5cc32ce77bb635aee5a3ec" category="inline-link-rx"></block> 页面。如果您有自己的交换机，请参见<block ref="352cc6d5e14cbc28943a82cb55bedc13" category="inline-link-rx"></block> 站点</block>
  <block id="afb48a56af012ba490b6f0c683ca069d" category="section-title">所需的配置信息</block>
  <block id="2b561d0cd2038d9a28bd819d497f4f68" category="paragraph">要进行配置，您需要为交换机提供适当数量和类型的缆线和缆线连接器。根据您最初配置的交换机类型，您需要使用随附的控制台缆线连接到交换机控制台端口；您还需要提供特定的网络信息。</block>
  <block id="3d8c1e9dc9abd665a6d51aff697d9586" category="section-title">所有交换机的所需网络信息</block>
  <block id="601b1c0673eb2ee2db12a0f15d9e12c3" category="list-text">所有交换机配置都需要以下网络信息：</block>
  <block id="31ecd7552867bf00e0a88fbcbfd147a0" category="list-text">用于管理网络流量的 IP 子网</block>
  <block id="77918707dd3c6ba610a21dee1c40ef85" category="list-text">每个存储系统控制器和所有适用交换机的主机名和 IP 地址</block>
  <block id="3cce89e076695683c3ae0c299fd7edcd" category="list-text">大多数存储系统控制器通过 e0M 接口连接到以太网服务端口（扳手图标）进行管理。在 AFF A800 和 AFF A700 系统上， e0M 接口使用专用以太网端口。</block>
  <block id="667cf55da9f4ccd45815c0c40a5e0099" category="list-text">请参见<block ref="e8018b6e740a667345f4bcc94e4023fc" category="inline-link-rx"></block> 以获取最新信息。</block>
  <block id="c8e6e23ad9289f83b629ddee385c1fe2" category="section-title">Cisco Nexus 9336C-x2 交换机所需的网络信息</block>
  <block id="52d1e2b26c863c666558b2b8fde1904d" category="paragraph">对于 Cisco Nexus 9336C-x2 交换机，您需要在首次启动交换机时对以下初始设置问题提供适当的响应。您站点的安全策略定义了响应和服务，以实现：</block>
  <block id="2587dca3500f5170d53254d138053d6d" category="list-text">是否中止自动配置并继续正常设置？（是 / 否）</block>
  <block id="6bba2a7f2881fffd3aea0b613c328174" category="paragraph">请回答 * 是 * 。默认值为 no</block>
  <block id="a0fe248777b36898477c1cf8df11c23e" category="list-text">是否要强制实施安全密码标准？（是 / 否）</block>
  <block id="8c028235a9cfd5a0f09aeb396a9b7f59" category="paragraph">请回答 * 是 * 。默认值为 yes 。</block>
  <block id="081cec44dcb55858c91c17808a56de55" category="list-text">输入管理员的密码。</block>
  <block id="ea8436264afe2287f0833f0688dd6efe" category="paragraph">默认密码为 admin ；您必须创建一个新的强密码。</block>
  <block id="65c4602baaace1fd0023f51ddbf338a1" category="paragraph">可以拒绝弱密码。</block>
  <block id="98a5741f83891dc4008aac780e84c9dd" category="list-text">是否要进入基本配置对话框？（是 / 否）</block>
  <block id="6488892cb9bcadbed18ad604a60e7a41" category="paragraph">在交换机的初始配置时，使用 * 是 * 进行响应。</block>
  <block id="dbd217512b7a9153f50f2161c224f890" category="list-text">是否创建其他登录帐户？（是 / 否）</block>
  <block id="6b0fcde5d66c70198c244a1b351e7e3c" category="paragraph">您的问题解答取决于站点的策略，取决于备用管理员。默认值为 no</block>
  <block id="6b35b6b49fa17b4a4d2e810bfc77436d" category="list-text">是否配置只读 SNMP 社区字符串？（是 / 否）</block>
  <block id="de890fdd4bec2fd13d76947dd5372353" category="paragraph">请使用 * 否 * 回答。默认值为 no</block>
  <block id="4f138867c5cb7d8f99271fe0353e931b" category="list-text">是否配置读写 SNMP 社区字符串？（是 / 否）</block>
  <block id="8c9d69e3b2c93a43b00bff0af8146dfa" category="list-text">输入交换机名称。</block>
  <block id="bdfcc5e6eb78e2d514e5179d5703228a" category="paragraph">交换机名称限制为 63 个字母数字字符。</block>
  <block id="821f2f9c33bb431a6cd65e0fef74f5a8" category="list-text">是否继续进行带外（ mgmt0 ）管理配置？（是 / 否）</block>
  <block id="7a9270d9e1d419cd8b0403fdc8da27a6" category="paragraph">在该提示符处，使用 * 是 * （默认值）进行响应。在 mgmt0 IPv4 address ：提示符处，输入 IP 地址： ip_address</block>
  <block id="03c612e50ace48a3e1166082ab8693e9" category="list-text">是否配置 default-gateway ？（是 / 否）</block>
  <block id="1bda92ccae06fac8b1581ef867dd4838" category="paragraph">请回答 * 是 * 。在 default-gateway ：提示符的 IPv4 地址处，输入 default_gateway 。</block>
  <block id="7c16b3b3191c66111f174fa6cd64c257" category="list-text">是否配置高级 IP 选项？（是 / 否）</block>
  <block id="b935eabb00c8caa6dfe6647bdaafc35a" category="list-text">是否启用 telnet 服务？（是 / 否）</block>
  <block id="0254cee13f2faa192208ae286c4d48bc" category="list-text">是否启用 SSH 服务？（是 / 否）</block>
  <block id="d6ac208fad263d998215866318843863" category="admonition">使用集群交换机运行状况监控器（ CSHM ）收集日志功能时，建议使用 SSH 。为了增强安全性，还建议使用 SSHv2 。</block>
  <block id="cf0438cf1f16dd8541401b40f77b205f" category="list-text">【第 14 步】输入要生成的 SSH 密钥类型（ DSA/RSA/RSA/rsa1 ）。默认值为 RSA 。</block>
  <block id="4affd6f79bcfe129021bccfab36973db" category="list-text">输入密钥位数（ 1024-2048 ）。</block>
  <block id="1f4ae51721a7026132603d022ea2df2e" category="list-text">是否配置 NTP 服务器？（是 / 否）</block>
  <block id="08ff2edeaa4e170065051a38d109eba7" category="list-text">配置默认接口层（ L3/L2 ）：</block>
  <block id="e2f3727963ac32e24fcabf07e61b1aa6" category="paragraph">请使用 * 二级 * 进行响应。默认值为 L2 。</block>
  <block id="da419bea93e82de29680266a222627b3" category="list-text">配置默认交换机端口接口状态（ shut/noshut ）：</block>
  <block id="4fc74edbc8417f3d40873f742eeb2be0" category="paragraph">请使用 * noshut * 进行响应。默认值为 noshut 。</block>
  <block id="fbcb89f3f4d929634a3871ee899f2db3" category="list-text">配置 CoPP 系统配置文件（严格 / 中等 / 宽松 / 密集）：</block>
  <block id="e2c3fe0d0a1b29bd32c331be18cb7fa1" category="paragraph">请使用 * 严格 * 回答。默认值为 strict 。</block>
  <block id="6ac87be8b3add0a420ea74735127e444" category="list-text">是否要编辑此配置？（是 / 否）</block>
  <block id="63380e79f39db6a40b46be28e461cc74" category="paragraph">此时应显示新配置。查看并对您刚刚输入的配置进行任何必要的更改。如果您对配置满意，请在提示符处回答 no 。如果要编辑配置设置，请使用 * 是 * 进行响应。</block>
  <block id="a526dfe64cb7296ac27bcc4595f2063f" category="list-text">是否使用此配置并保存？（是 / 否）</block>
  <block id="5a54e42dd698c598e59f9b64356c9418" category="paragraph">输入 * 是 * 以保存配置。此操作将自动更新 kickstart 和系统映像。</block>
  <block id="8ebeb0aa57e41e8e582e0d2bd7d57e8e" category="admonition">如果您在此阶段未保存配置，则下次重新启动交换机时，所有更改都不会生效。</block>
  <block id="82024d6a2c01f0a8732caf928f9407bf" category="inline-link">《 Cisco Nexus 9336C-x2 安装和升级指南》</block>
  <block id="f5cfc940c5ab0e780c503445cb40f82d" category="paragraph">有关交换机初始配置的详细信息，请参见以下指南：<block ref="c68d672ce672475dc8c9199a02c5303f" category="inline-link-rx"></block>。</block>
  <block id="9bceb8dc888693f3c7bf8c3da3644598" category="section-title">共享交换机所需的文档</block>
  <block id="e2cd1c4a8333627097591821747e2b1b" category="paragraph">要设置 ONTAP 网络，您需要特定的交换机和控制器文档。</block>
  <block id="c89388ccd8b3630466c7de50bd9dbd2d" category="inline-link">Cisco Nexus 9000 系列交换机支持</block>
  <block id="9f74bb1a4ed2d5fe3c6d27623df1cf32" category="paragraph">要设置 Cisco Nexus 9336C-x2 共享交换机，请参见<block ref="ccf9a5ebd47a9c01263e95d2949e4af7" category="inline-link-rx"></block> 页面。</block>
  <block id="45efd3c6a0810c7e08d1daeb80d4b5e2" category="cell">文档标题</block>
  <block id="15d9978fa28b29e838c1a90820c21d36" category="inline-link-macro">Nexus 9000 系列硬件安装指南</block>
  <block id="7d4653ec512f04431d73bb9bf8ab903c" category="cell"><block ref="7d4653ec512f04431d73bb9bf8ab903c" category="inline-link-macro-rx"></block></block>
  <block id="d482b8a15ff350479bf4e58fa1d0c597" category="cell">提供有关站点要求，交换机硬件详细信息和安装选项的详细信息。</block>
  <block id="61c15c69cf2811ab0e1cb8c85647bfb0" category="inline-link-macro">《 Cisco Nexus 9000 系列交换机软件配置指南》</block>
  <block id="34e06dbc7cc868b884fe9747d3b10d78" category="cell"><block ref="406d19524d83e268495b19398b2a04e1" category="inline-link-macro-rx"></block> （选择适用于交换机上安装的 NX-OS 版本的指南）</block>
  <block id="c32dd8e179950b695efe572ce0d49497" category="cell">提供为 ONTAP 操作配置交换机之前所需的初始交换机配置信息。</block>
  <block id="7a045983474b52b846c64f72c59ca06f" category="inline-link-macro">《 Cisco Nexus 9000 系列 NX-OS 软件升级和降级指南》</block>
  <block id="67a545ee7ed12190d95c50b1a1eacfbc" category="cell"><block ref="aa09b860dff7f72abc3bda8db3d666b6" category="inline-link-macro-rx"></block> （选择适用于交换机上安装的 NX-OS 版本的指南）</block>
  <block id="0ae88cfdc1291667d39f8cc8a6cea783" category="cell">提供有关如何根据需要将交换机降级为 ONTAP 支持的交换机软件的信息。</block>
  <block id="4e404eb7ac7195fae9c37d2b922bc5a6" category="inline-link-macro">Cisco Nexus 9000 系列 NX-OS 命令参考主索引</block>
  <block id="7d533cfa6de3a4dfd1037ee47cb73507" category="cell"><block ref="7d533cfa6de3a4dfd1037ee47cb73507" category="inline-link-macro-rx"></block></block>
  <block id="371b47d7397bde0e771e29bb3f8e7dce" category="cell">提供 Cisco 提供的各种命令参考的链接。</block>
  <block id="c3853edf42a69088b4d9bbbac526c549" category="inline-link-macro">《 Cisco Nexus 9000 MIB 参考》</block>
  <block id="715d43e03b2e674edf8ceffb487a5160" category="cell"><block ref="715d43e03b2e674edf8ceffb487a5160" category="inline-link-macro-rx"></block></block>
  <block id="8492478ce2831efd2b6e8ac6c4cd63c4" category="cell">介绍 Nexus 9000 交换机的管理信息库（ Management Information Base ， MIB ）文件。</block>
  <block id="6df290f9dcd0fa9e4528333108190ed0" category="inline-link-macro">Nexus 9000 系列 NX-OS 系统消息参考</block>
  <block id="e6470039e9bf2059219eca51f0ff61d8" category="cell"><block ref="e6470039e9bf2059219eca51f0ff61d8" category="inline-link-macro-rx"></block></block>
  <block id="035c54dd334ae57f4307cababd0f5695" category="cell">介绍 Cisco Nexus 9000 系列交换机的系统消息，信息性消息以及可能有助于诊断链路，内部硬件或系统软件问题的其他消息。</block>
  <block id="c561c2d54fd2bd6a81edc6ce1b0c7d7d" category="inline-link-macro">《 Cisco Nexus 9000 系列 NX-OS 发行说明》</block>
  <block id="b3c830c1f46c78e5e5bfa160bf68597f" category="cell"><block ref="2ac6309dec20e42c583f3092a07361f2" category="inline-link-macro-rx"></block> （选择交换机上安装的 NX-OS 版本的注释）</block>
  <block id="3f848203c9750d4f021c704fcabe3a7c" category="cell">介绍 Cisco Nexus 9000 系列的功能，错误和限制。</block>
  <block id="3a9c214d82ea0f7f835b71b5f4850c6b" category="inline-link-macro">Cisco Nexus 9000 系列的合规性和安全信息</block>
  <block id="83a1f0b32ba6ed26d00737e3faf8fc2e" category="cell"><block ref="83a1f0b32ba6ed26d00737e3faf8fc2e" category="inline-link-macro-rx"></block></block>
  <block id="fdffc0fdf626802f6fc29cff36498ecf" category="cell">提供 Nexus 9000 系列交换机的国际机构合规性，安全性和法定信息。</block>
  <block id="fd063930033e8c3d34fa893faa14f4ee" category="section-title">Cisco Nexus 9336C-x2 布线详细信息</block>
  <block id="5a5c48f7dd282373e89a35f202529de4" category="paragraph">您可以使用以下布线映像完成控制器和交换机之间的布线。</block>
  <block id="9396df2779b04c41024b11d80dbae215" category="paragraph">* 交换机连接 *<block ref="6a2cf54f6a37518ec42d92fd7fd3e59c" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4e4e9a3c74ffafdd7400bec54125834f" category="inline-image-macro">直连</block>
  <block id="0d0747a0392a0d4f6a81b1d260386050" category="paragraph">如果要将存储作为直连存储进行布线，而不是使用共享交换机存储端口，请按照直连图进行操作： * 直连 *<block ref="6c2050d09711322397bf2564af018947" category="inline-image-macro-rx" type="image"></block></block>
  <block id="894b4eb288cb9e47b7d37a64253de1ff" category="section-title">Cisco Nexus 9336C-x2 布线工作表</block>
  <block id="d2aa2982691bcb6b044696b6691d5677" category="paragraph">如果要记录受支持的平台，则必须参考填写好的布线工作表示例，填写空布线工作表。</block>
  <block id="3d7fd5afdd3e2a9008c8eb6e9d19e41c" category="inline-image-macro">布线工作表</block>
  <block id="7bfa22cf35645d8a9b2e335b3ee5f0b0" category="paragraph">每对交换机上的端口定义示例如下：<block ref="5965a3db7e52c18148f117f0240c1e3f" category="inline-image-macro-rx" type="image"></block></block>
  <block id="4cd361459ea2bb087ed6c989579796c7" category="paragraph">其中：</block>
  <block id="6518b73e43d19c30b6b829ae25fe0227" category="list-text">100 G ISL 连接到交换机 A 端口 35</block>
  <block id="ad8373aefb70ebebc60fc801181d19ad" category="list-text">100 G ISL 连接到交换机 A 端口 36</block>
  <block id="bd63d33de8f32e9e7d399fa9645015b1" category="list-text">100 G ISL 连接到交换机 B 端口 35</block>
  <block id="27e9b823e7c71b4d7a3ecbd09ffb2838" category="list-text">100 G ISL 连接到交换机 B 端口 36</block>
  <block id="9cfc8a50f07804d5007c52c4a385e3a2" category="section-title">空布线工作表</block>
  <block id="9ec84c8a49c539fada5b23f8acb3e112" category="paragraph">您可以使用空白布线工作表记录支持用作集群节点的平台。Hardware Universe 的 " 支持的集群连接 " 表定义了平台使用的集群端口。</block>
  <block id="eff06c6a47d34c39807f7ae5e22214f9" category="paragraph"><block ref="eff06c6a47d34c39807f7ae5e22214f9" category="inline-image-macro-rx" type="image"></block></block>
  <block id="b7167dcb288bc483f270fcd135c332ec" category="doc">通过添加两个新的共享交换机，从具有数据存储的无交换机集群进行迁移</block>
  <block id="8dfca7fe51402f701fd524d9f91fe93f" category="section-title">从具有数据存储的无交换机集群迁移</block>
  <block id="867937cadaaec41c51512879188ec686" category="paragraph">在无中断地将双节点无交换机集群迁移到使用 Cisco Nexus 9336C-x2 集群交换机的集群时，您必须了解某些配置信息，端口连接和布线要求。您使用的操作步骤取决于每个控制器上是有两个专用集群网络端口，还是每个控制器上有一个集群端口。记录的过程适用于使用光纤或双轴端口的所有节点，但如果节点将板载 10 Gb BASE-T RJ45 端口用于集群网络端口，则此交换机不支持此过程。</block>
  <block id="3002e37b8f67b01b4af288a109aca522" category="paragraph">大多数系统需要在每个控制器上使用两个专用集群网络端口。请参见 <block ref="5c27bdff6f5cc32ce77bb635aee5a3ec" category="inline-link-rx"></block> 有关详细信息 ...</block>
  <block id="ccc533253625ec3fd1cd1ad3dd395ae6" category="paragraph">如果您现有的双节点无交换机集群环境，则可以使用 Cisco Nexus 9336C-FX2 交换机迁移到双节点有交换机集群环境，以便可以扩展到集群中的两个节点以上。</block>
  <block id="0fd8ea58e8899f870165c3b59ed22856" category="list-text">双节点无交换机配置：</block>
  <block id="085e7d788f517113effde29af6642887" category="list-text">双节点无交换机配置必须已正确设置并正常运行。</block>
  <block id="2f41f17756f8fddf0c8be18682cabbff" category="list-text">节点必须运行 ONTAP 9.8 及更高版本。</block>
  <block id="3f5b599f12e68f8800bbe21877e029a3" category="list-text">所有集群端口都必须处于 * 启动 * 状态。</block>
  <block id="1ad1a22c4ab697b9deb6c2c5bdb1a3e7" category="list-text">所有集群逻辑接口（ LIF ）都必须处于 * 启动 * 状态并位于其 * 主端口上。</block>
  <block id="d305083cf7fe064c7db2cab89646c634" category="list-text">Cisco Nexus 9336C-x2 交换机配置：</block>
  <block id="3c5f7860b8066b3514dea9b2552a9d4e" category="list-text">两台交换机都必须具有管理网络连接。</block>
  <block id="76cac7e2c6e9eff307fb502a7b332f78" category="list-text">必须能够通过控制台访问集群交换机。</block>
  <block id="2a839505baafe2b51fb269fdd1c3743f" category="list-text">Nexus 9336C-f2 节点到节点交换机和交换机到交换机连接必须使用双轴电缆或光缆。</block>
  <block id="6f3b723bb63a293caab80c9adb46a550" category="list-text">NetApp<block ref="e8018b6e740a667345f4bcc94e4023fc" category="inline-link-rx"></block> 包含有关布线的详细信息。</block>
  <block id="ec7d25e213daa7f81e88019951528eb6" category="list-text">交换机间链路（ ISL ）缆线必须连接到两个 9336C-x2 交换机上的端口 1/35 和 1/36 。</block>
  <block id="c2bbc5d95e76d30fb3bb8d87ee2785b2" category="list-text">必须完成 9336C-x2 交换机的初始自定义。这样：</block>
  <block id="c7d4c68f782244f8c6c32355393a6897" category="list-text">9336C-x2 交换机正在运行最新版本的软件</block>
  <block id="4d5d52ebdf89c61ce4aac15a41a8f4a5" category="list-text">参考配置文件（ Reference Configuration Files ， RCF ）已应用于交换机</block>
  <block id="db390e5df1a38c520a6fb770cc881fd2" category="list-text">必须在新交换机上配置任何站点自定义，例如 SMTP ， SNMP 和 SSH 。</block>
  <block id="c68522049bdb09573c2acd021df2a207" category="paragraph">此操作步骤中的示例使用以下集群交换机和节点命名：</block>
  <block id="c07128d57bd3c1ce08b02f5c43857935" category="list-text">9336C-fx2 交换机的名称是 _CS1_ 和 _CS2_ 。</block>
  <block id="7ca131e501c9ca4de543fee222e1706e" category="list-text">集群 SVM 的名称是 _node1_ 和 _node2_ 。</block>
  <block id="e9ebd9f08e1d9e69098dfaf4a7e4d306" category="list-text">LIF 的名称分别是节点 1 上的 _node1_clus1_ 和 _node1_clus2_ 以及节点 2 上的 _node2_clus1_ 和 _node2_clus2_ 。</block>
  <block id="8f8e91158015f3d9f135060666e921be" category="list-text">根据 AFF A400 控制器，此操作步骤中使用的集群端口为 _e3A_ 和 _e3b_ 。。<block ref="e8018b6e740a667345f4bcc94e4023fc" category="inline-link-rx"></block> 包含有关平台的实际集群端口的最新信息。</block>
  <block id="1dc52a814aa197a34b98c9ba1ddb669d" category="list-text">如果在此集群上启用了 AutoSupport ，请通过调用 AutoSupport 消息来禁止自动创建案例： `ssystem node AutoSupport invoke -node * -type all -message MAINT=xh` 。</block>
  <block id="6ffe43c64e0e1693bc8124a4c0c9e1bc" category="paragraph">其中 x 是维护时段的持续时间，以小时为单位。</block>
  <block id="3be5556789dd2176db5a102e0d58ea77" category="admonition">AutoSupport 消息会通知技术支持此维护任务，以便在维护窗口期间禁止自动创建案例。</block>
  <block id="ab69441454502f4c7d26f429bd4cc498" category="list-text">在新集群交换机 CS1 和 CS2 上禁用所有面向节点的端口（而不是 ISL 端口）。不得禁用 ISL 端口。</block>
  <block id="5cbbd10ee541ea50b17f62d450697283" category="paragraph">以下示例显示了交换机 CS1 上面向节点的端口 1 到 34 已禁用：</block>
  <block id="439da491db6adba89cca8ac6262e8e93" category="list-text">【第 4 步】验证 ISL 和两个 9336C-x2 交换机 CS1 和 CS2 之间的 ISL 物理端口在端口 1/35 和 1/36 上是否正常运行： `s如何处理端口通道摘要`</block>
  <block id="586cc436ce07054393e126c7fb79a385" category="paragraph">以下示例显示交换机 CS1 上的 ISL 端口已启动：</block>
  <block id="0cf21251d72221c424510009df39cc04" category="paragraph">以下示例显示交换机 CS2 上的 ISL 端口已启动：</block>
  <block id="ef2ccb267101c1bb4550a0a88ba15fef" category="list-text">【第 5 步】显示相邻设备的列表： `s如何显示 cdp 邻居` 。</block>
  <block id="585048ec3e4d793fb863dfd03ca0bd5b" category="paragraph">此命令可提供有关连接到系统的设备的信息。以下示例列出了交换机 CS1 上的相邻设备：</block>
  <block id="1b6af97ed2dc264f0a8d2be382e6228a" category="paragraph">以下示例列出了交换机 CS2 上的相邻设备：</block>
  <block id="38696044bbd71d082ffea97d1d197778" category="list-text">【第 6 步】验证所有集群端口是否均已启动： `network port show - IP 空间集群`</block>
  <block id="608cd165bc6f1d8f9bc81d0ba9d4d6f9" category="paragraph">每个端口都应显示 "Link" 和 "Health" ：</block>
  <block id="9fca3b421a2bdacefaa47574b6560351" category="list-text">【第 7 步】验证所有集群 LIF 是否均已启动且正常运行： `network interface show - vserver Cluster`</block>
  <block id="8b805e029d1651596a1c4788eae9405c" category="paragraph">对于 `为 Home` ，每个集群 LIF 均应显示 true ，并且状态为 Admin/Oper 为 up/up 。</block>
  <block id="a0c660e29f0d8175447e446b2a7b6605" category="list-text">【第 8 步】验证是否已在所有集群 LIF 上启用自动还原： `network interface show - vserver cluster -fields auto-revert`</block>
  <block id="e8c46fad206eb807356b6c21b63d9b11" category="list-text">【第 9 步】从 node1 上的集群端口 E3A 断开缆线连接，然后使用 9336C-x2 交换机支持的适当布线方式将 E3A 连接到集群交换机 CS1 上的端口 1 。</block>
  <block id="b4bd63b9f9f57a91f3a35d2a15d07dec" category="list-text">从节点 2 上的集群端口 E3A 断开缆线连接，然后使用 9336C-x2 交换机支持的相应布线方式将 E3A 连接到集群交换机 CS1 上的端口 2 。</block>
  <block id="13926c16a2339f39a7e2d4218d47d10b" category="list-text">启用集群交换机 CS1 上面向节点的所有端口。</block>
  <block id="20c7b5e5752f5c1d50d2cad076f86369" category="paragraph">以下示例显示交换机 CS1 上的端口 1/1 到 1/34 已启用：</block>
  <block id="48960e0d1676fd6ac78ff83c8eacebcf" category="list-text">【第 12 步 ]] 确认 `Is Home` ： `network interface show - Vserver Cluster` 的所有集群 LIF 均为 * 已启动 * 且正常运行且显示为 true</block>
  <block id="64fa94ed984230f1b8ea17b502d4973c" category="paragraph">以下示例显示 node1 和 node2 上的所有 LIF 均为 * 上 * ，并且 `为主目录` 结果为 * 上 * ：</block>
  <block id="6867fef4b6bd2de211b840e3bbbfade4" category="list-text">【第 13 步】显示有关集群中节点状态的信息： `cluster show`</block>
  <block id="dbae8c204d7835be187f0c26e601f21a" category="paragraph">以下示例显示了有关集群中节点的运行状况和资格的信息：</block>
  <block id="7123a4fa209592c981816b0f845b643b" category="list-text">【第 14 步】从 node1 上的集群端口 e3b 拔下缆线，然后使用 9336C-x2 交换机支持的适当布线方式将 e3b 连接到集群交换机 CS2 上的端口 1 。</block>
  <block id="dbe6c5e5ec08f66cb9d9bbbf7537cf60" category="list-text">断开节点 2 上集群端口 e3b 的缆线连接，然后使用 9336C-x2 交换机支持的相应布线方式将 e3b 连接到集群交换机 CS2 上的端口 2 。</block>
  <block id="52912772c11becd9a50cbf825e907f87" category="list-text">启用集群交换机 CS2 上面向节点的所有端口。</block>
  <block id="368868489a1f6f26e1e93bfe93468574" category="paragraph">以下示例显示交换机 CS2 上的端口 1/1 到 1/34 已启用：</block>
  <block id="ed6ec2ced3bd6b1417ffd6a307d602f3" category="list-text">【第 17 步】验证所有集群端口是否均已启动： `network port show - IP 空间集群`</block>
  <block id="16d1eb4a10035952002efa1467d33598" category="paragraph">以下示例显示 node1 和 node2 上的所有集群端口均已启动：</block>
  <block id="c782f73b93588e1653a37c6028144e87" category="list-text">【第 18 步】验证 `为主页` 的所有接口是否均显示 true ： `network interface show - Vserver Cluster`</block>
  <block id="d674fde4628671c3e1078935d12e7997" category="admonition">完成此操作可能需要几分钟时间。</block>
  <block id="1ab96d1849f7724eb8af60316f393f9f" category="paragraph">以下示例显示 node1 和 node2 上的所有 LIF 均为 * 上 * ，并且 `为主目录` 结果为 true ：</block>
  <block id="2c36065908c2490cce62720c9153e948" category="list-text">【第 19 步】验证两个节点与每个交换机之间是否有一个连接： `scdp 邻居的方式`</block>
  <block id="1464260572606bd5f01302103114d67a" category="paragraph">以下示例显示了这两个交换机的相应结果：</block>
  <block id="fde24d4314549f5a2de46d76d84388d3" category="list-text">【第 20 步】显示有关集群中发现的网络设备的信息： `network device-discovery show -protocol cdp`</block>
  <block id="4ab68595b7465febd6b674ceb462fb7f" category="list-text">`sHA 对 1 （和 HA 对 2 ）的存储配置是否正确且无错误：` system switch Ethernet show</block>
  <block id="44025ac545f24dd0dd008b70219b2399" category="list-text">【第 22 步】验证设置是否已禁用： `network options switchless-cluster show`</block>
  <block id="00168480378876e963201494f9fdc956" category="admonition">完成此命令可能需要几分钟的时间。等待 " 三分钟生命周期到期 " 公告。</block>
  <block id="f1d50a679b7b3d0967aafba21d2b1454" category="paragraph">以下示例中的 `false` 输出显示配置设置已禁用：</block>
  <block id="f760d9a9bbefbc3a767c22c2b480d748" category="list-text">【第 23 步】验证集群中节点成员的状态： `cluster show`</block>
  <block id="00786e5e7924c0ff19f6286d0cfea575" category="paragraph">以下示例显示了有关集群中节点的运行状况和资格的信息：</block>
  <block id="a5817a6e7f672b3ab5b3f7c1f755970d" category="list-text">【第 24 步】确保集群网络具有完全连接： `cluster ping-cluster -node node-name`</block>
  <block id="6796b0a81714f43b4554e21da2a05f84" category="list-text">【第 25 步】将权限级别改回 admin ： `set -privilege admin`</block>
  <block id="b76e651d2878af6de8e2d66f88169399" category="list-text">使用以下命令启用以太网交换机运行状况监控器日志收集功能，以收集交换机相关的日志文件：</block>
  <block id="ac46a1398372944aea67e370678c8675" category="section-title">设置共享交换机</block>
  <block id="a4c011bd7e730e27cada0f1372a5d1bb" category="list-text">两个共享交换机的名称分别为 _SH1_ 和 _SH2_ 。</block>
  <block id="c85e7af53b23deb42e32c92201cdaea6" category="admonition">操作步骤要求同时使用 ONTAP 命令和 Cisco Nexus 9000 系列交换机命令，除非另有说明，否则会使用 ONTAP 命令。</block>
  <block id="937b84fb8d649c3a0225267e2159fd55" category="list-text">`s存储节点端口运行状况良好且正常运行：` torage port show -port-type ENET</block>
  <block id="93c4ea5521c5219f8fcb4eae38057d8f" category="list-text">【第 3 步】将 HA 对 1 的 NSM224 路径 A 端口移至 SH1 端口范围 11-22 。</block>
  <block id="c15bf25e0c95da8c6317ef9824bb4edf" category="list-text">安装从 HA 对 1 节点 1 路径 A 到 SH1 端口范围 11-22 的缆线。例如， AFF A400 上的存储端口路径为 e0c 。</block>
  <block id="91dc1507413f0a7e116492e9ab8b7e01" category="list-text">安装从 HA 对 1 节点 2 路径 A 到 SH1 端口范围 11-22 的缆线。</block>
  <block id="cd0f27c3f159ed1171da091e36806cc9" category="list-text">验证节点端口是否运行正常： `storage port show -port-type ENET`</block>
  <block id="c561445c147c82877b795542e3e5188f" category="list-text">【第 7 步】检查集群是否没有存储交换机或布线问题： `ssystem health alert show -instance`</block>
  <block id="f1e05ce4b31fb04295120bd05a4743a2" category="list-text">【第 8 步】将 HA 对 1 的 NSM224 路径 B 端口移至 SH2 端口范围 11-22 。</block>
  <block id="daf5a083f03ec28ca196624f5c0b70c6" category="list-text">安装从 HA 对 1 节点 1 路径 B 到 SH2 端口范围 11-22 的缆线。例如， AFF A400 上的路径 B 存储端口为 e5b 。</block>
  <block id="775cb9e0c66cbcbeb5ea42fe8437f948" category="list-text">安装从 HA 对 1 节点 2 路径 B 到 SH2 端口范围 11-22 的缆线。</block>
  <block id="aaf491248ed0270fc32ff08f982aac46" category="list-text">`sHA 对 1 的存储配置是否正确且无错误：` system switch Ethernet show</block>
  <block id="0ca03e80958632a5b480196fc36f2814" category="list-text">【第 13 步】将 HA 对 1 上未使用的（控制器）二级存储端口从存储重新配置到网络。如果直接连接了多个 NS224 ，则应重新配置一些端口。</block>
  <block id="07943fe8945ea223af7602f694f03c79" category="paragraph">将存储端口置于广播域中：</block>
  <block id="8f61ee87422ee53849c366ca3c1c6ce5" category="list-text">`network port broadcast-domain create` （根据需要创建新域）</block>
  <block id="e6e1d4c2a0821261ad22649783a49131" category="list-text">`network port broadcast-domain add-ports` （用于向现有域添加端口）</block>
  <block id="00f1aa07463199047fef449f663dd76d" category="list-text">【第 14 步】如果您禁止自动创建案例，请通过调用 AutoSupport 消息重新启用此功能： `ssystem node AutoSupport invoke -node * -type all -message MAINT=end`</block>
  <block id="890a375fe1995543bbde11772bf2a4fc" category="paragraph">本指南介绍如何通过聚合重新定位在不中断的情况下升级控制器硬件。</block>
  <block id="762829096f8c7b4b18d35eef0b74c5fb" category="paragraph">有关升级控制器硬件的其他方法，请参见 <block ref="0d30689c451a0e1a0cbf0023666aa774" category="inline-link-macro-rx"></block>。</block>
  <block id="645b41b640376c487d825f5296fcae9d" category="paragraph">通过将非根聚合从原始节点迁移到同一集群中的新节点，您可以无中断地升级一对运行 ONTAP 的节点上的控制器硬件。升级期间，可以访问要升级的节点上托管的数据。</block>
  <block id="ec8b10dd6bbff9309807f30eb5f83b02" category="paragraph">您可以通过两种 ARL 方法升级控制器硬件：使用系统命令或执行手动升级。开始之前，您必须确认为控制器硬件升级选择了正确的指南。</block>
  <block id="9b1c9d439120689633fe37233b21c66f" category="paragraph">如果您要使用系统命令执行升级，请参见下表：</block>
  <block id="6e6a93e1bc39df87c56313cbfd41fa2c" category="cell">如果您运行的是此 ONTAP 版本…</block>
  <block id="c8148f766ec78479f303b8e902e9099b" category="cell">要使用 system 命令进行升级，请使用…</block>
  <block id="041dd7a51404fc5dc5a87c2a0bc90b15" category="cell">9.8 或更高版本</block>
  <block id="1fbd6af5fc9d3299929ce0644169d884" category="inline-link-macro">使用 " 系统控制器更换 " 命令升级运行 ONTAP 9.8 或更高版本的控制器硬件</block>
  <block id="6d8870597149a914e87f938f108f5a49" category="cell"><block ref="6d8870597149a914e87f938f108f5a49" category="inline-link-macro-rx"></block></block>
  <block id="b9872d104f5b4706bfb3c12a12c6f3d6" category="cell">9.5 到 9.7</block>
  <block id="42e598379356302a5618c3e3978f1278" category="cell"><block ref="42e598379356302a5618c3e3978f1278" category="inline-link-macro-rx"></block></block>
  <block id="b8f22ccbf3539f982cde4fb452d34422" category="paragraph">如果要执行手动升级，请参见下表：</block>
  <block id="6af074e0669e408e576b460f5c34b89b" category="cell">要手动升级，请使用…</block>
  <block id="d3c6d4d869a34578de710ed95a961434" category="cell"><block ref="d3c6d4d869a34578de710ed95a961434" category="inline-link-macro-rx"></block></block>
  <block id="4c41f3a2ec168af1924a7c5a884bdc37" category="cell">9.0 到 9.7</block>
  <block id="16997a2bce5e5816e92695f9398ec84a" category="cell"><block ref="16997a2bce5e5816e92695f9398ec84a" category="inline-link-macro-rx"></block></block>
  <block id="7b2171ea7fd7b4ef8056cbed017bdddd" category="doc">ONTAP 9.8 系统文档</block>
  <block id="f11bd0266651c774d488523db903a725" category="admonition">* 注意 * ：如果您的系统具有存储磁盘，除非指示您进入维护模式，否则您可以在集群提示符处输入本节中的命令。如果您使用的是 Vseries 系统或 FlexArray 虚拟化软件并连接到存储阵列，则可以在维护模式提示符处在此部分中输入命令。要配置 UTA/UTA2 端口，您必须处于维护模式。</block>
  <block id="d430acf9b1fab77a9b9905bbf1423c57" category="list-text">【第 1 步】在 node3 上输入以下命令，检查端口当前的配置方式：</block>
  <block id="581e0d52eede5c7a9002197a5955188f" category="list-text">`s步骤 3]] 查看` system node hardware unified-connect show `或` ucadmin show 命令的输出，以确定 UTA/UTA2 端口是否具有所需的个性化设置。</block>
  <block id="39e1a687c8a1a3bb49c730ad7b98a3d5" category="cell">转至 <block ref="2fc3b3e515184c116c95342a9ca8cb9f" category="inline-xref-macro-rx"></block>。</block>
  <block id="aeeda50cd3cc8fa0b7819c50d25802cc" category="cell">跳过步骤 5 到步骤 12 ，然后转到 <block ref="e8dc02ba0ba84dfdb12d2955f04811ca" category="inline-xref-macro-rx"></block>。</block>
  <block id="8c1235ea1bd5309fe2724d440119a7bf" category="list-text">[[man_check_3_step5]] 执行以下操作之一：</block>
  <block id="702b58a3a2c0f7ca9c1ff79304cc3846" category="cell">具有存储磁盘，并且正在运行集群模式 Data ONTAP 8.3</block>
  <block id="177fe53a2ca3ad4477bf20631953c74e" category="cell">启动 node3 并进入维护模式： `boot_ontap maint`</block>
  <block id="9bc874604b7939971f9993fe8c042cc5" category="cell">转至 <block ref="f6d13a5ff9438ee0d4458e3f2ffb2fd3" category="inline-xref-macro-rx"></block>。您应已处于维护模式。</block>
  <block id="3b9a8502a8d7047daccb7dc1e076d1db" category="list-text">【 man_check_3_step6]] 执行以下操作之一：</block>
  <block id="1f14f34deb68e1ccfd51fd969391f85b" category="cell">转至 <block ref="e0afe2f8b687f2b937ad04447e0f4504" category="inline-xref-macro-rx"></block>。</block>
  <block id="fe13e7c4af341791013b658ec3446e14" category="cell">跳过第 7 步，转到 <block ref="21867c7d0c2b8bc3921bf40e9edec561" category="inline-xref-macro-rx"></block>。</block>
  <block id="5d8cdb858d03ccbaab4933257301ad1f" category="list-text">[[man_check_3_step7]] 如果适配器处于启动程序模式，并且 UTA/UTA2 端口联机，请使 UTA/UTA2 端口脱机：</block>
  <block id="de2f29988a1562cff5aece8243895ec3" category="paragraph">目标模式下的适配器会在维护模式下自动脱机。</block>
  <block id="f5127a07c0da9806f59a276c6a53e07b" category="list-text">[[man_check_3_step8]] 如果当前配置与所需用途不匹配，请根据需要更改配置：</block>
  <block id="20a6fed477bc68dded7a110a5998c20e" category="admonition">您需要对磁带驱动器， FlexArray 虚拟化系统和 MetroCluster 配置使用 FC 启动程序。您需要对 SAN 客户端使用 FC 目标。</block>
  <block id="87f04db4bf78b3f620b7363444f3162e" category="list-text">停止系统：</block>
  <block id="2f31b93de57cc6e92ee38aaed9b49765" category="paragraph">系统将在启动环境提示符处停止。</block>
  <block id="42a282655a6bcf78e540d618abe8f39f" category="cell">重新启动至维护模式： `boot_netapp maint`</block>
  <block id="4ccd0b13a5d5d3be43ff2600a91655cc" category="list-text">【第 11 步】验证设置：</block>
  <block id="f2cc2cb82b7d41d7e5604b8610c271a3" category="cell">是 V 系列或具有 FlexArray 虚拟化软件并连接到存储阵列</block>
  <block id="52b727613ccb81e1e924ffec991b2e74" category="paragraph">以下示例中的输出显示， FC4 类型的适配器 "1b" 更改为 `initiator` ，适配器 "2a" 和 "2b" 的模式更改为 `CNA` ：</block>
  <block id="fa05264b5c812e55c8ce27a16e3cb341" category="list-text">【第 12a 步】输入以下命令之一，使所有目标端口联机，每个端口输入一次：</block>
  <block id="7bf32aee58782ae16c1d768b4bf38822" category="list-text">【 man_check_3_step13]] 为端口布线。</block>
  <block id="ed79a6f393f23524ed190af7b250c69b" category="list-text">【第 14 步】执行以下操作之一：</block>
  <block id="9bced622fe4463826e54e9d72ffb3105" category="inline-link-macro">将端口从 node1 映射到 node3</block>
  <block id="eb62d15c59e51a7bf19844fae4092453" category="cell">转至 <block ref="3b6c063a8efbc88c969c7838f0611434" category="inline-link-macro-rx"></block>。</block>
  <block id="5bb1d2d89905f521825083d671817bcb" category="cell">是 V 系列系统或具有 FlexArray 虚拟化软件并连接到存储阵列</block>
  <block id="8ec15d413a08247a2b2856ae1be9d192" category="cell">返回到 _Install 和 boot node3_ 并在中继续 <block ref="a4103675c41ea57f7287e0804dd0c9dd" category="inline-link-macro-rx"></block>。</block>
  <block id="f72304143acea17b5bb5c4f384fb8c44" category="paragraph">如果要升级具有内部磁盘驱动器的控制器，则需要完成多个命令并检查其输出，以确保任何内部磁盘驱动器都不包含根聚合或数据聚合。</block>
  <block id="58e9601fd22e1eb1174624568b62ceaf" category="paragraph">如果您不升级内部磁盘驱动器上具有聚合的控制器，请跳过本节并转到一节 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block>。</block>
  <block id="3553fa4aee6c92a690d8b3d2baf9f853" category="list-text">输入 nodeshell ，每个原始节点输入一次。</block>
  <block id="cd526e6ac745b3bc2d71e7b70ccbe24c" category="paragraph">`ssystem node run -node &lt;node_name&gt;`</block>
  <block id="4321f2c566f6fd9e0f937fb671257921" category="list-text">显示内部驱动器：</block>
  <block id="71d2d9e08815f28311d42e1fe65de729" category="paragraph">`ssysconfig -av`</block>
  <block id="1a1cbaa9026d328ea0e1db1e1d719d1e" category="paragraph">系统将显示有关节点配置的详细信息，包括存储，如以下示例所示的部分输出所示：</block>
  <block id="1cec74df52c25d24213897a006ddbc7e" category="list-text">检查 `ssysconfig -av` 命令的存储输出以确定内部磁盘驱动器，然后记录相关信息。</block>
  <block id="63590836c75e5189303be6a7e2f1c0d6" category="paragraph">内部驱动器的 ID 开头为 "00" 。"00" 表示内部磁盘架，小数点后的数字表示各个磁盘驱动器。</block>
  <block id="2581141629fb014ce68faf5b319c8a1e" category="list-text">【 man_aggr_step4]] 在两个控制器上输入以下命令：</block>
  <block id="5047ace67eeca6eaa0de7c2c565db85b" category="paragraph">系统将显示节点的聚合状态，如以下示例中的部分输出所示：</block>
  <block id="67e1c5578ec472925218b8535f73fd69" category="admonition">用于创建聚合的设备可能不是物理磁盘，而是分区。</block>
  <block id="ffdb41868fb358842d696b4ff8240d4e" category="list-text">检查 `aggr status -r` 命令的输出，以使用内部磁盘驱动器确定聚合，然后记录相关信息。</block>
  <block id="4da1edbdb956754e59f0224136b9f957" category="paragraph">在上一步的示例中， "aggr2" 使用内部驱动器，如磁盘架 ID "0" 所示。</block>
  <block id="a0baee3eabdee6658afa877291a41600" category="list-text">在两个控制器上输入以下命令：</block>
  <block id="259baa89207f2b2aded364ccd7acb88e" category="paragraph">`aggr status -y`</block>
  <block id="8248266e12181ad17765b9cf8ce40a99" category="paragraph">系统将显示聚合上卷的相关信息，如以下示例中的部分输出所示：</block>
  <block id="f8fee0808da945cb32ac4bfb7b116901" category="paragraph">根据中的输出 <block ref="fafa89bc8a6136079f9e2f0a2a127d07" category="inline-xref-macro-rx"></block> 第 6 步： aggr2 使用三个内部驱动器— "0a.00.1" ， "0a.00.3" 和 "0a.00.9" ， "aggr2" 上的卷分别为 "vol6" ， "vol5" 和 "vol14" 。此外，在步骤 6 的输出中， "aggr0" 的读数在聚合信息的开头包含 "root" 一词。这表示它包含根卷。</block>
  <block id="85eba1a1c40e954eefa7c966f21fa202" category="list-text">检查 `aggr status -v` 命令的输出，以确定属于内部驱动器上任何聚合的卷，以及这些卷中是否有任何卷包含根卷。</block>
  <block id="a0879940337c9b44fb9cad5bc9f2d541" category="list-text">在每个控制器上输入以下命令，以退出 nodeshell ：</block>
  <block id="d9f6eac526670fe9182f1a63d251a180" category="paragraph">`退出`</block>
  <block id="f5a25cddbc643e856eabde4c6ba4d2a8" category="cell">如果控制器 ...</block>
  <block id="087b658bc1f71a1f2cb5ec53fee94d23" category="cell">请勿在内部磁盘驱动器上包含任何聚合</block>
  <block id="6a58d5f6ed9134ff245eb1172f368af9" category="cell">继续执行此操作步骤。</block>
  <block id="979cce52ff595ac16546680501986d88" category="cell">包含聚合，但内部磁盘驱动器上没有卷</block>
  <block id="15fa78dab9bfec90803987565e3a5e23" category="cell">继续执行此操作步骤。* 注 * ：继续操作之前，必须将聚合置于脱机状态，然后销毁内部磁盘驱动器上的聚合。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Disk 和聚合高级指南 _ 以了解有关管理聚合的信息。</block>
  <block id="0b63c25d5be0c7543233464f799ff9f8" category="cell">在内部驱动器上包含非根卷</block>
  <block id="fe6da5aeee0970bcb27fe1bdcd72a98f" category="cell">继续执行此操作步骤。* 注 * ：在继续操作之前，必须先将卷移动到外部磁盘架，使聚合脱机，然后销毁内部磁盘驱动器上的聚合。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Disk 和聚合高级指南 _ 以了解有关移动卷的信息。</block>
  <block id="1547c14e8c3676ab43b1f9bc7b69d98d" category="cell">包含内部驱动器上的根卷</block>
  <block id="cf992e4682189e679999df1f59ac6447" category="cell">请勿继续使用此操作步骤。您可以参考来升级控制器 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ 并使用操作步骤 _ 通过移动卷 _ 在运行集群模式 Data ONTAP 的一对节点上升级控制器硬件。</block>
  <block id="dec8ae2cc1cff82c9a15f47488d0827b" category="cell">在内部驱动器上包含非根卷，您不能将这些卷移动到外部存储</block>
  <block id="823ba7326edea0fb085b50c3aab24f80" category="cell">请勿继续使用此操作步骤。您可以使用操作步骤升级运行集群模式 Data ONTAP 的一对节点上的控制器硬件并移动 volumes_ 来升级控制器。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ ，您可以在其中访问此操作步骤。</block>
  <block id="3bb2def349bd01a4e09f553241c547bb" category="paragraph">您必须具有在部分中保存的 node2 中的 FC 端口设置值 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block>。</block>
  <block id="8651f71cd1a76b7df1a83cae390627a8" category="paragraph">如果您的系统没有 FC 配置，则可以跳过此部分。如果您的系统具有板载 UTA/UTA2 端口或 UTA/UTA2 适配器，则可以在中对其进行配置 <block ref="5752cac0a470e06ffceef40fba1931c1" category="inline-xref-macro-rx"></block>。</block>
  <block id="3b2aededaf9eb7fa977a61a8bd235fc8" category="cell">转至 <block ref="6df4b9385815488582550ff3bec853dc" category="inline-xref-macro-rx"></block>。</block>
  <block id="e31ad1284b7618a9c10777ed99b12e64" category="inline-xref">第 2 步</block>
  <block id="d0eda6a9db5e17455c4a85cb11800962" category="cell">转至 <block ref="9afe493afbfd571f8e15cdbbaa7d8361" category="inline-xref-macro-rx"></block>。</block>
  <block id="52b26cd7e65738a95d72c027a1b843c2" category="list-text">【 man_config_4_Step2]] 访问维护模式：</block>
  <block id="bdb2780eb5f1795b94cdb7892cd5237b" category="list-text">将新节点上的 FC 设置与先前从原始节点捕获的设置进行比较。</block>
  <block id="605ac6e16f1de07910babd12f8cb0f9e" category="list-text">[[man_config_4_Step5]] 执行以下操作之一：</block>
  <block id="bf5ce713a37cfb1c7cddb2ef1662c419" category="paragraph">根据需要修改 node4 上的 FC 端口：</block>
  <block id="2c28eea077fe0201e484901f94587d87" category="list-text">要对目标端口进行编程：</block>
  <block id="2f699cf77defdb8691038c3365c1e4cb" category="paragraph">`ssystem node hardware unified-connect modify -type | -t target -adapter &lt;port_name&gt;`</block>
  <block id="c5fb075990e07d49af83b424fc450275" category="list-text">要对启动程序端口进行编程：</block>
  <block id="cf4bec74c9d6f95cb8085d8a4bfd855b" category="paragraph">`ssystem node unified-connect modify type | -t initiator -adapter &lt;port_name&gt;`</block>
  <block id="348795cf2ff362808ef4789bfce998c1" category="paragraph">` 类型` 是 FC4 类型，目标或启动程序。</block>
  <block id="2b06110f9a6a9bf3ece9e1df55274e79" category="cell">根据需要修改 node4 上的 FC 端口： `ucadmin modify -m fc -t initiator -f &lt;adapter_port_name&gt;` ` -t` 是 FC4 类型，目标或启动程序。* 注 * ：需要将 FC 端口编程为启动程序。</block>
  <block id="aa056114701909ed085099828ff012a9" category="cell">输入以下命令并检查输出，以验证新设置： `ssystem node unified-connect show`</block>
  <block id="ae1a6eb25c428a13de7c805301540516" category="cell">输入以下命令并检查输出，以验证新设置： `ucadmin show`</block>
  <block id="7f3a5152afa49c8421359b8761a9a8ad" category="cell">新节点上的默认 FC 设置</block>
  <block id="e7df8bff382bf85b07ece9703c2f6808" category="cell">与在原始节点上捕获的相同</block>
  <block id="5f97f3ee15cc9d2abee53d7af46e1799" category="inline-xref">第 11 步</block>
  <block id="222214d2643fdfb746a901984df3eaaa" category="cell">转至 <block ref="313690309739126de0c32c721924102b" category="inline-xref-macro-rx"></block>。</block>
  <block id="7327bd79e6072c9ccdc2b478d3afacfb" category="cell">与您在原始节点上捕获的不同</block>
  <block id="2fe2c4e80b1376975584751f41c867c9" category="inline-xref">第 8 步</block>
  <block id="ebe743318b7324b4ebeb99a0a3c72423" category="cell">转至 <block ref="60c689da671dfc85fbc244a8ddc19d6a" category="inline-xref-macro-rx"></block>。</block>
  <block id="98570637b82059e5ffc8aa3289c7a48b" category="list-text">【 man_config_4_Step8]] 退出维护模式：</block>
  <block id="f93d9d44ef64b7bd548bb1548837f7c9" category="cell">是 V 系列系统或具有运行 Data ONTAP 8.3.0 或更高版本的 FlexArray 虚拟化软件</block>
  <block id="ae67b2e6adc83ff617429f7470e3fcf2" category="cell">在启动环境提示符处输入以下命令以访问维护模式： `boot_ontap maint`</block>
  <block id="a2aebe9559cbe6e73c0a0bf0d1bb9ef4" category="cell">不是 V 系列系统，也没有 FlexArray 虚拟化软件</block>
  <block id="1747e775d1492fb4a122964eb0ce6abd" category="cell">在启动环境提示符处输入以下命令，以启动 node4 ： `boot_ontap`</block>
  <block id="be71806e78200788394953879d8e5b6a" category="list-text">[[man_config_4_Step11]] 执行以下操作之一：</block>
  <block id="5f05ecbc9bc4d038e9ed396780511251" category="list-text">转至 <block ref="5752cac0a470e06ffceef40fba1931c1" category="inline-xref-macro-rx"></block> 如果 node4 具有 UTA/UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="04e69ed9c039a8d1bc156ec97e69f0d2" category="inline-link-macro">将端口从 node2 映射到 node4</block>
  <block id="1e7bd254c963a338c489202373c4ab17" category="list-text">跳过此部分，然后转到 <block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block> 如果 node4 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="08b25b9ad88e79131839ab732517a679" category="list-text">转至 <block ref="5752cac0a470e06ffceef40fba1931c1" category="inline-xref-macro-rx"></block> 如果 node4 具有 UTA/ UTA2 卡或 UTA/UTA2 板载端口。</block>
  <block id="54c8107ec5763757535759e84fcccba4" category="inline-link-macro">第 9 步</block>
  <block id="11b3cd1a1063bf814b7d2eeabae1825d" category="list-text">跳过 _Check and configure UTA/UTA2 ports on node4_ 如果 node4 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请返回 _Install and boot node4_ 部分，然后继续执行中的部分 <block ref="04be07c8b8cd85d6b2140c2bfb8113b6" category="inline-link-macro-rx"></block>。</block>
  <block id="826be71263f21097957d09d3f8ed668e" category="paragraph">在更换原始节点之前，您必须确保它们位于 HA 对中，没有缺失或故障磁盘，可以访问彼此的存储，并且不拥有分配给集群中其他节点的数据 LIF 。您还需要收集有关原始节点的信息，如果集群位于 SAN 环境中，请确保集群中的所有节点都处于仲裁状态。</block>
  <block id="e537424f11b8c436c4623dda13ea1af3" category="list-text">确保每个原始节点都有足够的资源，以便在接管模式期间为这两个节点的工作负载提供充分的支持。</block>
  <block id="f3c19cb23097cbe0b0079c33c1dda6e2" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _HA ONTAP 9 高可用性配置指南 _ 并按照 _HA 对最佳实践 _ 一节进行操作。原始节点均不应以 50% 以上的利用率运行；如果某个节点以低于 50% 的利用率运行，则它可以在控制器升级期间处理这两个节点的负载。</block>
  <block id="f57ddae179006dfe93c570a9886b51b0" category="list-text">完成以下子步骤，为原始节点创建性能基线：</block>
  <block id="e2ce8b648cf2a8577d2ac0054c830df5" category="list-text">确保诊断用户帐户已解锁。</block>
  <block id="04b97d849898994879d3546a0da9f87a" category="paragraph">* 重要信息 * ：诊断用户帐户仅用于低级别诊断，只能在技术支持的指导下使用。</block>
  <block id="cb0649853a09056775436f53b7e99dc5" category="paragraph">* 重要信息 * ：有关解锁用户帐户的信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到系统管理参考。</block>
  <block id="8fafe7b0e88d09400ee18fcc9299185e" category="list-text">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ 并下载性能和统计信息收集器（ Perfstat Converged ）。</block>
  <block id="061b69246434dcda481ca9452cf30635" category="paragraph">使用 perfstat Converged 工具，您可以建立性能基线，以便在升级后进行比较。</block>
  <block id="3e5ae45cd6aac12d01461471b0995845" category="list-text">按照 NetApp 支持站点上的说明创建性能基线。</block>
  <block id="7fcb92cfc1dea17cbdc84eda52cfac2b" category="list-text">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ 并在 NetApp 支持站点上创建支持案例。</block>
  <block id="38fd59ef0181a70014c49f0cfdd6ed5d" category="paragraph">您可以使用案例报告升级期间可能出现的任何问题。</block>
  <block id="e7b328a01b5a6b8fffc172cfd9f564c0" category="list-text">验证 node3 和 node4 的 NVMEM 或 NVRAM 电池是否已充电，如果未充电，请为其充电。</block>
  <block id="2e283ebf1bea253f33a9e884fa598e1e" category="paragraph">您需要物理检查 node3 和 node4 以查看 NVMEM 或 NVRAM 电池是否已充电。有关 node3 和 node4 型号的 LED 的信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _SIL_ Hardware Universe 。</block>
  <block id="6ab3181b33a0075c13f2de4c0920deff" category="admonition">* 注意 * 请勿尝试清除 NVRAM 内容。如果需要清除 NVRAM 的内容，请联系 NetApp 技术支持。</block>
  <block id="051d9c31ffa2621a5e49ba9e6d76c916" category="list-text">检查 node3 和 node4 上的 ONTAP 版本。</block>
  <block id="9a67d8c90151902aae7ada9ad8732901" category="paragraph">新节点上安装的 ONTAP 9.x 版本必须与原始节点上安装的版本相同。如果新节点安装的 ONTAP 版本不同，则在安装新控制器后，需要通过网络启动这些控制器。有关如何升级 ONTAP 的说明，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Microsoft ONTAP 9 升级和还原 / 降级指南 _ 。</block>
  <block id="53e359796554176ecef5639c8ed3ed05" category="paragraph">有关 node3 和 node4 上的 ONTAP 版本的信息应包含在装运箱中。节点启动时会显示 ONTAP 版本，您也可以将节点启动至维护模式并运行命令：</block>
  <block id="7877022c956918624cc0373ff564cad4" category="paragraph">`ve版本`</block>
  <block id="232ac82576b399b9dcdc3a264bb0c6ec" category="list-text">检查 node1 和节点 2 上是否有两个或四个集群 LIF ：</block>
  <block id="a2d27af8ce0592e36b8a208c0cb93d3e" category="paragraph">`network interface show -role cluster`</block>
  <block id="97946b80ce2a390dfbe694abb89b8da6" category="paragraph">系统将显示任何集群 LIF ，如以下示例所示：</block>
  <block id="b6f048f47d754b1245e072cf13364151" category="list-text">如果 node1 或 node2 上有两个或四个集群 LIF ，请通过完成以下子步骤确保您可以在所有可用路径上对两个集群 LIF 执行 ping 操作：</block>
  <block id="4ae0280fe3dd6476913cdfef9bf98f8f" category="list-text">输入高级权限级别：</block>
  <block id="6a76a1a5611a7cd78d175bb62eecc5c0" category="paragraph">系统将显示以下消息：</block>
  <block id="88bdbe46ad1d0b5212db8d769f0d6c7c" category="list-text">输入 `y` 。</block>
  <block id="1be278766df14cf22410e71cf6d2cf07" category="list-text">对节点执行 Ping 操作并测试连接：</block>
  <block id="30533ddc427fb292c7d2a7a069e893e2" category="paragraph">`cluster ping-cluster -node node_name`</block>
  <block id="e2ef0e388993deb8d5ac2d2c4c589106" category="paragraph">系统将显示类似于以下示例的消息：</block>
  <block id="87d93b522596e870c62c871bdbe44c11" category="paragraph">如果节点使用两个集群端口，您应看到它能够在四个路径上进行通信，如示例所示。</block>
  <block id="063014cb1baf1ab4cfba01ed9c5cdcb1" category="list-text">返回到管理级别权限：</block>
  <block id="3e6f17c57130b6f779ec8a030abc6ae0" category="list-text">确保 node1 和 node2 位于 HA 对中，并验证节点是否彼此连接，以及是否可以进行接管：</block>
  <block id="7a309bb6c6af5ef06efe5f48e0c54074" category="paragraph">以下示例显示了节点彼此连接并可进行接管时的输出：</block>
  <block id="8ad3217d99ee19b408199ad575ffe3af" category="paragraph">两个节点均不应处于部分交还状态。以下示例显示 node1 处于部分交还状态：</block>
  <block id="1a0e7aa8e280128ae61771ef3ba60eea" category="paragraph">如果任一节点处于部分交还状态，请使用 `storage failover giveback` 命令执行交还，然后使用 `storage failover show-giveback` 命令确保仍不需要交还聚合。有关命令的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到《 _ONTAP 9 高可用性配置指南》。</block>
  <block id="e1b6253c9fd3e54d029ac4ea06c7ca29" category="list-text">【 man_prepare_nodes_step9]] 确保 node1 和 node2 均不拥有其当前所有者（而不是主所有者）的聚合：</block>
  <block id="af83575c95d637895459a44e86fa9e26" category="paragraph">`storage aggregate show -node &lt;node_name&gt; -is-home false -fields owner-name ， homename ， state`</block>
  <block id="e86a1d7ab77ef690a506c50aeb0e4407" category="paragraph">如果 node1 和 node2 都不拥有当前所有者（而不是主所有者）的聚合，则系统将返回类似于以下示例的消息：</block>
  <block id="b985e562bbb6750dd51f653600fe0a16" category="paragraph">以下示例显示了一个名为 node2 的节点的命令输出，该节点是四个聚合的主所有者，但不是当前所有者：</block>
  <block id="d2d09b67c3b189d4996ce96fdb6e7f46" category="cell">如果命令位于中 <block ref="f234334393599d38df4eb27863e3dcfa" category="inline-xref-macro-rx"></block>...</block>
  <block id="187bf5770ab4eb046ac279545d76a28d" category="cell">输出为空</block>
  <block id="618ca5b25d5cf4c26b7057f25a52023b" category="inline-xref">第 12 步</block>
  <block id="6cf9162d078961b85385ab5ffe206def" category="cell">跳过步骤 11 ，然后转到 <block ref="9e04aeb1482ff26e4ec2b4e66367360a" category="inline-xref-macro-rx"></block>。</block>
  <block id="4862cab8c196cf3e955c3421a6f0ab8b" category="cell">具有输出</block>
  <block id="009df4941179f7e77d7594ecfc0c10f7" category="cell">转至 <block ref="1fe89f878ebb086a789e2e41fed56343" category="inline-xref-macro-rx"></block>。</block>
  <block id="edc71aed1f3d88be9cfa9b3b3f030a94" category="list-text">[[man_prepare_nodes_step11]] 如果 node1 或 node2 拥有其当前所有者而非主所有者的聚合，请完成以下子步骤：</block>
  <block id="f38dad169237355428118b60b1896828" category="list-text">将配对节点当前拥有的聚合返回到主所有者节点：</block>
  <block id="93b9f692990cbe40ba44ff8b66800ba1" category="paragraph">`storage failover giveback -ofnode &lt;home_node_name&gt;`</block>
  <block id="17ef288fc5accadf7f08a6841d89c986" category="list-text">验证 node1 和 node2 均不拥有其当前所有者（而不是主所有者）的聚合：</block>
  <block id="239ac3b08eb08347dc0ce94de0522c08" category="paragraph">`storage aggregate show -nodes &lt;node_name&gt; -is-home false -fields owner-name ， home-name ， state`</block>
  <block id="cdb18b743b776d3188bce1696bcee067" category="list-text">[[man_prepare_nodes_step12]] 确保 node1 和 node2 可以访问彼此的存储，并验证是否没有缺少磁盘：</block>
  <block id="d4a6afd0a40d578ef1c16c580930990a" category="paragraph">`storage failover show -fields local-missing-disks ， partner-missing-disks`</block>
  <block id="9351d7b864e0fec6d8e9ce484c7e1792" category="paragraph">以下示例显示了未缺少磁盘时的输出：</block>
  <block id="c82f6efd677e95b86319ae86cdcc3bd9" category="paragraph">如果缺少任何磁盘，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _HA ONTAP 9 磁盘和聚合高级指南 _ ， _ONTAP 9 逻辑存储管理指南 _ 和 _ONTAP 9 高可用性配置指南 _ ，以便为 HA 对配置存储。</block>
  <block id="89b6ed3de0a424283818fdf7fccd43c6" category="list-text">确保 node1 和 node2 运行状况良好且有资格加入集群：</block>
  <block id="f1178fa107fef2eea6cd954e57dbda27" category="paragraph">以下示例显示了两个节点均符合条件且运行状况良好时的输出：</block>
  <block id="b5c6fde8816eb583a49b6c0314b82928" category="list-text">将权限级别设置为高级：</block>
  <block id="a28608e752cbbce9cbd1454dfca4e122" category="list-text">[[man_prepare_nodes_step15]] 确保 node1 和 node2 运行相同的 ONTAP 版本：</block>
  <block id="e5efd9c28238577691b2e984771aea4a" category="paragraph">`ssystem node image show -node &lt;node1 ， node2 &gt; -iscurrent true`</block>
  <block id="ee93f64f74bbb51a61f0871bf27e8d58" category="paragraph">以下示例显示了命令的输出：</block>
  <block id="39011a93d54cda514415ade9083fc4bd" category="list-text">验证 node1 和 node2 均不拥有属于集群中其他节点的任何数据 LIF ，并检查输出中的 `Current Node` 和 `is Home` 列：</block>
  <block id="7bba44cc0aa97ec42a95cacd643fa5f4" category="paragraph">`network interface show -role data -is-home false -curr-node &lt;node_name&gt;`</block>
  <block id="5ac0c9fe3d719e05a93a39b429e96f47" category="paragraph">以下示例显示了 node1 中没有归集群中其他节点所有的 LIF 时的输出：</block>
  <block id="c94a099e774b563198a3d0a4747eeeb1" category="paragraph">以下示例显示了 node1 拥有另一节点主拥有的数据 LIF 时的输出：</block>
  <block id="624ebabf7bed06677af18b73e9b75ed4" category="list-text">如果中的输出 <block ref="f85aebae90992a111c19def12492ab18" category="inline-xref-macro-rx"></block> 显示 node1 或 node2 拥有集群中其他节点拥有的任何数据 LIF ，请将这些数据 LIF 从 node1 或 node2 迁移出：</block>
  <block id="b4ebcf376ab05c920671af65b7daaf8c" category="paragraph">`network interface revert -vserver * -lif *`</block>
  <block id="90cb08ba1d76f3a3dfeee17c19be4d3e" category="paragraph">有关 `network interface revert` 命令的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Microsoft ONTAP 9 命令：手册页参考 _ 。</block>
  <block id="9aad19d5c9012d934daf081b9a8a5f8d" category="list-text">检查 node1 或 node2 是否拥有任何故障磁盘：</block>
  <block id="befc7c82e5a0017b377265524e554a72" category="paragraph">`storage disk show -nodelist &lt;node1 ， node2 &gt; -broken`</block>
  <block id="42b9e1733c1cb77cbd905ea8bf82ed4f" category="paragraph">如果任何磁盘出现故障，请按照 _ONTAP 9 磁盘和聚合高级指南 _ 中的说明将其删除。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _ONTAP 9 磁盘和聚合高级指南 _ 。）</block>
  <block id="897a592bf71f640f9c341f736bc9ee4e" category="list-text">通过完成以下子步骤并记录每个命令的输出，收集有关 node1 和 node2 的信息：</block>
  <block id="76a16743e07ac3cea2f75990f2aad527" category="admonition">您稍后将在操作步骤中使用此信息。</block>
  <block id="86bd7b7efad49e1892e19e0073d55fb5" category="list-text">记录两个节点的型号，系统 ID 和序列号：</block>
  <block id="6954b4a189214669ac4df406940dd33e" category="paragraph">`ssystem node show -node &lt;node1 ， node2 &gt; -instance`</block>
  <block id="dfb5c700fcc3e30efac3db32160fbcf2" category="admonition">您将使用此信息重新分配磁盘并停用原始节点。</block>
  <block id="e09e773592434045763d0f91877696a1" category="list-text">在 node1 和 node2 上输入以下命令，并记录输出中有关磁盘架，每个磁盘架中的磁盘数，闪存存储详细信息，内存， NVRAM 和网卡的信息：</block>
  <block id="15b1cd8e0a84466d3709aaf6e05cddf0" category="paragraph">`运行 -node &lt;node_name&gt; sysconfig`</block>
  <block id="4f52adca7234907fc88d3196c013afca" category="admonition">您可以使用此信息确定可能要传输到 node3 或 node4 的部件或配件。如果您不知道节点是 V 系列系统还是具有 FlexArray 虚拟化软件，也可以从输出中了解到这一点。</block>
  <block id="183d8f9cbafac0e6a6d6ea1ecdc927af" category="list-text">在 node1 和 node2 上输入以下命令，并记录两个节点上处于联机状态的聚合：</block>
  <block id="c6cb2ac6573aa936dedbb241c7666136" category="paragraph">`storage aggregate show -node &lt;node_name&gt; -state online`</block>
  <block id="8e812627c78a44fd6a82255d855942ae" category="admonition">您可以使用此信息以及以下子步骤中的信息来验证聚合和卷在整个操作步骤中是否保持联机，但在重新定位期间处于脱机状态的短暂时间除外。</block>
  <block id="75cf5ffcfa777a87d0faf388944df0a1" category="list-text">【 man_prepare_nodes_step19]] 在 node1 和 node2 上输入以下命令，并记录两个节点上脱机的卷：</block>
  <block id="9725ef50c82a6779c393b0d1203f8040" category="paragraph">`volume show -node &lt;node_name&gt; -state offline`</block>
  <block id="649d1a5dd8b62184f1d84c77b9e0782d" category="admonition">升级后，您将再次运行命令并将此输出与此步骤中的输出进行比较，以查看是否有任何其他卷脱机。</block>
  <block id="f1914c021e0eba7910a7110848bb7b02" category="list-text">输入以下命令，查看 node1 或 node2 上是否配置了任何接口组或 VLAN ：</block>
  <block id="668c0014fabb7b9c53aeeddba81cd3f5" category="paragraph">`network port ifgrp show`</block>
  <block id="793d1d4f275c1119fa9ef4c6bdeb245e" category="paragraph">`network port vlan show`</block>
  <block id="f44fab1c935aab23f65aad42a018c6c3" category="paragraph">请注意接口组或 VLAN 是在 node1 还是 node2 上配置的；您需要在下一步以及后续步骤的操作步骤中提供这些信息。</block>
  <block id="6b6d8dc68906d8c318a7c2d09898cb94" category="list-text">在 node1 和 node2 上完成以下子步骤，以确保稍后可以在操作步骤中正确映射物理端口：</block>
  <block id="b84ea1287ec7320899965ee9778b33f8" category="list-text">输入以下命令以查看除 `clusterwide` 以外的节点上是否存在故障转移组：</block>
  <block id="b60d742c0bb409f0ebcb8588e87621e0" category="paragraph">`network interface failover-groups show`</block>
  <block id="091f947ae047399826a034c153b6f964" category="paragraph">故障转移组是系统上存在的一组网络端口。由于升级控制器硬件可能会更改物理端口的位置，因此在升级期间可能会无意中更改故障转移组。</block>
  <block id="8d9c45aa37c89a2c1648b1756ab487ea" category="paragraph">系统将在节点上显示故障转移组，如以下示例所示：</block>
  <block id="da98a346ceebae46d5f809b0a76fa466" category="list-text">如果存在非 `clusterwide` 的故障转移组，请记录故障转移组名称以及属于故障转移组的端口。</block>
  <block id="4284018d8ed5fd4750bbe54e42d5131e" category="list-text">输入以下命令以查看节点上是否配置了任何 VLAN ：</block>
  <block id="cd2907c0af6cc6fce6a7f22620877696" category="paragraph">`network port vlan show -node &lt;node_name&gt;`</block>
  <block id="c4bc09685f2b51c989913c717d719690" category="paragraph">VLAN 通过物理端口进行配置。如果物理端口发生更改，则稍后需要在操作步骤中重新创建 VLAN 。</block>
  <block id="d12a9049e51fd6e424aa4359a72b4295" category="paragraph">系统将显示节点上配置的 VLAN ，如以下示例所示：</block>
  <block id="c14e11ebbdc4deecee898760f94845d8" category="list-text">如果节点上配置了 VLAN ，请记下每个网络端口和 VLAN ID 配对。</block>
  <block id="52be7caa23f8083514a04ae35866982c" category="cell">接口组或 VLAN</block>
  <block id="298af6f79d48efea731daf2a5fb8b16a" category="cell">在 node1 或 node2 上</block>
  <block id="4d65d20e483d642b29f52e830db50552" category="inline-xref">第 24 步</block>
  <block id="aa969b6a363de5881c89bb2473ec8437" category="cell">完成 <block ref="9b49efbf480dedd669e8261bbf55488f" category="inline-xref-macro-rx"></block> 和 <block ref="75c40b124b57824cd48270709549c07b" category="inline-xref-macro-rx"></block>。</block>
  <block id="6c2e7ce55ecae714a2208a38f28950b9" category="cell">不在 node1 或 node2 上</block>
  <block id="68eb39c6bade33093ea7116e69724b9d" category="cell">转至 <block ref="75c40b124b57824cd48270709549c07b" category="inline-xref-macro-rx"></block>。</block>
  <block id="371f291ab5b98703097ed6da7c8ed52f" category="list-text">[[man_prepare_nodes_step23]] 如果您不知道 node1 和 node2 是在 SAN 环境还是非 SAN 环境中，请输入以下命令并检查其输出：</block>
  <block id="088bfd1403b81327173d6033bdca4fa2" category="paragraph">`network interface show -vserver &lt;vserver_name&gt; -data-protocol iscsi_FCP`</block>
  <block id="acbfcb7305e244387e0051fa5f508401" category="paragraph">如果没有为 SVM 配置 iSCSI 或 FC ，则此命令将显示类似于以下示例的消息：</block>
  <block id="f5ec26fd612e05501dc188ab23c1e529" category="paragraph">您可以使用 `network interface show` 命令和 ` -data-protocol nfs|cifs` 参数确认节点位于 NAS 环境中。</block>
  <block id="94b030f9c4d0cf01d4214519980e06e7" category="paragraph">如果为 SVM 配置了 iSCSI 或 FC ，则该命令将显示类似于以下示例的消息：</block>
  <block id="6d0f0ab3ba176428ba45b4d0b08cb29a" category="list-text">[[man_prepare_nodes_step24]] 通过完成以下子步骤验证集群中的所有节点是否都处于仲裁状态：</block>
  <block id="41755192777732f571a4c320827bfc6d" category="list-text">验证内核中每个节点的集群服务状态一次：</block>
  <block id="998af7db71400f287ae13a492f9d193a" category="paragraph">`cluster kernel-service show`</block>
  <block id="a911ca42751cdd210f50c82f44049c10" category="paragraph">如果大多数节点运行状况良好，并且可以彼此通信，则集群中的节点将处于仲裁状态。有关详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到系统管理参考。</block>
  <block id="6c4e983088f8ed9f67246e1b17b638ca" category="list-text">返回到管理权限级别：</block>
  <block id="bd63b39861eaf09922b2f696e573be58" category="cell">如果集群 ...</block>
  <block id="cf72c95a9046542261893f709403a8d2" category="cell">已配置 SAN</block>
  <block id="6f690bd73c9853fafd7c1e4456ccea21" category="inline-xref">第 26 步</block>
  <block id="a2ca851f93b3aab00f2a1a9d215797c0" category="cell">转至 <block ref="25d05608683c9030994c9dfb7a4f0a9b" category="inline-xref-macro-rx"></block>。</block>
  <block id="6f3802a8c39ecd17753209796818c9f5" category="cell">未配置 SAN</block>
  <block id="bb321334fcb278e04a88480d13054b7e" category="inline-xref">第 29 步</block>
  <block id="4bf8f638d47f6a7f9ed2b167e6c58b28" category="cell">转至 <block ref="423690fd8b3d3c5955a0b43d62ab9b67" category="inline-xref-macro-rx"></block>。</block>
  <block id="dca3bf352f9922771b35f1e03c591788" category="list-text">【 man_prepare_nodes_step26]] 输入以下命令并检查其输出，验证 node1 和 node2 上是否存在已启用 SAN iSCSI 或 FC 服务的每个 SVM 的 SAN LIF ：</block>
  <block id="d9a90656b27774b99262e8722363244c" category="paragraph">`network interface show -data-protocol iscsi_FCP -home-node &lt;node_name&gt;`</block>
  <block id="963e82614f757a8eee0259303f34527b" category="paragraph">命令可显示 node1 和 node2 的 SAN LIF 信息。以下示例将状态 Admin/Oper 列中的状态显示为 up/up ，表示 SAN iSCSI 和 FC 服务已启用：</block>
  <block id="8a70e662724b21080c560e6be7f2c5c4" category="paragraph">或者，您也可以输入以下命令来查看更详细的 LIF 信息：</block>
  <block id="d026c064778006f9c03fdbc86d65f2bb" category="paragraph">`network interface show -instance -data-protocol iscsi_FCP`</block>
  <block id="ff03f81e3805469dd3ca43d2811a614d" category="list-text">输入以下命令并记录系统的输出，以捕获原始节点上任何 FC 端口的默认配置：</block>
  <block id="3e2b2bdb70af85f67ec523ee76a4f03b" category="paragraph">命令显示集群中所有 FC 端口的相关信息，如以下示例所示：</block>
  <block id="b0465c9d2f8edb4e2978de4f3bb93497" category="paragraph">您可以在升级后使用此信息设置新节点上的 FC 端口配置。</block>
  <block id="1c805b4cc00ee084b0e3a5a9c212e9a2" category="list-text">如果要升级 V 系列系统或安装了 FlexArray 虚拟化软件的系统，请输入以下命令并记录输出，以捕获有关原始节点拓扑的信息：</block>
  <block id="1f21d3af1ebfd92fe19ca32d07d90016" category="paragraph">`storage array config show -switch`</block>
  <block id="c83875af1cfc44dcf937e003fd6ad9bf" category="paragraph">系统将显示拓扑信息，如以下示例所示：</block>
  <block id="1bd4ed27f87546af3edbba37df0590cf" category="list-text">[man_prepare_nodes_step29]] 完成以下子步骤：</block>
  <block id="fd24198d12e02d20f511f9c35f66ebb1" category="list-text">在一个原始节点上输入以下命令并记录输出：</block>
  <block id="7321ac6691d90f67ea8ea42f26847df8" category="paragraph">`sservice-processor show -node * -instance`</block>
  <block id="72dfb8d3e52e5d9045db9ad00960535b" category="paragraph">系统会显示两个节点上的 SP 的详细信息。</block>
  <block id="f1d0d797b1496a22b2143e972a97045a" category="list-text">确保 SP 状态为 `online` 。</block>
  <block id="9d69314bda1bdc408f81a03d72f99767" category="list-text">确保已配置 SP 网络。</block>
  <block id="7f4649d278edc769a0ec529585086778" category="list-text">记录 IP 地址和有关 SP 的其他信息。</block>
  <block id="2874b759bc0f9d6f832a84f482485f96" category="paragraph">您可能希望在新节点上重复使用原始系统中远程管理设备（此处为 SP ）的网络参数。有关 SP 的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _System 管理参考 _ 和 _ONTAP 9 命令：手册页参考 _ 。</block>
  <block id="73e2f3b9e6d19fe1e2189067c752d909" category="list-text">【 man_prepare_nodes_step30]] 如果希望新节点与原始节点具有相同的许可功能，请输入以下命令以查看原始系统上的集群许可证：</block>
  <block id="57fb8c1782e77bfa17ea95c66f54a6dd" category="paragraph">`ssystem license show -owner *`</block>
  <block id="4f8f7baa705fb90b9c5bec95668e59f5" category="paragraph">以下示例显示了 cluster1 的站点许可证：</block>
  <block id="b83718d5186db84761322d32f4ea05ac" category="list-text">在 _NetApp 支持站点 _ 为新节点获取新许可证密钥。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _NetApp 支持站点 _ 。</block>
  <block id="5bb4c97c29100d63e333b5886f7e88b0" category="paragraph">如果此站点没有所需的许可证密钥，请联系您的 NetApp 销售代表。</block>
  <block id="6e97d82c25e14f4edc2307703de3f74f" category="list-text">在每个节点上输入以下命令并检查其输出，以检查原始系统是否已启用 AutoSupport ：</block>
  <block id="6be10f97ff0bf527322d5fe2064f26ca" category="paragraph">`ssystem node AutoSupport show -node &lt;node1 ， node2 &gt;`</block>
  <block id="28705e432bcaee564beb0750f6d4f55d" category="paragraph">命令输出显示是否已启用 AutoSupport ，如以下示例所示：</block>
  <block id="9d35920fb64314f04ebb4c503b9d4637" category="cell">如果原始系统 ...</block>
  <block id="82afadce5c137568366e29a810db005a" category="cell">已启用 AutoSupport ...</block>
  <block id="c732f1d7a89abd68a48f92313a9b4364" category="inline-xref">第 34 步</block>
  <block id="1ab718a04314b36269d3b2b096aac75a" category="list-text">转至 <block ref="395265ffe56efe9e97ae9cc3752b2f60" category="inline-xref-macro-rx"></block>。</block>
  <block id="e5358fe562a4d74ac4231d8e23d0b088" category="inline-link-macro">获取用于存储加密的外部密钥管理服务器的 IP 地址</block>
  <block id="e080d72a1a31976179b4632b6b55abc6" category="list-text">转到部分 <block ref="0427c7f36b4a2a717a929ec10534f5c0" category="inline-link-macro-rx"></block>。</block>
  <block id="9c13f9e2316ce6eb31c97c43c9f42070" category="cell">未启用 AutoSupport ...</block>
  <block id="6fcae9afe7013bc84597d8c4231312ba" category="list-text">按照 _System 管理参考 _ 中的说明启用 AutoSupport 。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到系统管理参考。）</block>
  <block id="04f24e11b658105f38ef40a82c24839e" category="paragraph">* 注意： * 首次配置存储系统时，默认情况下会启用 AutoSupport 。尽管您可以随时禁用 AutoSupport ，但应保持启用状态。启用 AutoSupport 可以显著帮助您确定问题，并在存储系统出现问题时提供解决方案。</block>
  <block id="38380a05879fb0225ede644e75b655eb" category="list-text">转至 <block ref="0427c7f36b4a2a717a929ec10534f5c0" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="4179c1d88c83e870ed525f69e82e0369" category="list-text">【 man_prepare_nodes_step34]] 在两个原始节点上输入以下命令并检查输出，以验证 AutoSupport 是否配置了正确的邮件主机详细信息和收件人电子邮件 ID ：</block>
  <block id="a8c3aac51d9227fa38d968e2651f9145" category="paragraph">`ssystem node AutoSupport show -node node_name -instance`</block>
  <block id="f9145af7d3453430abd5b300de96a961" category="paragraph">有关 AutoSupport 的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _System 管理参考 _ 和 _ONTAP 9 命令：手册页参考 _ 。</block>
  <block id="1139339a9b05d9d73e22e4329260fdc9" category="list-text">[[man_prepare_nodes_step35 ，步骤 35]] 输入以下命令向 NetApp 发送 node1 的 AutoSupport 消息：</block>
  <block id="2dc3e53d8dbc94d5425e399af7be362e" category="paragraph">`ssystem node AutoSupport invoke -node node1 -type all -message "upgrading node1 from platform_old to platform_new"`</block>
  <block id="4086f5138ec309c4999cbff0dc76073d" category="admonition">此时，请勿向 NetApp 发送 node2 的 AutoSupport 消息；稍后可在操作步骤中执行此操作。</block>
  <block id="37fdb57fc31ec512b7d4dde37a7ab8d7" category="list-text">【 man_prepare_nodes_step36 ，步骤 36]] 输入以下命令并检查其输出，以验证是否已发送 AutoSupport 消息：</block>
  <block id="cccac064a74482bb09e58f71e14d1eb8" category="paragraph">`ssystem node AutoSupport show -node &lt;node1&gt; -instance`</block>
  <block id="28dd44ad0b0bcceee8ca8498734facba" category="paragraph">字段 `Last Subject Sent ：` 和 `Last Time Sent ：` 包含上次发送消息的消息标题以及消息发送时间。</block>
  <block id="76b84f6ac9c180bd922bf1f7f126e4f3" category="list-text">【 man_lif_verif_3_step6]] 通过输入以下命令将每个 NAS 数据 LIF 迁移到 node3 ，每个 LIF 一次：</block>
  <block id="6c255263113a7719b1ecd239473107b4" category="paragraph">`network interface migrate -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -destination-node &lt;node3&gt; -destination-port &lt;netport_ifgrp&gt;`</block>
  <block id="2a315513f7616cc1af14936ea2d874e2" category="list-text">【 man_lif_verif_3_step7]] 确保数据迁移持久：</block>
  <block id="41decee97eaf6a02382e1043cd497047" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt;-home-port &lt;netport_ifgrp&gt; -home-node &lt;node3&gt;`</block>
  <block id="a1bec963768ced37ff6941c78a44a2b2" category="list-text">【 man_lif_verif_3_step8]] 确保 SAN LIF 位于 node3 上的正确端口上：</block>
  <block id="585706a23104766700d11344f2e0ba1f" category="paragraph">`network interface show -data-protocol iscsi_FCP -home-node &lt;node3&gt;`</block>
  <block id="fd9ca0bcb22fd53f185265e5000e6dfc" category="paragraph">系统将返回类似于以下示例的输出：</block>
  <block id="c54266e61fa0c81baa92579805dc7963" category="list-text">如果 node3 中的任何 SAN LIF 或 SAN LIF 组位于 node1 上不存在的端口上，或者需要映射到其他端口，请通过完成以下子步骤将其移动到 node3 上的相应端口：</block>
  <block id="2a5c2b7daa59600bf737f8138fa7c5d8" category="list-text">将 LIF 状态设置为 "down" ：</block>
  <block id="c45d65e293bff08cd4322d40820fe3f2" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -status-admin down`</block>
  <block id="c9ac8fe8e0b43e6046de0567dc54775e" category="list-text">从端口集中删除 LIF ：</block>
  <block id="d69d2bd9d3262a8ab5d370d315213f33" category="paragraph">`portset remove -vserver &lt;vserver_name&gt; -portset &lt;portset_name&gt; -port-name &lt;port_name&gt;`</block>
  <block id="d21772becf211f27205d2c80c2749c12" category="list-text">输入以下命令之一：</block>
  <block id="fd8145a34775436c1a5fe969965d449f" category="list-text">移动单个 LIF ：</block>
  <block id="e6002eba5d1a039b35fcb8536729f448" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -home-port &lt;new_home_port&gt;`</block>
  <block id="30f710fc2b8d913378fc91684f0863fd" category="list-text">将一个不存在或不正确的端口上的所有 LIF 移动到新端口：</block>
  <block id="7066be16c0309959c4b2035bead5b139" category="paragraph">`network interface modify ｛ -home-port &lt;port_on_node1&gt; -home-node &lt;node1&gt; -role data ｝ -home-port &lt;new_home_port_on_node3 &gt;`</block>
  <block id="0a3646df26d19fcc6a0ee6929a6ea7be" category="list-text">将 LIF 重新添加到端口集：</block>
  <block id="6427a184f2e8fa2884ff0d3eebe006ce" category="paragraph">`portset add -vserver &lt;vserver_name&gt; -portset &lt;portset_name&gt; -port-name &lt;port_name&gt;`</block>
  <block id="d78bc2532b76c692bc747f0206ce2369" category="admonition">您需要确保将 SAN LIF 移动到与原始端口具有相同链路速度的端口。</block>
  <block id="3920c87ab45883a20b7f4aff2eb8f6f9" category="list-text">将所有 LIF 的状态修改为 "up" ，以便 LIF 可以在节点上接受和发送流量：</block>
  <block id="18cd286e7e66b1d7cc6dd09759e173e8" category="paragraph">`network interface modify -home-port &lt;port_name&gt; -home-node &lt;node3&gt;-lif data -status-admin up`</block>
  <block id="95ecba7b6bea27535042e5096f91549c" category="list-text">在任一节点上输入以下命令并检查其输出，以验证 LIF 是否已移至正确的端口，以及 LIF 的状态是否为 "up" ，具体方法是在任一节点上输入以下命令并检查输出：</block>
  <block id="fb56fd816b904059bf738c97552e7950" category="paragraph">`network interface show -home-node &lt;node3&gt; -role data`</block>
  <block id="2e0b337c1378c2a234102f1198e8adba" category="list-text">[[man_lif_verif_3_step11]] 如果任何 LIF 已关闭，请通过为每个 LIF 输入以下命令将 LIF 的管理状态设置为 "up" ：</block>
  <block id="d69a84eb389c545291c152fff3de9999" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -status-admin up`</block>
  <block id="78036b97ca6165fc32dd17167726e77f" category="list-text">向 NetApp 发送 node1 的升级后 AutoSupport 消息：</block>
  <block id="b430ac926445a5f58cb4f6464a0ee269" category="paragraph">`ssystem node AutoSupport invoke -node &lt;node3&gt; -type all -message "node1 successfully uped" from &lt;platform_old&gt; to &lt;platform_new&gt;"`</block>
  <block id="218c1c22487e3cea0e94aedcabb843e2" category="paragraph">您必须具有保存在中的 node1 中的 FC 端口设置值 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block>。</block>
  <block id="dfec8ed00cbb51821de82d335a0ba98b" category="paragraph">如果您的系统没有 FC 配置，则可以跳过此部分。如果您的系统具有板载 UTA/UTA2 端口或 UTA/UTA2 卡，则可以在中对其进行配置 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block>。</block>
  <block id="53d8e9a89e7df0f2e9d3d1647aa47fa3" category="admonition">* 重要信息 * ：如果您的系统具有存储磁盘，请在集群提示符处输入本节中的命令。如果您使用的是 V 系列系统或 FlexArray 虚拟化软件并连接到存储阵列，请在维护模式下在此部分中输入命令。</block>
  <block id="9dc09e5212ac728648450db66b8f3668" category="list-text">【第 1 步】执行以下操作之一：</block>
  <block id="fb0e67401f3473ee656312bb98935878" category="cell">转至 <block ref="4e8d6367d01e7a88b5b6b591ecf5d6db" category="inline-xref-macro-rx"></block></block>
  <block id="32781b45218385923d91bc21b08c6b68" category="cell">转至 <block ref="79ba4e2202506d0f17b14ab90d196879" category="inline-xref-macro-rx"></block></block>
  <block id="838b228ad3b40461ad1dc100f5671807" category="list-text">【 man_config_3_step2]] 启动 node3 和访问维护模式：</block>
  <block id="7e6f8de582e2388fb39a5c5c26caa64f" category="list-text">【第 3 步】执行以下操作之一：</block>
  <block id="534ca774217e84be533a1aad9cf31936" category="cell">输入以下命令： `ssystem node hardware unified-connect show`</block>
  <block id="fe780061729afd0c0f2800209c7c7bf6" category="cell">是 V 系列系统或具有 FlexArray 虚拟化软件并连接到存储阵列。</block>
  <block id="b7911a4b9aaa4584cf3072f4df9d0033" category="cell">输入以下命令 `ucadmin show`</block>
  <block id="d0f2b99979906267ea4c720be3fdf8c1" category="list-text">【第 4 步】将 node3 的 FC 设置与先前从 node1 捕获的设置进行比较。</block>
  <block id="befe3449c034cb6f4631649c7a4ed066" category="list-text">[[man_config_3_step5]] 执行以下操作之一：</block>
  <block id="cb4a7a262c1057120daeee2df7839247" category="cell">与您在 node1 上捕获的相同</block>
  <block id="2b56e7490fdbb3cfe1904501429274b7" category="cell">转至 <block ref="c6c9a381b48f60f002c0199635146c23" category="inline-xref-macro-rx"></block>。</block>
  <block id="2cc211fd01662dba325fa6afb2cb24dc" category="cell">与您在 node1 上捕获的不同</block>
  <block id="3a3387d05eb4dc59724516e63ce89fe1" category="cell">转至 <block ref="cb1e6c315615cb7630d3b8a437827bc2" category="inline-xref-macro-rx"></block>。</block>
  <block id="8858cbf1016a885e6783f73cde18ddf4" category="list-text">【 man_config_3_step6]] 执行以下操作之一：</block>
  <block id="eef9069309a77ac006f5011dca4b9f9a" category="paragraph">根据需要输入以下命令之一，修改 node3 上的 FC 端口：</block>
  <block id="2ce4edae9e9c97b20fed47972e1d4caf" category="list-text">要对目标端口进行编程： `ssystem node hardware unified-connect modify -type | -t target -adapter &lt;port_name&gt;`</block>
  <block id="51587a6d058865620a3fb14c6d8c9d9a" category="list-text">要对启动程序端口进行编程： `ssystem node hardware unified-connect modify -type | -t initiator -adapter &lt;port_name&gt;`</block>
  <block id="f785fd1b7c2d6c5d48b8a31065275b2a" category="cell">根据需要输入以下命令，修改 node3 上的 FC 端口： `ucadmin modify -m fc -t initiator -f &lt;adapter_port_name&gt;` ` -t` 是 FC4 类型，目标或启动程序。* 注 * ：必须将 FC 端口编程为启动程序。</block>
  <block id="0f46f9b9f7235f322cd04b338ecda49c" category="list-text">【第 7 步】执行以下操作之一：</block>
  <block id="85a79ca9227090c23bb3d6d14dbbe0af" category="cell">输入以下命令并检查输出，以验证新设置： `ssystem node hardware unified-connect show`</block>
  <block id="2c6e937b15ebe6468c586dd1b4eb466a" category="list-text">【第 8 步】输入以下命令退出维护模式：</block>
  <block id="b3a919f35f16fa3a39c85eac5d885d2f" category="list-text">【第 9 步】输入命令后，请等待系统在启动环境提示符处停止。</block>
  <block id="c62d6d151dbb06716a8276f4f8bb89e0" category="list-text">【第 10 步】执行以下操作之一：</block>
  <block id="648ad8a1b1818127b7b933420429d236" category="cell">如果要升级的系统 ...</block>
  <block id="8e49fbf8016e97e15077debef6c06b54" category="cell">是 V 系列系统或具有运行集群模式 Data ONTAP 8.3 的 FlexArray 虚拟化软件</block>
  <block id="51ae224ccdb747cc08ff98ed97fed51f" category="cell">在启动环境提示符处启动 node3 并访问维护： `boot_ontap maint`</block>
  <block id="8cf0032370f0f9233266234c2a7feab7" category="cell">不是 V 系列系统或没有 FlexArray 虚拟化软件</block>
  <block id="7e422d66a2b07e1e654868dee6aae687" category="cell">在启动环境提示符处启动 node3 ： `boot_ontap`</block>
  <block id="1509937ac092a7690a93d056a0c33d58" category="list-text">【 man_config_3_step11]] 执行以下操作之一：</block>
  <block id="3e5bf76136102b434c2a000604dc77c1" category="list-text">如果 node3 具有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请转至 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block>。</block>
  <block id="306e854e226a650b7acec40ba5a0e249" category="list-text">如果 node3 没有 UTA/UTA2 卡或 UTA/UTA2 板载端口，请跳过 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block> 然后转到 <block ref="3b6c063a8efbc88c969c7838f0611434" category="inline-link-macro-rx"></block>。</block>
  <block id="6c804c4adac8740743dd6f41da471795" category="list-text">如果 node3 具有卡或板载端口，请转至 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block>。</block>
  <block id="49844625e7eb80b095f9d3c525f8cba6" category="list-text">如果 node3 没有卡或板载端口，请跳过 <block ref="574c49ad3466f1bed21aff7050a30e36" category="inline-xref-macro-rx"></block>，并返回到 _Install 和 boot node3_ ，然后在继续 <block ref="a4103675c41ea57f7287e0804dd0c9dd" category="inline-link-macro-rx"></block>。</block>
  <block id="a55f4c112389aef5c1095610759695f4" category="paragraph">您需要在机架中安装 node4 ，将 node2 连接传输到 node4 以及启动 node4 。此外，还必须重新分配任何 node2 备用磁盘，属于 root 的任何磁盘以及先前未重新定位到 node3 的任何非根聚合。</block>
  <block id="46bf31662c49b18f28ea137563eae20a" category="paragraph">如果 node4 的 ONTAP 9 版本与 node2 上安装的版本不同，则需要对其进行网络启动。安装 node4 后，从 Web 服务器上存储的 ONTAP 9 映像启动它。然后，您可以按照中的说明将正确的文件下载到启动介质设备，以供后续系统启动 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block></block>
  <block id="7450170c152f247fc2c9a5ece1d25571" category="paragraph">但是，如果 node4 安装的 Data ONTAP 9 版本与 node2 上安装的版本相同或更高，则不需要对其执行网络启动。</block>
  <block id="02a3537f6e96697842c87c410e1169a9" category="paragraph">* 重要 * ：</block>
  <block id="44a1dd334ad3ac6220ea0adf17519961" category="list-text">如果要升级连接到存储阵列的 V 系列系统或使用 FlexArray 虚拟化软件的系统，则需要完成 <block ref="a48f24f7fd083b3ec1c1fb7f5bee1e25" category="inline-xref-macro-rx"></block> 到 <block ref="23a128901edc6abd74721071977e73e9" category="inline-xref-macro-rx"></block>，请将此部分保留在 <block ref="4b3dcb4f5ad67f2f001c91135169a837" category="inline-xref-macro-rx"></block> 并按照中的说明进行操作 <block ref="488c6e462745f03d8c1dfb3ba61f7258" category="inline-link-macro-rx"></block> 根据需要在维护模式下输入命令。然后，您需要返回到此部分并通过恢复操作步骤 <block ref="9b924d5c1ba14dd46bf7c40da5a15e7c" category="inline-xref-macro-rx"></block>。</block>
  <block id="78b1d5bad885b3107f106e5d1a9b18ec" category="list-text">但是，如果要升级具有存储磁盘的系统，则需要完成整个部分，然后继续执行部分 <block ref="488c6e462745f03d8c1dfb3ba61f7258" category="inline-link-macro-rx"></block>，在集群提示符处输入命令。</block>
  <block id="bdb96da2d8e74dfce89eef174e77991a" category="list-text">[[man_install4_Step1]] 执行以下操作之一：</block>
  <block id="668ee630125cb736935532180dec5496" category="cell">如果 node4 将位于 ...</block>
  <block id="162e71035e50cc882a8bc6f9ff5b49f2" category="cell">与 node3 不同的机箱</block>
  <block id="fd915b6d9d7d8df5863bf1a398fcf38a" category="cell">转至 <block ref="5da993404245519b124ccd5cfdc8f96e" category="inline-xref-macro-rx"></block>。</block>
  <block id="517089a54c66f01f0ee8cb8683dad1ec" category="cell">具有 node3 的同一机箱</block>
  <block id="9a56a499535dc46c81b504689b6f1584" category="cell">跳过步骤 2 和 3 ，然后转到 <block ref="d70dd93eaf2d4e4f4bee874c28b01d22" category="inline-xref-macro-rx"></block>。</block>
  <block id="409539264ec665ff1676a423db4f5983" category="list-text">[[man_install4_Step2]] 确保 node4 具有足够的机架空间。</block>
  <block id="b8b0bf4a502958083dc62a5c96442944" category="paragraph">如果 node4 与 node3 位于不同的机箱中，则可以将 node4 与 node2 放在同一位置。如果 node3 和 node4 位于同一机箱中，则 node4 已位于其相应的机架位置。</block>
  <block id="b2a26edcdea9e0bc9d1a1f149aaa56af" category="list-text">【 man_install4_Step4]] 为节点 4 布线，将连接从节点 2 移动到节点 4 。</block>
  <block id="9f13bb9f267a0b057f115598b95b4a04" category="paragraph">以下参考资料可帮助您正确进行缆线连接。转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 以链接到它们。</block>
  <block id="268eeab46cc4cbb65d5e580b239819b7" category="list-text">node4 平台的 _Installation and Setup Instructions_or _FlexArray 虚拟化安装要求和参考 _ 。</block>
  <block id="d5a449fe0916c29f3c21ed516c3a0a85" category="list-text">相应的磁盘架指南。</block>
  <block id="04319c214e3e53544ee494bc7426c28f" category="list-text">ONTAP 9 高可用性配置指南 _</block>
  <block id="19c5c8c6d8397114c1994a6c3eb88f1f" category="paragraph">使用缆线连接以下连接：</block>
  <block id="6b3c36f97ba6ae6e5b790f8c06f76595" category="admonition">您无需将互连卡 /FC_VI 卡或互连 /FC_VI 缆线连接从 node2 移至 node4 ，因为大多数平台型号都具有唯一的互连卡型号。</block>
  <block id="7c6dcbfbd814e3914af912fc227236db" category="cell">如果 node4 位于 ...</block>
  <block id="0eac7849b27808b92dfd85fd93d5adf9" category="cell">与 node3 相同的机箱</block>
  <block id="ebfef1d5b820c6361e45e99afc605aff" category="cell">转至 <block ref="4b3dcb4f5ad67f2f001c91135169a837" category="inline-xref-macro-rx"></block>。</block>
  <block id="23651fb868295760fbf6e0040b0debb0" category="cell">转至 <block ref="38932d9b2776291a7bec718b723ae495" category="inline-xref-macro-rx"></block>。</block>
  <block id="84857d961b292bb9faee31d20a2e4320" category="list-text">【 man_install4_Step6]] 打开 node4 的电源，然后按 `Ctrl-C` 以访问启动环境提示符来中断启动。</block>
  <block id="2533698a45ba6cab05df3bd9337b544f" category="admonition">启动 node4 时，您可能会看到以下消息：</block>
  <block id="6904f97422da010c9982167637cc6d56" category="list-text">【 ｛ man_install4_Step7]] 如果您在步骤 6 中看到警告消息，请执行以下操作：</block>
  <block id="abb5e8621f032d746c9aa9b35f472595" category="list-text">检查是否存在任何可能指示 NVRAM 电池电量低以外问题的控制台消息，如有必要，请采取任何必要的更正措施。</block>
  <block id="8ece0169cd074b513037985b1656b1cd" category="list-text">让电池充电并完成启动过程。</block>
  <block id="30567eb6dc573926907b3bb63db7137a" category="admonition">* 警告：不要覆盖此延迟。如果不允许电池充电，可能会导致数据丢失。 *</block>
  <block id="945c73c9ea193c92dd8b512126669f13" category="list-text">[[man_install4_Step8]] 执行以下操作之一：</block>
  <block id="a2a7998a5450e891bb5464c1204815d8" category="cell">跳过第 9 步到第 14 步，然后转到 <block ref="5c1f19cc6cb716956fba505fb903a21f" category="inline-xref-macro-rx"></block>。</block>
  <block id="0366496afb0bd008f8fb19b74f53ec71" category="inline-link-macro">在节点 4 上配置 FC 端口</block>
  <block id="7973536954a566dd7a59dc4fa1580481" category="list-text">转至 _set the FC or UTA/UTA2 configuration on node4_ 一节并完成各节 <block ref="5dc4a26bdcd4279b0919835bab13d0db" category="inline-link-macro-rx"></block> 和 <block ref="b0f6547feb9924da912bf4fa3357e2fc" category="inline-link-macro-rx"></block>，根据您的系统情况而定。</block>
  <block id="f01b0d07fd3bcdce42fd5cf6a8f46551" category="list-text">返回到此部分，完成从开始的其余步骤 <block ref="9b924d5c1ba14dd46bf7c40da5a15e7c" category="inline-xref-macro-rx"></block>。</block>
  <block id="0ecbf7c74e381542280cb5ae382623c0" category="paragraph">* 重要信息 * ：在 V 系列系统上启动 Data ONTAP 之前，您必须重新配置 FC 板载端口， UTA/UTA2 板载端口和 UTA/UTA2 卡。</block>
  <block id="562a6369849944020611b8a9540b9c5c" category="list-text">【 man_install4_Step9]] 将新节点的 FC 启动程序端口添加到交换机分区。</block>
  <block id="a68de9b3c6fcb14f9c96b6e558ca71f8" category="list-text">修改与存储阵列上的阵列 LUN 关联的主机或卷组中的全球通用端口名称（ WWPN ）值。</block>
  <block id="1ad5461b16a79391d48cbca2383e0c9e" category="list-text">输入以下命令并检查其输出，以验证阵列 LUN 现在是否对 node4 可见：</block>
  <block id="6b3585cc5d8743bbae5204f3097641c4" category="paragraph">`ssysconfig -v`</block>
  <block id="134f75a624b82855271656ebc0cf2d5f" category="paragraph">系统将显示每个 FC 启动程序端口可见的所有阵列 LUN 。如果阵列 LUN 不可见，则您不能在本节稍后将磁盘从 node2 重新分配到 node4 。</block>
  <block id="05ecdb384acc604bb6388efe9a979597" category="list-text">按 `Ctrl-C` 以显示启动菜单，然后选择维护模式。</block>
  <block id="a2835e58397213dc9bedb9afe05d29d2" category="list-text">在维护模式提示符处，输入以下命令：</block>
  <block id="9b30a77b62fcc76d557f789dd6ce3167" category="list-text">为 ONTAP 配置 node4 ：</block>
  <block id="70dbb49a6cbad96a6befa2a87cf2c5ce" category="paragraph">`set-defaults`</block>
  <block id="70fa8a94fae594e32ef99991313ee137" category="list-text">如果在此配置中使用 FDE ，则必须将 `setenv bootarg.storageencryption.support` 变量设置为 `true` ，并将 `kmip.init.maxwait` 变量设置为 `off` ，以避免在加载 node2 配置后出现启动环路：</block>
  <block id="c769624c49a19cf249ae2dabe50fafd5" category="list-text">如果 node4 上安装的 ONTAP 版本与 node2 上安装的 ONTAP 9 版本相同或更高，请输入以下命令：</block>
  <block id="bd525e59dc1c481092f22bdaeff4a9cb" category="cell">node4 上的 ONTAP 版本不正确或当前不正确</block>
  <block id="d4d1f4ca7806007366aa98184f062124" category="inline-xref">第 20 步</block>
  <block id="642ae729bd75051692412fd6ebaf2526" category="cell">转至 <block ref="1fde564298826640b3bacb4260e3eaea" category="inline-xref-macro-rx"></block>。</block>
  <block id="9b66895c756fece1df6c42e12763649b" category="cell">node4 上的 ONTAP 版本正确或最新</block>
  <block id="7769822edfc550f3ba37429715882554" category="inline-xref">第 25 步</block>
  <block id="107c908e64ebe1cdac15562994203122" category="cell">转至 <block ref="aadd3e12a76cc16c765ef6c4ab9ed890" category="inline-xref-macro-rx"></block>。</block>
  <block id="76b2a354a862c0069407c912fb51ee50" category="list-text">【 man_install4_Step20]] 通过选择以下操作之一来配置网络启动连接。</block>
  <block id="819576ac2beda71a5f64c74e58833045" category="admonition">您应使用管理端口和 IP 地址作为网络启动连接。请勿使用数据 LIF IP 地址，否则在执行升级期间可能会发生数据中断。</block>
  <block id="4a8c92edcf5608186b4e424977f98a73" category="cell">在启动环境提示符处输入以下命令，以自动配置连接： `ifconfig e0M -auto`</block>
  <block id="6b3f72590e2ba575765b270b75ec3265" category="cell">在启动环境提示符处输入以下命令以手动配置连接： `ifconfig e0M -addr=&lt;filer_addr&gt; mask=&lt;netmask&gt; -gw=&lt;gateway&gt; dns=&lt;dns_addr&gt; domain=&lt;dns_domain&gt;` ` &lt;filer_addr&gt;` 是存储系统的 IP 地址。` &lt; 网络掩码 &gt;` 是存储系统的网络掩码。` &lt; 网关 &gt;` 是存储系统的网关。` &lt;dns_addr&gt;` 是网络上名称服务器的 IP 地址。` &lt;dns_domain&gt;` 是域名服务（ DNS ）域名。如果使用此可选参数，则无需在网络启动服务器 URL 中使用完全限定域名；您只需要服务器的主机名。* 注 * ：接口可能需要其他参数。有关详细信息，请在固件提示符处输入 `help ifconfig` 。</block>
  <block id="a1e9c2458084c8aed432506005e0789e" category="cell">`netboot \http://&lt;web_server_ip/path_to_webaccessible_directory&gt;/netboot/kernel`</block>
  <block id="7e0c898eb7a2157f9a4fe767ff353ea1" category="cell">`netboot \http://&lt;web_server_ip/path_to_webaccessible_directory/ontap_version&gt;_image.tgz`</block>
  <block id="feed6e71880a4cdb6f484b72b59ad1c7" category="paragraph">` &lt;path_to_the_web-accessible_directory&gt;` 应指向您在中下载 ` &lt;ontap_version&gt;_image.tgz` 的位置 <block ref="d7ca8bd1bdacba48998a89c59527e756" category="inline-link-macro-rx"></block> 在 _prepare for netboot_ 一节中。</block>
  <block id="309791cba48d347af2b367032b3dd97b" category="list-text">从启动菜单中，选择 `option （ 7 ） Install new software first` 。</block>
  <block id="0b2229e3a518ca5320ae9e1f22775ad9" category="paragraph">此菜单选项可下载新的 Data ONTAP 映像并将其安装到启动设备中。</block>
  <block id="c0c1ca8a9ddeae72e1e2be38243a2522" category="paragraph">请忽略以下消息：</block>
  <block id="af7a0d97078a38e1bd7d89c61066724a" category="paragraph">` " 此操作步骤不支持在 HA 对上进行无中断升级 "`</block>
  <block id="52e732ba64db04aee6e7ad74ff701940" category="paragraph">注意适用场景可无中断升级 Data ONTAP ，而不是升级控制器。</block>
  <block id="3649c3b28305249c1b3207c6087eaedc" category="list-text">【 ｛ man_install4_step23]] 如果系统提示您继续运行操作步骤，请输入 y ，当系统提示您输入软件包时，请输入 URL ：</block>
  <block id="ad4f522a516d9a5742a3b1abdd5d7e77" category="paragraph">` http://&lt;web_server_ip/path_to_web-accessible_directory/ontap_version&gt;_image.tgz`</block>
  <block id="3678fe02acf5ec3ff8f4fbebc3fd7a4d" category="list-text">完成以下子步骤：</block>
  <block id="037fcad07615e2da823be3a48a35cfb8" category="paragraph">控制器模块重新启动，但停留在启动菜单处，因为启动设备已重新格式化，需要还原配置数据。</block>
  <block id="212239c0a7a5196ffbd8cc3895cfce05" category="list-text">【 man_install4_Step25]] 从启动菜单中选择维护模式 `5` ，并在系统提示您继续启动时输入 `y` 。</block>
  <block id="88dd4b794782fce5edb7683e13199311" category="list-text">在继续操作之前，请转到 <block ref="488c6e462745f03d8c1dfb3ba61f7258" category="inline-link-macro-rx"></block> 对节点上的 FC 或 UTA/UTA2 端口进行任何必要的更改。执行这些部分中建议的更改，重新启动节点并进入维护模式。</block>
  <block id="7e3544f15733cd05bc2830419b4be7f9" category="list-text">输入以下命令并检查输出以查找 node4 的系统 ID ：</block>
  <block id="b42167fc8c56e26bc5bde99cbcb98104" category="paragraph">`d` 展示 -A</block>
  <block id="4e974a66c77c6d900d32abc8f0338440" category="paragraph">系统将显示节点的系统 ID 及其磁盘信息，如以下示例所示：</block>
  <block id="fae986fa29654ebe6966932d05eb132d" category="inline-link-macro">将非根聚合从 node2 重新定位到 node3</block>
  <block id="6ebd270373edc34882879e2c2ed9e67b" category="list-text">重新分配 node2 的备用磁盘，属于根的磁盘以及第节前面未重新定位到 node3 的任何非根聚合 <block ref="2eb3ddacc3cdbca929068de80db9b0b7" category="inline-link-macro-rx"></block>：</block>
  <block id="f6083059f6516202ed7ac1092bed861b" category="cell">Disk type</block>
  <block id="65f83791dfc3308f8c98325d44977d10" category="cell">运行命令 ...</block>
  <block id="8e209d660098d73b07642a1950888f1d" category="cell">共享磁盘</block>
  <block id="a3432db44a757895f3eb3a1c9f4d3cea" category="cell">`dreassign -s` ` &lt;node2_sysid&gt; -d &lt;node4_sysid&gt; -p &lt;node3_sysid&gt;`</block>
  <block id="567c7db5eb132ed0419b894d763f1872" category="cell">无共享</block>
  <block id="cb3bccddce7862ce1908af49d7e9df63" category="cell">`disks disk reassign -s` ` &lt;node2_sysid&gt; -d &lt;node4_sysid&gt;`</block>
  <block id="b95982609bcaa66a9948629f87fe8589" category="inline-link-macro">第 10 步</block>
  <block id="7f9877f92749af42ef730feeda0dba70" category="paragraph">对于 ` &lt;node2_sysid&gt;` 值，请使用中捕获的信息 <block ref="09a261426dbc4b06f375c3dc720b5b79" category="inline-link-macro-rx"></block> 记录 node2 信息 _ 部分的。对于 ` &lt;node4_sysid&gt;` ，请使用中捕获的信息 <block ref="9c7125eb7b33f2cb03297a560d0660b0" category="inline-xref-macro-rx"></block>。</block>
  <block id="2e55dc5dee1972467c8f86adee9b26a8" category="admonition">只有当存在共享磁盘时，才需要在维护模式下使用 ` -p` 选项。</block>
  <block id="423897eae7d5975e08caad3349a2ff49" category="paragraph">使用 `ddisk reassign` 命令将仅重新分配 ` &lt;node2_sysid&gt;` 为当前所有者的磁盘。</block>
  <block id="685b8dfe5883c0cc4f183236c52e6cdd" category="paragraph">当系统要求中止磁盘重新分配时，输入 `n` 。</block>
  <block id="c8baecc7560f46020b0d73d658566eab" category="paragraph">当系统要求您中止磁盘重新分配时，您必须按照以下步骤所示问题解答一系列提示：</block>
  <block id="35c143d9885250e0128441d72be169dd" category="list-text">输入 `y` 以继续。</block>
  <block id="906012ab50dee220a65fb1458eb58128" category="list-text">输入 `y` 以允许更新磁盘所有权。</block>
  <block id="0bcba60a38db3b0f12b08821c6ae56fc" category="list-text">如果要从具有外部磁盘的系统升级到支持内部和外部磁盘的系统（例如， A800 系统），请将 node4 设置为 root ，以确保它从 node2 的根聚合启动。</block>
  <block id="81d274af1a54983c64b259dfc78b1c9f" category="admonition">* 警告：必须按所示的确切顺序执行以下子步骤；否则可能发生原因会导致中断甚至数据丢失。 *</block>
  <block id="1ca7ffcdba47b0e1e7fe67ed3e918c17" category="list-text">检查 node2 聚合的整体状态：</block>
  <block id="9cf332fc3e49cdbc8c4e5181c30ae161" category="list-text">输入以下命令并观察输出，以验证控制器和机箱是否配置为 `ha` ：</block>
  <block id="af2a502808ef81f73370e9e64784659d" category="paragraph">系统会在 PROM 中记录它们是采用 HA 对还是独立配置。独立系统或 HA 对中的所有组件的状态都必须相同。</block>
  <block id="92435116502eec5121875eb86e01c666" category="paragraph">如果控制器和机箱未配置为 `ha` ，请使用以下命令更正配置：</block>
  <block id="2e89fd69efdc517bb6463b3444e009df" category="paragraph">`ha-config modify chassis ha` 。</block>
  <block id="efa973aed3146abf01226e85a9e5f816" category="paragraph">如果您使用的是 MetroCluster 配置，请使用以下命令更正此配置：</block>
  <block id="27dae2ee8e632216c89579f651774f45" category="paragraph">`ha-config modify chassis mcc`</block>
  <block id="79d038b849b0e37c67ee77c0b56d066f" category="list-text">销毁 node4 上的邮箱：</block>
  <block id="7f7deb46e1585e846e2fd054b1b2af5a" category="paragraph">`m邮箱销毁本地`</block>
  <block id="97c16f2bd68041ac79ef06049407d0c7" category="list-text">退出维护模式：</block>
  <block id="953d8f613cc775b0d7904f99aec7a052" category="list-text">在 node3 上，检查系统日期，时间和时区：</block>
  <block id="e3f03a007dc36d2b8067017bfe222275" category="list-text">在 node4 上，在启动环境提示符处检查日期：</block>
  <block id="02bb70865b20c57eb319b73c84b5fd7f" category="list-text">在 node4 上，在启动环境提示符处检查时间：</block>
  <block id="c73ed66a3414025099d74b00d7536036" category="list-text">验证配对系统 ID 是否设置正确，如中所述 <block ref="6f4b83e10b4758eab71105c01c130b34" category="inline-xref-macro-rx"></block> 在选项下。</block>
  <block id="eb91daa92a7cd6e3d0f28a92df381e46" category="paragraph">`setenv partner-sysid &lt;node3_sysid&gt;`</block>
  <block id="0f463f9540d67b2794aa78893f83b8aa" category="list-text">在启动环境提示符处输入启动菜单：</block>
  <block id="ca0b24352c36c0cc73393a18e38ead22" category="list-text">在启动菜单中，在提示符处输入 `6` ，选择选项 * （ 6 ） Update flash from backup config* 。</block>
  <block id="23fc33b520f7242c5f2fb610689e9e8c" category="list-text">在提示符处输入 `y` 。</block>
  <block id="d9f991b0b3aa3c03080efb5d84a35c57" category="paragraph">启动正常进行，系统会提示您确认系统 ID 不匹配。</block>
  <block id="88d91937c0736919ae3483a3cb1e1f7e" category="admonition">系统可能会重新启动两次，然后才会显示不匹配警告。</block>
  <block id="c3a51f505b0a44650db3707558ddeefc" category="list-text">确认不匹配。节点可能会在正常启动之前完成一轮重新启动。</block>
  <block id="cc7dd78f409b3f942015e8a65f2c11e8" category="list-text">登录到 node4 。</block>
  <block id="44bbe343e421273c157c5d1c833a433b" category="list-text">【第 1 步】通过在任一节点上输入以下命令并捕获输出，列出 node2 不拥有的所有 NAS 数据 LIF ：</block>
  <block id="690cd6839e2f529e9d1be34efa6f9791" category="paragraph">`network interface show -role data -curr-node &lt;node2&gt;-is-home false -home-node &lt;node3&gt;`</block>
  <block id="831368d2ac042989f939504faf6cdf51" category="list-text">【第 2 步】执行以下操作之一：</block>
  <block id="423e99aaa66fb1d5698571ceb7787197" category="cell">如果 node1...</block>
  <block id="4273a0997ee0d6df35945422d9f57ec6" category="cell">已配置接口组或 VLAN</block>
  <block id="05aa25da736018fa33e8cc8667b1e0f1" category="cell">转至 <block ref="fa7afcf3541ce640333b443234c694da" category="inline-xref-macro-rx"></block>。</block>
  <block id="31a8cab14d1d7febef6f8053dcd9552d" category="cell">未配置接口组或 VLAN</block>
  <block id="09b00a0d82c468f9038424665ba3a692" category="cell">跳过步骤 3 ，然后转到 <block ref="a5ee73999909412ce73c7e745a3cb5c2" category="inline-xref-macro-rx"></block>。</block>
  <block id="8c5ada6be3ca66f32616fd020694ec45" category="list-text">[[man_lif_verif_3_step3]] 执行以下子步骤，将最初位于 node1 上的接口组和 VLAN 上托管的任何 NAS 数据 LIF 从 node2 迁移到 node3 ：</block>
  <block id="fd8bd88e1dcef54d04236465f2b87693" category="list-text">【 man_lif_verif_3_substepa 】通过为每个 LIF 输入以下命令，将先前属于接口组中 node1 的 node2 上托管的任何数据 LIF 迁移到 node3 上能够在同一网络上托管 LIF 的端口：</block>
  <block id="494973c7f1f28c90b456a3998b09b84a" category="paragraph">`network interface migrate -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -destination-node &lt;node3&gt; – destination-port &lt;netport_ifgrp&gt;`</block>
  <block id="d280fa5d8e575828d8f638790f296c00" category="inline-xref">子步骤 A</block>
  <block id="630798093592f408d28e43d1a5875c4f" category="list-text">在中修改 LIF 的主端口和主节点 <block ref="ffe3d697e3afcad8e9e0e14f978885cb" category="inline-xref-macro-rx"></block> 输入以下命令，将 LIF 设置为当前托管 LIF 的端口和节点，每个 LIF 设置为一次：</block>
  <block id="7c38b19f61b4cf300416bf64071c3a06" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -home-node &lt;node3&gt; -home-port &lt;netport_ifgrp&gt;`</block>
  <block id="569a27e0dcf14d4091837fcac510315b" category="list-text">【 man_lif_verif_3_substepc]] 通过为每个 LIF 输入以下命令，将先前属于 VLAN 端口上 node1 的 node2 上托管的任何数据 LIF 迁移到 node3 上能够在同一网络上托管 LIF 的端口：</block>
  <block id="9ad3609f9c94e5d3764345c4a95d6e85" category="inline-xref">子步骤 c</block>
  <block id="acdda21dc8c7ea3a875f05cfa2d42fb8" category="list-text">在中修改 LIF 的主端口和主节点 <block ref="0ba0c3832c194a002bde244af82cc6e8" category="inline-xref-macro-rx"></block> 输入以下命令，将 LIF 设置为当前托管 LIF 的端口和节点，每个 LIF 设置为一次：</block>
  <block id="f0de8680ab31eb7304741a5d6c335bce" category="list-text">[[man_lif_verif_3_step4]] 执行以下操作之一：</block>
  <block id="9b9179b830c575fb1e672a3bed56f248" category="cell">如果集群配置为 ...</block>
  <block id="c07ee5debf5f3a3fef16c1ee5e8e4942" category="cell">NAS</block>
  <block id="a8737f289941aae34c7bdcaf30a6f49c" category="cell">完成 <block ref="5bf3f4cb83f848c38272cdda13b03424" category="inline-xref-macro-rx"></block> 和 <block ref="5afb3629d2897001a44bd62c86195932" category="inline-xref-macro-rx"></block>，跳过步骤 7 并完成 <block ref="6f2b0e2c7df1e7ce442716f4a9ac5045" category="inline-xref-macro-rx"></block> 到 <block ref="d664f7f06c19c1d6c4e1d7d9cba27620" category="inline-xref-macro-rx"></block>。</block>
  <block id="62a0282d39568be094470486eaf70c4f" category="cell">SAN</block>
  <block id="e7bc8e4a360dbc42e9759f708ed40f33" category="cell">禁用节点上的所有 SAN LIF 以将其关闭以进行升级： `network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -home-node &lt;node_to_upgrade&gt; -home-port &lt;netport_ifgrp&gt; -status-admin down`</block>
  <block id="9049f1bbc92896381d7b5ffdc386e3b2" category="list-text">在其中一个节点上输入以下命令，以启用存储故障转移：</block>
  <block id="4d090b6b4178c6d326829a98b05a4cd7" category="paragraph">`storage failover modify -enabled true -node &lt;node3&gt;`</block>
  <block id="9d070d121ee26abdb5d314d6fff4c15c" category="list-text">验证是否已启用存储故障转移：</block>
  <block id="44b65ecdfbcd9fda48c21d17aae6347e" category="cell">如果集群为 ...</block>
  <block id="73b5646d22daa7a0c1b15cb75822045d" category="cell">双节点集群</block>
  <block id="f58285c881fa273f24181ed6fc4f5253" category="cell">在任一节点上输入以下命令以启用集群高可用性： `cluster ha modify -configured true`</block>
  <block id="bbe624d4e7e26aa8777e96c55a0041f3" category="cell">包含两个以上节点的集群</block>
  <block id="97b53f9857ac13c0da869099d031be38" category="cell">转至 <block ref="822b8237ef75a77ff6f775dfc30b209c" category="inline-xref-macro-rx"></block>。</block>
  <block id="c923a045fa01384244a7d722820ecb7f" category="list-text">【 man_ense_setup_Step4]] 输入以下命令并检查输出，以验证 node3 和 node4 是否属于同一集群：</block>
  <block id="993ec2fcd18633816cf0d4d290fcf5a3" category="list-text">输入以下命令并检查输出，以验证 node3 和 node4 是否可以访问彼此的存储：</block>
  <block id="00c012d0f7127c31c470ac3c1c76aa44" category="list-text">输入以下命令并检查输出，以验证 node3 和 node4 均不拥有集群中其他节点拥有的主数据 LIF ：</block>
  <block id="2a6d96821a4ce6866da866e48a1ece2a" category="paragraph">如果 node3 或 node4 拥有集群中其他节点所拥有的主数据 LIF ，请使用 `network interface revert` 命令将数据 LIF 还原到其主所有者。</block>
  <block id="f67d0a54b752ca4f669625b9f2eba648" category="list-text">确认 node3 拥有 node1 中的聚合，而 node4 拥有 node2 中的聚合：</block>
  <block id="b7836a7a1972d5f8803e2f44bd3cb658" category="paragraph">`storage aggregate show -owner-name &lt;node3&gt;` `storage aggregate show -owner-name &lt;node4&gt;`</block>
  <block id="862da4c0b3b19ba62c050373943cd909" category="list-text">确定是否有任何卷脱机：</block>
  <block id="4655a1857691d25ac0c12a710dad5454" category="paragraph">`volume show -node &lt;node3&gt; -state offline` `volume show -node &lt;node4&gt; -state offline`</block>
  <block id="183048ad5f29710efbac355627777865" category="inline-link-macro">第 19 步（ d ）</block>
  <block id="be3ae65f9ab44c1be767b14ddc884bfc" category="list-text">如果任何卷处于脱机状态，请将其与您在中捕获的脱机卷列表进行比较 <block ref="f226f1513a3b2dc8065e1f4d6987a247" category="inline-link-macro-rx"></block> 在 _Prepare the nodes for upgrade" 中，根据需要输入以下命令使任何脱机卷联机，每个卷一次：</block>
  <block id="5d41e09cfbf05ac79dc026cd1e32857c" category="list-text">通过为每个节点输入以下命令，为新节点安装新许可证：</block>
  <block id="8502756d136a7fbd63f0576ce096751b" category="paragraph">`ssystem license add -license-code &lt; 许可证代码，许可证代码，许可证代码 ...&gt;`</block>
  <block id="65d93c0f2eae68c69877f67ce3781996" category="paragraph">license-code 参数接受一个包含 28 个大写字母字符密钥的列表。您可以一次添加一个许可证，也可以一次添加多个许可证，每个许可证密钥用逗号分隔。</block>
  <block id="1f6c8829a415beddc4ce10181f20094a" category="inline-link-macro">第 16 步</block>
  <block id="379a68b9bd0f0131eae2f5bd87fa4bcc" category="list-text">如果在配置中使用了 NetApp 存储加密（ NSE ），并且您将 `setenv bootarg.storageencryption.support` 命令设置为 "true" ，并将 `kmip.init.maxwait` 变量 "off" （在中 <block ref="c34adc28d35ee24325c874eba95a8786" category="inline-link-macro-rx"></block> 对于 _Install and boot node3_ ），您需要重置变量： `set diag ； systemshell -node &lt;node-name&gt; -command sudo kenv -u -p kmip.init.maxwait`</block>
  <block id="c13dda3e4975b286bfb62f3d9aa8cfa5" category="list-text">要从原始节点中删除所有旧许可证，请输入以下命令之一：</block>
  <block id="a0cc12382dcdc36e42046d83b6c7e109" category="paragraph">`ssystem license clean-up -unused -expired` `ssystem license delete -serial number &lt;node_serial number&gt; -package &lt;licensable_package&gt;`</block>
  <block id="f1645d1878d86f7024812da747846642" category="list-text">要删除所有已过期的许可证，请输入：</block>
  <block id="fd6db757e3a6fb12f04139c8f48aab93" category="list-text">要删除所有未使用的许可证，请输入：</block>
  <block id="0fae8f5a8ab68238375deb31e474111d" category="list-text">要从集群中删除特定许可证，请在节点上输入以下命令：</block>
  <block id="a2f728dde7d316431fdf17126688b93c" category="paragraph">`ssystem license delete -serial number &lt;node1-serial number&gt; -package *` `ssystem license delete -serial -number &lt;node2-serial number&gt; -package *`</block>
  <block id="d1ee77d0c558bd478284637572157e43" category="list-text">输入以下命令并检查其输出，以验证是否已正确安装许可证：</block>
  <block id="7092e15f19aa79a4b642157f15a4bcf6" category="inline-link-macro">第 30 步</block>
  <block id="332e0dd58dd105f49bb8b855cc6e08e6" category="paragraph">您可能需要将输出与中捕获的输出进行比较 <block ref="aa31de159a7a7903f22336e05c00b63e" category="inline-link-macro-rx"></block> 的 _ 准备节点以进行升级 _ 。</block>
  <block id="65816664fef74fe3f15406730c518f76" category="list-text">通过在两个节点上执行以下命令来配置 SP ：</block>
  <block id="948b0596f650b1efb4aebbdb1ff268fe" category="paragraph">`ssystem service-processor network modify -node &lt;node-name&gt;`</block>
  <block id="3d39e72120bdfa8b32eb4183896ece25" category="paragraph">转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到系统管理参考 _ 以了解 SP 的相关信息，以及 _System 9 ONTAP 命令：手册页参考 _ 以了解有关 `ssystem service-processor network modify` 命令的详细信息。</block>
  <block id="8bd516232448307a629aa2ad8fe64430" category="list-text">输入以下命令，输入高级权限级别：</block>
  <block id="b67e0c8ad4d089069e3751204ab49a05" category="paragraph">`storage failover modify -node &lt;node-name&gt; -cifs-no-duration default-medium_low`</block>
  <block id="ee16bb116206ed27e74abc4888edf806" category="list-text">如果系统的工作负载的 50% 到 75% 的操作小于 4 KB ，请输入 `medium` 。</block>
  <block id="93b838bedea5b323f56d1fb4aec030fe" category="list-text">如果系统的工作负载的 75% 到 100% 的操作小于 4 KB ，请输入 `low` 。</block>
  <block id="7b6a4090ff6553e6b643348d522b6560" category="list-text">输入以下命令，返回到管理员级别：</block>
  <block id="52eb8cb5708af7396828abc72517413d" category="list-text">如果要在新节点上设置无交换机集群，请转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _Network 支持站点 _ 并按照 _switchover to a two-node switchless cluster_ 中的说明进行操作。</block>
  <block id="a98b8d21a1cabe96a7d765976c724ace" category="paragraph">如果在 node3 和 node4 上启用了存储加密，请完成中的步骤 <block ref="94c0a6a874300fcf012d00a23a1b673f" category="inline-link-macro-rx"></block>。否则，请完成中的步骤 <block ref="6e48b929ca0767f00c15eeb6d7e78755" category="inline-link-macro-rx"></block>。</block>
  <block id="fe3a7dc1b68f02ec33d1b3d2d4f9bc56" category="list-text">检查 `ssystem node hardware unified-connect show` 或 `ucadmin show` 命令的输出，并确定 UTA/UTA2 端口是否具有所需的特性。</block>
  <block id="e48bdf2afbb963c9c495bf4f571895e3" category="cell">转至 <block ref="ffd96dfebf67595a1e4a6d625bee7496" category="inline-xref-macro-rx"></block>。</block>
  <block id="fa74cc012fef0feff6e924f8039749e1" category="cell">跳过步骤 5 到步骤 12 ，然后转到 <block ref="ff1d63240cee2bdc1933860b7f07a8df" category="inline-xref-macro-rx"></block>。</block>
  <block id="e6d6e537e4b0f2bf8e825c2e64f00645" category="list-text">[[man_check_4_Step5]] 执行以下操作之一：</block>
  <block id="37633c05750191dfa133d84e3b55c00e" category="cell">具有存储磁盘，并且正在运行 Data ONTAP 8.3</block>
  <block id="8445b1a045f75f905d430fc7d5f5e71c" category="cell">启动 node4 并进入维护模式： `boot_ontap maint`</block>
  <block id="6769a0fd294ca78345db234c229b8959" category="cell">转至 <block ref="2c3bbf8d53e9379a42c94980adfa90a7" category="inline-xref-macro-rx"></block>。您应已处于维护模式。</block>
  <block id="c61e8c3c627841f886b0a3031439d4ce" category="list-text">[[man_check_4_Step6]] 执行以下操作之一：</block>
  <block id="6515c49355bf1419526d1fd9c737ec8c" category="cell">UTA/UTA2 卡上的端口</block>
  <block id="eaff3678ecd6d545f7ac3a0842914aa5" category="cell">转至 <block ref="f4d4591f64bb8abe68f0b67355d1fe59" category="inline-xref-macro-rx"></block>。</block>
  <block id="4cb16c5207497dcfcaffd56afa4f1814" category="cell">跳过第 7 步，转到 <block ref="d63e67436ac7351debc07c052c32757d" category="inline-xref-macro-rx"></block>。</block>
  <block id="117986e3a34af461f5f6e6bb88045f84" category="list-text">【 man_check_4_Step7]] 如果适配器处于启动程序模式，并且 UTA/UTA2 端口处于联机状态，请使 UTA/UTA2 端口脱机：</block>
  <block id="286e43e6e6a24f0c4b7567121cef9f66" category="list-text">[[man_check_4_Step8]] 如果当前配置与所需用途不匹配，请输入以下命令根据需要更改配置：</block>
  <block id="36408e09de8feb146f54fe1e158d953d" category="list-text">` -m` 是特性模式： FC 或 10GbE UTA 。</block>
  <block id="2b96adc86d11d2a69afb2ec82da4f190" category="admonition">您需要对磁带驱动器和 FlexArray 虚拟化系统使用 FC 启动程序。您需要对 SAN 客户端使用 FC 目标。</block>
  <block id="0e0addb82f30f2aa03c68b146f054849" category="list-text">输入以下命令并检查其输出，以验证设置：</block>
  <block id="315359e3c6323d4eda359054319c0815" category="list-text">执行以下操作之一：</block>
  <block id="893a166b79c7215fddb938b9ba769f94" category="cell">是 V 系列系统或具有 FlexArray 虚拟化软件，并连接到存储阵列且运行 Data ONTAP 8.3</block>
  <block id="5ac574a53621b9436797f566cbab7941" category="cell">重新启动到维护模式： `boot_ontap maint`</block>
  <block id="5dd9d9d622ac506af56607785cc61574" category="cell">输入以下命令： `ucadmin show`</block>
  <block id="9b035cae403b89af2a989a976daad295" category="paragraph">以下示例中的输出显示， FC4 类型的适配器 "1b" 更改为 `initiator` ，适配器 "2a" 和 "2b" 的模式更改为 `CNA` 。</block>
  <block id="f8cd2564c015235fc797e229583e1023" category="list-text">【 man_check_4_Step13]] 连接端口。</block>
  <block id="439c508e4033b6c215e1a9262db35444" category="cell">转至 <block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block>。</block>
  <block id="dbe83a6e258bdc99b8051f4d3cf01d67" category="cell">返回到 _Install and boot node4_ 部分，然后继续执行中的部分 <block ref="04be07c8b8cd85d6b2140c2bfb8113b6" category="inline-link-macro-rx"></block>。</block>
  <block id="5d59517a984e405c3da4037ff1d7d898" category="paragraph">在以下情况下，聚合可能无法正确重新定位，将 node1 作为其主节点，而不是 node3 ：</block>
  <block id="0aedbbe9928008ef20e9f0f31cd1ec93" category="list-text">在第 3 阶段，聚合从 node2 重新定位到 node3 。要重新定位的某些聚合的主节点为 node1 。例如，此类聚合可以称为 aggr_node_1 。如果 aggr_node_1 的重新定位在第 3 阶段失败，并且无法强制重新定位，则聚合将留在 node2 上。</block>
  <block id="94db9769a66bbb4255b02f44f30a1506" category="list-text">在第 4 阶段之后，将 node2 替换为 node4 。更换 node2 后， aggr_node_1 将联机，并将 node4 作为其主节点，而不是 node3 。</block>
  <block id="ba508067c72d91e8f63afe491acaa462" category="paragraph">启用存储故障转移后，您可以通过完成以下步骤在第 6 阶段后修复不正确的所有权问题：</block>
  <block id="c76bc65b459278a8c28b143bd2794d8c" category="list-text">输入以下命令以获取聚合列表：</block>
  <block id="d088dd9060f2818253fb3709d9939a18" category="paragraph">要确定未正确重新定位的聚合，请参阅在一节中获取的主所有者为 node1 的聚合列表 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block> 并将其与上述命令的输出进行比较。</block>
  <block id="a3249f2582556adc14fc6268c4136b8c" category="list-text">将步骤 1 的输出与您在一节中为 node1 捕获的输出进行比较 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block> 并记下未正确重新定位的所有聚合。</block>
  <block id="6351a4102dcb6a482f6002fe35685d71" category="list-text">【 auto_aggr_relocate_fail_Step3]] 重新定位节点 4 上遗留的聚合：</block>
  <block id="d104a5e5375beeea24cb6ac3c7c3d89f" category="paragraph">`storage aggregate relocation start -node &lt;node4&gt;-aggr &lt;aggr_node_1&gt; -destination &lt;node3&gt;`</block>
  <block id="0bc9088bdd248bcc7cf35ab01ea701a4" category="list-text">验证 node3 现在是否为聚合的主所有者：</block>
  <block id="65f247827acd19f6f7debcc6880344b0" category="paragraph">如果聚合的主所有者不是 node3 ，则可以在中使用相同的重新定位命令将其重新定位到 node3 <block ref="b826fa5e08f60e3e6100c14200617b18" category="inline-xref-macro-rx"></block>。</block>
  <block id="bdbf296139657929f989f110dccebbd3" category="doc">检查聚合重新定位失败</block>
  <block id="a5c607fe9749b0c2b2f2e3b910604ce4" category="list-text">输入以下命令并检查输出：</block>
  <block id="56b7bc3034bef19019ebfa88f6cac964" category="paragraph">有关 `storage aggregate relocation start` ， `override-vetoes` 和 `override-destination-checks` 选项的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Microsoft ONTAP 9 命令：手册页参考 _ 。</block>
  <block id="de10ab1a09136633c0a0d61641d1973a" category="list-text">【 man_aggr_fail_step1]] 输入以下命令以获取聚合列表：</block>
  <block id="d741a7f5a9101301995b152ddb32e5b0" category="list-text">【第 2 步】比较的输出 <block ref="fd60626f79429d907548fd26d9ef209a" category="inline-xref-macro-rx"></block> 以及您在部分中为 node1 捕获的输出 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block> 并记下未正确重新定位的所有聚合。</block>
  <block id="51cad6c5dffb7d53bbb0121b4ba9d369" category="list-text">【 man_aggr_fail_Step3]] 重新定位 node4 上遗留的聚合：</block>
  <block id="f51f0d388b73026dbf95e6d91f6386c1" category="list-text">输入以下命令以验证 node3 现在是否为聚合的主所有者：</block>
  <block id="5bf0f8993606c9f18dbf04cc257eab62" category="paragraph">如果聚合的主所有者不是 node3 ，则可以在中使用相同的重新定位命令将其重新定位到 node3 <block ref="d5a5e127c26ff67c138bce9a8ae2c1fa" category="inline-xref-macro-rx"></block>。</block>
  <block id="22cbc441beb824687fff4489b675b3e7" category="paragraph">要停用 node2 ，您需要正确关闭 node2 并将其从机架或机箱中卸下。如果集群位于 SAN 环境中，则还需要删除 SAN LIF 。</block>
  <block id="ac9d5901ac51a7a9e98d7f8c6c0740f1" category="cell">如果集群 ...</block>
  <block id="318bbb9db21483c1e16d2e2dbe7f1651" category="cell">双节点集群</block>
  <block id="34d4031d3d37d8d9b80a5f9b450de553" category="cell">转至 <block ref="1cb6f5a9f7eef3599c4443318664abfe" category="inline-xref-macro-rx"></block>。</block>
  <block id="1ec03101c59723f4e07d47729c2bb2c0" category="cell">包含两个以上节点的集群</block>
  <block id="5e674106f615dae34230d16b22371cb8" category="cell">转至 <block ref="0bbd9dc76625f42ec6de8739e60cb44f" category="inline-xref-macro-rx"></block>。</block>
  <block id="b2af6e76142ed067163cd5edf51978b0" category="list-text">【 man_REALET_2_Step2]] 在任一节点上输入以下命令，以访问高级权限级别：</block>
  <block id="1626aa8f9ba900c076affceeaaad8930" category="list-text">输入以下命令并检查其输出，以验证是否已禁用集群 HA ：</block>
  <block id="485e8bd9380904feaa09d87fa46616ff" category="paragraph">`cluster ha show`</block>
  <block id="35df860936da8d9b2d5477ee7413fdee" category="list-text">输入以下命令并检查其输出，以检查 node2 当前是否持有 epsilon ：</block>
  <block id="7d25068d39532ede875f6fae939c62aa" category="paragraph">以下示例显示 node2 持有 epsilon ：</block>
  <block id="7b8424ae8ebc04e308b8d348d8d07edf" category="list-text">如果 node2 持有 epsilon ，请在节点上将 epsilon 标记为 `false` ，以便可以将其传输到 node3 ：</block>
  <block id="932227bf3dc2956702a635e8f4cd18a1" category="paragraph">`cluster modify -node &lt;node2&gt; -epsilon false`</block>
  <block id="9b3ca02a7473e1db3c0c57693a01aabe" category="list-text">将 epsilon `true` 标记为 node3 ，将 epsilon 传输到 node3 ：</block>
  <block id="4c3c404ced021bba5536c6b573cad272" category="paragraph">`cluster modify -node &lt;node3&gt; -epsilon true`</block>
  <block id="02447279c68e4d1b8321c16d451e2f25" category="list-text">验证设置是否为双节点无交换机集群：</block>
  <block id="0bd1c8991d4969dac07a0c2f2dde50b5" category="paragraph">`network options switchless-cluster show`</block>
  <block id="0906da04c2f71c2ff6e8d8aa1a0b62e6" category="paragraph">此命令的值必须与系统的物理状态匹配。</block>
  <block id="b7a9c811aab8e6da8894f06c47eec709" category="list-text">[[man_REALET_2_Step9]] 返回到管理员级别：</block>
  <block id="bac8149e88ecf5bf2c4de5cf6b1ac1b2" category="list-text">在任一控制器上输入以下命令以暂停 node2 ： `ssystem node halt -node &lt;node2&gt;`</block>
  <block id="befba560e8eaef2f66cac914b95edc61" category="list-text">node2 完全关闭后，将其从机箱或机架中卸下。升级完成后，您可以停用 node2 。请参见 <block ref="6e48b929ca0767f00c15eeb6d7e78755" category="inline-link-macro-rx"></block>。</block>
  <block id="efc5de9a5891b52ce2b37c9ed2854d5f" category="paragraph">在关闭并停用 node1 之前，您需要记录有关其集群网络，管理和 FC 端口以及 NVRAM 系统 ID 的信息。稍后将 node1 映射到 node3 并重新分配磁盘时，您需要在操作步骤中提供此信息。</block>
  <block id="b01288321618ebc4fb03d07a48ec080c" category="list-text">【第 1 步】输入以下命令并捕获其输出：</block>
  <block id="a9f729911b0af57b8d1d08f2584625b6" category="paragraph">`network route show`</block>
  <block id="db55c697ce008329c5b7d6628a252009" category="list-text">输入以下命令并捕获其输出：</block>
  <block id="743c43b069d893a88b2732926f57f5db" category="paragraph">`vserver services name-service dns show`</block>
  <block id="e06877d8614b07524debe1149bac1e78" category="list-text">[[man_record_node1_step3]] 在任一控制器上输入以下命令，以查找 node1 上的集群网络和节点管理端口：</block>
  <block id="ac1f4efe2cbbc63bd8c0842b84e1d3c8" category="paragraph">`network interface show -curr-node &lt;node1&gt; -role cluster ， intercluster ， node-mgmt ， cluster-mgmt`</block>
  <block id="2f163f9a8fcb45472b7c0a84f088f4de" category="paragraph">系统将显示集群中节点的集群，集群间，节点管理和集群管理 LIF ，如以下示例所示：</block>
  <block id="5feb72299c708ed8b5e527e5963476fe" category="admonition">您的系统可能没有集群间 LIF 。</block>
  <block id="8fac25219c50f2cc9f32de6a06dd0afa" category="list-text">捕获中命令输出中的信息 <block ref="63c89ae17921f4702dc8719a6b0480a8" category="inline-xref-macro-rx"></block> 以在部分中使用 <block ref="3b6c063a8efbc88c969c7838f0611434" category="inline-link-macro-rx"></block>。</block>
  <block id="d852fb2583585e10c3885982eaf29670" category="paragraph">要将新控制器端口映射到旧控制器端口，需要提供输出信息。</block>
  <block id="4dea80d6ab207bc372820b8a74a583df" category="list-text">在 node1 上输入以下命令：</block>
  <block id="6516511e2cda8e73f01c2c8b9a2373b2" category="paragraph">`network port show -node &lt;node1&gt; -type physical`</block>
  <block id="c98e23a6f059dd6276dbffb11af4d53d" category="paragraph">系统将显示节点上的物理端口，如以下示例所示：</block>
  <block id="e39f84c1a169d8d90af9c95f44865bc0" category="list-text">记录端口及其广播域。</block>
  <block id="00e8b0b0df56090152aa5c1cb1bd4a45" category="paragraph">稍后，需要在操作步骤中将广播域映射到新控制器上的新端口。</block>
  <block id="5a88073443b3ca14db2fbd6903a55330" category="paragraph">`network fcp adapter show -node &lt;node1&gt;`</block>
  <block id="554c196eb9c5953b024f2cc2c07ba455" category="paragraph">系统将显示节点上的 FC 端口，如以下示例所示：</block>
  <block id="f33b448fa0bb738f614e66795ee372d4" category="list-text">记录端口。</block>
  <block id="183e98aa2a84c4dee16223d4c260f2ce" category="paragraph">稍后在操作步骤中映射新控制器上的新 FC 端口需要输出信息。</block>
  <block id="5d3cbeccba5dac0370b9c40f95d5d063" category="list-text">如果您之前没有这样做，请输入以下命令，检查 node1 上是否配置了接口组或 VLAN ：</block>
  <block id="f6f8a9635aff4aef3e52d34ba925926b" category="paragraph">您将使用部分中的信息 <block ref="3b6c063a8efbc88c969c7838f0611434" category="inline-link-macro-rx"></block>。</block>
  <block id="61a6d655671eebbd633c1d84fae09e17" category="cell">如果您 ...</block>
  <block id="8c197b9ca5649983d88c28532ed4d151" category="inline-link-macro">准备要升级的节点</block>
  <block id="43ac883a14249b98283d8e22e6127ba8" category="cell">已在部分中记录 NVRAM 系统 ID 编号 <block ref="7eb7fb0c5f668aa416ee9ca8030df058" category="inline-link-macro-rx"></block>。</block>
  <block id="722b28462ad8b131d5cfd84a2c2f881a" category="cell">转到下一部分， <block ref="830cfeba72054433fc0dcccc19f6d055" category="inline-link-macro-rx"></block>。</block>
  <block id="105886469ee101bc5425140d42df484b" category="cell">未在部分中记录 NVRAM 系统 ID 编号 <block ref="7eb7fb0c5f668aa416ee9ca8030df058" category="inline-link-macro-rx"></block></block>
  <block id="1c5349057e46140156bc0d263443383c" category="cell">完成 <block ref="91d37fb83183cdc5da036c812dec4eb7" category="inline-xref-macro-rx"></block> 和 <block ref="2a3037c203afea4262e2cc05eb0708b3" category="inline-xref-macro-rx"></block> 然后继续 <block ref="830cfeba72054433fc0dcccc19f6d055" category="inline-link-macro-rx"></block>。</block>
  <block id="866ca6e46d7456a7c276afd3eb54db5d" category="list-text">【 man_record_node1_step11]] 在任一控制器上输入以下命令：</block>
  <block id="a68d4121a0f2927e059683a1133fbbe1" category="paragraph">`ssystem node show -instance -node &lt;node1&gt;`</block>
  <block id="9bcd562ef44a8e11e5fd0e0492ebe6c4" category="paragraph">系统将显示 node1 的相关信息，如以下示例所示：</block>
  <block id="5b9519c4c2b57166c18827dfa9f50f7c" category="list-text">[[man_record_node1_step12]] 记录要在部分中使用的 NVRAM 系统 ID 编号 <block ref="b27daeccf5fbd8a2e88a3636ee615b74" category="inline-link-macro-rx"></block>。</block>
  <block id="0798efe32af9ed8a849deddb03ef31cf" category="paragraph">将聚合从 node2 重新定位到 node3 后，您需要将 node2 拥有的 NAS 数据 LIF 移动到 node3 。</block>
  <block id="71f0ff9a99872664cb504bc17756a9a7" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。升级期间，集群或服务运行状况无需移动 SAN LIF 。除非需要将 SAN LIF 映射到新端口，否则不会移动这些 LIF 。将 LIF 从 node3 移动到 node4 并使 node4 联机后，必须验证 LIF 是否运行正常并位于相应的端口上。</block>
  <block id="e2400a5784b6e69a68f8240fc8be98e0" category="list-text">【第 1 步】通过在任一节点上输入以下命令并捕获输出，列出 node2 拥有的所有 NAS 数据 LIF ：</block>
  <block id="83dae04d05ca0d2bbd524535d62e877e" category="paragraph">`network interface show -data-protocol nfs|cifs -home-node &lt;node2&gt;`</block>
  <block id="1dfd4aeb9eb2d67718bb179a87daccb5" category="paragraph">以下示例显示了 node2 的命令输出：</block>
  <block id="aa0c21cc929471b59f51bf7561edb3b2" category="cell">如果 node2...</block>
  <block id="141b9f4f51c5a1d44c0555e2cab43f56" category="cell">已配置接口组或 VLAN</block>
  <block id="0cce85d021e13ea0d84461759b2a3b08" category="cell">转至 <block ref="d5cd2572a667e81ae2cb0b0539de3785" category="inline-xref-macro-rx"></block>。</block>
  <block id="e47ea6851b10e922828b9e5bacc36c92" category="cell">未配置接口组或 VLAN</block>
  <block id="d7f8ef927cf7428c7625c268a1c951ef" category="cell">跳过步骤 3 ，然后转到 <block ref="2dd22df3b6260ee6ac1883b31af6d999" category="inline-xref-macro-rx"></block>。</block>
  <block id="6d3379271564572a595ab2fbc869131a" category="list-text">[[man_move_lif_2_3_step3]] 执行以下步骤以迁移节点 2 上接口组和 VLAN 上托管的 NAS 数据 LIF ：</block>
  <block id="daaee2c9342de97c2c423f905e0ea71f" category="list-text">[[man_move_lif_2_3_substepa]] 通过为每个 LIF 输入以下命令，将 node2 上接口组上托管的任何数据 LIF 迁移到 node3 上能够在同一网络上托管 LIF 的端口：</block>
  <block id="048f81150ce15262b658b7de15b84690" category="paragraph">`network interface migrate -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -destination-node &lt;node3&gt; – destination-port &lt;netport_ifgrp&gt;`</block>
  <block id="4fd830a8ef7653e7cc91a40076c34365" category="list-text">在中修改 LIF 的主端口和主节点 <block ref="6c89c517e670ac026543379bd9a9844e" category="inline-xref-macro-rx"></block> 通过输入以下命令将 LIF 连接到当前托管 LIF 的端口和节点，每个节点输入一次：</block>
  <block id="657b6a55549088546a48050df59aeff1" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -home-node &lt;node3&gt; -homport &lt;netport_ifgrp&gt;`</block>
  <block id="274dd4ace55dc7cc39f1a5eb3afbcbf1" category="list-text">【 man_move_lif_2_3_substepc]] 通过为每个 LIF 输入以下命令，将节点 2 上 VLAN 上托管的任何 LIF 迁移到节点 3 上能够在与 VLAN 相同的网络上托管 LIF 的端口：</block>
  <block id="107232f6e653a89ac23c99590a7ea101" category="list-text">在中修改 LIF 的主端口和主节点 <block ref="e5ef0b90c6e2aafbe1f927b2cb6685c9" category="inline-xref-macro-rx"></block> 输入以下命令，将 LIF 设置为当前托管 LIF 的端口和节点，每个 LIF 设置为一次：</block>
  <block id="d113d66e692935f5a59a62900427b861" category="list-text">[[man_move_lif_2_3_step4]] 执行以下操作之一：</block>
  <block id="20cdfa79ed0499babc80c9a3f7d7297c" category="cell">完成 <block ref="2da0d67c04c83434137e9b301dfd86dd" category="inline-xref-macro-rx"></block> 到 <block ref="12556117786215462f4f983b89f009f9" category="inline-xref-macro-rx"></block>。</block>
  <block id="44f77dbcf99acc01b3bf655a89bfcc5e" category="cell">跳过步骤 5 到步骤 8 ，然后完成 <block ref="b80e3f5f2f06a1383cb71c69b52c021e" category="inline-xref-macro-rx"></block>。</block>
  <block id="7f84238811a0744aed44244f31a3bd53" category="cell">NAS 和 SAN</block>
  <block id="da070fa74bde99b92534bf987c65a7e1" category="cell">完成 <block ref="2da0d67c04c83434137e9b301dfd86dd" category="inline-xref-macro-rx"></block> 到 <block ref="ccd0910cd159fbfd70d254145a6c4d20" category="inline-xref-macro-rx"></block>。</block>
  <block id="1b8095077175bc0e7f7bb5fbb73e6504" category="list-text">[[man_move_lif_2_3_step5]] 如果平台上的数据端口不同，请将这些端口添加到广播域：</block>
  <block id="e8db799447d1b0c26463d2838519203a" category="paragraph">`network port broadcast-domain add-ports -ipspace &lt;ipspace_name&gt; -broadcast-domain mgmt -ports &lt;node ： port&gt;`</block>
  <block id="2f563bb65059883cdd406846273f0ca4" category="paragraph">以下示例将节点 "6280-1 " 上的端口 "e0a" 和节点 "8060-1 " 上的端口 "e0i" 添加到 IP 空间 "Default" 中的广播域 "mgmt" ：</block>
  <block id="1062bb6c92253a8c9b640ee692419b26" category="list-text">【第 6 步】输入以下命令，将每个 NAS 数据 LIF 迁移到 node3 ，每个 LIF 一次：</block>
  <block id="cf94c0385b5c2ed33b1d57956c4697d4" category="paragraph">`network interface migrate -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -destination-node &lt;node3&gt; -destination-port &lt;netport_ifgrp&gt;`</block>
  <block id="0049a5f9500f1de5ca8ef0f389c62f72" category="list-text">【第 7 步】在任一节点上输入以下命令并检查输出，以验证 NAS LIF 是否已移至正确的端口以及 LIF 的状态是否为 up ：</block>
  <block id="74736b1b1199beaea5593b316d8e4625" category="paragraph">`network interface show -curr-node &lt;node3&gt;-data-protocol cifs|nfs`</block>
  <block id="6f72830bc34189a08fe7627d74d89f3b" category="list-text">[[man_move_lif_2_3_step8]] 如果任何 LIF 已关闭，请通过输入以下命令将 LIF 的管理状态设置为 "up" ，每个 LIF 一次：</block>
  <block id="5ebc0a94cbbcb381cb1a98cffc3adac0" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;LIF_name&gt; -status-admin up`</block>
  <block id="ba45f9f836b05d2d37a836a9ed696d6f" category="list-text">[[man_move_lif_2_3_step9]] 如果您配置了接口组或 VLAN ，请完成以下子步骤：</block>
  <block id="8e2087071d353c6f56da3d27b7a84dfc" category="list-text">从接口组中删除 VLAN ：</block>
  <block id="74189835f85e9e3f27da7d0ea64f8c56" category="paragraph">`network port vlan delete -node &lt;node_name&gt; -port &lt;ifgrp&gt; -vlan-id &lt;vlan_ID&gt;`</block>
  <block id="ef57ddf1d14f7687cdf12a4b023fe0ba" category="list-text">输入以下命令并检查其输出，以确定节点上是否配置了任何接口组：</block>
  <block id="d2cddb90501569c80df4ec0677bd9046" category="paragraph">`network port ifgrp show -node &lt;node_name&gt; -ifgrp &lt;ifgrp_name&gt; -instance`</block>
  <block id="32c2f2dc33f1ff3a5d165af69042d610" category="paragraph">系统将显示节点的接口组信息，如以下示例所示：</block>
  <block id="c02532d4249a0cf1658188c0c95a7129" category="list-text">如果节点上配置了任何接口组，请记录接口组的名称以及分配给这些接口组的端口，然后输入以下命令删除这些端口，每个端口输入一次：</block>
  <block id="a1858c4eb2fed033fc49b2a7a2049d7b" category="paragraph">`network port ifgrp remove-port -node &lt;node_name&gt; -ifgrp &lt;ifgrp_name&gt; -port &lt;port_name&gt;`</block>
  <block id="4de30509db28d6f26dbb6eb1fa0448e9" category="paragraph">在关闭并停用 node2 之前，您需要记录有关其集群网络，管理和 FC 端口以及 NVRAM 系统 ID 的信息。稍后将 node2 映射到 node4 并重新分配磁盘时，您需要在操作步骤中提供此信息。</block>
  <block id="06482362cad7119c97decfadddef47d1" category="list-text">在 node2 上查找集群网络，节点管理，集群间和集群管理端口：</block>
  <block id="1fcb48e8a1ae19116b9bf2f39685db30" category="paragraph">`network interface show -curr-node &lt;node_name&gt; -role cluster ， intercluster ， nodemgmt ， cluster-mgmt`</block>
  <block id="9581ef2fce7ca5bef124feac72dd7c62" category="paragraph">系统将显示该节点以及集群中其他节点的 LIF ，如以下示例所示：</block>
  <block id="66df24136907c6cba70f63950b15a0d8" category="admonition">您的系统可能没有集群间 LIF 。您只能在一个节点对的一个节点上使用集群管理 LIF 。的示例输出显示了集群管理 LIF <block ref="4d0816bae74d8d665981da69c5c8d7a9" category="inline-link-macro-rx"></block> 在 _Record node1 port information_.</block>
  <block id="db388cc11af248e636d23a7634f79da1" category="list-text">捕获输出中的信息以在部分中使用 <block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block>。</block>
  <block id="b226d44baee1fdcf5f175befc4240f79" category="list-text">确定节点 2 上的物理端口：</block>
  <block id="0ce26da6eb15f1794580d79135daecea" category="paragraph">`network port show -node &lt;node_name&gt; -type physical` +</block>
  <block id="3aba4579adf045f7017d47291de9ae6e" category="paragraph">`node_name` 是要迁移的节点。</block>
  <block id="a36b8ceea3403515d94e1d9ad1d33833" category="paragraph">系统将显示 node2 上的物理端口，如以下示例所示：</block>
  <block id="1a494d33f95411ce2d7f871e87234bb6" category="paragraph">稍后，需要在操作步骤中将广播域映射到新控制器上的端口。</block>
  <block id="36d2ce7941b2c78c3d67d83e5bab95ab" category="list-text">确定 node2 上的 FC 端口：</block>
  <block id="922cfc273cc764471719b8a70b2bd795" category="paragraph">`network fcp adapter show`</block>
  <block id="e2ce1c0ee0599997916e05613833e82e" category="paragraph">系统将显示 node2 上的 FC 端口，如以下示例所示：</block>
  <block id="f30296e85c9b7a573f431b89a15b6b93" category="list-text">如果您之前没有这样做，请检查 node2 上是否配置了接口组或 VLAN ：</block>
  <block id="9e650495d6414abbc47ea05fdc36dd7e" category="paragraph">`ifgrp show`</block>
  <block id="35803428da21a4a214ff09f1442e2f58" category="paragraph">`VLAN show`</block>
  <block id="15fb68f8a892a3ed6a57c8b5eca53ec5" category="paragraph">您将使用部分中的信息 <block ref="fface1ac702bde6d72ceb6e55eb8b2b6" category="inline-link-macro-rx"></block>。</block>
  <block id="1f7052fd85a8ced9cd9c65f079fcb154" category="cell">已在中记录 NVRAM 系统 ID 编号 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block></block>
  <block id="65e4801fe9cb3563a071b657463a3c1c" category="cell">转至 <block ref="610cb2d6e87c5e838ceef8f48f57b082" category="inline-link-macro-rx"></block>。</block>
  <block id="30183fbd349bcd94fdabd371e0fdc8d9" category="cell">未在中记录 NVRAM 系统 ID 编号 <block ref="cd8ad1809865824065fe011b80800cd6" category="inline-link-macro-rx"></block></block>
  <block id="b31b744fd8c5cbe34c282a8e3311866b" category="cell">完成 <block ref="3ef612fafd35c4ea98dad97a133c5f3f" category="inline-xref-macro-rx"></block> 和 <block ref="a3461a8cfeac3856b6bf21e7388f2534" category="inline-xref-macro-rx"></block> 然后转到下一节， <block ref="610cb2d6e87c5e838ceef8f48f57b082" category="inline-link-macro-rx"></block>。</block>
  <block id="435d35070ba8894d910a50e35db1d4e2" category="list-text">【 man_record_2_step9]] 显示节点 2 的属性：</block>
  <block id="5d34eef64c7b53994a7dde374d44b94b" category="paragraph">`ssystem node show -instance -node node2`</block>
  <block id="bc110b3ccc057d2275d5e8ae87f525b0" category="list-text">【 man_record_2_step10]] 记录要在部分中使用的 NVRAM 系统 ID <block ref="f326c815b47f4f2909494bae5cd735d5" category="inline-link-macro-rx"></block>。</block>
  <block id="0d5eded42a5e8cbfa58553f5dd4cd263" category="paragraph">将 node2 的非根聚合重新定位到 node3 后，您现在必须将其从 node3 重新定位到 node4 。</block>
  <block id="a6bef5c01b3429b867cf90c4a3de3fac" category="list-text">【 man_relocate_3_4_Step1]] 在任一控制器上输入以下命令，并检查输出以确定要重新定位的非根聚合：</block>
  <block id="086b43d0e04175cf8790abef24a23665" category="paragraph">`storage aggregate show -owner-name &lt;node3&gt; -home-id &lt;node2_system_id&gt;`</block>
  <block id="d7a08960a9315fad49e6564d33d4cb9c" category="list-text">通过完成以下子步骤重新定位聚合：</block>
  <block id="8e8511da8932baf12f2a23e74d02e1c7" category="list-text">在任一节点上输入以下命令，以访问高级权限级别：</block>
  <block id="f30ab70d9dfcf364c12d5f98b0968ba7" category="paragraph">`storage aggregate relocation start -node &lt;node3&gt; -destination &lt;node4&gt; -aggregate-list &lt;aggr_name1 ， aggr_name2...&gt; -no-controller-upgrade true`</block>
  <block id="1aa99f376709f3c0651ec2c29125ea92" category="paragraph">聚合列表是您在中获取的 node4 所拥有的聚合的列表 <block ref="ba9af23ac982f5cc7837b1ecc9c3cb47" category="inline-xref-macro-rx"></block>。</block>
  <block id="35b5d5d5526d39377fa3fde3fe0919cd" category="paragraph">重新定位在后台进行。重新定位聚合可能需要几秒到几分钟的时间。此时间既包括客户端中断，也包括非中断部分。此命令不会重新定位任何脱机或受限聚合。</block>
  <block id="0ac9d40efe1470ec53257470c91f7314" category="list-text">返回到管理员级别：</block>
  <block id="edcc2ad4cfcd55c9715e9c9b93b871f5" category="list-text">【第 3 步】检查重新定位状态：</block>
  <block id="1f9c1a513cadbe90207536ee44ba50c9" category="paragraph">`storage aggregate relocation show -node &lt;node3&gt;`</block>
  <block id="435f14e8c9936aa21efde9eac795b40f" category="paragraph">重新定位聚合后，输出将显示该聚合的 `D1` 。</block>
  <block id="48cbb5f03f0f49e19a1fa9ce8f82961f" category="admonition">等待所有 node2 聚合重新定位到 node4 ，然后再继续下一步。</block>
  <block id="b81c90895c008292ba5de518bf5f82a3" category="cell">如果重新定位 ...</block>
  <block id="ffd498a9668905f8533b8e27b647969c" category="cell">所有聚合均已成功</block>
  <block id="80e9ee80960399cedd826a005aef0a59" category="cell">转至 <block ref="77e0750fdfbf6d57fd18f2bfe5d7ed8c" category="inline-xref-macro-rx"></block>。</block>
  <block id="773fa54d2a554dd5ed9a1437e409ed98" category="cell">任何聚合失败或被否决</block>
  <block id="2716a9803b0e07013e6cd314ef080ce2" category="list-text">检查 EMS 日志以了解更正操作。</block>
  <block id="434233acf6409db55ccbef4618a05f4c" category="list-text">执行更正操作。</block>
  <block id="f5bf9910c32ce3468dc3a0f80ee2e47a" category="list-text">重新定位任何出现故障或被否决的聚合：</block>
  <block id="8efb346b295cc43a0b01aa0890f6da31" category="paragraph">`storage aggregate relocation start -node &lt;node3&gt; destination &lt;node4&gt; -aggregate-list &lt;aggr_name1 ， aggr_name2...&gt; no-controller-upgrade true`</block>
  <block id="32a147207e605041251ef80abd4e6acf" category="paragraph">聚合列表是失败或被否决的聚合的列表。</block>
  <block id="91fabe0a54e8933e0d8a78d90297363f" category="paragraph">如有必要，您可以使用以下方法之一强制执行重新定位：</block>
  <block id="fac06d8e56699ef41a841be6b176ebd7" category="list-text">覆盖否决检查：</block>
  <block id="2af820da1a1b18a7aaeb296667169248" category="paragraph">`s存储聚合重新定位 start -override-vetoes -no-controller-upgrade`</block>
  <block id="d43b683fda30183131790fb642203a1d" category="list-text">覆盖目标检查：</block>
  <block id="01c6e1a269dc83c83d6e3aa64688f33f" category="paragraph">`storage aggregate relocation start -override-destination-checks -ndocontroller-upgrade`</block>
  <block id="a3de10d100fc985813ee74719526afe6" category="paragraph">有关存储聚合重新定位命令的详细信息，请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Microsoft ONTAP 9 磁盘和聚合高级指南 _ 和 _ONTAP 9 命令：手册页参考 _ 。</block>
  <block id="74e5caecf2b87f363c4a9dae7dca9c15" category="list-text">[[man_relocate_3_4_Step5]] 验证所有 node2 非根聚合是否已联机及其在 node4 上的状态：</block>
  <block id="28b5866cf6b60125947b501f1d057f36" category="paragraph">`storage aggregate show -node &lt;node4&gt; -state offline -root false`</block>
  <block id="ba83d23180997e074fb16dcfc2cd6da8" category="paragraph">node2 聚合在中的命令输出中列出 <block ref="ba9af23ac982f5cc7837b1ecc9c3cb47" category="inline-xref-macro-rx"></block>。</block>
  <block id="176e1e5a47c3db6bc56e4ccb10905065" category="list-text">如果任何聚合脱机或变为外部聚合，请对每个聚合使用以下命令将其联机：</block>
  <block id="00751ef0752943fad6f5c251990dbefb" category="list-text">验证 node2 聚合中的所有卷是否在 node4 上处于联机状态：</block>
  <block id="9fe3979261ad706bcee5b4c047e18834" category="list-text">如果 node4 上的任何卷脱机，请将其联机：</block>
  <block id="54ab7b4b354c31db3c1958974da7349a" category="list-text">向 NetApp 发送有关 node4 的升级后 AutoSupport 消息：</block>
  <block id="61be86123ac7716617c75c3d56ea68a9" category="paragraph">`ssystem node AutoSupport invoke -node &lt;node4&gt; -type all -message "&lt;node2&gt; successfully uped" from &lt;platform_old&gt; to &lt;platform_new&gt;"`</block>
  <block id="f9758b6af31acb5b16f9295ac0f7c556" category="paragraph">要停用 node1 ，您需要禁用 node2 的 HA 对，正确关闭 node1 并将其从机架或机箱中卸下。</block>
  <block id="aa7894ff1a9d6e45a378e3bbe939cb80" category="list-text">验证集群中的节点数：</block>
  <block id="0520dd500d342650e01dc4a099a267bb" category="paragraph">系统将显示集群中的节点，如以下示例所示：</block>
  <block id="44fe06f5f571cfd547aa44853b8a4f9d" category="list-text">【 man_REALET_1_step2]] 根据需要禁用存储故障转移：</block>
  <block id="f4c0a7ed135e62d38e56c9a16bf13990" category="list-text">在任一节点上输入以下命令，以禁用集群高可用性：</block>
  <block id="d875f9fec183da794cd6d6245ef00d1d" category="paragraph">`cluster ha modify -configured false`</block>
  <block id="27a8730bbe580dd65301349dcdc539f8" category="list-text">禁用存储故障转移：</block>
  <block id="1990cae950960555eed1d17b76599009" category="paragraph">`storage failover modify -node &lt;node1&gt; -enabled false`</block>
  <block id="0cf8f0e4fb23d1270d640c0a8e820f4b" category="cell">禁用存储故障转移： `storage failover modify -node &lt;node1&gt; -enabled false`</block>
  <block id="8048736d756a32521201f074d2730091" category="list-text">验证是否已禁用存储故障转移：</block>
  <block id="2adf18e995507a97d0d1e8af8c85e4f0" category="paragraph">以下示例显示了在为节点禁用存储故障转移后， `storage failover show` 命令的输出：</block>
  <block id="c4b530495164ce1eeaab4b08e9534859" category="list-text">验证数据 LIF 状态：</block>
  <block id="d95955bc6aa8350efd75d95d4bbee99b" category="paragraph">`network interface show -role data -curr-node &lt;node2&gt;-home-node &lt;node1&gt;`</block>
  <block id="5fbed693cb6b31f11a703890fc87d45f" category="inline-link-macro">故障排除</block>
  <block id="1337205e844f111a9850e68ab7fe85fb" category="paragraph">查看 * 状态管理 /Oper* 列，查看是否有任何 LIF 已关闭。如果有任何 LIF 发生故障，请参见 <block ref="f37de8559f00b8ef58b12c6857d24513" category="inline-link-macro-rx"></block> 部分。</block>
  <block id="8405f8a611485472bfa1ab420a9a9a02" category="cell">转至 <block ref="caeb7d58e7293f2d87a762ba5d4df397" category="inline-xref-macro-rx"></block>。</block>
  <block id="a4749d514e1548558e90fda0a15746ff" category="cell">转至 <block ref="242f372e62d4ec9b0208b2bd3cc69817" category="inline-xref-macro-rx"></block>。</block>
  <block id="9cd28d632d37554bc6b8bc94ae2073e5" category="list-text">【 man_REALET_1_step6]] 访问任一节点上的高级权限级别：</block>
  <block id="fa3bee6ea4c5e23d15d4c301c3141248" category="list-text">【第 7 步】验证集群 HA 是否已禁用：</block>
  <block id="f113138c0fa8fa7f0032e6a3fdc72c0a" category="paragraph">如果尚未禁用集群 HA ，请重复此操作 <block ref="af42b54b31642eb564c9e40bb4e550a9" category="inline-xref-macro-rx"></block>。</block>
  <block id="a646d4448d74f354bb17f8dd1f3b7055" category="list-text">【 ｛ man_REALET_1_step8]] 检查 node1 当前是否持有 epsilon ：</block>
  <block id="c3eb5e5ac705b7d7ad0bcb8afd287152" category="paragraph">由于集群中的节点数可能为偶数，因此一个节点的表决权重会增加一个百分比，称为 epsilon 。请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 可链接到系统管理参考 _ 以了解详细信息。</block>
  <block id="1eca50be6c9670acdf0a0635f4b23d14" category="admonition">如果您使用的是四节点集群，则 Epsilon 可能位于集群中不同 HA 对中的节点上。</block>
  <block id="d582f21b8a69a6d942b9b1950f660f93" category="paragraph">以下示例显示 node1 持有 epsilon ：</block>
  <block id="56083d4ecb6381ba220374fe9dad2f3b" category="list-text">如果 node1 持有 epsilon ，则在节点上标记 epsilon `false` ，以便将其传输到 node2 ：</block>
  <block id="ce94642d2db6471658f082810ff26760" category="paragraph">`cluster modify -node &lt;node1&gt; -epsilon false`</block>
  <block id="c50c8db58d7cb6ecb263a833f1594cf2" category="list-text">将 epsilon `true` 标记为 node2 ，将 epsilon 传输到 node2 ：</block>
  <block id="132623365cd4f5bf09a28e344e0106d0" category="paragraph">`cluster modify -node &lt;node2&gt; -epsilon true`</block>
  <block id="6f223a55c3e4c37c6154b48d9ad6d103" category="list-text">验证是否已对 node2 进行更改：</block>
  <block id="0e3cd42cd6320745185eaab80053ad4a" category="paragraph">node2 的 epsilon 现在应为 true ， node1 的 epsilon 现在应为 false 。</block>
  <block id="f11c9613319f6e81aa0fa42fd830a1cb" category="list-text">验证设置是否为双节点无交换机集群：</block>
  <block id="f72b72c0926d6dd4d51ae53a658c3ab1" category="list-text">从 node1 提示符处暂停 node1 ：</block>
  <block id="f6c12efc36044a403873657724eb5a4a" category="paragraph">`ssystem node halt -node &lt;node1&gt;`</block>
  <block id="7d63f771d73dc7f75f06e358cd9a7510" category="admonition">* 注意 * ：如果 node1 与 node2 位于同一机箱中，请勿使用电源开关或拔下电源线来关闭机箱。如果这样做，正在提供数据的 node2 将关闭。</block>
  <block id="ecd3525fa194c253a8cabf432a4a5041" category="list-text">当系统提示您确认是否要暂停系统时，输入 `y` 。</block>
  <block id="4554f5f9818af46c131a159c2ec43887" category="paragraph">节点将停留在启动环境提示符处。</block>
  <block id="839c9527e6867357b4949b3cb19bd5a6" category="list-text">当 node1 显示启动环境提示符时，将其从机箱或机架中取出。</block>
  <block id="d1e63174073b4ec3e4d49ef0ca235c5b" category="paragraph">升级完成后，您可以停用 node1 。请参见 <block ref="6e48b929ca0767f00c15eeb6d7e78755" category="inline-link-macro-rx"></block>。</block>
  <block id="8d20a51d0c0718e7e116461f15d49fb3" category="paragraph">在升级操作步骤期间，远程 LIF 处理 SAN LUN 的流量。升级期间，集群或服务运行状况无需移动 SAN LIF 。除非需要将 SAN LIF 映射到新端口，否则不会移动这些 LIF 。使 node4 联机后，您需要验证 LIF 是否运行正常并位于相应的端口上。</block>
  <block id="12720c14368020238cd7150824f980eb" category="list-text">通过在任一节点上输入以下命令并捕获输出，列出不属于 node3 的所有 NAS 数据 LIF ：</block>
  <block id="9482a7fa27802a7ab7e05f7ded4a42bd" category="paragraph">`network interface show -role data -curr-node node3 -is-home false`</block>
  <block id="f4f6617b632a0c1c2dc3fa9db1c234c1" category="cell">转至 <block ref="81b5453f8cd7e29a23486e4650786cf5" category="inline-xref-macro-rx"></block>。</block>
  <block id="2a0ce78ac6ca1adeedbcfa1fd0a257cc" category="cell">跳过步骤 3 ，然后转到 <block ref="945e0dec7328bd39afca611c47b45c97" category="inline-xref-macro-rx"></block>。</block>
  <block id="dac6519e0e0abeb2d86af52963ff687b" category="list-text">[[man_lif_verif_4_Step3]] 执行以下步骤，将最初位于 node2 上的接口组和 VLAN 上托管的任何 NAS 数据 LIF 从 node3 迁移到 node4 。</block>
  <block id="bea582814d8029e4e79ed1f1f67178fa" category="list-text">【 man_lif_verif_4_substepa 】通过为每个 LIF 输入以下命令，将先前属于接口组上 node2 的 node3 上托管的任何 LIF 迁移到 node4 上能够在同一网络上托管 LIF 的端口：</block>
  <block id="d78b67076b08536aa74614da580aa8e7" category="paragraph">`network interface migrate -vserver &lt;vserver_name&gt; -lif &lt;lif_name&gt; -destination-node node4 – destination-port &lt;netport_ifgrp&gt;`</block>
  <block id="bb2b7d2b593abe391065563c1a991c60" category="list-text">在中修改 LIF 的主端口和主节点 <block ref="f2edbd3671dda6c8c6a0d5b9f5139a77" category="inline-xref-macro-rx"></block> 输入以下命令，将 LIF 设置为当前托管 LIF 的端口和节点，每个 LIF 设置为一次：</block>
  <block id="f3ab69d92a4ce66d6b40a6fc5ed64045" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;datalif_name&gt; -home-node node4 home-port &lt;netport_ifgrp&gt;`</block>
  <block id="ca8c32ea8d9ad20129f9bd82dd476c20" category="list-text">【 man_lif_verif_4_substepc]] 通过为每个 LIF 输入以下命令，将先前属于 VLAN 端口上 node2 的 node3 上托管的任何 LIF 迁移到 node4 上能够在同一网络上托管 LIF 的端口：</block>
  <block id="ad068be6c9c7081a732def4a358736ad" category="paragraph">`network interface migrate -vserver &lt;vserver_name&gt; -lif &lt;datalif_name&gt; -destination-node node4 – destination-port &lt;netport_ifgrp&gt;`</block>
  <block id="b9698583aeb95570efa407aaaba06094" category="list-text">在中修改 LIF 的主端口和主节点 <block ref="239198568c8cd082441ca4901dc23f34" category="inline-xref-macro-rx"></block> 输入以下命令，将 LIF 设置为当前托管 LIF 的端口和节点，每个 LIF 设置为一次：</block>
  <block id="9b464868d559a5e4c0a4b39f6f928522" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;datalif_name&gt; -home-node &lt;node4&gt; home-port &lt;netport_ifgrp&gt;`</block>
  <block id="1ba9f89e7307ad05e44ad05bb958ca27" category="list-text">【 man_lif_verif_4_Step4]] 执行以下操作之一：</block>
  <block id="583ceb80a05614853a17d060bdc9978d" category="cell">完成 <block ref="24ba20dfe80c75ddf74b686c1f78edbe" category="inline-xref-macro-rx"></block> 到 <block ref="464cefb825ec041ae0f8085658a0717b" category="inline-xref-macro-rx"></block>，跳过步骤 9 并完成 <block ref="487182da65d4a8fd64dac32686f96826" category="inline-xref-macro-rx"></block> 到 <block ref="6d60445fd0a028ec8dafc7e8858e9dac" category="inline-xref-macro-rx"></block>。</block>
  <block id="407fbf8918b07e23f7ad6bd07a5d9cd9" category="cell">跳过步骤 5 到步骤 8 并完成 <block ref="95473255aa630f367ac347162090735e" category="inline-xref-macro-rx"></block> 到 <block ref="6d60445fd0a028ec8dafc7e8858e9dac" category="inline-xref-macro-rx"></block>。</block>
  <block id="b7cf099ecc920b7356c7938e36ead518" category="cell">完成 <block ref="24ba20dfe80c75ddf74b686c1f78edbe" category="inline-xref-macro-rx"></block> 到 <block ref="6d60445fd0a028ec8dafc7e8858e9dac" category="inline-xref-macro-rx"></block>。</block>
  <block id="486afcecd3768de955874ac9b04d982d" category="list-text">【 man_lif_verif_4_Step5]] 如果您的平台上的数据端口不同，请输入以下命令将这些端口添加到广播域：</block>
  <block id="0d0d30231651c6bea6f3a8ab9bef8b41" category="paragraph">`network port broadcast-domain add-ports -ipspace &lt;ipspace_name&gt; -broadcast-domain mgmt ports &lt;node ： port&gt;`</block>
  <block id="59770005b7a829dfa2de1246fe18d7ed" category="paragraph">以下示例将节点 "6280-1 " 上的端口 "e0a" 和节点 "8060-1 " 上的端口 "e0i" 添加到 IP 空间默认值中的广播域管理中：</block>
  <block id="271e5c91e502440a4641a9bc05a02df6" category="list-text">输入以下命令，将每个 NAS 数据 LIF 迁移到 node4 ，每个 LIF 一次：</block>
  <block id="159244917402d1438cdf46fe3aac9f6b" category="paragraph">`network interface migrate -vserver &lt;vserver-name&gt; -lif &lt;datalif-name&gt; -destination-node &lt;node4&gt; -destination-port &lt;netport_ifgrp&gt; -home-node &lt;node4&gt;`</block>
  <block id="45c770ea39ce7a89e3fa87a10d51bc25" category="list-text">确保数据迁移持久：</block>
  <block id="d6454642fa6de121b504b22f0485cca0" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;datalif_name&gt; -home-port &lt;netport_ifgrp&gt;`</block>
  <block id="8ad5a71314693935e3bce24596d44ef1" category="list-text">【 man_lif_verif_4_Step8]] 输入以下命令列出所有网络端口并检查其输出，以验证所有链路的状态是否为 `up` ：</block>
  <block id="2a2c5a2b5a3d8988556727450e1a29e2" category="paragraph">以下示例显示了 `network port show` 命令的输出，其中一些 LIF 已启动，另一些 LIF 已关闭：</block>
  <block id="ed11f195f4f8f4017e6e51d88466a5a2" category="list-text">【 man_lif_verif_4_Step9]] 如果 `network port show` 命令的输出显示了新节点中不可用且旧节点中存在的网络端口，请通过完成以下子步骤删除旧网络端口：</block>
  <block id="7d4a5f4bd766fdaca38d0e0f6141ee90" category="list-text">输入以下命令，输入高级权限级别：</block>
  <block id="c72099f9d20f92c2086837037b97fc90" category="list-text">为每个旧网络端口输入以下命令一次：</block>
  <block id="5175d0f510ad3fc3bfd43ed48a78795e" category="paragraph">`network port delete -node &lt;node_name&gt; -port &lt;port_name&gt;`</block>
  <block id="f624be69667373d41ab52d00b2f142d4" category="list-text">[[man_lif_verif_4_Step10]] 通过完成以下子步骤，确保 SAN LIF 位于 node4 上的正确端口上：</block>
  <block id="175804e163fef92888323305db0643d2" category="paragraph">`network interface show -data-protocol iscsi_FCP -home-node node4`</block>
  <block id="35ca9ca12f5a137b27b3f6675a68cbd9" category="list-text">如果 node4 中的任何 SAN LIF 或 SAN LIF 组位于 node2 上不存在的端口上，请输入以下命令之一将其移动到 node4 上的相应端口：</block>
  <block id="2fbcca46574c079f4fb5aa457abc282e" category="list-text">将 LIF 状态设置为 down ：</block>
  <block id="faa2ac3f77b838a1d072635dac66a426" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;lif_name&gt; -status-admin down`</block>
  <block id="d760c0961d6b0dca026082038bc5020a" category="paragraph">`network interface modify -lif &lt;lif_name&gt; -home-port &lt;new_home_port&gt;`</block>
  <block id="8c0fbdd8434a31926cdab8193028a740" category="paragraph">`network interface modify ｛ -home-port &lt;port_on_node2 &gt; -home-node &lt;node2 &gt; -role data ｝ -home-port &lt;new_home_port_on_node4 &gt;`</block>
  <block id="2e3c23cf91c21a249f56ef996f27a61a" category="list-text">输入以下命令，将所有 LIF 的状态修改为 `up` ，以便 LIF 可以在节点上接受和发送流量：</block>
  <block id="8bc5cf3f80ad8a49c6ada1790801222e" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -home-port &lt;port_name&gt; -home-node &lt;node4&gt; lif &lt;lif_name&gt; -status-admin up`</block>
  <block id="f1eab2abaeb4ee31499ddda2b6919c69" category="list-text">在任一节点上输入以下命令并检查输出，以验证是否已将任何 SAN LIF 移动到正确的端口，以及 LIF 的状态是否为 `up` ：</block>
  <block id="8c094e66fbad29785444d71fd6c0dcac" category="paragraph">`network interface show -home-node &lt;node4&gt; -role data`</block>
  <block id="b0da7502535a227e64440d7a547ea6dd" category="list-text">[[man_lif_verif_4_Step13]] 如果任何 LIF 已关闭，请通过输入以下命令将 LIF 的管理状态设置为 `up` ，每个 LIF 一次：</block>
  <block id="ebb0dbe9b70bf46780fd67ec02dcb63a" category="paragraph">`network interface modify -vserver &lt;vserver_name&gt; -lif &lt;lif_name&gt; -status-admin up`</block>
  <block id="b8a386efa3c6aa2c0554c650dfc15d81" category="paragraph">在将 node2 替换为 node4 之前，您必须为 node2 发送 AutoSupport 消息，然后将 node2 所拥有的非根聚合重新定位到 node3 。</block>
  <block id="e4fe7514f720448bae21164b8b7a8a98" category="list-text">【第 1 步】向 NetApp 发送 node2 的 AutoSupport 消息：</block>
  <block id="088fc05a96b10d26c3f25411385117f2" category="paragraph">`ssystem node AutoSupport invoke -node &lt;node2&gt; -type all -message "upgrading &lt;node2&gt; from &lt;platform_old&gt; to &lt;platform_new&gt;"`</block>
  <block id="fb876532a1278ecbe2a9e2aa30ef59c2" category="list-text">验证是否已发送 AutoSupport 消息：</block>
  <block id="2e7bb8e758be89869c95ab23b96089a8" category="paragraph">`ssystem node AutoSupport show -node &lt;node2&gt;-instance`</block>
  <block id="632ce4fa5102cfac495b3c1490de0513" category="paragraph">字段 " 上次发送主题： " 和 " 上次发送时间： " 包含上次发送消息的消息标题以及消息发送时间。</block>
  <block id="872a7a7f067f5ac8e7a4df8b55cb3129" category="list-text">【第 3 步】重新定位非根聚合：</block>
  <block id="33cfec7231d81810ac482a09c5b69c00" category="list-text">列出 Node2 所拥有的聚合：</block>
  <block id="ceb3b4f875043e902ad0c2c7df540ac4" category="paragraph">`storage aggregate show -owner-name &lt;node2&gt;`</block>
  <block id="e5d22039d8dff591d18701d62fb4083d" category="list-text">启动聚合重新定位：</block>
  <block id="2a2be3ec611dd374f220ea53bd3e0758" category="paragraph">`storage aggregate relocation start -node &lt;node2&gt;-destination &lt;node3&gt;-aggregate-list * -no-controller-upgrade true`</block>
  <block id="cba3015195e189328dd15ef19c0cdcff" category="admonition">此命令仅查找非根聚合。</block>
  <block id="c3aa957126a7abd53abe73b1af74dfb8" category="paragraph">重新定位在后台进行。重新定位聚合可能需要几秒到几分钟的时间。此时间既包括客户端中断，也包括非中断部分。此命令不会重新定位任何脱机或受限聚合。</block>
  <block id="00bfced11707df12b7beabc9cb1854c6" category="list-text">返回到管理权限级别：</block>
  <block id="6b5ba31b334c119525a36a4c654c79fc" category="list-text">验证 node2 的重新定位状态：</block>
  <block id="a6f10385b3e5082eca317137f25e29be" category="paragraph">`storage aggregate relocation show -node &lt;node2&gt;`</block>
  <block id="e0b277bd202f6924948f2209a81b8cb0" category="paragraph">重新定位聚合后，输出将显示 "done" 。</block>
  <block id="5f99044f7fd5dd98c2e83408099900a7" category="admonition">您必须等待 node2 所拥有的所有聚合都重新定位到 node3 ，然后再继续下一步。</block>
  <block id="c8ee48ad015fbbcc6f1c096e31a9b081" category="cell">转至 <block ref="0d8c3ea689b325a11fe26527348a6eff" category="inline-xref-macro-rx"></block>。</block>
  <block id="12d1b6919c7c68de63bfe55847d735a3" category="cell">任何聚合失败或被否决</block>
  <block id="d6e415f41ef651a14c6408b58b5f34fa" category="list-text">显示详细的状态消息：</block>
  <block id="4382ef08403cdc87d0db14f4b0dbe621" category="paragraph">`storage aggregate show -instance`</block>
  <block id="52aa1d8f7452c944bbc112edc69d159d" category="paragraph">您还可以检查 EMS 日志以查看所需的更正操作。</block>
  <block id="64a1f8cc2ee975b38446e3b8f940164e" category="paragraph">* 注释 * ： `event log show` 命令可列出发生的任何错误。</block>
  <block id="3f8dbc42a73ae9a6487e0757b393d2fb" category="paragraph">`storage aggregate relocation start -node &lt;node2&gt;-destination &lt;node3&gt;-aggregate-list * -no-controllerupgrade true`</block>
  <block id="856f354dcadb2aef2f73a7a610300d05" category="paragraph">如有必要，您可以使用以下方法之一强制执行重新定位：</block>
  <block id="6abaecd9da93fcc5260d726fe8a8fa56" category="list-text">通过覆盖否决检查：</block>
  <block id="b62638cdb7e1a6240698379b6c81d35b" category="paragraph">`s存储聚合重新定位 start -override-vetoes true -no-controller-upgrade`</block>
  <block id="230cd704f9f55647ecfe8129ed941e8e" category="list-text">通过覆盖目标检查：</block>
  <block id="35df77bf8b92d76c3b871148e8c46c51" category="paragraph">`storage aggregate relocation start -override-destination-checks true -ndocontroller-upgrade`</block>
  <block id="bba7ef312132aa21315af40f6e3ff0f6" category="paragraph">有关 storage aggregate relocation 命令的详细信息，请转至 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 链接到 _Microsoft ONTAP 9 磁盘和聚合高级指南 _ 和 _ONTAP 9 命令：手册页参考 _ 。</block>
  <block id="329fdaa2cd3cf795781d3ee938047475" category="list-text">【 man_relocate_2_3_step6]] 验证 node3 上的所有非根聚合是否联机：</block>
  <block id="ef54d8b76027ced4d5a36092399b0849" category="paragraph">`storage aggregate show -node &lt;node3&gt; -state offline -root false`</block>
  <block id="ecc3f3e0b2ef3c70a30fe8be1af81d75" category="paragraph">如果任何聚合已脱机或变为外部聚合，则必须使其联机，每个聚合一次：</block>
  <block id="1dc7145853b865022c2423c0562bf7ed" category="list-text">验证 node3 上的所有卷是否均已联机：</block>
  <block id="8526a5587200c78144bc2d1fabd13d3a" category="paragraph">如果 node3 上的任何卷脱机，则必须使其联机，每个卷一次：</block>
  <block id="7adac7d8af549857f31077a908e21bf4" category="paragraph">`volume online -vserver &lt;vserver-name&gt; -volume &lt;volume-name&gt;`</block>
  <block id="5d28ff5ed2a011a10e2c1fd4e4e77822" category="list-text">验证 node2 不拥有任何联机非根聚合：</block>
  <block id="dcc422920951416bc8ad4e66178b7556" category="paragraph">`storage aggregate show -owner-name &lt;node2&gt;-ha-policy sfo -state online`</block>
  <block id="232cf0d45bdcae298c19689d1bf05bea" category="paragraph">命令输出不应显示联机非根聚合，因为所有非根联机聚合都已重新定位到 node3 。</block>
  <block id="c8e5788139bcf856c78024561a09d301" category="paragraph">在将 node1 替换为 node3 之前，您需要先使用 storage aggregate relocation 命令将非根聚合从 node1 移动到 node2 ，然后再验证重新定位。</block>
  <block id="fedb2a32e0130d4ae814cd5cc418f72f" category="list-text">【第 1 步】通过完成以下子步骤重新定位非根聚合：</block>
  <block id="825e41d7fbc98709f251a794a6b6711e" category="paragraph">`storage aggregate relocation start -node &lt;node1&gt; -destination &lt;node2&gt;-aggregate-list * -no-controller-upgrade true`</block>
  <block id="9cac941a6d5ae11593b2f268722b37cf" category="paragraph">重新定位将在后台进行。重新定位聚合可能需要几秒到几分钟的时间。时间包括客户端中断和非中断部分。此命令不会重新定位任何脱机或受限聚合。</block>
  <block id="db3c32b2915aa7ffd2fcacb5e017dbc9" category="list-text">在 node1 上输入以下命令，以检查重新定位状态：</block>
  <block id="716079406663f621295f101d9a247a06" category="paragraph">`storage aggregate relocation show -node &lt;node1&gt;`</block>
  <block id="d550e31a6ccbb056c2d7ab1e68692363" category="admonition">等待 node1 拥有的所有非根聚合重新定位到 node2 ，然后再继续下一步。</block>
  <block id="b77ef5d765d72155b0da6da7cb47f0ed" category="cell">如果重新定位 ...</block>
  <block id="b15b9b498c001e92853f9fea21ef7ef8" category="cell">那么 ...</block>
  <block id="a0fba600b5c045fae79ae007d77c6f09" category="cell">所有聚合均已成功</block>
  <block id="2ac86beb93582e4754639412014b59eb" category="cell">转至 <block ref="449ef68af8e0094cdf2287c1416d1ff3" category="inline-xref-macro-rx"></block>。</block>
  <block id="1141d7067c13df20d6186fc00309e10b" category="cell">任何聚合出现故障或被否决</block>
  <block id="642f5c5e7ce4f58241664b57c66dae22" category="list-text">重新定位任何出现故障或被否决的聚合： `storage aggregate relocation start -node &lt;node1&gt; - destination &lt;node2&gt; -aggregate-list * -no-controller-upgrade true`</block>
  <block id="9eb367512ec712e8def159a017644487" category="list-text">返回到管理员级别： `set -privilege admin` 如有必要，您可以使用以下方法之一强制执行重新定位：</block>
  <block id="a927bee35dc67490b39aa8c4291ca745" category="list-text">覆盖否决检查： `s存储聚合重新定位 start -override-vetoes true -no-controller-upgrade`</block>
  <block id="592a7b363e77ec54f4a9454a15b2fa70" category="list-text">覆盖目标检查： `s存储聚合重新定位 start -override-destination-checks true -no-controller-upgrade`</block>
  <block id="004721d229fe907e42d94f6930fb3cb6" category="paragraph">请参见 <block ref="3352feee8874655040be7cccb077b0f9" category="inline-link-macro-rx"></block> 要链接到 _Disks 和聚合高级指南 _ 和 _Storage ONTAP 9 命令：手册页参考 _ ，请了解有关存储聚合重新定位命令的详细信息。</block>
  <block id="dc1c151c89f0b15dbd97af39108f3403" category="list-text">[[man_relocate_1_2_step4]] 验证所有非根聚合是否均已联机及其在节点 2 上的状态：</block>
  <block id="5614977b273243c18da92e09a399f4ff" category="list-text">在 node2 上输入以下命令并检查其输出，以验证 node2 上的所有卷是否联机：</block>
  <block id="c5fde6e8a15ba7f224d13ea83e3c2c34" category="paragraph">可在上一个 `volume show` 命令的输出中找到与此命令结合使用的 `vserver-name` 。</block>
  <block id="9b65be5be5396e39e6973853034324bc" category="list-text">在 node2 上输入以下命令：</block>
  <block id="8976f4697be8e317a4fb1b4403b3fb59" category="paragraph">`storage failover show -node &lt;node2&gt;`</block>
  <block id="7fb67b5bff7cd5b5583c80436154eeca" category="paragraph">输出应显示以下消息：</block>
  <block id="bc50ecc4b8edbc1374bfa0e110d2cdf4" category="list-text">验证 node1 不拥有任何联机的非根聚合：</block>
  <block id="388b62ec918acf6b46e5c8dc7c42fc85" category="paragraph">`storage aggregate show -owner-name &lt;node1&gt; -ha-policy sfo -state online`</block>
  <block id="e68954fba0117f19310a10c0e5f075ec" category="paragraph">输出不应显示任何已重新定位到 node2 的联机非根聚合。</block>
  <block id="fbe97acb6a92a57289db38df1cbd3acc" category="paragraph">您需要在机架中安装 node3 ，将 node1 的连接传输到 node3 ，启动 node3 并安装 ONTAP 。然后，您需要重新分配 node1 的任何备用磁盘，属于根卷的任何磁盘以及先前未重新定位到 node2 的任何非根聚合。</block>
  <block id="57ed4780c0ea12318bd8f9bbfaddce0f" category="paragraph">如果 node3 与 node1 上安装的 ONTAP 9 版本不同，则需要对其进行网络启动。安装 node3 后，从 Web 服务器上存储的 ONTAP 9 映像启动它。然后，您可以将正确的文件下载到启动介质设备，以供后续系统启动。请参见 <block ref="4815c2d091d790c1d3bab94177b38eaf" category="inline-link-macro-rx"></block>。</block>
  <block id="0570d4a42e9be3c955a39beb93846d1e" category="paragraph">但是，如果 node3 安装的 ONTAP 9 版本与 node1 相同或更高，则不需要对其执行网络启动。</block>
  <block id="9811d17595c532c211fe17a338c29af7" category="admonition">* 重要信息 * ：如果要升级连接到存储阵列的 V 系列系统或使用连接到存储阵列的 FlexArray 虚拟化软件的系统，则需要完成升级 <block ref="533e5b5383ee7eeec7355f568e8aaf6b" category="inline-xref-macro-rx"></block> 到 <block ref="593996bb06ec10671cada9089fb35dd4" category="inline-xref-macro-rx"></block>，请将此部分保留在 <block ref="72140e6a9de023ebc205559b767779ea" category="inline-xref-macro-rx"></block> 并按照中的说明进行操作 <block ref="b874d68563e926f19d0f15015f15f190" category="inline-link-macro-rx"></block> 和 <block ref="a9e7644d0d01665bbdf613cdb831fa7f" category="inline-link-macro-rx"></block> 根据需要在维护模式下输入命令。然后，您必须返回到此部分并继续使用 <block ref="239474d202713b3a406727408fd68f72" category="inline-xref-macro-rx"></block>。但是，如果要升级具有存储磁盘的系统，则需要完成整个部分，然后转到 <block ref="b874d68563e926f19d0f15015f15f190" category="inline-link-macro-rx"></block> 和 <block ref="a9e7644d0d01665bbdf613cdb831fa7f" category="inline-link-macro-rx"></block>，在集群提示符处输入命令。</block>
  <block id="1b5474698e4bc6bfa928589ed23b1571" category="list-text">【 man_install3_step1]] 确保为 node3 预留机架空间。</block>
  <block id="773d119bfcf7806a94138f5cf32996fe" category="list-text">【第 2 步】按照适用于您的节点型号的 _Installation and Setup Instructions_ 在机架中安装 node3 。</block>
  <block id="443b6c77a2b004d6de0907662fe36a4d" category="list-text">node3 平台的 _Installation and Setup Instructions_or _FlexArray 虚拟化安装要求和参考 _ 。</block>
  <block id="e233e040e6ab1ade1870396947dd6b5a" category="admonition">您可能不需要将互连卡或集群互连缆线连接从 node1 移至 node3 ，因为大多数平台型号都具有唯一的互连卡型号。对于 MetroCluster 配置，您需要将 FC-VI 缆线连接从 node1 移至 node3 。如果新主机没有 FC-VI 卡，则可能需要移动 FC-VI 卡。</block>
  <block id="63cc66bd900313017fb0834b1cbbbc81" category="list-text">【 man_install3_step4]] 打开 node3 的电源，然后在控制台终端上按 Ctrl-C 以访问启动环境提示符，从而中断启动过程。</block>
  <block id="6c2cb2a49908831d5791f25bb5371a3d" category="list-text">如果您在中看到警告消息，则需要执行以下操作 <block ref="189d751c0d059b7e2fcaef080c81111f" category="inline-xref-macro-rx"></block>，执行以下操作：</block>
  <block id="7efd430adfeaf9ea4f3e48e21d2c4f96" category="admonition">* 注意 * ：请勿覆盖此延迟；如果不允许电池充电，可能会导致数据丢失。</block>
  <block id="5b8c681411bac96a813b6b62eba17d9c" category="list-text">【 man_install3_step6]] 执行以下操作之一：</block>
  <block id="ad9768b53d0a33cd1368bd0b1d373a3b" category="cell">跳过第 7 步到第 12 步，然后转到 <block ref="85131af613f0169831e213f11ca11041" category="inline-xref-macro-rx"></block>。</block>
  <block id="6dd9e2c232d9aa889adc2bdc1d259396" category="list-text">转至 <block ref="fae618cfa140cbca52d057afef5df1da" category="inline-link-macro-rx"></block> 并完成各小节 <block ref="b874d68563e926f19d0f15015f15f190" category="inline-link-macro-rx"></block> 和 <block ref="a9e7644d0d01665bbdf613cdb831fa7f" category="inline-link-macro-rx"></block>，根据您的系统情况而定。</block>
  <block id="66b6cfbf89b613b9a80d84ec1d7b5fa0" category="list-text">返回到此部分，完成从开始的其余步骤 <block ref="239474d202713b3a406727408fd68f72" category="inline-xref-macro-rx"></block>。</block>
  <block id="120d825f771126cb963c76c2ff005e6d" category="list-text">【 man_install3_step7]] 将新节点的 FC 启动程序端口添加到交换机分区。</block>
  <block id="12aae7624013a12c0ade8f6f2e309d62" category="paragraph">如果您的系统具有磁带 SAN ，则需要对启动程序进行分区。有关说明，请参见存储阵列和分区文档。</block>
  <block id="0dd10d8b45274d5c198af78bfab2e446" category="list-text">【 man_install3_step8]] 将 FC 启动程序端口作为新主机添加到存储阵列，将阵列 LUN 映射到新主机。</block>
  <block id="5cca5c853f000ca16ba17533a6116cd7" category="list-text">[[man_install3_step9]] 修改与存储阵列上的阵列 LUN 关联的主机或卷组中的全球通用端口名称（ WWPN ）值。</block>
  <block id="6a81c1ece5ddd721a1ff7521454f87c9" category="list-text">如果您的配置使用基于交换机的分区，请调整分区以反映新的 WWPN 值。</block>
  <block id="fa1040cb978ca2065cad32e28e6d9d58" category="list-text">[[man_install3_step11]] 验证阵列 LUN 现在是否对 node3 可见：</block>
  <block id="d8096974edc78f9fe2db726869876695" category="paragraph">系统将显示每个 FC 启动程序端口可见的所有阵列 LUN 。如果阵列 LUN 不可见，您将无法在本节稍后将磁盘从 node1 重新分配到 node3 。</block>
  <block id="b69192040391e08f61402b09c27822b8" category="list-text">【 man_install3_step12]] 按 Ctrl-C 显示启动菜单并选择维护模式。</block>
  <block id="fe85761838c7d215174afe4ace6c66f0" category="list-text">在维护模式提示符处，输入以下命令：</block>
  <block id="907c22891918b5b80e66731ae6eed77e" category="list-text">【 man_install3_step14]] 执行以下操作之一：</block>
  <block id="8b2f23f3c3f7445164b524932e61d65b" category="cell">如果要升级到的系统位于 ...</block>
  <block id="1f00007c6687ede4ed2d2b6e91ce451d" category="cell">双机箱配置（控制器位于不同机箱中）</block>
  <block id="1ec921c80439dda2ee883653fa1acb7b" category="cell">转至 <block ref="4332c8cc4c85f33bda2a347fe16e2dc6" category="inline-xref-macro-rx"></block>。</block>
  <block id="0471a95f16e566048e66f2d81f432967" category="cell">单机箱配置（控制器位于同一机箱中）</block>
  <block id="0aaa18e158b2b22ed630223549710480" category="list-text">将控制台缆线从 node3 切换到 node4 。</block>
  <block id="85418bdb866bf209cc89fc9250fd0f04" category="paragraph">如果两个控制器位于同一机箱中，则应已打开电源。</block>
  <block id="0f26d4df0f59d99659fc6ffdd8539aff" category="paragraph">* 注 * ：在启动环境提示符处保留 node4 ；您将返回到中的 node4 <block ref="f326c815b47f4f2909494bae5cd735d5" category="inline-link-macro-rx"></block>。</block>
  <block id="620bed07fd84663ccd35004111b0a13c" category="list-text">如果您在中看到警告消息，请执行此操作 <block ref="189d751c0d059b7e2fcaef080c81111f" category="inline-xref-macro-rx"></block>，按照中的说明进行操作 <block ref="593996bb06ec10671cada9089fb35dd4" category="inline-xref-macro-rx"></block></block>
  <block id="a70d58ca96ede2bc6122de5eaba9afaf" category="list-text">将控制台缆线从 node4 切回到 node3 。</block>
  <block id="7c0d2cf152b2cde561a140a996176952" category="list-text">【 man_install3_step15]] 为 ONTAP 配置 node3 ：</block>
  <block id="7238df7481760a2449dc9206c452edfe" category="list-text">`s此配置正在使用 NetApp 存储加密（ NSE ），则必须将` etenv bootarg.storageencryption.support `命令设置为` true `，并将 kmip.init.maxwait` `变量设置为` off ，以避免在加载 node1 配置后出现启动环路：</block>
  <block id="0546806bd19b344e7d0ca13460d96992" category="list-text">【 ｛ man_install3_step17]] 如果 node3 上安装的 ONTAP 版本与 node1 上安装的 ONTAP 9 版本相同或更高，请列出磁盘并将其重新分配给新的 node3 ：</block>
  <block id="7ce11de7229520360ee33defaf28ec82" category="admonition">* 警告 * ：如果此新节点曾在任何其他集群或 HA 对中使用过，则必须运行 `wipeconfig` 才能继续。否则可能会导致服务中断或数据丢失。如果先前使用了替代控制器，请联系技术支持，尤其是在这些控制器运行的是在 7- 模式下运行的 ONTAP 时。</block>
  <block id="b04b66d312941ba2b1d5910ec5f5fb36" category="list-text">【 man_install3_step18]] 按 CTRL-C 显示启动菜单。</block>
  <block id="7be8c6136747afe24ab6f25f931c2451" category="list-text">[[man_install3_step19]] 执行以下操作之一：</block>
  <block id="b65dee077de24058e64aa96e60e2a56a" category="cell">node3 上的 ONTAP 版本是否正确或最新</block>
  <block id="a17dd4e0d7995e108ec012fad7f027d2" category="cell">转至 <block ref="f66707bf1ec53e37a427dd9510962619" category="inline-xref-macro-rx"></block>。</block>
  <block id="de22fad1fba6c28f624ef4e272674d1c" category="cell">node3 上的 ONTAP 版本正确或最新</block>
  <block id="46f709b9c191a3a487187b13c2365dfb" category="cell">转至 <block ref="c27981c94d7a26c42c925c89e96e7aa2" category="inline-xref-macro-rx"></block>。</block>
  <block id="fd96d8e5cccd1d83cf17d6327a03d1c6" category="list-text">【 man_install3_step20]] 通过选择以下操作之一来配置网络启动连接。</block>
  <block id="4c1c25953b4f042240caac106d2566d7" category="admonition">您应使用管理端口和 IP 作为网络启动连接。请勿使用数据 LIF IP ，否则在执行升级期间可能会发生数据中断。</block>
  <block id="5de475f75526f08af360b918b25d9c72" category="cell">在启动环境提示符处输入以下命令，以自动配置连接： `ifconfig e0M -auto`</block>
  <block id="8348f733ee288862d85696832806d154" category="cell">在启动环境提示符处输入以下命令以手动配置连接： `ifconfig e0M -addr=&lt;filer_addr&gt; -mask=&lt;netmask&gt; -gw=&lt;gateway&gt; -dns=&lt;dns_addr&gt; domain=&lt;dns_domain&gt;` ` &lt;filer_addr&gt;` 是存储系统的 IP 地址。` &lt; 网络掩码 &gt;` 是存储系统的网络掩码。` &lt; 网关 &gt;` 是存储系统的网关。` &lt;dns_addr&gt;` 是网络上名称服务器的 IP 地址。` &lt;dns_domain&gt;` 是域名服务（ DNS ）域名。如果使用此可选参数，则无需在网络启动服务器 URL 中使用完全限定域名；您只需要服务器的主机名。* 注 * ：接口可能需要其他参数。有关详细信息，请在固件提示符处输入 `help ifconfig` 。</block>
  <block id="c6515be7805d880dbdafbd44b289b127" category="list-text">【 man_install3_step21]] 对 node3 执行网络启动：</block>
  <block id="060bac7551430a178937e2648b5887ad" category="cell">`netboot \http://&lt;web_server_ip&gt;/&lt;path_to_webaccessible_directory&gt;/netboot/kernel`</block>
  <block id="00b4984c2d25fdcefc8d29921eef1f1e" category="cell">`netboot \http://&lt;web_server_ip&gt;/&lt;path_to_webaccessible_directory&gt;/&lt;ontap_version&gt;_image.tgz`</block>
  <block id="59dc84b79b5b387630517d0425882b8b" category="paragraph">` &lt;path_to_the_web-accessible_directory&gt;` 应指向您在中下载 ` &lt;ontap_version&gt;_image.tgz` 的位置 <block ref="d7ca8bd1bdacba48998a89c59527e756" category="inline-link-macro-rx"></block> 在 _prepare for netboot_ 一节中。</block>
  <block id="2fb52103bc9daf7b4aede017a96951c9" category="list-text">在启动菜单中，选择选项 * （ 7 ）首先安装新软件 * 。</block>
  <block id="69a0e067620a40fba4263752d3fe4568" category="paragraph">注意适用场景可无中断升级 ONTAP ，而不是升级控制器。</block>
  <block id="f830f5c2c7020add65334fcbe428e442" category="admonition">请始终使用 netboot 将新节点更新为所需映像。如果使用其他方法在新控制器上安装映像，则可能安装了错误的映像。此问题描述适用场景是 ONTAP 的所有版本。</block>
  <block id="04099f33ed449c6b9e9de3b50608f5b9" category="list-text">如果系统提示您继续运行操作步骤，请输入 `y` ，并在系统提示您输入软件包时输入以下 URL ：</block>
  <block id="3c0f763f2bc1dd7e6fadcfba8981f852" category="paragraph">` http://&lt;web_server_ip&gt;/&lt;path_to_web-accessible_directory&gt;/&lt;ontap_version_image&gt;.tgz`</block>
  <block id="2c7541d49584476284eeeb476f886996" category="list-text">[[man_install3_step24]] 完成以下子步骤：</block>
  <block id="f5344ffb10f5a3797c46c51d263a2247" category="list-text">【 man_install3_step25]] 输入 `5` 以选择 * （ 5 ）维护模式启动 * ，然后在系统提示您继续启动时输入 `y` 。</block>
  <block id="785f077ce03eca259bde1ebc98236191" category="list-text">【 man_install3_step26]] 继续操作前，请转到 <block ref="fae618cfa140cbca52d057afef5df1da" category="inline-link-macro-rx"></block> 对节点上的 FC 或 UTA/UTA2 端口进行任何必要的更改。</block>
  <block id="28d8bed0b221acc406520dd121da3607" category="paragraph">按照这些部分中的建议进行更改，重新启动节点并进入维护模式。</block>
  <block id="3c2b28e2fbf2a2223e837ab88d03f849" category="list-text">【 man_install3_step27]] 找到 node3 的系统 ID ：</block>
  <block id="5f2c6daaf0c238ad93e5125dbf2761ac" category="admonition">输入命令后，您可能会看到消息 `disk show ： no disks match option -a` 。此消息不是错误消息，因此您可以继续使用操作步骤。</block>
  <block id="11856588314d0c959b2b916a938edde8" category="inline-link-macro">将非根聚合从 node1 重新定位到 node2</block>
  <block id="5193fe09e1ceefb41d5d867b112b9d76" category="list-text">【 man_install3_step28]] 重新分配 node1 的备用磁盘，属于根的所有磁盘以及先前未重新定位到 node2 的任何非根聚合 <block ref="b90d8347ded957c31748eee44116abad" category="inline-link-macro-rx"></block>。</block>
  <block id="e58f70cf5e99e435b7646dac5761bf14" category="paragraph">根据您的系统是否具有共享磁盘，输入 `disk reassign` 命令的适当格式：</block>
  <block id="b7e4748ce69e686648ca756a108c4b9a" category="cell">磁盘类型</block>
  <block id="7dcd3c42056665a1fe2861837141a4ef" category="cell">然后运行命令 ...</block>
  <block id="0750281966aad85c85445c89d7c91b52" category="cell">`dreassign -s &lt;node1_sysid&gt; -d &lt;node3_sysid&gt; -p &lt;node2_sysid&gt;`</block>
  <block id="4f477aa8d74177d31f1821bc7c80ca24" category="cell">无共享磁盘</block>
  <block id="8afa8f9cacfed8bdd6f0488284dc4065" category="cell">`dreassign` &lt;node1_sysid&gt; -d &lt;node3_sysid&gt;</block>
  <block id="8ebc8c8801836bd409313dd264bebb92" category="inline-link-macro">记录 node1 信息</block>
  <block id="848124e1b504add6b8579f483956bfa5" category="paragraph">对于 ` &lt;node1_sysid&gt;` 值，请使用中捕获的信息 <block ref="111c70a978efb37ba3bd0ea564da1d79" category="inline-link-macro-rx"></block>。要获取 ` 的值 &lt;node3_sysid&gt;` ，请使用 `ssysconfig` 命令。</block>
  <block id="fa1b01822fe176dec2ddb8bb6b318a7d" category="paragraph">`d` reassign ` 命令仅重新分配` &lt;node1_sysid&gt; 为当前所有者的磁盘。</block>
  <block id="41ba4da5f40ea13d5dbc91aee57574fa" category="list-text">【 man_install3_step29]] 输入 `n` 。</block>
  <block id="fa85c8699d7f56dacbb4e8faea6f7ca9" category="list-text">【 man_install3_step30]] 输入 `y`</block>
  <block id="3048e99df5c1d939bc99597cf7c39563" category="list-text">【 man_install3_step31]] 输入 `y` 。</block>
  <block id="fae6f0fa0e0d1485407928519885a027" category="list-text">【 ｛ man_install3_step32]] 如果要从具有外部磁盘的系统升级到支持内部和外部磁盘的系统（例如， AFF A800 系统），请将 node1 聚合设置为 root ，以确保 node3 从 node1 的根聚合启动。</block>
  <block id="d3d32ef75ce9ff503846dd7cba71bf68" category="admonition">* 警告 * ：您必须按所示的确切顺序执行以下子步骤；否则可能发生原因会导致中断甚至数据丢失。</block>
  <block id="78eac47117b1548ba46bbe2c967c2d0e" category="list-text">如果需要，将 node1 聚合置于联机状态：</block>
  <block id="166de6b414dfe6910615ee231f5b5ac9" category="paragraph">`aggr_online &lt;root_aggr_from_node1&gt;`</block>
  <block id="ac66c3891b6bd6651ca36713f2cbc96d" category="list-text">阻止 node3 从其原始根聚合启动： `aggr offline &lt;root_aggr_on_node3&gt;`</block>
  <block id="4b869d3d95b4e6c45358c7bc8e4b934b" category="paragraph">`aggr options &lt;aggr_from_node1&gt; root`</block>
  <block id="b954307d2b22ae21f23dbb0d3021f158" category="list-text">【 man_install3_step33]] 验证控制器和机箱是否配置为 `ha` ：</block>
  <block id="87e6946315bfe910b90ed3288541cb11" category="paragraph">以下示例显示了 ha-config show 命令的输出：</block>
  <block id="9ed2f003b53007950b273f820637f2f3" category="paragraph">系统会在 PROM 中记录它们是采用 HA 对还是独立配置。独立系统或 HA 对中的所有组件的状态都必须相同。</block>
  <block id="915fe2ff566601b3b69119813a6a715c" category="paragraph">如果控制器和机箱未配置为 "ha" ，请使用以下命令更正配置：</block>
  <block id="43a7c5c250e7fdd6688e153749ea1e66" category="list-text">【 man_install3_step34]] 销毁 node3 上的邮箱：</block>
  <block id="8d299662551d8d2c41258f4f6d6c9a12" category="paragraph">控制台将显示以下消息：</block>
  <block id="675438e125383dfd4814c428aefc13d8" category="list-text">【 man_install3_step35]] 在提示符处输入 `y` 确认您要销毁本地邮箱。</block>
  <block id="0f364398a13cd3160c5a3eba4374e4ce" category="list-text">【 man_install3_step36]] 退出维护模式：</block>
  <block id="6c2cda43f17004428fa50b03b8e373c3" category="list-text">在 node2 上，检查系统日期，时间和时区：</block>
  <block id="dd26f958a5b55f32337b614d1f3ab0b4" category="list-text">【 ｛ man_install3_step38]] 在 node3 上，在启动环境提示符处检查日期：</block>
  <block id="0c06e4208a8e928e9b4bef1d6977045b" category="list-text">【 man_install3_step39]] 如有必要，请在 node3 上设置日期：</block>
  <block id="837e654f683f43c3c5fa5a8cbc3e1758" category="list-text">在 node3 上，在启动环境提示符处检查时间：</block>
  <block id="eddc7836dd13de8cd3248be302e5a1a2" category="list-text">【 man_install3_step41]] 如有必要，请在 node3 上设置时间：</block>
  <block id="39556538db3e5f05fbb53219f4983f96" category="inline-xref">第 28 步</block>
  <block id="7485a5597807044bfa9f5d885f51e65e" category="list-text">【 man_install3_step42]] 验证配对系统 ID 是否设置正确，如中所述 <block ref="a332b57e87c8a775e38e07b999240874" category="inline-xref-macro-rx"></block> 在 -p 开关下：</block>
  <block id="ec135f98d38764e511e3c524db87080e" category="list-text">如果需要，请在 node3 上设置配对系统 ID ：</block>
  <block id="7cab439150d9019f1bfd1705f608418d" category="list-text">【 man_install3_step44]] 在启动环境提示符处访问启动菜单：</block>
  <block id="09022876876a6198264f6a07698a4d4c" category="list-text">在启动菜单中，输入 `6` 以选择选项 * （ 6 ） Update flash from backup config* 。</block>
  <block id="e5dbae26747d85c8b1145f23fe152ba6" category="list-text">在提示符处输入 `y` 。</block>
  <block id="8a149c3025530503ca7711ed784cd091" category="paragraph">启动正常进行，然后系统会要求您确认系统 ID 不匹配。</block>
  <block id="c818f07a4851d5ab8b1a806cff312e25" category="list-text">[[man_install3_step47]] 确认不匹配，如以下示例所示：</block>
  <block id="fb74f9c51a3457e88ae16fbed6c6b978" category="paragraph">节点可能会经过一轮重新启动，然后才能正常启动。</block>
  <block id="f52332ab232b64dcde0ca0ea781c1755" category="list-text">【 man_install3_step48]] 登录到 node3 。</block>
  <block id="3b878279a04dc47d60932cb294d96259" category="sidebar">概述</block>
  <block id="3ffee04e4bb020103f1bece18c2ac58e" category="sidebar">自动执行控制器升级过程</block>
  <block id="eee953986530407bd81dc7dec37f7151" category="sidebar">第 1 阶段准备升级</block>
  <block id="d410001785d5e6cf46422378e7dc305f" category="sidebar">第 2 阶段重新定位和停用节点 1</block>
  <block id="db0f435716365df4f28208e723c02179" category="sidebar">第 3 阶段安装和启动节点 3.</block>
  <block id="cd93c6e9e61b2d31c781ea8786cb4e81" category="sidebar">第 4 阶段重新定位和停用节点 2.</block>
  <block id="62e340083f3c5febba2fa693ce759a1a" category="sidebar">第 5 阶段安装和启动节点 4.</block>
  <block id="ded1f8eb21bf382d51471642d150b8d5" category="sidebar">第 6 阶段完成升级</block>
  <block id="7544ac790dfd93708d405ed1581f027e" category="sidebar">使用 " 系统控制器更换 " 命令升级运行 ONTAP 9.8 或更高版本的控制器硬件</block>
  <block id="11e53cadb3f3ce7f81a0771ae2847cad" category="sidebar">使用 system controller replace 命令升级运行 ONTAP 9.8 或更高版本的控制器硬件</block>
  <block id="abcb075e8014a215302582b99f190e3b" category="sidebar">使用 system controller replace 命令将运行 ONTAP 9.5 的控制器硬件升级到 9.7</block>
  <block id="830b2fbf979d4b0e6b8a05c44baa464f" category="sidebar">使用聚合重新定位手动升级运行 ONTAP 9.8 或更高版本的控制器硬件</block>
  <block id="48619622a13bb2610110f65aed3c8a90" category="sidebar">使用聚合重新定位手动升级运行 ONTAP 9.7 或更早版本的控制器硬件</block>
</blocks>