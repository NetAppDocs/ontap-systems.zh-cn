---
permalink: c190/bootmedia-replace.html 
sidebar: sidebar 
keywords: aff c190, replace, boot, media, controller, module, fru map 
summary: 您必须在控制器模块中找到启动介质，然后按照说明进行更换。 
---
= 卸下控制器模块，更换启动介质并将启动映像传输到启动介质— AFF C190
:icons: font
:imagesdir: ../media/


要更换启动介质，您必须卸下受损的控制器模块，安装替代启动介质并将启动映像传输到 USB 闪存驱动器。



== 第 1 步：卸下控制器

[role="lead"]
要访问控制器模块中的组件，必须先从系统中卸下控制器模块，然后再卸下控制器模块上的盖板。

.步骤
. 如果您尚未接地，请正确接地。
. 松开将缆线绑在缆线管理设备上的钩环带，然后从控制器模块上拔下系统缆线和 SFP （如果需要），并跟踪缆线的连接位置。
+
将缆线留在缆线管理设备中，以便在重新安装缆线管理设备时，缆线排列有序。

. 从控制器模块的左右两侧卸下缆线管理设备并将其放在一旁。
+
image::../media/drw_25xx_cable_management_arm.png[DRW 25xx 缆线管理臂]

. 按压凸轮把手上的闩锁，直到其释放为止，完全打开凸轮把手以从中板释放控制器模块，然后用两只手将控制器模块拉出机箱。
+
image::../media/drw_2240_x_opening_cam_latch.png[DRW 2240 x 打开凸轮闩锁]

. 将控制器模块翻转，将其放在平稳的表面上。
. 滑动蓝色卡舌以释放盖板，然后向上翻盖并打开，从而打开盖板。
+
image::../media/drw_2600_opening_pcm_cover.png[DRW 2600 打开 PCM 盖板]





== 第 2 步：更换启动介质

[role="lead"]
您必须在控制器模块中找到启动介质，然后按照说明进行更换。

. 使用下图或控制器模块上的 FRU 映射找到启动介质：
. 按启动介质外壳上的蓝色按钮，将启动介质从其外壳中释放，然后将其竖直拉出启动介质插槽。
+

NOTE: 请勿将启动介质竖直向上扭曲或拉，因为这样可能会损坏插槽或启动介质。

. 将替代启动介质的边缘与启动介质插槽对齐，然后将其轻轻推入插槽。
. 检查启动介质，确保其完全固定在插槽中。
+
如有必要，请取出启动介质并将其重新插入插槽。

. 向下推启动介质以接合启动介质外壳上的锁定按钮。
. 合上控制器模块外盖。




== 第 3 步：将启动映像传输到启动介质

[role="lead"]
您可以使用已安装映像的 USB 闪存驱动器将系统映像安装到替代启动介质。但是，您必须在此操作步骤期间还原 `var` 文件系统。

* 您必须具有一个已格式化为 32 位的 USB 闪存驱动器，并且容量至少为 4 GB 。
* 与受损控制器运行的 ONTAP 映像版本相同的副本。您可以从 NetApp 支持站点上的 * 下载 * 部分下载相应的映像
+
** 如果启用了 NVE ，请按照下载按钮中的指示，使用 NetApp 卷加密下载映像。
** 如果未启用 NVE ，请按照下载按钮中的指示，在不使用 NetApp 卷加密的情况下下载映像。


* 如果您的系统是 HA 对，则必须具有网络连接。
* 如果您的系统是独立系统，则不需要网络连接，但在还原 var 文件系统时，您必须执行额外的重新启动。


.步骤
. 将控制器模块的末端与机箱中的开口对齐，然后将控制器模块轻轻推入系统的一半。
. 重新安装缆线管理设备，并根据需要重新对系统进行布线。
+
重新布线时，如果已卸下介质转换器（ SFP ），请务必重新安装它们。

. 将 USB 闪存驱动器插入控制器模块上的 USB 插槽。
+
确保将 USB 闪存驱动器安装在标有 USB 设备的插槽中，而不是 USB 控制台端口中。

. 将控制器模块完全推入系统中，确保凸轮把手离开 USB 闪存驱动器，用力推动凸轮把手以完成控制器模块的就位，将凸轮把手推至关闭位置，然后拧紧翼形螺钉。
+
一旦节点完全安装到机箱中，它就会开始启动。

. 在出现 `Starboot 时按 Ctrl-C 中断启动过程以在 LOADER 提示符处停止。按 Ctrl-C 中止 ...`
+
如果您未收到此消息，请按 Ctrl-C ，选择选项以启动到维护模式，然后 `halt` 节点以启动到加载程序。

. 尽管环境变量和 bootarg 已保留，但您应使用 `printenv _bootarg name_` 命令检查是否已为您的系统类型和配置正确设置了所有必需的启动环境变量和 bootarg ，并使用 `setenv _variable-name <value>_` 命令更正任何错误。
+
.. 检查启动环境变量：
+
*** `bootarg.init.boot_clustered`
*** `partner-sysid`
*** `bootarg.init.flash_optimized` ，适用于 AFF C190
*** `bootarg.init.switchless_cluster.enable`


.. 如果已启用外部密钥管理器，请检查 `kenv` ASUP 输出中列出的 bootarg 值：
+
*** `bootarg.storageencryption.support <value>`
*** `bootarg.keymanager.support <value>`
*** `kmip.init.interface <value>`
*** `kmip.init.ipaddr <value>`
*** `kmip.init.netmask <value>`
*** `kmip.init.gateway <value>`


.. 如果启用了板载密钥管理器，请检查 `kenv` ASUP 输出中列出的 bootarg 值：
+
*** `bootarg.storageencryption.support <value>`
*** `bootarg.keymanager.support <value>`
*** `bootarg.bontery_keymanager <value>`


.. 保存使用 ` * savenv*` 命令更改的环境变量
.. 使用 ` * printenv _variable-name_*` 命令确认所做的更改。


. 启动恢复映像：
+
` * 启动恢复 __ontap_image_name__.tgz*`

+

NOTE: 如果 `image.tgz` 文件的名称不是 image.tgz ，例如 `boot_recovery 9_4.tgz` ，则需要在 `boot_recovery` 命令中包含不同的文件名。

+
系统将启动到启动菜单，并提示您输入启动映像名称。

. 输入 USB 闪存驱动器上的启动映像名称：
+
` * _ 映像名称 _ .tgz*`

+
安装 `image_name.tgz` 后，系统会提示您从运行状况良好的节点还原备份配置（ `var` 文件系统）。

. 还原 `var` 文件系统：
+
[cols="1,2"]
|===
| 如果您的系统 ... | 那么 ... 


 a| 
网络连接
 a| 
.. 当系统提示您还原备份配置时，按 ` * y*` 。
.. 将运行状况良好的节点设置为高级权限级别：
+
` * 设置 -privilege advanced*`

.. 运行 restore backup 命令：
+
` * 系统节点还原备份 -node local -target-address _impaired_node_ip_address_*`

.. 将节点恢复为管理员级别：
+
` * 设置 -privilege admin*`

.. 当系统提示您使用已还原的配置时，按 ` * y*` 。
.. 当系统提示重新启动节点时，按 ` * y*` 。




 a| 
无网络连接
 a| 
.. 当系统提示您还原备份配置时，按 ` * n*` 。
.. 系统提示时重新启动系统。
.. 从显示的菜单中选择 * 从备份配置更新闪存 * （同步闪存）选项。
+
如果系统提示您继续更新，请按 ` * y*` 。



|===
. 验证环境变量是否按预期设置。
+
.. 使节点显示 LOADER 提示符。
+
在 ONTAP 提示符处，您可以对命令 `ssystem node halt -skip-lif-migration-before-shutdown true -ignore-quorum-warnings true -inhibit-takeover true` 执行问题描述。

.. 使用 `printenv` 命令检查环境变量设置。
.. 如果未按预期设置环境变量，请使用 `setenv _environment_variable_name changed_value_` 命令对其进行修改。
.. 使用 `saveenv` 命令保存所做的更改。
.. 重新启动节点。


. 下一步取决于您的系统配置：
+
[cols="1,2"]
|===
| 如果您的系统位于 ... | 那么 ... 


 a| 
一种独立配置
 a| 
您可以在节点重新启动后开始使用系统。



 a| 
HA 对
 a| 
受损节点显示 `Waiting for Giveback...` 消息后，从运行正常的节点执行交还：

.. 从运行正常的节点执行交还：
+
` * 存储故障转移交还 -ofnode _partner_node_name_*`

+
这将启动将受损节点聚合和卷的所有权从运行状况良好的节点交还给受损节点的过程。

+
[NOTE]
====
如果交还被否决，您可以考虑覆盖此否决。

http://docs.netapp.com/ontap-9/topic/com.netapp.doc.dot-cm-hacg/home.html["《 ONTAP 9 高可用性配置指南》"]

====
.. 使用 `storage failover show-giveback` 命令监控交还操作的进度。
.. 交还操作完成后，使用 `storage failover show` 命令确认 HA 对运行状况良好，并且可以进行接管。
.. 如果您使用 `storage failover modify` 命令禁用了自动交还，请将其还原。


|===

