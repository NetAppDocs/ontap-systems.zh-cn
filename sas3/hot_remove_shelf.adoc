---
permalink: sas3/hot-remove-shelf.html 
sidebar: sidebar 
keywords: hot-remove, disk, shelf, iom12, module, nondisruptive, module-nondisruptively, system, power, serving, data, i/o, progress, hot-remove, stack, shelves, hot-remove a disk shelf with iom12 modules, DS460C, transport DS460C, move DS460C, remove drives from DS460C, DS460C drive handling, iom12b 
summary: 您可以在需要移动或更换磁盘架时热移除带有 IOM12 模块的磁盘架（无中断地从已启动且正在执行 I/O 的系统中移除磁盘架）。您可以从磁盘架堆栈中的任意位置热删除一个或多个磁盘架，也可以删除磁盘架堆栈。 
---
= 热移除磁盘架—带有IOM12/IOM12B模块的磁盘架
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
您可以在需要移动或更换磁盘架时热移除带有IOM12/IOM12B模块的磁盘架(无中断地从已启动且正在执行I/O的系统中移除磁盘架)。您可以从磁盘架堆栈中的任意位置热删除一个或多个磁盘架，也可以删除磁盘架堆栈。

.开始之前
* 您的系统必须采用多路径 HA ，多路径，四路径 HA 或四路径配置。
+
对于具有板载存储的平台、例如AFF A200、AFF A220、FAS2600系列和FAS2700系统、外部存储必须采用多路径HA或多路径的形式进行布线。

+

NOTE: 对于使用多路径连接对外部存储进行布线的 FAS2600 系列单控制器系统，该系统为混合路径配置，因为内部存储使用单路径连接。

* 您的系统不能显示任何 SAS 布线错误消息。
+
您可以下载并运行 Active IQ Config Advisor 以查看任何 SAS 布线错误消息以及应采取的更正操作。

+
https://["NetApp 下载： Config Advisor"]

* HA 对配置不能处于接管状态。
* 您必须已从要移除的磁盘架中的磁盘驱动器（磁盘驱动器必须为备用磁盘）中删除所有聚合。
+

NOTE: 如果尝试使用要删除的磁盘架上的聚合执行此操作步骤，则可能会使系统出现故障，并出现多磁盘崩溃。

+
您可以使用 `storage aggregate offline -aggregate _aggregate_name_` 命令，然后使用 `storage aggregate delete -aggregate _aggregate_name_` 命令。

* 如果要从堆栈中移除一个或多个磁盘架，则必须考虑距离因素，以绕过要移除的磁盘架；因此，如果当前缆线不够长，则需要提供更长的缆线。


.关于此任务
* * 最佳实践： * 最佳实践是，从要删除的磁盘架中的磁盘驱动器中删除聚合后，删除磁盘驱动器所有权。
+
通过从备用磁盘驱动器中删除所有权信息，可以根据需要将该磁盘驱动器正确集成到另一个节点中。



[NOTE]
====
用于从磁盘驱动器中删除所有权的操作步骤要求您禁用磁盘所有权自动分配。您可以在此操作步骤末尾重新启用磁盘所有权自动分配。

https://["磁盘和聚合概述"]

====
* 对于双节点以上的集群模式 ONTAP 系统，最佳实践是将 epsilon 重新分配给正在进行计划内维护的 HA 对以外的 HA 对。
+
Reassigning epsilon minimizes the risk of unforeseen errors impacting all nodes in a clustered ONTAP system.您可以使用以下步骤确定持有 epsilon 的节点，并根据需要重新分配 epsilon ：

+
.. 将权限级别设置为 advanced ： `set -privilege advanced`
.. 确定哪个节点持有 epsilon ： `cluster show`
+
持有 epsilon 的节点在 `epsilon` 列中显示 `true` 。（不持有 epsilon 的节点会显示 `false` 。）

.. 如果 HA 对中正在进行维护的节点显示 `true` （持有 epsilon ），则从节点中删除 epsilon ： `cluster modify -node _node_name_ -epsilon false`
.. 将 epsilon 分配给另一个 HA 对中的节点： `cluster modify -node _node_name_ -epsilon true`
.. 返回到管理权限级别： `set -privilege admin`


* 如果要从堆栈热移除磁盘架（但保留堆栈），则一次可重新布线并验证一个路径（路径 A ，路径 B ），以绕过要移除的磁盘架，从而始终保持控制器与堆栈的单路径连接。
+

NOTE: 如果在为堆栈重新布线以绕过要移除的磁盘架时，不保持从控制器到堆栈的单路径连接，则可能会导致系统出现多磁盘崩溃。

* *可能的磁盘架损坏：*如果要卸下DS460C磁盘架、而要将其移至数据中心的其他部分或将其运送到其他位置、请参见一节。 <<移动或传输DS460C磁盘架>> 此操作步骤 的末尾。


.步骤
. 验证您的系统配置是否为 `Multi-Path HA` ， `Multi-Path` ， `四路径 HA` 或 `Quad-path` ： `ssysconfig`
+
您可以从任一控制器的 nodeshell 运行此命令。系统可能需要长达一分钟才能完成发现。

+
此配置将在 `SSystem Storage Configuration` 字段中列出。

+

NOTE: 对于使用多路径连接连接连接外部存储的 FAS2600 系列单控制器系统，输出将显示为 `mied-path` ，因为内部存储使用单路径连接。

. 验证要删除的磁盘架中的磁盘驱动器没有聚合（备用），并且所有权已删除：
+
.. 在任一控制器的 clustershell 中输入以下命令： `storage disk show -shelf _shelf_number_`
.. 检查输出以确认待移除磁盘架中的磁盘驱动器上没有聚合。
+
没有聚合的磁盘驱动器在 `Container Name` 列中有一个短划线。

.. 检查输出以验证是否已从要移除的磁盘架上的磁盘驱动器中删除所有权。
+
无所有权的磁盘驱动器在 `owner` 列中有一个短划线。

+

NOTE: 如果要移除的磁盘架中有故障磁盘驱动器，则这些驱动器已在 `Container Type` 列中损坏。（故障磁盘驱动器没有所有权。）

+
以下输出显示了要移除的磁盘架（磁盘架 3 ）上的磁盘驱动器处于正确状态，可用于移除磁盘架。所有磁盘驱动器上的聚合都会被删除；因此，每个磁盘驱动器的 `Container Name` 列会显示一个短划线。所有磁盘驱动器上的所有权也会被删除；因此，每个磁盘驱动器的 `owner` 列会显示一个短划线。



+
[listing]
----
cluster::> storage disk show -shelf 3

           Usable           Disk   Container   Container
Disk         Size Shelf Bay Type   Type        Name       Owner
-------- -------- ----- --- ------ ----------- ---------- ---------
...
1.3.4           -     3   4 SAS    spare                -         -
1.3.5           -     3   5 SAS    spare                -         -
1.3.6           -     3   6 SAS    broken               -         -
1.3.7           -     3   7 SAS    spare                -         -
...
----
. 以物理方式找到要移除的磁盘架。
+
如果需要，您可以打开磁盘架的位置（蓝色） LED ，以帮助以物理方式定位受影响的磁盘架： `storage shelf location-led modify -shelf-name _shelf_name_ -led-status on`

+

NOTE: 磁盘架具有三个位置 LED ：一个位于操作员显示面板上，一个位于每个 IOM12 模块上。定位 LED 保持亮起 30 分钟。您可以通过输入相同的命令并使用 off 选项来将其关闭。

. 如果要删除整个磁盘架堆栈，请完成以下子步骤；否则，请转至下一步：
+
.. 拔下路径 A （ IOM A ）和路径 B （ IOM B ）上的所有 SAS 缆线。
+
这包括用于待移除堆栈中所有磁盘架的控制器到磁盘架缆线和磁盘架到磁盘架缆线。

.. 转至步骤 9. 。


. 如果要从堆栈中删除一个或多个磁盘架（但要保留堆栈），请通过完成一组适用的子步骤对路径 A （ IOM A ）堆栈连接进行重新布线，以绕过要删除的磁盘架：
+
如果要在堆栈中删除多个磁盘架，请一次完成一个磁盘架的一组适用子步骤。

+

NOTE: 请至少等待 10 秒，然后再连接端口。SAS 缆线连接器具有方向性；正确连接到 SAS 端口时，连接器会卡入到位，磁盘架 SAS 端口 LNK LED 会呈绿色亮起。对于磁盘架，您可以插入 SAS 缆线连接器，拉片朝下（位于连接器的下侧）。

+
[cols="2*"]
|===
| 如果要删除 ... | 那么 ... 


 a| 
堆栈任一端的磁盘架（逻辑第一个或最后一个磁盘架）
 a| 
.. 从要移除的磁盘架上的 IOM A 端口中移除所有磁盘架到磁盘架的布线，并将其放在一旁。
.. 拔下连接到待移除磁盘架上的 IOM A 端口的所有控制器到堆栈布线，并将其插入堆栈中下一个磁盘架上的相同 IOM A 端口。
+
"`next` " 磁盘架可以位于要移除的磁盘架上方或下方，具体取决于要从中移除磁盘架的堆栈的一端。





 a| 
堆栈中间的磁盘架堆栈中间的磁盘架只连接到其他磁盘架，而不连接到任何控制器。
 a| 
.. 从要移除的磁盘架上的 IOM A 端口 1 和 2 或端口 3 和 4 以及下一个磁盘架的 IOM A 中移除所有磁盘架到磁盘架的布线，然后将其放在一旁。
.. 拔下连接到待移除磁盘架上的 IOM A 端口的其余磁盘架到磁盘架布线，然后将其插入堆栈中下一个磁盘架上的相同 IOM A 端口。"`next` " 磁盘架可以位于要移除的磁盘架上方或下方，具体取决于您从中移除布线的 IOM A 端口（ 1 和 2 或 3 和 4 ）。


|===
+
从堆栈的一端或中间卸下磁盘架时，可以参考以下布线示例。请注意以下布线示例：

+
** IOM12 模块是按 DS224C 或 DS212C 磁盘架中的方式并排排列的；如果您使用的是 DS460C ，则 IOM12 模块排列在另一个之上。
** 每个示例中的堆栈都使用标准磁盘架到磁盘架布线进行布线，该布线用于使用多路径 HA 或多路径连接进行布线的堆栈。
+
如果堆栈使用四路径 HA 或四路径连接进行布线，则可以推断重新布线，这种连接使用双宽磁盘架到磁盘架的布线。

** 布线示例显示了如何为路径 A （ IOM A ）重新布线。
+
对路径 B （ IOM B ）重复重新布线。

** 从堆栈末端删除磁盘架的布线示例显示了如何删除使用多路径 HA 连接进行布线的堆栈中最后一个逻辑磁盘架。
+
如果要移除堆栈中第一个逻辑磁盘架，或者堆栈具有多路径连接，则可以推断重新布线。

+
image::../media/drw_hotremove_end.gif[DRW 热删除结束]

+
image::../media/drw_hotremove_middle.gif[DRW 热删除中间]



. 确认您绕过了要移除的磁盘架，并正确重新建立路径 A （ IOM A ）堆栈连接： `storage disk show -port`
+
对于 HA 对配置，您可以从任一控制器的 clustershell 运行此命令。系统可能需要长达一分钟才能完成发现。

+
输出的前两行显示通过路径 A 和路径 B 连接的磁盘驱动器最后两行输出显示了通过单路径路径路径 B 进行连接的磁盘驱动器

+
[listing]
----
cluster::> storage show disk -port

PRIMARY  PORT SECONDARY      PORT TYPE SHELF BAY
-------- ---- ---------      ---- ---- ----- ---
1.20.0   A    node1:6a.20.0  B    SAS  20    0
1.20.1   A    node1:6a.20.1  B    SAS  20    1
1.21.0   B    -              -    SAS  21    0
1.21.1   B    -              -    SAS  21    1
...
----
. 下一步取决于 `storage disk show -port` 命令输出：
+
[cols="2*"]
|===
| 如果输出显示 ... | 那么 ... 


 a| 
堆栈中的所有磁盘驱动器均通过路径 A 和路径 B 连接，但您断开连接的磁盘架中的磁盘驱动器除外，这些磁盘驱动器仅通过路径 B 连接
 a| 
转至下一步。

您已成功绕过要移除的磁盘架，并在堆栈中的其余磁盘驱动器上重新建立路径 A 。



 a| 
除上述内容外的任何其他内容
 a| 
重复步骤 5 和步骤 6 。

您必须更正布线。

|===
. 对要移除的磁盘架（在堆栈中）完成以下子步骤：
+
.. 对路径 B 重复步骤 5 到步骤 7
+

NOTE: 重复步骤 7 ，如果已正确重新为堆栈布线，则只能看到通过路径 A 和路径 B 连接的所有剩余磁盘驱动器

.. 重复步骤 1 ，确认您的系统配置与从堆栈中删除一个或多个磁盘架之前的配置相同。
.. 转至下一步。


. 如果在准备此操作步骤时从磁盘驱动器中删除了所有权，但禁用了磁盘所有权自动分配，请输入以下命令重新启用此功能；否则，请转至下一步： `storage disk option modify -autodassign on`
+
对于 HA 对配置，您可以从两个控制器的 clustershell 运行命令。

. 关闭已断开连接的磁盘架，并从磁盘架拔下电源线。
. 从机架或机柜中卸下磁盘架。
+
为了减轻磁盘架重量并便于操作，请卸下电源和 I/O 模块（ IOM ）。

+
对于DS460C磁盘架、满载的磁盘架的重量约为247磅(112千克)；因此、从机架或机柜中卸下磁盘架时、请务必小心谨慎。

+

CAUTION: 建议您使用一个机械升降机或四个人使用升降机把手来安全移动DS460C磁盘架。

+
您的DS460C发货随附了四个可拆卸的升降把手(每侧两个)。要使用提升把手、请将把手的卡舌插入磁盘架侧面的插槽并向上推、直到其卡入到位、以安装提升把手。然后、在将磁盘架滑入导轨时、一次使用拇指闩锁断开一组手柄。下图显示了如何连接提升把手。

+
image::../media/drw_ds460c_handles.gif[DRW ds460c 句柄]

+
如果要将DS460C磁盘架移动到数据中心的其他部分或将其传输到其他位置、请参见下一节。 <<移动或传输DS460C磁盘架>>。



.移动或传输DS460C磁盘架
如果将DS460C磁盘架移动到数据中心的其他部分或将磁盘架传输到其他位置、则需要从驱动器抽盒中卸下驱动器、以避免可能损坏驱动器抽盒和驱动器。

* 如果您在新系统安装或磁盘架热添加过程中安装了DS460C磁盘架、则保存了驱动器包装材料、请在移动驱动器之前使用这些材料重新打包驱动器。
+
如果未保存包装材料、则应将驱动器放在缓冲表面上或使用备用缓冲包装。切勿将驱动器堆栈在彼此之上。

* 在处理驱动器之前、请佩戴ESD腕带、该腕带接地到存储机箱上未上漆的表面。
+
如果没有腕带、请先触摸存储机箱机箱上未上漆的表面、然后再处理驱动器。

* 您应采取措施小心处理驱动器：
+
** 在拆卸、安装或搬运驱动器以支撑其重量时、请始终用双手。
+

CAUTION: 请勿将手放在驱动器托架下侧暴露的驱动器板上。

** 请注意、不要将驱动器撞到其他表面。
** 驱动器应远离磁性设备。
+

CAUTION: 磁场可能会破坏驱动器上的所有数据、并且发生原因 会对驱动器电路造成不可修复的损坏。




