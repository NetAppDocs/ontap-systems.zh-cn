---
permalink: afx-1k/system-management-replace.html 
sidebar: sidebar 
keywords: afx 1k, replace the system manager module 
summary: 当 AFX 1K 存储系统中的系统管理模块出现故障或其固件损坏时，请更换它。更换过程包括关闭控制器、更换发生故障的系统管理模块、重新启动控制器、更新许可证密钥以及将发生故障的部件返回给NetApp。 
---
= 更换系统管理模块 - AFX 1K
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
当 AFX 1K 存储系统中的系统管理模块出现故障或其固件损坏时，请更换它。更换过程包括关闭控制器、更换发生故障的系统管理模块、重新启动控制器、更新许可证密钥以及将发生故障的部件返回给NetApp。

系统管理模块位于控制器背面第 8 个插槽的左侧，包含用于系统管理的板载组件以及用于外部管理的端口。必须关闭目标控制器并断电才能更换损坏的系统管理模块或更换启动介质。

系统管理模块具有以下板载组件：

* 启动介质、无需卸下控制器模块即可更换启动介质。
* BMC
* 管理交换机


系统管理模块还包含以下用于外部管理的端口：

* RJ45串行
* USB串行(C型)
* USB Type-A (启动恢复)
* 用于 e0M 和BMC网络访问的 RJ45 以太网服务端口


.开始之前
* 确保所有其他系统组件均正常工作。
* 确保配对控制器能够接管受损控制器。
* 请确保将故障组件更换为从NetApp收到的更换组件。


.关于此任务
此操作步骤使用以下术语：

* 受损控制器是指要在其中执行维护的控制器。
* 运行正常的控制器是受损控制器的 HA 配对控制器。




== 第 1 步：关闭受损控制器

关闭或接管受损控制器。

要关闭受损控制器，您必须确定控制器的状态，并在必要时执行控制器的存储故障转移接管，以便健康的控制器继续从受损控制器存储提供数据。

.关于此任务
* 如果您的集群具有四个以上的节点，则它必须达到法定人数。要查看有关节点的集群信息，请使用 `cluster show`命令。有关 `cluster show`命令，请参阅link:https://docs.netapp.com/us-en/ontap/system-admin/display-nodes-cluster-task.html["查看ONTAP集群中的节点级详细信息"^]。
* 如果集群不处于法定人数，或者任何控制器（受损控制器除外）的健康状况或资格显示为错误，则必须在关闭受损控制器之前纠正该问题。看link:https://docs.netapp.com/us-en/ontap/system-admin/synchronize-node-cluster-task.html?q=Quorum["将节点与集群同步"^] 。


.步骤
. 如果启用了AutoSupport 、则通过调用AutoSupport 消息禁止自动创建案例：
+
`system node autosupport invoke -node * -type all -message MAINT=<# of hours>h`

+
以下AutoSupport 消息禁止自动创建案例两小时：

+
`cluster1:> system node autosupport invoke -node * -type all -message MAINT=2h`

. 从受损控制器的控制台禁用自动交还：
+
`storage failover modify -node impaired-node -auto-giveback-of false`

+

NOTE: 当您看到“您想禁用自动回馈吗？”时，请输入 `y`。

+
.. 如果您运行的是ONTAP版本 9.17.1，并且受损控制器无法启动或已被接管，则必须先从正常控制器断开 HA 互连链路，然后再启动受损控制器。这可以防止受损控制器执行自动交还。
+
`system ha interconnect link off -node healthy-node -link 0`

+
`system ha interconnect link off -node healthy-node -link 1`

+

NOTE: 如果您运行的不是ONTAP版本 9.17.1，请跳过上述步骤并转到步骤 3。



. 将受损控制器显示为 LOADER 提示符：
+
[cols="1,2"]
|===
| 如果受损控制器显示 ... | 那么 ... 


 a| 
LOADER 提示符
 a| 
转至下一步。



 a| 
系统提示符或密码提示符
 a| 
从健康控制器接管或停止受损控制器：
`storage failover takeover -ofnode _impaired_node_name_ -halt _true_`

_-halt true_ 参数将受损节点带入 LOADER 提示符。

|===




== 第2步：更换受损的系统管理模块

更换受损的系统管理模块。

. 删除系统管理模块：
+

NOTE: 确保NVRAM已完成减载、然后再继续。当NV模块上的LED熄灭时、NVRAM将被解除。如果LED闪烁、请等待闪烁停止。如果闪烁持续时间超过5分钟、请联系技术支持以获得帮助。

+
image::../media/drw_a1k_sys-mgmt_remove_ieops-1384.svg[更换系统管理模块]

+
[cols="1,4"]
|===


 a| 
image::../media/icon_round_1.png[标注编号1]
 a| 
系统管理模块凸轮闩锁

|===
+
.. 如果您尚未接地，请正确接地。
.. 从 PSU 上拔下电源线。
.. 移除连接到系统管理模块的所有电缆。标记电缆连接的位置，以便重新安装模块时可以将它们重新连接到正确的端口。
.. 向下旋转缆线管理托架、方法是拉动缆线管理托架内侧两侧的按钮、然后向下旋转托架。
.. 按下系统管理模块上的凸轮按钮。
.. 将凸轮杆向下旋转至最远位置。
.. 将手指环入凸轮杆上的孔中、然后将模块直接拉出系统。
.. 将系统管理模块放在防静电垫上以访问启动介质。


. 将启动介质移至替代系统管理模块：
+
image::../media/drw_a1k_boot_media_remove_replace_ieops-1377.svg[启动介质更换]

+
[cols="1,4"]
|===


 a| 
image::../media/icon_round_1.png[标注编号1]
 a| 
系统管理模块凸轮闩锁



 a| 
image::../media/icon_round_2.png[标注编号2]
 a| 
启动介质锁定按钮



 a| 
image::../media/icon_round_3.png[标注编号3]
 a| 
启动介质

|===
+
.. 按下受损系统管理模块中的蓝色启动介质锁定按钮。
.. 向上旋转启动介质并将其滑出插槽。


. 在替代系统管理模块中安装启动介质：
+
.. 将启动介质的边缘与插槽外壳对齐，然后将其轻轻直推入插槽。
.. 向下旋转行李箱介质、直至其接触到锁定按钮。
.. 按下蓝色锁定按钮、将行李箱介质一直向下旋转、然后松开蓝色锁定按钮。


. 将更换用的系统管理模块安装到机柜中：
+
.. 将更换用的系统管理模块的边缘与系统开口对齐、然后将其轻轻推入控制器模块。
.. 将模块轻轻滑入插槽、直到凸轮闩锁开始与I/O凸轮销啮合、然后一直向上旋转凸轮闩锁以将模块锁定到位。


. 将缆线管理ARM向上旋转到关闭位置。
. 重新对系统管理模块进行配置。




== 第3步：重新启动控制器模块

重新启动控制器模块。

. 将电源线重新插入 PSU。
+
系统重新启动，通常进入 LOADER 提示符。

. 在加载程序提示符处输入_BYE_。
. 当控制台消息停止时、按<enter>。
+
** 如果您看到_login_提示，请转到下一步。
** 如果您没有看到登录提示，请登录合作伙伴节点。


. 仅返回具有 override-destination-checks 选项的根：
+
`storage failover giveback -ofnode impaired-node -only-root true -override -destination-checks true`

+

NOTE: 以下命令仅在诊断模式权限级别下可用。有关权限级别的更多信息，请参阅link:https://docs.netapp.com/us-en/ontap/system-admin/administrative-privilege-levels-concept.html["了解ONTAP CLI 命令的权限级别"^]。

+
如果遇到错误，请联系 https://support.netapp.com["NetApp 支持"]。

. 等待交还报告完成后 5 分钟，然后检查故障转移和交还状态：
+
`storage failover show`和 `storage failover show-giveback`

+

NOTE: 以下命令仅在诊断模式权限级别下可用。

. 如果 HA 互连链路已断开，请将其恢复：
+
`system ha interconnect link on -node healthy-node -link 0`

+
`system ha interconnect link on -node healthy-node -link 1`

. 通过交还存储使受损控制器恢复正常运行：
+
`storage failover giveback -ofnode _impaired_node_name_`

. 如果自动交还功能已禁用，请重新启用它： `storage failover modify -node local -auto-giveback-of true` 。
. 如果启用了AutoSupport，则还原/取消禁止自动创建案例： `system node autosupport invoke -node * -type all -message MAINT=END`。




== 第4步：安装许可证并注册序列号

更换系统管理模块时，控制器的系统序列号 (SSN) 会发生变化。如果受损节点使用需要标准（节点锁定）许可证的ONTAP功能，则必须为该节点安装新许可证。对于具有标准许可证的功能，集群中的每个节点都应具有该功能的自己的密钥。

.关于此任务
在安装许可证密钥之前、需要标准许可证的功能仍可供节点使用。但是、如果此节点是集群中唯一具有此功能许可证的节点、则不允许对此功能进行配置更改。此外、在节点上使用未经许可的功能可能会使您违反许可协议、因此您应尽快在上为此节点安装替代许可证密钥。

.开始之前
需要新系统序列号的NetApp许可证文件 (NLF)。有关NetApp许可证文件的更多信息，请参阅link:https://kb.netapp.com/on-prem/ontap/Ontap_OS/OS-KBs/ONTAP_9.10.1_and_later_licensing_overview["ONTAP 9.10.1 及更高版本许可概述"^]。

您有 90 天的时间来安装许可证密钥，之后所有旧许可证都将失效。安装有效的许可证密钥后，您有 24 小时的时间在宽限期结束前安装所有密钥。


NOTE: 如果您的系统最初运行的是ONTAP 9.15.1 或更高版本，请使用link:https://kb.netapp.com/on-prem/ontap/OHW/OHW-KBs/Post_Motherboard_Replacement_Process_to_update_Licensing_on_a_AFF_FAS_system["主板更换后流程、用于更新AFF/FAS系统上的许可"^]。如果您不确定系统的初始ONTAP版本，请参阅link:https://hwu.netapp.com["NetApp Hardware Universe"^]了解更多信息。

.步骤
. 如果需要新的许可证密钥，请在上获取替代许可证密钥 https://mysupport.netapp.com/site/global/dashboard["NetApp 支持站点"] 在软件许可证下的我的支持部分中。
+

NOTE: 系统会自动生成所需的新许可证密钥，并将其发送到文件中的电子邮件地址。如果您未能在 30 天内收到包含许可证密钥的电子邮件，应联系技术支持。

. 通过ONTAP系统管理器安装每个许可证密钥。
+
有关更多信息，请参阅link:https://docs.netapp.com/us-en/ontap/task_admin_enable_new_features.html["使用ONTAP System Manager 添加许可证密钥来启用新功能"^] 。

. 如果需要，删除旧许可证：
+
.. 检查未使用的许可证： `license clean-up -unused -simulate`
.. 如果列表显示正确，请删除未使用的许可证： `license clean-up -unused`


. 向 NetApp 支持部门注册系统序列号。
+
** 如果启用了 AutoSupport ，请发送 AutoSupport 消息以注册序列号。
** 如果未启用 AutoSupport ，请调用 https://mysupport.netapp.com["NetApp 支持"] 注册序列号。






== 第 5 步：将故障部件退回 NetApp

按照套件随附的 RMA 说明将故障部件退回 NetApp 。 https://mysupport.netapp.com/site/info/rma["部件退回和更换"]有关详细信息、请参见页面。
